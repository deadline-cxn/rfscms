<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>RFSCMSAPIDocumentation: memes.php Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">RFSCMSAPIDocumentation
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('memes_8php.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">memes.php</div>  </div>
</div><!--header-->
<div class="contents">
<a href="memes_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?
<a name="l00002"></a><a class="code" href="memes_8php.html#a4f1246057441cf06b8f4c6bbf00e17c0">00002</a> <a class="code" href="memes_8php.html#a4f1246057441cf06b8f4c6bbf00e17c0">$meme_thumbwidth</a>=200;
<a name="l00003"></a><a class="code" href="memes_8php.html#af2634960614a91be62b248e369cd0113">00003</a> <a class="code" href="memes_8php.html#af2634960614a91be62b248e369cd0113">$meme_editwidth</a>=256;
<a name="l00004"></a><a class="code" href="memes_8php.html#a68275239561953622e8a0cbe1d88962b">00004</a> <a class="code" href="memes_8php.html#a68275239561953622e8a0cbe1d88962b">$meme_fullsize</a>=512;
<a name="l00005"></a>00005 
<a name="l00006"></a>00006 <span class="keywordflow">if</span>($_REQUEST[<span class="charliteral">&#39;a&#39;</span>]==<span class="stringliteral">&quot;ms&quot;</span>) {
<a name="l00007"></a>00007     $mid=$_REQUEST[<span class="stringliteral">&#39;mid&#39;</span>];
<a name="l00008"></a>00008     echo <span class="stringliteral">&quot;&lt;img src=\&quot;$RFS_SITE_URL/include/generate.image.php/?download_it_$mid.png&amp;mid=$mid&amp;owidth=$meme_fullsize\&quot; border=0&gt;&lt;/a&gt;&quot;</span>;
<a name="l00009"></a>00009     exit();
<a name="l00010"></a>00010 }
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 chdir(<span class="stringliteral">&quot;../../&quot;</span>);
<a name="l00013"></a>00013 include(<span class="stringliteral">&quot;header.php&quot;</span>);
<a name="l00014"></a>00014 <span class="comment"></span>
<a name="l00015"></a>00015 <span class="comment">/////////////////////////////////////////////////////////////////////////////////</span>
<a name="l00016"></a>00016 <span class="comment"></span><span class="comment">// New meme</span>
<a name="l00017"></a><a class="code" href="memes_8php.html#add85fc873683fffac26fcf9e69864095">00017</a> <span class="keyword">function</span> <a class="code" href="memes_8php.html#add85fc873683fffac26fcf9e69864095">memes_action_new_meme</a>() { eval(<a class="code" href="lib_8rfs_8php.html#acffda4746c06a226d1b11dca941bcfe1">lib_rfs_get_globals</a>());
<a name="l00018"></a>00018     echo <span class="stringliteral">&quot;&lt;p&gt;Select a file to use for the caption.&lt;/p&gt;\n&quot;</span>;
<a name="l00019"></a>00019     echo <span class="stringliteral">&quot;&lt;form  enctype=\&quot;multipart/form-data\&quot; action=\&quot;$RFS_SITE_URL/modules/memes/memes.php\&quot; method=\&quot;post\&quot;&gt;\n&quot;</span>;
<a name="l00020"></a>00020     echo <span class="stringliteral">&quot;&lt;table border=0&gt;\n&quot;</span>;
<a name="l00021"></a>00021     echo <span class="stringliteral">&quot;&lt;input type=hidden name=action value=new_meme_go&gt;\n&quot;</span>;
<a name="l00022"></a>00022     echo <span class="stringliteral">&quot;&lt;input type=\&quot;hidden\&quot; name=\&quot;MAX_FILE_SIZE\&quot; value=\&quot;93000000\&quot;&gt;&quot;</span>;
<a name="l00023"></a>00023     echo <span class="stringliteral">&quot;&lt;tr&gt;&lt;td align=right&gt;Select file:      &lt;/td&gt;&lt;td &gt;&lt;input name=\&quot;userfile\&quot; type=\&quot;file\&quot; size=80&gt; &lt;/td&gt;&lt;/tr&gt;\n&quot;</span>;
<a name="l00024"></a>00024     echo <span class="stringliteral">&quot;&lt;tr&gt;&lt;td align=right&gt;Safe for work:    &lt;/td&gt;&lt;td&gt;&lt;select name=sfw&gt;&lt;option&gt;yes&lt;option&gt;no&lt;/select&gt;&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>;
<a name="l00025"></a>00025     echo <span class="stringliteral">&quot;&lt;tr&gt;&lt;td align=right&gt;Hide from public: &lt;/td&gt;&lt;td&gt;&lt;select name=hidden&gt;&lt;option&gt;no&lt;option&gt;yes&lt;/select&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span>;
<a name="l00026"></a>00026     echo <span class="stringliteral">&quot;&lt;input type=hidden name=category value=Meme&gt;&quot;</span>;
<a name="l00027"></a>00027     echo <span class="stringliteral">&quot;&lt;input type=hidden name=hidden value=no&gt;&quot;</span>;
<a name="l00028"></a>00028     echo <span class="stringliteral">&quot;&lt;tr&gt;&lt;td align=right&gt;Short name :&lt;/td&gt;&lt;td&gt;&lt;input type=textbox name=sname value=\&quot;$name\&quot;&gt;&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>;
<a name="l00029"></a>00029     echo <span class="stringliteral">&quot;&lt;tr&gt;&lt;td align=right valign=top&gt;Description:&lt;/td&gt;&lt;td&gt;&lt;textarea name=\&quot;desc\&quot; rows=\&quot;7\&quot; cols=\&quot;40\&quot;&gt;&lt;/textarea&gt;&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>;
<a name="l00030"></a>00030     echo <span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;td&gt;&lt;input type=\&quot;submit\&quot; name=\&quot;submit\&quot; value=\&quot;Upload!\&quot;&gt;&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>;
<a name="l00031"></a>00031     echo <span class="stringliteral">&quot;&lt;/table&gt;\n&quot;</span>;
<a name="l00032"></a>00032     echo <span class="stringliteral">&quot;&lt;/form&gt;\n&quot;</span>;
<a name="l00033"></a>00033     include(<span class="stringliteral">&quot;footer.php&quot;</span>);
<a name="l00034"></a>00034 }
<a name="l00035"></a><a class="code" href="memes_8php.html#a198bc46d74a6c6f082661fc55f1ab13d">00035</a> <span class="keyword">function</span> <a class="code" href="memes_8php.html#a198bc46d74a6c6f082661fc55f1ab13d">memes_action_new_meme_go</a>() { eval(<a class="code" href="lib_8rfs_8php.html#acffda4746c06a226d1b11dca941bcfe1">lib_rfs_get_globals</a>());
<a name="l00036"></a>00036     echo <span class="stringliteral">&quot;Uploading meme picture...\n&quot;</span>;
<a name="l00037"></a>00037     $furl=<span class="stringliteral">&quot;files/pictures/&quot;</span>.$_FILES[<span class="stringliteral">&#39;userfile&#39;</span>][<span class="stringliteral">&#39;name&#39;</span>];
<a name="l00038"></a>00038     $furl =str_replace(<span class="stringliteral">&quot;//&quot;</span>,<span class="stringliteral">&quot;/&quot;</span>,$furl);
<a name="l00039"></a>00039     <span class="keywordflow">if</span>(move_uploaded_file($_FILES[<span class="stringliteral">&#39;userfile&#39;</span>][<span class="stringliteral">&#39;tmp_name&#39;</span>], $furl))            {
<a name="l00040"></a>00040         $error=<span class="stringliteral">&quot;File is valid, and was successfully uploaded. &quot;</span>;
<a name="l00041"></a>00041         $error.=<span class="stringliteral">&quot;It was stored as [$furl]\n&quot;</span>;
<a name="l00042"></a>00042         $xp_ext = explode(<span class="stringliteral">&quot;.&quot;</span>,$_FILES[<span class="stringliteral">&#39;userfile&#39;</span>][<span class="stringliteral">&#39;name&#39;</span>],40);
<a name="l00043"></a>00043         $j = count ($xp_ext)-1;
<a name="l00044"></a>00044         $ext = <span class="stringliteral">&quot;$xp_ext[$j]&quot;</span>;
<a name="l00045"></a>00045         $filetype=strtolower($ext);
<a name="l00046"></a>00046         $filesizebytes=$_FILES[<span class="stringliteral">&#39;userfile&#39;</span>][<span class="stringliteral">&#39;size&#39;</span>];
<a name="l00047"></a>00047         $time1=date(<span class="stringliteral">&quot;Y-m-d H:i:s&quot;</span>);
<a name="l00048"></a>00048         $description=addslashes($description);
<a name="l00049"></a>00049         <span class="keywordflow">if</span>(empty(<a class="code" href="wab_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>)) <a class="code" href="wab_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>=$sname;
<a name="l00050"></a>00050         $poster=999;
<a name="l00051"></a>00051         <span class="keywordflow">if</span>(<a class="code" href="video__wall_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>-&gt;id)$poster=<a class="code" href="video__wall_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>-&gt;id;
<a name="l00052"></a>00052         <a class="code" href="lib_8mysql_8php.html#a06fb53fc71e262dce115fd3a98bcecdd">lib_mysql_query</a>(<span class="stringliteral">&quot;INSERT INTO `pictures` (`name`) VALUES(&#39;$name&#39;);&quot;</span>);
<a name="l00053"></a>00053         $id=mysql_insert_id();
<a name="l00054"></a>00054         <span class="comment">//$cid=mysql_fetch_object(lib_mysql_query(&quot;select * from categories where name = &#39;$category&#39;&quot;));</span>
<a name="l00055"></a>00055         <a class="code" href="lib_8mysql_8php.html#a06fb53fc71e262dce115fd3a98bcecdd">lib_mysql_query</a>(<span class="stringliteral">&quot;update `pictures` set `category`=&#39;$category&#39;  where `id`=&#39;$id&#39;&quot;</span>);
<a name="l00056"></a>00056         <a class="code" href="lib_8mysql_8php.html#a06fb53fc71e262dce115fd3a98bcecdd">lib_mysql_query</a>(<span class="stringliteral">&quot;update `pictures` set `sname`=&#39;$sname&#39;        where `id`=&#39;$id&#39;&quot;</span>);
<a name="l00057"></a>00057         <a class="code" href="lib_8mysql_8php.html#a06fb53fc71e262dce115fd3a98bcecdd">lib_mysql_query</a>(<span class="stringliteral">&quot;update `pictures` set `sfw`=&#39;$sfw&#39;            where `id`=&#39;$id&#39;&quot;</span>);
<a name="l00058"></a>00058         <a class="code" href="lib_8mysql_8php.html#a06fb53fc71e262dce115fd3a98bcecdd">lib_mysql_query</a>(<span class="stringliteral">&quot;update `pictures` set `hidden`=&#39;$hidden&#39;      where `id`=&#39;$id&#39;&quot;</span>);
<a name="l00059"></a>00059         <a class="code" href="lib_8mysql_8php.html#a06fb53fc71e262dce115fd3a98bcecdd">lib_mysql_query</a>(<span class="stringliteral">&quot;update `pictures` set description=&#39;$desc&#39;      where `id`=&#39;$id&#39;&quot;</span>);
<a name="l00060"></a>00060         <a class="code" href="lib_8mysql_8php.html#a06fb53fc71e262dce115fd3a98bcecdd">lib_mysql_query</a>(<span class="stringliteral">&quot;update `pictures` set poster=&#39;$poster&#39;         where `id`=&#39;$id&#39;&quot;</span>);
<a name="l00061"></a>00061         $furl=addslashes($furl);
<a name="l00062"></a>00062         <a class="code" href="lib_8mysql_8php.html#a06fb53fc71e262dce115fd3a98bcecdd">lib_mysql_query</a>(<span class="stringliteral">&quot;update `pictures` set url = &#39;$furl&#39; where `id`=&#39;$id&#39;&quot;</span>);
<a name="l00063"></a>00063         <a class="code" href="lib_8mysql_8php.html#a06fb53fc71e262dce115fd3a98bcecdd">lib_mysql_query</a>(<span class="stringliteral">&quot;update `pictures` set time = &#39;$time1&#39; where `id`=&#39;$id&#39;&quot;</span>);
<a name="l00064"></a>00064         $error.= <span class="stringliteral">&quot; ---- Added $name to database ---- &quot;</span>;
<a name="l00065"></a>00065         global $basepic;
<a name="l00066"></a>00066         $basepic=$id;
<a name="l00067"></a>00067         $error.=<span class="stringliteral">&quot; $basepic&quot;</span>;
<a name="l00068"></a>00068         <a class="code" href="install_8php.html#af9da176a74bd49cb97ea35c6ac7257bc">$action</a>=<span class="stringliteral">&quot;memegenerate&quot;</span>;
<a name="l00069"></a>00069         $mid=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00070"></a>00070         $private=$hidden;
<a name="l00071"></a>00071         <a class="code" href="lib_8forms_8php.html#ad285a3a501e01b34c5905b2d94728dd6">lib_forms_info</a>(<span class="stringliteral">&quot;Status: [$error]&quot;</span>,<span class="stringliteral">&quot;WHITE&quot;</span>,<span class="stringliteral">&quot;GREEN&quot;</span>); 
<a name="l00072"></a>00072         <a class="code" href="memes_8php.html#a22c3ee429a73e5afdb6b63adf3c86c93">memes_action_memegenerate</a>();
<a name="l00073"></a>00073     }
<a name="l00074"></a>00074     <span class="keywordflow">else</span>{
<a name="l00075"></a>00075         $error =<span class="stringliteral">&quot;File upload error!&quot;</span>;
<a name="l00076"></a>00076         echo <span class="stringliteral">&quot;File upload error! [&quot;</span>.$_FILES[<span class="stringliteral">&#39;userfile&#39;</span>][<span class="stringliteral">&#39;name&#39;</span>].<span class="stringliteral">&quot;][&quot;</span>.$_FILES[<span class="stringliteral">&#39;userfile&#39;</span>][<span class="stringliteral">&#39;error&#39;</span>].<span class="stringliteral">&quot;][&quot;</span>.$_FILES[<span class="stringliteral">&#39;userfile&#39;</span>][<span class="stringliteral">&#39;tmp_name&#39;</span>].<span class="stringliteral">&quot;][&quot;</span>.$uploadFile.<span class="stringliteral">&quot;]\n&quot;</span>;
<a name="l00077"></a>00077     }
<a name="l00078"></a>00078     
<a name="l00079"></a>00079     <span class="keywordflow">if</span>(!$error){
<a name="l00080"></a>00080         $error .= <span class="stringliteral">&quot;No files have been selected for upload&quot;</span>;
<a name="l00081"></a>00081     }
<a name="l00082"></a>00082     <a class="code" href="lib_8forms_8php.html#ad285a3a501e01b34c5905b2d94728dd6">lib_forms_info</a>(<span class="stringliteral">&quot;Status: [$error]&quot;</span>,<span class="stringliteral">&quot;WHITE&quot;</span>,<span class="stringliteral">&quot;GREEN&quot;</span>); 
<a name="l00083"></a>00083     include(<span class="stringliteral">&quot;footer.php&quot;</span>);
<a name="l00084"></a>00084 }<span class="comment"></span>
<a name="l00085"></a>00085 <span class="comment">/////////////////////////////////////////////////////////////////////////////////</span>
<a name="l00086"></a>00086 <span class="comment"></span><span class="comment">// MEME delete confirm</span>
<a name="l00087"></a><a class="code" href="memes_8php.html#a210a391f421e8922d9e9dfb823e62894">00087</a> <span class="keyword">function</span> <a class="code" href="memes_8php.html#a210a391f421e8922d9e9dfb823e62894">memes_action_meme_delete</a>() { eval(<a class="code" href="lib_8rfs_8php.html#acffda4746c06a226d1b11dca941bcfe1">lib_rfs_get_globals</a>());
<a name="l00088"></a>00088     $donotshowcats=<span class="keyword">true</span>;
<a name="l00089"></a>00089     <span class="keywordflow">if</span>(<a class="code" href="lib_8access_8php.html#af6adaf74ff6c2ded2143f472076c176a">lib_access_check</a>(<span class="stringliteral">&quot;memes&quot;</span>,<span class="stringliteral">&quot;delete&quot;</span>)){
<a name="l00090"></a>00090         $dd=<span class="stringliteral">&quot;&lt;form action=$RFS_SITE_URL/modules/memes/memes.php method=post&gt;Confirm delete meme:</span>
<a name="l00091"></a>00091 <span class="stringliteral">        &lt;input type=submit name=memedelete value=Delete&gt;</span>
<a name="l00092"></a>00092 <span class="stringliteral">        &lt;input type=hidden name=action value=meme_delete_go&gt;</span>
<a name="l00093"></a>00093 <span class="stringliteral">        &lt;input type=hidden name=mid value=$mid&gt;</span>
<a name="l00094"></a>00094 <span class="stringliteral">        &lt;/form&gt;&quot;</span>;   
<a name="l00095"></a>00095         <a class="code" href="lib_8forms_8php.html#ad285a3a501e01b34c5905b2d94728dd6">lib_forms_info</a>($dd,<span class="stringliteral">&quot;black&quot;</span>,<span class="stringliteral">&quot;red&quot;</span>);  
<a name="l00096"></a>00096         $t=<a class="code" href="sp_8php.html#a0c788ee1ad50aa3f1b2c28bb7a00db49">$m</a>-&gt;name.<span class="stringliteral">&quot;-&quot;</span>.time();<span class="comment">// /$t.png</span>
<a name="l00097"></a>00097         echo <span class="stringliteral">&quot;&lt;a href=&#39;$RFS_SITE_URL/include/generate.image.php/$t.png?mid=$m-&gt;id&amp;owidth=$meme_fullsize&#39; target=_blank&gt;</span>
<a name="l00098"></a>00098 <span class="stringliteral">        &lt;img src=&#39;$RFS_SITE_URL/include/generate.image.php/$t.png?mid=$mid&amp;owidth=256&#39; border=0&gt;&lt;/a&gt;&quot;</span>;
<a name="l00099"></a>00099     }
<a name="l00100"></a>00100     <span class="keywordflow">else</span> {
<a name="l00101"></a>00101         echo <span class="stringliteral">&quot;&lt;p&gt;You can not delete memes.&lt;/p&gt;&quot;</span>;
<a name="l00102"></a>00102     }
<a name="l00103"></a>00103 }
<a name="l00104"></a><a class="code" href="memes_8php.html#aff9f1cae87a4dc139925cf96fd2a31df">00104</a> <span class="keyword">function</span> <a class="code" href="memes_8php.html#aff9f1cae87a4dc139925cf96fd2a31df">memes_action_meme_delete_go</a>() { eval(<a class="code" href="lib_8rfs_8php.html#acffda4746c06a226d1b11dca941bcfe1">lib_rfs_get_globals</a>());
<a name="l00105"></a>00105     <span class="keywordflow">if</span>(<a class="code" href="lib_8access_8php.html#af6adaf74ff6c2ded2143f472076c176a">lib_access_check</a>(<span class="stringliteral">&quot;memes&quot;</span>,<span class="stringliteral">&quot;delete&quot;</span>)) {
<a name="l00106"></a>00106         <a class="code" href="lib_8mysql_8php.html#a06fb53fc71e262dce115fd3a98bcecdd">lib_mysql_query</a>(<span class="stringliteral">&quot;delete from meme where id=&#39;$mid&#39; limit 1&quot;</span>);
<a name="l00107"></a>00107     }
<a name="l00108"></a>00108     <a class="code" href="memes_8php.html#aefda927d28dab6028cba434fab908d29">memes_action_showmemes</a>();
<a name="l00109"></a>00109 }<span class="comment"></span>
<a name="l00110"></a>00110 <span class="comment">/////////////////////////////////////////////////////////////////////////////////</span>
<a name="l00111"></a>00111 <span class="comment"></span><span class="comment">// MEME save</span>
<a name="l00112"></a><a class="code" href="memes_8php.html#af7a2caec52cad87bd09e3beb28243005">00112</a> <span class="keyword">function</span> <a class="code" href="memes_8php.html#af7a2caec52cad87bd09e3beb28243005">memes_action_meme_save</a>() { eval(<a class="code" href="lib_8rfs_8php.html#acffda4746c06a226d1b11dca941bcfe1">lib_rfs_get_globals</a>());
<a name="l00113"></a>00113     <a class="code" href="lib_8mysql_8php.html#a06fb53fc71e262dce115fd3a98bcecdd">lib_mysql_query</a>(<span class="stringliteral">&quot;update meme set status=&#39;SAVED&#39; where id=&#39;$mid&#39;&quot;</span>);
<a name="l00114"></a>00114     <a class="code" href="lib_8forms_8php.html#ad285a3a501e01b34c5905b2d94728dd6">lib_forms_info</a>(<span class="stringliteral">&quot;SAVED!&quot;</span>,<span class="stringliteral">&quot;WHITE&quot;</span>,<span class="stringliteral">&quot;GREEN&quot;</span>);
<a name="l00115"></a>00115      <a class="code" href="memes_8php.html#aefda927d28dab6028cba434fab908d29">memes_action_showmemes</a>();    
<a name="l00116"></a>00116 }<span class="comment"></span>
<a name="l00117"></a>00117 <span class="comment">/////////////////////////////////////////////////////////////////////////////////</span>
<a name="l00118"></a>00118 <span class="comment"></span><span class="comment">// MEME generate</span>
<a name="l00119"></a><a class="code" href="memes_8php.html#a22c3ee429a73e5afdb6b63adf3c86c93">00119</a> <span class="keyword">function</span> <a class="code" href="memes_8php.html#a22c3ee429a73e5afdb6b63adf3c86c93">memes_action_memegenerate</a>() { eval(<a class="code" href="lib_8rfs_8php.html#acffda4746c06a226d1b11dca941bcfe1">lib_rfs_get_globals</a>());
<a name="l00120"></a>00120         
<a name="l00121"></a>00121     <a class="code" href="wab_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>       = addslashes(<a class="code" href="wab_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>);
<a name="l00122"></a>00122     $texttop    = addslashes($_REQUEST[<span class="stringliteral">&#39;texttop&#39;</span>]);
<a name="l00123"></a>00123     $textbottom = addslashes($_REQUEST[<span class="stringliteral">&#39;textbottom&#39;</span>]);  
<a name="l00124"></a>00124     
<a name="l00125"></a>00125     $poster=999;
<a name="l00126"></a>00126     <span class="keywordflow">if</span>(<a class="code" href="video__wall_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>-&gt;id) $poster=<a class="code" href="video__wall_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>-&gt;id;
<a name="l00127"></a>00127     <span class="keywordflow">if</span>(empty($private)) $private=<span class="stringliteral">&quot;no&quot;</span>;
<a name="l00128"></a>00128     
<a name="l00129"></a>00129     <span class="keywordflow">if</span>($mid==0) {       
<a name="l00130"></a>00130         $infoout=<span class="stringliteral">&quot;Adding new caption&quot;</span>;
<a name="l00131"></a>00131         <span class="keywordflow">if</span>(empty($texttop)) $texttop=<span class="stringliteral">&quot;_NEW&quot;</span>;
<a name="l00132"></a>00132             echo <span class="stringliteral">&quot; POSTER [$poster]&lt;br&gt;&quot;</span>;
<a name="l00133"></a>00133             echo <span class="stringliteral">&quot;PICTURE [$basepic] &lt;br&gt;&quot;</span>;
<a name="l00134"></a>00134             $q=<span class="stringliteral">&quot;insert into meme</span>
<a name="l00135"></a>00135 <span class="stringliteral">                  ( `name`,`poster`, `basepic`,`texttop`,`status`)</span>
<a name="l00136"></a>00136 <span class="stringliteral">            VALUES(&#39;$name&#39;,&#39;$poster&#39;, &#39;$basepic&#39;,  &#39;$texttop&#39;, &#39;EDIT&#39;);&quot;</span>;
<a name="l00137"></a>00137         <a class="code" href="lib_8mysql_8php.html#a06fb53fc71e262dce115fd3a98bcecdd">lib_mysql_query</a>($q);
<a name="l00138"></a>00138         <a class="code" href="config_8php.html#aad108a6abffdea835bc6cc2f3244751e">$GLOBALS</a>[<span class="stringliteral">&#39;mid&#39;</span>]=mysql_insert_id();
<a name="l00139"></a>00139        }
<a name="l00140"></a>00140     <span class="keywordflow">else</span> {
<a name="l00141"></a>00141         $infoout=<span class="stringliteral">&quot;Updating caption $mid&quot;</span>;
<a name="l00142"></a>00142         <span class="keywordflow">if</span>(!empty($_REQUEST[<span class="stringliteral">&#39;name&#39;</span>]))
<a name="l00143"></a>00143         <a class="code" href="lib_8mysql_8php.html#a06fb53fc71e262dce115fd3a98bcecdd">lib_mysql_query</a>(<span class="stringliteral">&quot;update meme set `name`             = &#39;$name&#39;            where id=&#39;$mid&#39;&quot;</span>);
<a name="l00144"></a>00144         <span class="keywordflow">if</span>(!empty($_REQUEST[<span class="stringliteral">&#39;poster&#39;</span>]))
<a name="l00145"></a>00145         <a class="code" href="lib_8mysql_8php.html#a06fb53fc71e262dce115fd3a98bcecdd">lib_mysql_query</a>(<span class="stringliteral">&quot;update meme set `poster`           = &#39;$poster&#39;          where id=&#39;$mid&#39;&quot;</span>);
<a name="l00146"></a>00146         <span class="keywordflow">if</span>(!empty($_REQUEST[<span class="stringliteral">&#39;texttop&#39;</span>]))
<a name="l00147"></a>00147         <a class="code" href="lib_8mysql_8php.html#a06fb53fc71e262dce115fd3a98bcecdd">lib_mysql_query</a>(<span class="stringliteral">&quot;update meme set `texttop`      = &#39;$texttop&#39;         where id=&#39;$mid&#39;&quot;</span>);
<a name="l00148"></a>00148         <span class="keywordflow">if</span>(!empty($_REQUEST[<span class="stringliteral">&#39;textbottom&#39;</span>]))
<a name="l00149"></a>00149         <a class="code" href="lib_8mysql_8php.html#a06fb53fc71e262dce115fd3a98bcecdd">lib_mysql_query</a>(<span class="stringliteral">&quot;update meme set `textbottom`   = &#39;$textbottom&#39;      where id=&#39;$mid&#39;&quot;</span>);
<a name="l00150"></a>00150         <span class="keywordflow">if</span>(!empty($_REQUEST[<span class="stringliteral">&#39;chgfont&#39;</span>]))
<a name="l00151"></a>00151         <a class="code" href="lib_8mysql_8php.html#a06fb53fc71e262dce115fd3a98bcecdd">lib_mysql_query</a>(<span class="stringliteral">&quot;update meme set `font`        = &#39;$chgfont&#39;       where id=&#39;$mid&#39;&quot;</span>);
<a name="l00152"></a>00152         <span class="keywordflow">if</span>(!empty($_REQUEST[<span class="stringliteral">&#39;text_color&#39;</span>]))
<a name="l00153"></a>00153         <a class="code" href="lib_8mysql_8php.html#a06fb53fc71e262dce115fd3a98bcecdd">lib_mysql_query</a>(<span class="stringliteral">&quot;update meme set `text_color`       = &#39;$text_color&#39;    where id=&#39;$mid&#39;&quot;</span>);
<a name="l00154"></a>00154         <span class="keywordflow">if</span>(!empty($_REQUEST[<span class="stringliteral">&#39;text_bg_color&#39;</span>]))
<a name="l00155"></a>00155         <a class="code" href="lib_8mysql_8php.html#a06fb53fc71e262dce115fd3a98bcecdd">lib_mysql_query</a>(<span class="stringliteral">&quot;update meme set `text_bg_color`    = &#39;$text_bg_color&#39; where id=&#39;$mid&#39;&quot;</span>);
<a name="l00156"></a>00156         <span class="keywordflow">if</span>(!empty($_REQUEST[<span class="stringliteral">&#39;text_size&#39;</span>]))
<a name="l00157"></a>00157         <a class="code" href="lib_8mysql_8php.html#a06fb53fc71e262dce115fd3a98bcecdd">lib_mysql_query</a>(<span class="stringliteral">&quot;update meme set `text_size`        = &#39;$text_size&#39;     where id=&#39;$mid&#39;&quot;</span>);
<a name="l00158"></a>00158         <span class="keywordflow">if</span>(!empty($_REQUEST[<span class="stringliteral">&#39;private&#39;</span>]))
<a name="l00159"></a>00159         <a class="code" href="lib_8mysql_8php.html#a06fb53fc71e262dce115fd3a98bcecdd">lib_mysql_query</a>(<span class="stringliteral">&quot;update meme set `private`      = &#39;$private&#39;       where id=&#39;$mid&#39;&quot;</span>);
<a name="l00160"></a>00160         <span class="keywordflow">if</span>(!empty($_REQUEST[<span class="stringliteral">&#39;datborder&#39;</span>]))
<a name="l00161"></a>00161         <a class="code" href="lib_8mysql_8php.html#a06fb53fc71e262dce115fd3a98bcecdd">lib_mysql_query</a>(<span class="stringliteral">&quot;update meme set `datborder`        = &#39;$datborder&#39;        where id=&#39;$mid&#39;&quot;</span>);
<a name="l00162"></a>00162     }   
<a name="l00163"></a>00163     $meme=<a class="code" href="lib_8mysql_8php.html#a80af159483fec4094697cef8c5c187a6">lib_mysql_fetch_one_object</a>(<span class="stringliteral">&quot;select * from meme where id=&#39;$mid&#39;&quot;</span>);
<a name="l00164"></a>00164     <a class="code" href="video__wall_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>=<a class="code" href="lib_8users_8php.html#ab325575e26a72205f4f036d966330e22">lib_users_get_data</a>($poster);
<a name="l00165"></a>00165     global $basepic;
<a name="l00166"></a>00166     $basepic=$meme-&gt;basepic;
<a name="l00167"></a>00167     <a class="code" href="lib_8forms_8php.html#ad285a3a501e01b34c5905b2d94728dd6">lib_forms_info</a>($infoout.<span class="stringliteral">&quot; &gt;&gt; $meme-&gt;id ($mid) $meme-&gt;name &gt;&gt; $meme-&gt;texttop &gt;&gt; $meme-&gt;textbottom&quot;</span>,  <span class="stringliteral">&quot;WHITE&quot;</span>,<span class="stringliteral">&quot;GREEN&quot;</span>);
<a name="l00168"></a>00168     <a class="code" href="memes_8php.html#ac1bb6801ef55ff17dc52f957a80e13d2">memes_action_memeedit</a>();
<a name="l00169"></a>00169 }<span class="comment"></span>
<a name="l00170"></a>00170 <span class="comment">/////////////////////////////////////////////////////////////////////////////////</span>
<a name="l00171"></a>00171 <span class="comment"></span><span class="comment">// MEME editor</span>
<a name="l00172"></a><a class="code" href="memes_8php.html#ac1bb6801ef55ff17dc52f957a80e13d2">00172</a> <span class="keyword">function</span> <a class="code" href="memes_8php.html#ac1bb6801ef55ff17dc52f957a80e13d2">memes_action_memeedit</a>() { eval(<a class="code" href="lib_8rfs_8php.html#acffda4746c06a226d1b11dca941bcfe1">lib_rfs_get_globals</a>()); 
<a name="l00173"></a>00173     <span class="keywordflow">if</span>(empty($mid)) $mid=$id;
<a name="l00174"></a>00174     <a class="code" href="lib_8forms_8php.html#ad285a3a501e01b34c5905b2d94728dd6">lib_forms_info</a>(<span class="stringliteral">&quot;Editing $name caption #$mid&quot;</span>,<span class="stringliteral">&quot;BLACK&quot;</span>,<span class="stringliteral">&quot;#ff9900&quot;</span>);
<a name="l00175"></a>00175     <a class="code" href="sp_8php.html#a0c788ee1ad50aa3f1b2c28bb7a00db49">$m</a>=<a class="code" href="lib_8mysql_8php.html#a80af159483fec4094697cef8c5c187a6">lib_mysql_fetch_one_object</a>(<span class="stringliteral">&quot;select * from meme where id=&#39;$mid&#39;&quot;</span>);
<a name="l00176"></a>00176     $pic=<a class="code" href="lib_8mysql_8php.html#a80af159483fec4094697cef8c5c187a6">lib_mysql_fetch_one_object</a>(<span class="stringliteral">&quot;select * from pictures where id=&#39;$m-&gt;basepic&#39;&quot;</span>);   
<a name="l00177"></a>00177     <a class="code" href="rfswiki_8php.html#ab0ed46ece3f8d301125a0f2728d90d7b">$p</a>=<a class="code" href="video__wall_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>-&gt;id;
<a name="l00178"></a>00178     <span class="keywordflow">if</span>(empty(<a class="code" href="rfswiki_8php.html#ab0ed46ece3f8d301125a0f2728d90d7b">$p</a>)) <a class="code" href="rfswiki_8php.html#ab0ed46ece3f8d301125a0f2728d90d7b">$p</a>=999;
<a name="l00179"></a>00179     <span class="keywordflow">if</span>( (<a class="code" href="sp_8php.html#a0c788ee1ad50aa3f1b2c28bb7a00db49">$m</a>-&gt;poster==<a class="code" href="rfswiki_8php.html#ab0ed46ece3f8d301125a0f2728d90d7b">$p</a>) || (<a class="code" href="video__wall_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>-&gt;access==255) ) {
<a name="l00180"></a>00180         <span class="keywordflow">if</span>(<a class="code" href="sp_8php.html#a0c788ee1ad50aa3f1b2c28bb7a00db49">$m</a>-&gt;poster!=<a class="code" href="rfswiki_8php.html#ab0ed46ece3f8d301125a0f2728d90d7b">$p</a>)
<a name="l00181"></a>00181             <a class="code" href="lib_8forms_8php.html#ad285a3a501e01b34c5905b2d94728dd6">lib_forms_info</a>(<span class="stringliteral">&quot;NOT YOURS ADMIN! / EDIT ANYWAY (LOL)&quot;</span>,<span class="stringliteral">&quot;WHITE&quot;</span>,<span class="stringliteral">&quot;RED&quot;</span>);
<a name="l00182"></a>00182         <span class="keywordflow">if</span>(empty(<a class="code" href="wab_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>)) <a class="code" href="wab_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>=<a class="code" href="sp_8php.html#a0c788ee1ad50aa3f1b2c28bb7a00db49">$m</a>-&gt;name;
<a name="l00183"></a>00183         <span class="keywordflow">if</span>(empty(<a class="code" href="wab_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>)) $nout=<span class="stringliteral">&quot;SHOW_TEXT_10#20#name=$name&quot;</span>.$RFS_SITE_DELIMITER;
<a name="l00184"></a>00184         <span class="keywordflow">else</span>  {         
<a name="l00185"></a>00185             $nout=<span class="stringliteral">&quot;name=$name&quot;</span>.$RFS_SITE_DELIMITER;
<a name="l00186"></a>00186         }
<a name="l00187"></a>00187         echo <span class="stringliteral">&quot;&lt;table border=0 cellspacing=0 cellpadding=0&gt;&lt;tr&gt;&lt;td valign=top&gt;&quot;</span>;
<a name="l00188"></a>00188         $ofont=<span class="stringliteral">&quot;fonts/impact.ttf&quot;</span>;
<a name="l00189"></a>00189         $ocolor=<span class="stringliteral">&quot;white&quot;</span>;
<a name="l00190"></a>00190         $text_bg_color=<span class="stringliteral">&quot;black&quot;</span>;
<a name="l00191"></a>00191         <span class="keywordflow">if</span>(!empty(<a class="code" href="sp_8php.html#a0c788ee1ad50aa3f1b2c28bb7a00db49">$m</a>-&gt;font)) $ofont=<a class="code" href="sp_8php.html#a0c788ee1ad50aa3f1b2c28bb7a00db49">$m</a>-&gt;font;
<a name="l00192"></a>00192         <span class="keywordflow">if</span>(!empty(<a class="code" href="sp_8php.html#a0c788ee1ad50aa3f1b2c28bb7a00db49">$m</a>-&gt;text_color)) $ocolor=<a class="code" href="sp_8php.html#a0c788ee1ad50aa3f1b2c28bb7a00db49">$m</a>-&gt;text_color;
<a name="l00193"></a>00193         <span class="keywordflow">if</span>(!empty(<a class="code" href="sp_8php.html#a0c788ee1ad50aa3f1b2c28bb7a00db49">$m</a>-&gt;text_bg_color)) $text_bg_color=<a class="code" href="sp_8php.html#a0c788ee1ad50aa3f1b2c28bb7a00db49">$m</a>-&gt;text_bg_color;
<a name="l00194"></a>00194         <span class="keywordflow">if</span>(empty($private)) $private=<span class="stringliteral">&quot;no&quot;</span>;
<a name="l00195"></a>00195 
<a name="l00196"></a>00196         rfs_bqf( <span class="stringliteral">&quot;action=memegenerate&quot;</span>.<a class="code" href="config_8sitevars_8php.html#a06fab752c166675deeb7a9191add17ab">$RFS_SITE_DELIMITER</a>.
<a name="l00197"></a>00197                  <span class="stringliteral">&quot;id=$pic-&gt;id&quot;</span>.$RFS_SITE_DELIMITER.
<a name="l00198"></a>00198                  <span class="stringliteral">&quot;mid=$m-&gt;id&quot;</span>.$RFS_SITE_DELIMITER.
<a name="l00199"></a>00199                  <span class="stringliteral">&quot;chgfont=$m-&gt;font&quot;</span>.$RFS_SITE_DELIMITER.
<a name="l00200"></a>00200                  $nout.
<a name="l00201"></a>00201                  <span class="stringliteral">&quot;SHOW_SELECTOR_colors#name#text_color#$ocolor&quot;</span>.$RFS_SITE_DELIMITER.
<a name="l00202"></a>00202                  <span class="stringliteral">&quot;SHOW_SELECTOR_colors#name#text_bg_color#$text_bg_color&quot;</span>.$RFS_SITE_DELIMITER.
<a name="l00203"></a>00203                  <span class="stringliteral">&quot;SHOW_TEXT_10#20#datborder=$m-&gt;datborder&quot;</span>.$RFS_SITE_DELIMITER.
<a name="l00204"></a>00204                  <span class="stringliteral">&quot;SHOW_TEXT_10#20#private=$private&quot;</span>.$RFS_SITE_DELIMITER.
<a name="l00205"></a>00205                  <span class="stringliteral">&quot;SHOW_TEXT_10#20#text_size=$m-&gt;text_size&quot;</span>.$RFS_SITE_DELIMITER.
<a name="l00206"></a>00206                  <span class="stringliteral">&quot;SHOW_TEXT_10#20#texttop=$m-&gt;texttop&quot;</span>.$RFS_SITE_DELIMITER.
<a name="l00207"></a>00207                  <span class="stringliteral">&quot;SHOW_TEXT_10#20#textbottom=$m-&gt;textbottom&quot;</span>,
<a name="l00208"></a>00208                  <span class="stringliteral">&quot;Go&quot;</span> );
<a name="l00209"></a>00209         echo <span class="stringliteral">&quot;&lt;p&gt;&quot;</span>;
<a name="l00210"></a>00210         
<a name="l00211"></a>00211         $t=<a class="code" href="sp_8php.html#a0c788ee1ad50aa3f1b2c28bb7a00db49">$m</a>-&gt;name.<span class="stringliteral">&quot;-&quot;</span>.time();         
<a name="l00212"></a>00212         echo <span class="stringliteral">&quot; &lt;a href=&#39;$RFS_SITE_URL/include/generate.image.php/$t.png?mid=$m-&gt;id&amp;owidth=$meme_fullsize&amp;forcerender=1&#39; target=_blank&gt;</span>
<a name="l00213"></a>00213 <span class="stringliteral">                &lt;img src=&#39;$RFS_SITE_URL/include/generate.image.php/$t.png?</span>
<a name="l00214"></a>00214 <span class="stringliteral">                mid=$m-&gt;id&amp;</span>
<a name="l00215"></a>00215 <span class="stringliteral">                owidth=$meme_editwidth&amp;</span>
<a name="l00216"></a>00216 <span class="stringliteral">                forcerender=1&#39;</span>
<a name="l00217"></a>00217 <span class="stringliteral">                border=0&gt;</span>
<a name="l00218"></a>00218 <span class="stringliteral">                &lt;/a&gt;&quot;</span>;
<a name="l00219"></a>00219                 
<a name="l00220"></a>00220         echo <span class="stringliteral">&quot;&lt;/p&gt;&quot;</span>;
<a name="l00221"></a>00221 
<a name="l00222"></a>00222         echo <span class="stringliteral">&quot;&lt;/td&gt;&lt;td width=80% valign=top&gt;&quot;</span>;
<a name="l00223"></a>00223         
<a name="l00224"></a>00224         <span class="comment">/*lib_forms_info(&quot;&lt;BR&gt;Planning following features&lt;br&gt;</span>
<a name="l00225"></a>00225 <span class="comment">                    TODO: Add upload ttf font.&lt;br&gt;</span>
<a name="l00226"></a>00226 <span class="comment">                    TODO: Add text color pickers &lt;br&gt;</span>
<a name="l00227"></a>00227 <span class="comment">                    TODO: Add border color picker&lt;br&gt;</span>
<a name="l00228"></a>00228 <span class="comment">                    TODO: Add TRUE FALSE OPTIONIZER&lt;br&gt;</span>
<a name="l00229"></a>00229 <span class="comment">                    &amp;nbsp;&quot;,&quot;WHITE&quot;,&quot;RED&quot;);</span>
<a name="l00230"></a>00230 <span class="comment">                    */</span>
<a name="l00231"></a>00231 
<a name="l00232"></a>00232 
<a name="l00233"></a>00233         echo <span class="stringliteral">&quot;&lt;a href=&#39;$RFS_SITE_URL/modules/memes/memes.php?action=meme_save&amp;mid=$m-&gt;id&amp;showfonts=true&#39;&gt;&quot;</span>;
<a name="l00234"></a>00234         <a class="code" href="lib_8images_8php.html#a52e7c029a7a270bf973acfd7f7f1f65f">lib_images_text</a>(<span class="stringliteral">&quot;SAVE THIS MEME&quot;</span>,<span class="stringliteral">&quot;HoW%20tO%20dO%20SoMeThInG.ttf&quot;</span>,28,812,74,0,0,150,150,0,0,0,0,1,1);
<a name="l00235"></a>00235         echo <span class="stringliteral">&quot;&lt;/a&gt;&lt;BR&gt;&quot;</span>;
<a name="l00236"></a>00236 
<a name="l00237"></a>00237         echo <span class="stringliteral">&quot;&lt;a href=&#39;$RFS_SITE_URL/modules/memes/memes.php?action=memeedit&amp;mid=$m-&gt;id&amp;showfonts=true&#39;&gt;&quot;</span>;
<a name="l00238"></a>00238         $wf=str_replace(<span class="stringliteral">&quot;fonts/&quot;</span>,<span class="stringliteral">&quot;&quot;</span>,<a class="code" href="sp_8php.html#a0c788ee1ad50aa3f1b2c28bb7a00db49">$m</a>-&gt;font);
<a name="l00239"></a>00239 
<a name="l00240"></a>00240         <a class="code" href="lib_8images_8php.html#a52e7c029a7a270bf973acfd7f7f1f65f">lib_images_text</a>(    <span class="stringliteral">&quot;Change Font ($wf)&quot;</span>,<span class="stringliteral">&quot;HoW%20tO%20dO%20SoMeThInG.ttf&quot;</span>,28,812,74,0,0,10,145,148,1,1,0,1,1);
<a name="l00241"></a>00241         echo <span class="stringliteral">&quot;&lt;/a&gt;&lt;BR&gt;&quot;</span>;
<a name="l00242"></a>00242 
<a name="l00243"></a>00243 
<a name="l00244"></a>00244         $rr=100;
<a name="l00245"></a>00245         <span class="keywordflow">if</span>($showfonts) {
<a name="l00246"></a>00246             $dir_count=0; $dirfiles = array();
<a name="l00247"></a>00247             $handle=opendir(<span class="stringliteral">&quot;$RFS_SITE_PATH/files/fonts&quot;</span>) or die(<span class="stringliteral">&quot;Unable to open filepath&quot;</span>);
<a name="l00248"></a>00248             <span class="keywordflow">while</span> (<span class="keyword">false</span>!==(<a class="code" href="thumbnail_8php.html#aa1bfbd27060176201b271918dff57e8f">$file</a> = readdir($handle))) array_push($dirfiles,<a class="code" href="thumbnail_8php.html#aa1bfbd27060176201b271918dff57e8f">$file</a>);
<a name="l00249"></a>00249             closedir($handle); reset($dirfiles); asort($dirfiles);
<a name="l00250"></a>00250             <span class="keywordflow">while</span>(list ($key, <a class="code" href="thumbnail_8php.html#aa1bfbd27060176201b271918dff57e8f">$file</a>) = each ($dirfiles)){
<a name="l00251"></a>00251                 <span class="keywordflow">if</span>(<a class="code" href="thumbnail_8php.html#aa1bfbd27060176201b271918dff57e8f">$file</a>!=<span class="stringliteral">&quot;.&quot;</span>) <span class="keywordflow">if</span>(<a class="code" href="thumbnail_8php.html#aa1bfbd27060176201b271918dff57e8f">$file</a>!=<span class="stringliteral">&quot;..&quot;</span>)
<a name="l00252"></a>00252                     <span class="keywordflow">if</span>(!is_dir($dir.<span class="stringliteral">&quot;/&quot;</span>.<a class="code" href="thumbnail_8php.html#aa1bfbd27060176201b271918dff57e8f">$file</a>)){
<a name="l00253"></a>00253                         $t=<a class="code" href="sp_8php.html#a0c788ee1ad50aa3f1b2c28bb7a00db49">$m</a>-&gt;name.<span class="stringliteral">&quot;-&quot;</span>.time();
<a name="l00254"></a>00254                         $text_size=12;
<a name="l00255"></a>00255 
<a name="l00256"></a>00256                         $rr+=15; $rg+=32; $rb+=8; 
<a name="l00257"></a>00257                         <span class="keywordflow">if</span>($rr&gt;255) $rr=100;
<a name="l00258"></a>00258                         <span class="keywordflow">if</span>($rg&gt;255) $rg=0;
<a name="l00259"></a>00259                         <span class="keywordflow">if</span>($rb&gt;255) $rb=0;
<a name="l00260"></a>00260         
<a name="l00261"></a>00261 
<a name="l00262"></a>00262     echo <span class="stringliteral">&quot;&lt;a href=&#39;$RFS_SITE_URL/modules/memes/memes.php?action=memegenerate&amp;chgfont=$file&amp;mid=$m-&gt;id&#39;&gt;</span>
<a name="l00263"></a>00263 <span class="stringliteral">                            &lt;img src=&#39;$RFS_SITE_URL/include/generate.image.php/$t.png?action=showfont&amp;font=$file&amp;text_size=16&amp;forcerender=1&amp;oheight=120&amp;forceheight=1&amp;icr=$rr&amp;icg=$rg&amp;icb=$rb&#39; border=0&gt;&lt;/a&gt;&quot;</span>;
<a name="l00264"></a>00264                 }
<a name="l00265"></a>00265             }
<a name="l00266"></a>00266         }
<a name="l00267"></a>00267         echo <span class="stringliteral">&quot;&lt;/tr&gt;&lt;/table&gt;&quot;</span>;
<a name="l00268"></a>00268     }
<a name="l00269"></a>00269     <span class="keywordflow">else</span>{
<a name="l00270"></a>00270         echo <span class="stringliteral">&quot;&lt;p&gt;This is not your caption.&lt;/p&gt;&quot;</span>;        
<a name="l00271"></a>00271     }
<a name="l00272"></a>00272     
<a name="l00273"></a>00273     include(<span class="stringliteral">&quot;footer.php&quot;</span>);
<a name="l00274"></a>00274 }<span class="comment"></span>
<a name="l00275"></a>00275 <span class="comment">/////////////////////////////////////////////////////////////////////////////////</span>
<a name="l00276"></a>00276 <span class="comment"></span><span class="comment">// MEME vote up</span>
<a name="l00277"></a><a class="code" href="memes_8php.html#accf5785377823ef34a043265a7666219">00277</a> <span class="keyword">function</span> <a class="code" href="memes_8php.html#accf5785377823ef34a043265a7666219">memes_action_muv</a>() { eval(<a class="code" href="lib_8rfs_8php.html#acffda4746c06a226d1b11dca941bcfe1">lib_rfs_get_globals</a>()); 
<a name="l00278"></a>00278     $muv=<span class="stringliteral">&quot;MUV$mid&quot;</span>;    
<a name="l00279"></a>00279     <a class="code" href="install_8php.html#af9da176a74bd49cb97ea35c6ac7257bc">$action</a>=<span class="stringliteral">&quot;showmemes&quot;</span>;
<a name="l00280"></a>00280     <span class="keywordflow">if</span>(!<a class="code" href="wab_8php.html#a7e78406241b519489b23a8c902b4a8de">$_SESSION</a>[$muv]){        
<a name="l00281"></a>00281         <a class="code" href="sp_8php.html#a0c788ee1ad50aa3f1b2c28bb7a00db49">$m</a>=<a class="code" href="lib_8mysql_8php.html#a80af159483fec4094697cef8c5c187a6">lib_mysql_fetch_one_object</a>(<span class="stringliteral">&quot;select * from meme where id=&#39;$mid&#39;&quot;</span>);
<a name="l00282"></a>00282         <a class="code" href="sp_8php.html#a0c788ee1ad50aa3f1b2c28bb7a00db49">$m</a>-&gt;rating+=1;
<a name="l00283"></a>00283         <a class="code" href="lib_8mysql_8php.html#a06fb53fc71e262dce115fd3a98bcecdd">lib_mysql_query</a>(<span class="stringliteral">&quot;update meme set rating=&#39;$m-&gt;rating&#39; where id=&#39;$mid&#39;&quot;</span>);
<a name="l00284"></a>00284         <a class="code" href="wab_8php.html#a7e78406241b519489b23a8c902b4a8de">$_SESSION</a>[$muv]=<span class="keyword">true</span>;
<a name="l00285"></a>00285     } <span class="keywordflow">else</span> {
<a name="l00286"></a>00286         <a class="code" href="lib_8forms_8php.html#ad285a3a501e01b34c5905b2d94728dd6">lib_forms_info</a>(<span class="stringliteral">&quot;Multiple upvoting is not allowed.&quot;</span>,<span class="stringliteral">&quot;white&quot;</span>,<span class="stringliteral">&quot;red&quot;</span>);
<a name="l00287"></a>00287     }
<a name="l00288"></a>00288     <a class="code" href="memes_8php.html#aefda927d28dab6028cba434fab908d29">memes_action_showmemes</a>();
<a name="l00289"></a>00289 }<span class="comment"></span>
<a name="l00290"></a>00290 <span class="comment">/////////////////////////////////////////////////////////////////////////////////</span>
<a name="l00291"></a>00291 <span class="comment"></span><span class="comment">// MEME vote down</span>
<a name="l00292"></a><a class="code" href="memes_8php.html#af20724681c4d39ccba29b8e570666134">00292</a> <span class="keyword">function</span> <a class="code" href="memes_8php.html#af20724681c4d39ccba29b8e570666134">memes_action_mdv</a>() { eval(<a class="code" href="lib_8rfs_8php.html#acffda4746c06a226d1b11dca941bcfe1">lib_rfs_get_globals</a>());
<a name="l00293"></a>00293     $mdv=<span class="stringliteral">&quot;MDV$mid&quot;</span>;
<a name="l00294"></a>00294     <a class="code" href="install_8php.html#af9da176a74bd49cb97ea35c6ac7257bc">$action</a>=<span class="stringliteral">&quot;showmemes&quot;</span>;
<a name="l00295"></a>00295     <span class="keywordflow">if</span>(!<a class="code" href="wab_8php.html#a7e78406241b519489b23a8c902b4a8de">$_SESSION</a>[$mdv]){
<a name="l00296"></a>00296         <a class="code" href="sp_8php.html#a0c788ee1ad50aa3f1b2c28bb7a00db49">$m</a>=<a class="code" href="lib_8mysql_8php.html#a80af159483fec4094697cef8c5c187a6">lib_mysql_fetch_one_object</a>(<span class="stringliteral">&quot;select * from meme where id=&#39;$mid&#39;&quot;</span>);
<a name="l00297"></a>00297         <a class="code" href="sp_8php.html#a0c788ee1ad50aa3f1b2c28bb7a00db49">$m</a>-&gt;rating-=1;
<a name="l00298"></a>00298         <a class="code" href="lib_8mysql_8php.html#a06fb53fc71e262dce115fd3a98bcecdd">lib_mysql_query</a>(<span class="stringliteral">&quot;update meme set rating=&#39;$m-&gt;rating&#39; where id=&#39;$mid&#39;&quot;</span>);
<a name="l00299"></a>00299         <a class="code" href="wab_8php.html#a7e78406241b519489b23a8c902b4a8de">$_SESSION</a>[$mdv]=<span class="keyword">true</span>;
<a name="l00300"></a>00300     }
<a name="l00301"></a>00301     <span class="keywordflow">else</span> {
<a name="l00302"></a>00302         <a class="code" href="lib_8forms_8php.html#ad285a3a501e01b34c5905b2d94728dd6">lib_forms_info</a>(<span class="stringliteral">&quot;Multiple downvoting is not allowed.&quot;</span>,<span class="stringliteral">&quot;white&quot;</span>,<span class="stringliteral">&quot;red&quot;</span>);
<a name="l00303"></a>00303     }
<a name="l00304"></a>00304     <a class="code" href="memes_8php.html#aefda927d28dab6028cba434fab908d29">memes_action_showmemes</a>();
<a name="l00305"></a>00305 }<span class="comment"></span>
<a name="l00306"></a>00306 <span class="comment">/////////////////////////////////////////////////////////////////////////////////</span>
<a name="l00307"></a>00307 <span class="comment"></span><span class="comment">// MEME show memes</span>
<a name="l00308"></a><a class="code" href="memes_8php.html#aefda927d28dab6028cba434fab908d29">00308</a> <span class="keyword">function</span> <a class="code" href="memes_8php.html#aefda927d28dab6028cba434fab908d29">memes_action_showmemes</a>(){ eval(<a class="code" href="lib_8rfs_8php.html#acffda4746c06a226d1b11dca941bcfe1">lib_rfs_get_globals</a>());
<a name="l00309"></a>00309     echo <span class="stringliteral">&quot;&lt;h1&gt;Meme generator&lt;/h1&gt;&quot;</span>;
<a name="l00310"></a>00310     $mcols=5; $mrows=5;
<a name="l00311"></a>00311     $toget=$mcols*$mrows;
<a name="l00312"></a>00312     <span class="keywordflow">if</span>(empty($mtop)) $mtop=0;
<a name="l00313"></a>00313     <span class="keywordflow">if</span>(empty($mbot)) $mbot=$toget;
<a name="l00314"></a>00314     
<a name="l00315"></a>00315     <a class="code" href="lib_8mysql_8php.html#a06fb53fc71e262dce115fd3a98bcecdd">lib_mysql_query</a>(<span class="stringliteral">&quot;delete FROM meme WHERE TIMESTAMPDIFF(MINUTE,`time`,NOW()) &gt; 5 and status = &#39;EDIT&#39;&quot;</span>);    
<a name="l00316"></a>00316     $donotshowcats=<span class="keyword">true</span>;
<a name="l00317"></a>00317     
<a name="l00318"></a>00318     $q=<span class="stringliteral">&quot;select * from meme  &quot;</span>;
<a name="l00319"></a>00319     $q.=<span class="stringliteral">&quot; where &quot;</span>;
<a name="l00320"></a>00320     <span class="keywordflow">if</span>(!empty($onlyshow))
<a name="l00321"></a>00321         $q.=<span class="stringliteral">&quot; `name`=&#39;$onlyshow&#39; and&quot;</span>;
<a name="l00322"></a>00322     $q.=<span class="stringliteral">&quot; `private`&lt;&gt;&#39;yes&#39; and `status` = &#39;SAVED&#39;&quot;</span>;
<a name="l00323"></a>00323     $q.=<span class="stringliteral">&quot; order by rating desc &quot;</span>;
<a name="l00324"></a>00324     $ql=<span class="stringliteral">&quot; limit $mtop,$mbot &quot;</span>;
<a name="l00325"></a>00325     <a class="code" href="sp_8php.html#a8abe176bc41afd728f32ba8c506cbd98">$r</a>=<a class="code" href="lib_8mysql_8php.html#a06fb53fc71e262dce115fd3a98bcecdd">lib_mysql_query</a>($q.$ql);
<a name="l00326"></a>00326     $n=mysql_num_rows(<a class="code" href="sp_8php.html#a8abe176bc41afd728f32ba8c506cbd98">$r</a>); 
<a name="l00327"></a>00327 
<a name="l00328"></a>00328     <span class="keywordflow">if</span>( $mtop &gt; 0 ) {
<a name="l00329"></a>00329         $tmtop=$mtop-$mbot;
<a name="l00330"></a>00330         <a class="code" href="lib_8buttons_8php.html#aa742abd5349fe3663c04f8474591cf17">lib_buttons_make_button</a>(<span class="stringliteral">&quot;$RFS_SITE_URL/modules/memes/memes.php?action=showmemes&amp;mtop=$tmtop&amp;mbot=$mbot&amp;onlyshow=$onlyshow&quot;</span>,<span class="stringliteral">&quot;PREVIOUS PAGE&quot;</span>);
<a name="l00331"></a>00331     } 
<a name="l00332"></a>00332     <span class="keywordflow">if</span>(!empty($onlyshow)) {
<a name="l00333"></a>00333         <a class="code" href="lib_8buttons_8php.html#aa742abd5349fe3663c04f8474591cf17">lib_buttons_make_button</a>(<span class="stringliteral">&quot;$RFS_SITE_URL/modules/memes/memes.php?action=showmemes&amp;mtop=$mtop&amp;mbot=$mbot&amp;onlyshow=&quot;</span>,<span class="stringliteral">&quot;Show All Captions&quot;</span>);
<a name="l00334"></a>00334     }
<a name="l00335"></a>00335     $ql=<span class="stringliteral">&quot; limit &quot;</span>.($mtop+$mbot+$toget).<span class="stringliteral">&quot; ;&quot;</span>;
<a name="l00336"></a>00336     $rrr=<a class="code" href="lib_8mysql_8php.html#a06fb53fc71e262dce115fd3a98bcecdd">lib_mysql_query</a>($q.$ql);
<a name="l00337"></a>00337     
<a name="l00338"></a>00338     $nnn=mysql_num_rows($rrr);
<a name="l00339"></a>00339     <span class="comment">//echo &quot;&lt;hr&gt; mtop+mbot+toget [&quot;.($mtop+$mbot+$toget).&quot;] mbot+mtop [&quot;.($mbot+$mtop).&quot;] nnn[&quot;.$nnn.&quot;] &lt;BR&gt;&quot;;</span>
<a name="l00340"></a>00340     <span class="keywordflow">if</span>( ($mbot+$mtop) &lt; $nnn) {
<a name="l00341"></a>00341         $mtop+=$mbot;
<a name="l00342"></a>00342         <a class="code" href="lib_8buttons_8php.html#aa742abd5349fe3663c04f8474591cf17">lib_buttons_make_button</a>(<span class="stringliteral">&quot;$RFS_SITE_URL/modules/memes/memes.php?action=showmemes&amp;mtop=$mtop&amp;mbot=$mbot&amp;onlyshow=$onlyshow&quot;</span>,<span class="stringliteral">&quot;NEXT PAGE&quot;</span>);
<a name="l00343"></a>00343     }
<a name="l00344"></a>00344     
<a name="l00345"></a>00345     echo <span class="stringliteral">&quot;&lt;hr&gt;&quot;</span>;
<a name="l00346"></a>00346     <span class="keywordflow">for</span>($i=0;$i&lt;$n;$i++){
<a name="l00347"></a>00347         <a class="code" href="sp_8php.html#a0c788ee1ad50aa3f1b2c28bb7a00db49">$m</a>=mysql_fetch_object(<a class="code" href="sp_8php.html#a8abe176bc41afd728f32ba8c506cbd98">$r</a>);
<a name="l00348"></a>00348         echo <span class="stringliteral">&quot;&lt;div id=$m-&gt;id style=\&quot;float: left;\&quot;&gt;&quot;</span>;
<a name="l00349"></a>00349         <a class="code" href="module_8memes_8php.html#ab20928f166c1d5de1cd06d53795c3af4">rfs_show1meme</a>(<a class="code" href="sp_8php.html#a0c788ee1ad50aa3f1b2c28bb7a00db49">$m</a>-&gt;id);
<a name="l00350"></a>00350         echo <span class="stringliteral">&quot;&lt;/div&gt;&quot;</span>;
<a name="l00351"></a>00351     }
<a name="l00352"></a>00352     echo <span class="stringliteral">&quot;&lt;br style=&#39;clear: both;&#39;&gt;&quot;</span>;
<a name="l00353"></a>00353     include(<span class="stringliteral">&quot;footer.php&quot;</span>);
<a name="l00354"></a>00354     exit();
<a name="l00355"></a>00355 }<span class="comment"></span>
<a name="l00356"></a>00356 <span class="comment">/////////////////////////////////////////////////////////////////////////////////</span>
<a name="l00357"></a>00357 <span class="comment"></span><span class="comment">// MEME default action</span>
<a name="l00358"></a><a class="code" href="memes_8php.html#ac34f84ba1847fd5f5d114dc32b23da34">00358</a> <span class="keyword">function</span> <a class="code" href="memes_8php.html#ac34f84ba1847fd5f5d114dc32b23da34">memes_action_</a>() { eval(<a class="code" href="lib_8rfs_8php.html#acffda4746c06a226d1b11dca941bcfe1">lib_rfs_get_globals</a>());
<a name="l00359"></a>00359     <a class="code" href="memes_8php.html#aefda927d28dab6028cba434fab908d29">memes_action_showmemes</a>();
<a name="l00360"></a>00360 }
<a name="l00361"></a>00361 
<a name="l00362"></a>00362 ?&gt;
</pre></div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="memes_8php.html">memes.php</a>      </li>

    <li class="footer">Generated on Tue Mar 18 2014 03:33:39 for RFSCMSAPIDocumentation by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
