<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>RFSCMSAPIDocumentation: exams.php Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">RFSCMSAPIDocumentation
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('exams_8php.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">exams.php</div>  </div>
</div><!--header-->
<div class="contents">
<a href="exams_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 chdir(<span class="stringliteral">&quot;../../&quot;</span>);
<a name="l00004"></a>00004 include(<span class="stringliteral">&quot;include/lib.mysql.php&quot;</span>);
<a name="l00005"></a>00005 
<a name="l00006"></a>00006 <span class="keywordflow">if</span>(empty($_REQUEST[<span class="stringliteral">&#39;exam_id&#39;</span>])) <a class="code" href="adm_8php.html#ada57e7bb7c152edad18fe2f166188691">$title</a>=<span class="stringliteral">&quot;Exams&quot;</span>;
<a name="l00007"></a>00007 <span class="keywordflow">else</span>  {
<a name="l00008"></a>00008         $tex=<a class="code" href="lib_8mysql_8php.html#ad42d2c11477299cecf3dd06b259a316e">mfo1</a>(<span class="stringliteral">&quot;select * from exams where id=&#39;&quot;</span>.$_REQUEST[<span class="stringliteral">&#39;exam_id&#39;</span>].<span class="stringliteral">&quot;&#39;&quot;</span>);
<a name="l00009"></a>00009         <a class="code" href="adm_8php.html#ada57e7bb7c152edad18fe2f166188691">$title</a>=<span class="stringliteral">&quot;Exam ($tex-&gt;name)&quot;</span>;
<a name="l00010"></a>00010 }
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <a class="code" href="exams_8php.html#abeba4ddc6d9603d906caa8fc0e77207b">$answer_data</a>[1]=<span class="stringliteral">&quot;A&quot;</span>;
<a name="l00013"></a><a class="code" href="exams_8php.html#abeba4ddc6d9603d906caa8fc0e77207b">00013</a> <a class="code" href="exams_8php.html#abeba4ddc6d9603d906caa8fc0e77207b">$answer_data</a>[2]=<span class="stringliteral">&quot;B&quot;</span>;
<a name="l00014"></a><a class="code" href="exams_8php.html#a680da5cbe2270a1568a1957991e06458">00014</a> <a class="code" href="exams_8php.html#abeba4ddc6d9603d906caa8fc0e77207b">$answer_data</a>[3]=<span class="stringliteral">&quot;C&quot;</span>;
<a name="l00015"></a><a class="code" href="exams_8php.html#ad4b371828a3aa97128317b9ada1b21c7">00015</a> <a class="code" href="exams_8php.html#abeba4ddc6d9603d906caa8fc0e77207b">$answer_data</a>[4]=<span class="stringliteral">&quot;D&quot;</span>;
<a name="l00016"></a><a class="code" href="exams_8php.html#a6776163deca0306eebc485f351c42c8a">00016</a> <a class="code" href="exams_8php.html#abeba4ddc6d9603d906caa8fc0e77207b">$answer_data</a>[5]=<span class="stringliteral">&quot;E&quot;</span>;
<a name="l00017"></a><a class="code" href="exams_8php.html#ab95d96e2868677f8d2a7863b2d34ef14">00017</a> <a class="code" href="exams_8php.html#abeba4ddc6d9603d906caa8fc0e77207b">$answer_data</a>[6]=<span class="stringliteral">&quot;F&quot;</span>;
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 include(<span class="stringliteral">&quot;header.php&quot;</span>);
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="keywordflow">if</span>(!<a class="code" href="lib_8rfs_8php.html#a3609b7f3d3b5fd21ee37b823c7c32546">sc_yes</a>(<a class="code" href="session_8php.html#ad56c24858a88af52e4da3ae2f6a2b3b0">$_SESSION</a>[<span class="stringliteral">&#39;logged_in&#39;</span>])) {
<a name="l00023"></a>00023     echo <span class="stringliteral">&quot;You&#39;re not logged in. &lt;br&gt; &quot;</span>; 
<a name="l00024"></a>00024     <span class="keywordflow">for</span>($i=0;$i&lt;35;$i++) echo <span class="stringliteral">&quot;&lt;br&gt;&quot;</span>;
<a name="l00025"></a>00025     include(<span class="stringliteral">&quot;footer.php&quot;</span>);
<a name="l00026"></a>00026     exit;
<a name="l00027"></a>00027 }
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="keywordflow">if</span>(<a class="code" href="lib_8mysql_8php.html#acdc8ebc6dbeee8624b9ddcfd3f892098">sc_access_check</a>(<span class="stringliteral">&quot;exams.php&quot;</span>,<span class="stringliteral">&quot;view_results&quot;</span>)) {
<a name="l00031"></a>00031     
<a name="l00032"></a>00032     $qc=<a class="code" href="session_8php.html#ad56c24858a88af52e4da3ae2f6a2b3b0">$_SESSION</a>[<span class="stringliteral">&#39;question_id&#39;</span>];
<a name="l00033"></a>00033     <span class="keywordflow">if</span>($qc) {
<a name="l00034"></a>00034 
<a name="l00035"></a>00035         <a class="code" href="sp_8php.html#a8abe176bc41afd728f32ba8c506cbd98">$r</a>=<a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>(<span class="stringliteral">&quot;select * from exam_questions where id=&#39;$qc&#39;&quot;</span>);
<a name="l00036"></a>00036         $q=mysql_fetch_assoc(<a class="code" href="sp_8php.html#a8abe176bc41afd728f32ba8c506cbd98">$r</a>);
<a name="l00037"></a>00037         
<a name="l00038"></a>00038         <span class="comment">//echo &quot;&lt;hr&gt;&quot;;</span>
<a name="l00039"></a>00039         
<a name="l00040"></a>00040         $correct=<span class="keyword">false</span>;
<a name="l00041"></a>00041         
<a name="l00042"></a>00042         <a class="code" href="lib_8debug_8php.html#a9b55f447faf2e1928eb5c9ce9b9a864d">d_echo</a>(<span class="stringliteral">&quot;PREVIOUS QUESTION RESULTS: ($exam_id.$qc) &quot;</span>);
<a name="l00043"></a>00043         <a class="code" href="lib_8debug_8php.html#a9b55f447faf2e1928eb5c9ce9b9a864d">d_echo</a>(<span class="stringliteral">&quot;type: &quot;</span>.$q[<span class="stringliteral">&#39;type&#39;</span>].<span class="stringliteral">&quot; &quot;</span>.<span class="stringliteral">&quot;correct answer: &quot;</span>.$q[<span class="stringliteral">&#39;correct_answer&#39;</span>]);
<a name="l00044"></a>00044 
<a name="l00045"></a>00045        $qx=explode(<span class="stringliteral">&quot;,&quot;</span>,$q[<span class="stringliteral">&quot;correct_answer&quot;</span>]);
<a name="l00046"></a>00046         
<a name="l00047"></a>00047         <span class="keywordflow">for</span>($i=0;$i&lt;count($qx);$i++) <a class="code" href="lib_8debug_8php.html#a9b55f447faf2e1928eb5c9ce9b9a864d">d_echo</a>($qx[$i].<span class="stringliteral">&quot; -&gt; &quot;</span>.$q[<span class="stringliteral">&quot;choice_&quot;</span>.$qx[$i]]);
<a name="l00048"></a>00048 
<a name="l00049"></a>00049         <span class="keywordflow">if</span> ($q[<span class="stringliteral">&quot;type&quot;</span>]==<span class="stringliteral">&quot;multi_select&quot;</span>)  {
<a name="l00050"></a>00050 
<a name="l00051"></a>00051             <span class="keywordflow">if</span>($a==<span class="stringliteral">&quot;A&quot;</span>) $correct=<span class="stringliteral">&quot;$a&quot;</span>;
<a name="l00052"></a>00052             <span class="keywordflow">if</span>($b==<span class="stringliteral">&quot;B&quot;</span>) $correct.=<span class="stringliteral">&quot;,$b&quot;</span>;
<a name="l00053"></a>00053             <span class="keywordflow">if</span>(<a class="code" href="sp_8php.html#a26c2f6c0ee7cb69a545305a8949c045c">$c</a>==<span class="stringliteral">&quot;C&quot;</span>) $correct.=<span class="stringliteral">&quot;,$c&quot;</span>;
<a name="l00054"></a>00054             <span class="keywordflow">if</span>($d==<span class="stringliteral">&quot;D&quot;</span>) $correct.=<span class="stringliteral">&quot;,$d&quot;</span>;
<a name="l00055"></a>00055             <span class="keywordflow">if</span>($e==<span class="stringliteral">&quot;E&quot;</span>) $correct.=<span class="stringliteral">&quot;,$e&quot;</span>;
<a name="l00056"></a>00056             <span class="keywordflow">if</span>(<a class="code" href="getclasses_8php.html#a23c42e7d231a63025b55e4eb7e3d4c99">$f</a>==<span class="stringliteral">&quot;F&quot;</span>) $correct.=<span class="stringliteral">&quot;,$f&quot;</span>;
<a name="l00057"></a>00057 
<a name="l00058"></a>00058             $correct=ltrim($correct,<span class="stringliteral">&quot;,&quot;</span>);
<a name="l00059"></a>00059 
<a name="l00060"></a>00060             <span class="comment">// echo &quot; $correct &lt;BR&gt;&quot;;</span>
<a name="l00061"></a>00061             <span class="comment">//echo $q[&#39;correct_answer&#39;].&quot; &lt;br&gt;&quot;;</span>
<a name="l00062"></a>00062             
<a name="l00063"></a>00063             <span class="keywordflow">if</span>($correct==$q[<span class="stringliteral">&#39;correct_answer&#39;</span>]) {
<a name="l00064"></a>00064                 $correct=<span class="keyword">true</span>;
<a name="l00065"></a>00065                 <span class="comment">//echo &quot;CORRECT!&lt;BR&gt;&quot;;</span>
<a name="l00066"></a>00066             } <span class="keywordflow">else</span> {
<a name="l00067"></a>00067                 $correct=<span class="keyword">false</span>;
<a name="l00068"></a>00068                 <span class="comment">//echo &quot;INCORRECT!&lt;BR&gt;&quot;;</span>
<a name="l00069"></a>00069             }
<a name="l00070"></a>00070             
<a name="l00071"></a>00071             
<a name="l00072"></a>00072         }
<a name="l00073"></a>00073         
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 
<a name="l00076"></a>00076         <span class="keywordflow">if</span> (    ($q[<span class="stringliteral">&quot;type&quot;</span>]==<span class="stringliteral">&quot;fib_dropdown&quot;</span>) ||
<a name="l00077"></a>00077                 ($q[<span class="stringliteral">&quot;type&quot;</span>]==<span class="stringliteral">&quot;fill_in_blank&quot;</span>) ) {
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 
<a name="l00080"></a>00080                     <span class="keywordflow">if</span>(!empty($qx[0])) {
<a name="l00081"></a>00081                         <span class="comment">//echo $qx[0].&quot; --- &quot;.$a.&quot; --- &quot;;</span>
<a name="l00082"></a>00082                         <span class="keywordflow">if</span>($qx[0]==$a) {
<a name="l00083"></a>00083                             <span class="comment">// echo &quot;CORRECT&quot;;</span>
<a name="l00084"></a>00084                             $correct=<span class="keyword">true</span>;
<a name="l00085"></a>00085                             }
<a name="l00086"></a>00086                         }
<a name="l00087"></a>00087                         
<a name="l00088"></a>00088                     <span class="keywordflow">if</span>(!empty($qx[1])) {
<a name="l00089"></a>00089                          <span class="comment">//echo $qx[1].&quot; --- &quot;.$b.&quot; --- &quot;;</span>
<a name="l00090"></a>00090                         <span class="keywordflow">if</span>($qx[1]==$b) { 
<a name="l00091"></a>00091                             <span class="comment">// echo &quot;CORRECT&quot;;</span>
<a name="l00092"></a>00092                              $correct=<span class="keyword">true</span>; 
<a name="l00093"></a>00093                             }
<a name="l00094"></a>00094                             <span class="keywordflow">else</span> $correct=<span class="keyword">false</span>;
<a name="l00095"></a>00095                         }
<a name="l00096"></a>00096                         
<a name="l00097"></a>00097                     <span class="keywordflow">if</span>(!empty($qx[2])) {
<a name="l00098"></a>00098                         <span class="comment">//echo $qx[2].&quot; --- &quot;.$c.&quot; --- &quot;;</span>
<a name="l00099"></a>00099                         <span class="keywordflow">if</span>($qx[2]==<a class="code" href="sp_8php.html#a26c2f6c0ee7cb69a545305a8949c045c">$c</a>) { 
<a name="l00100"></a>00100                             <span class="comment">//echo &quot;CORRECT&quot;;</span>
<a name="l00101"></a>00101                             $correct=<span class="keyword">true</span>; 
<a name="l00102"></a>00102                             }
<a name="l00103"></a>00103                             <span class="keywordflow">else</span> $correct=<span class="keyword">false</span>;
<a name="l00104"></a>00104                         }
<a name="l00105"></a>00105                         
<a name="l00106"></a>00106                     <span class="keywordflow">if</span>(!empty($qx[3])) {
<a name="l00107"></a>00107                         <span class="comment">//echo $qx[3].&quot; --- &quot;.$d.&quot; --- &quot;;</span>
<a name="l00108"></a>00108                         <span class="keywordflow">if</span>($qx[3]==$d) { 
<a name="l00109"></a>00109                             <span class="comment">//echo &quot;CORRECT&quot;;</span>
<a name="l00110"></a>00110                             $correct=<span class="keyword">true</span>; 
<a name="l00111"></a>00111                             }
<a name="l00112"></a>00112                             <span class="keywordflow">else</span> $correct=<span class="keyword">false</span>;
<a name="l00113"></a>00113                         }
<a name="l00114"></a>00114                         
<a name="l00115"></a>00115                     <span class="keywordflow">if</span>(!empty($qx[4])) {
<a name="l00116"></a>00116                         <span class="comment">//echo $qx[4].&quot; --- &quot;.$e.&quot; --- &quot;;</span>
<a name="l00117"></a>00117                         <span class="keywordflow">if</span>($qx[4]==$e) { 
<a name="l00118"></a>00118                             <span class="comment">//echo &quot;CORRECT&quot;;</span>
<a name="l00119"></a>00119                             $correct=<span class="keyword">true</span>; 
<a name="l00120"></a>00120                             }
<a name="l00121"></a>00121                             <span class="keywordflow">else</span> $correct=<span class="keyword">false</span>;
<a name="l00122"></a>00122                         }
<a name="l00123"></a>00123                         
<a name="l00124"></a>00124                     <span class="keywordflow">if</span>(!empty($qx[5])) {
<a name="l00125"></a>00125                         <span class="comment">//echo $qx[5].&quot; --- &quot;.$f.&quot; --- &quot;;</span>
<a name="l00126"></a>00126                         <span class="keywordflow">if</span>($qx[5]==<a class="code" href="getclasses_8php.html#a23c42e7d231a63025b55e4eb7e3d4c99">$f</a>) { 
<a name="l00127"></a>00127                             <span class="comment">//echo &quot;CORRECT&quot;;</span>
<a name="l00128"></a>00128                             $correct=<span class="keyword">true</span>; 
<a name="l00129"></a>00129                             }
<a name="l00130"></a>00130                             <span class="keywordflow">else</span> $correct=<span class="keyword">false</span>;
<a name="l00131"></a>00131                         }
<a name="l00132"></a>00132                 
<a name="l00133"></a>00133         }
<a name="l00134"></a>00134         
<a name="l00135"></a>00135         
<a name="l00136"></a>00136         <span class="keywordflow">if</span>($q[<span class="stringliteral">&quot;type&quot;</span>]==<span class="stringliteral">&quot;multiple_choice&quot;</span>) {
<a name="l00137"></a>00137             
<a name="l00138"></a>00138             <span class="comment">//echo &quot; --- $group1 --- &quot;;</span>
<a name="l00139"></a>00139             <span class="comment">//echo $q[&#39;correct_answer&#39;];</span><span class="comment"></span>
<a name="l00140"></a>00140 <span class="comment">            /// echo &quot; --- &quot;;</span>
<a name="l00141"></a>00141 <span class="comment"></span>            
<a name="l00142"></a>00142             
<a name="l00143"></a>00143             <span class="keywordflow">if</span>($group1==$q[<span class="stringliteral">&quot;correct_answer&quot;</span>])  {
<a name="l00144"></a>00144                 <span class="comment">//echo &quot;CORRECT&quot;;</span>
<a name="l00145"></a>00145                 $correct=<span class="keyword">true</span>;  
<a name="l00146"></a>00146             }               
<a name="l00147"></a>00147         }  <span class="comment">// c3745-is-mz.122-13.T9.bin</span>
<a name="l00148"></a>00148         
<a name="l00149"></a>00149         <span class="keywordflow">if</span>($q[<span class="stringliteral">&quot;type&quot;</span>]==<span class="stringliteral">&quot;true_false&quot;</span>) {
<a name="l00150"></a>00150             
<a name="l00151"></a>00151             <span class="comment">//echo &quot; --- $group1 --- &quot;;</span>
<a name="l00152"></a>00152             <span class="comment">//echo $q[&#39;correct_answer&#39;];</span>
<a name="l00153"></a>00153             <span class="comment">//echo &quot; --- &quot;;</span>
<a name="l00154"></a>00154             
<a name="l00155"></a>00155             <span class="keywordflow">if</span>(strtolower($group1)==$q[<span class="stringliteral">&quot;correct_answer&quot;</span>]) {
<a name="l00156"></a>00156                 
<a name="l00157"></a>00157              <span class="comment">//echo &quot;CORRECT&quot;;</span>
<a name="l00158"></a>00158                 $correct=<span class="keyword">true</span>;  
<a name="l00159"></a>00159             }
<a name="l00160"></a>00160         }
<a name="l00161"></a>00161         
<a name="l00162"></a>00162         <a class="code" href="lib_8debug_8php.html#a9b55f447faf2e1928eb5c9ce9b9a864d">d_echo</a>(<span class="stringliteral">&quot;group1: $group1 &lt;BR&gt;</span>
<a name="l00163"></a>00163 <span class="stringliteral">        a: $a &lt;BR&gt;</span>
<a name="l00164"></a>00164 <span class="stringliteral">        b: $b &lt;BR&gt;</span>
<a name="l00165"></a>00165 <span class="stringliteral">        c: $c &lt;BR&gt;</span>
<a name="l00166"></a>00166 <span class="stringliteral">        d: $d &lt;BR&gt;</span>
<a name="l00167"></a>00167 <span class="stringliteral">        e: $e &lt;BR&gt;</span>
<a name="l00168"></a>00168 <span class="stringliteral">        f: $f&quot;</span>);
<a name="l00169"></a>00169         
<a name="l00170"></a>00170         
<a name="l00171"></a>00171         <a class="code" href="lib_8debug_8php.html#a9b55f447faf2e1928eb5c9ce9b9a864d">d_echo</a> (<span class="stringliteral">&quot; CORRECT: $correct &quot;</span>);     
<a name="l00172"></a>00172 
<a name="l00173"></a>00173             <a class="code" href="sp_8php.html#a8abe176bc41afd728f32ba8c506cbd98">$r</a>=<a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>(<span class="stringliteral">&quot;select * from exam_users where `question_id`=&#39;$qc&#39; and</span>
<a name="l00174"></a>00174 <span class="stringliteral">                                                              `user`=&#39;$data-&gt;name&#39; and</span>
<a name="l00175"></a>00175 <span class="stringliteral">                                                              `exam_id`=&#39;$exam_id&#39; &quot;</span>);
<a name="l00176"></a>00176                                                               
<a name="l00177"></a>00177             $eud=@mysql_fetch_object(<a class="code" href="sp_8php.html#a8abe176bc41afd728f32ba8c506cbd98">$r</a>);
<a name="l00178"></a>00178                                                             
<a name="l00179"></a>00179             <span class="keywordflow">if</span>($eud-&gt;id) { 
<a name="l00180"></a>00180                                 <a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>(<span class="stringliteral">&quot;update exam_users set `correct`=&#39;$correct&#39;  where `question_id`=&#39;$qc&#39; and</span>
<a name="l00181"></a>00181 <span class="stringliteral">                                                                      `user`=&#39;$data-&gt;name&#39; and</span>
<a name="l00182"></a>00182 <span class="stringliteral">                                                                       `exam_id`=&#39;$exam_id&#39;&quot;</span>);
<a name="l00183"></a>00183             }
<a name="l00184"></a>00184             <span class="keywordflow">else</span> {
<a name="l00185"></a>00185         
<a name="l00186"></a>00186                     <a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>(<span class="stringliteral">&quot;insert into exam_users   (`user`, `exam_id`, `question_id`, `correct`)</span>
<a name="l00187"></a>00187 <span class="stringliteral">                                                    values (&#39;$data-&gt;name&#39;, &#39;$exam_id&#39;, &#39;$qc&#39;, &#39;$correct&#39;) &quot;</span>);
<a name="l00188"></a>00188                                                     
<a name="l00189"></a>00189             }
<a name="l00190"></a>00190 
<a name="l00191"></a>00191         <span class="comment">//echo &quot;&lt;hr&gt;&quot;;</span>
<a name="l00192"></a>00192         <a class="code" href="session_8php.html#ad56c24858a88af52e4da3ae2f6a2b3b0">$_SESSION</a>[<span class="stringliteral">&#39;question_id&#39;</span>]=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00193"></a>00193     }
<a name="l00194"></a>00194     
<a name="l00195"></a>00195 }
<a name="l00196"></a>00196 
<a name="l00197"></a>00197 
<a name="l00198"></a>00198 <span class="keywordflow">if</span>(<a class="code" href="install_8php.html#af9da176a74bd49cb97ea35c6ac7257bc">$action</a>==<span class="stringliteral">&quot;reset_exam&quot;</span>){
<a name="l00199"></a>00199     $qid=0;
<a name="l00200"></a>00200     <a class="code" href="session_8php.html#ad56c24858a88af52e4da3ae2f6a2b3b0">$_SESSION</a>[<span class="stringliteral">&#39;exam_$exam_id&#39;</span>]=<span class="stringliteral">&quot;0&quot;</span>;
<a name="l00201"></a>00201 }
<a name="l00202"></a>00202 
<a name="l00203"></a>00203 <span class="keywordflow">if</span>(<a class="code" href="install_8php.html#af9da176a74bd49cb97ea35c6ac7257bc">$action</a>==<span class="stringliteral">&quot;admin_exam_test&quot;</span>) {
<a name="l00204"></a>00204     <a class="code" href="session_8php.html#ad56c24858a88af52e4da3ae2f6a2b3b0">$_SESSION</a>[<span class="stringliteral">&#39;exam_$exam_id&#39;</span>]=<span class="stringliteral">&quot;1&quot;</span>;
<a name="l00205"></a>00205     <a class="code" href="install_8php.html#af9da176a74bd49cb97ea35c6ac7257bc">$action</a>=<span class="stringliteral">&quot;run_exam&quot;</span>;
<a name="l00206"></a>00206 }
<a name="l00207"></a>00207 
<a name="l00208"></a>00208 <span class="keywordflow">if</span>(empty(<a class="code" href="install_8php.html#af9da176a74bd49cb97ea35c6ac7257bc">$action</a>)) <a class="code" href="install_8php.html#af9da176a74bd49cb97ea35c6ac7257bc">$action</a>=<span class="stringliteral">&quot;list_exams&quot;</span>;
<a name="l00209"></a>00209 
<a name="l00210"></a>00210 <span class="keywordflow">if</span> (<a class="code" href="install_8php.html#af9da176a74bd49cb97ea35c6ac7257bc">$action</a>==<span class="stringliteral">&quot;list_exams&quot;</span>) {
<a name="l00211"></a>00211 
<a name="l00212"></a>00212     <span class="keywordflow">if</span>( <a class="code" href="lib_8mysql_8php.html#acdc8ebc6dbeee8624b9ddcfd3f892098">sc_access_check</a>(<span class="stringliteral">&quot;exams.php&quot;</span>,<span class="stringliteral">&quot;edit&quot;</span>) ) { 
<a name="l00213"></a>00213             echo <span class="stringliteral">&quot;[&lt;a href=&#39;$RFS_SITE_URL/modules/exams/exams.php?action=admin_edit&#39;&gt;Exam Administration&lt;/a&gt;]&quot;</span>;
<a name="l00214"></a>00214     }   
<a name="l00215"></a>00215     
<a name="l00216"></a>00216     
<a name="l00217"></a>00217     $n=0;
<a name="l00218"></a>00218     <a class="code" href="sp_8php.html#a8abe176bc41afd728f32ba8c506cbd98">$r</a>=<a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>(<span class="stringliteral">&quot;select * from exams&quot;</span>);
<a name="l00219"></a>00219     <span class="keywordflow">if</span>(<a class="code" href="sp_8php.html#a8abe176bc41afd728f32ba8c506cbd98">$r</a>) $n=mysql_num_rows(<a class="code" href="sp_8php.html#a8abe176bc41afd728f32ba8c506cbd98">$r</a>);
<a name="l00220"></a>00220     echo <span class="stringliteral">&quot;&lt;table border=0 cellspacing=0 cellpadding=2&gt;&quot;</span>;
<a name="l00221"></a>00221     
<a name="l00222"></a>00222     echo <span class="stringliteral">&quot;&lt;tr&gt; &lt;td&gt;&lt;/td&gt; &lt;td&gt; Name &lt;/td&gt;  &lt;td&gt;Your Score&lt;/td&gt;  &lt;td&gt;Passing Score&lt;/td&gt; &lt;/tr&gt;&quot;</span>;
<a name="l00223"></a>00223     <span class="keywordflow">for</span>($i=0;$i&lt;$n;$i++) {
<a name="l00224"></a>00224             <a class="code" href="linkbin_2linkbin_8php.html#acc3ddc926074609c4cff4f0aa1793fad">$gt</a>++; <span class="keywordflow">if</span>(<a class="code" href="linkbin_2linkbin_8php.html#acc3ddc926074609c4cff4f0aa1793fad">$gt</a>&gt;1) <a class="code" href="linkbin_2linkbin_8php.html#acc3ddc926074609c4cff4f0aa1793fad">$gt</a>=0;
<a name="l00225"></a>00225             $exam=mysql_fetch_object(<a class="code" href="sp_8php.html#a8abe176bc41afd728f32ba8c506cbd98">$r</a>);
<a name="l00226"></a>00226             echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;
<a name="l00227"></a>00227             
<a name="l00228"></a>00228             echo <span class="stringliteral">&quot;&lt;td class=sc_project_table_$gt&gt;&quot;</span>;         
<a name="l00229"></a>00229             echo <span class="stringliteral">&quot;&lt;a href=&#39;$RFS_SITE_URL/modules/exams/exams.php?action=run_exam&amp;exam_id=$exam-&gt;id&#39;&gt;</span>
<a name="l00230"></a>00230 <span class="stringliteral">            &lt;img src=&#39;$RFS_SITE_URL/images/icons/Play.png&#39; width=16 border=0&gt;&lt;/a&gt;</span>
<a name="l00231"></a>00231 <span class="stringliteral">            &lt;/td&gt;&quot;</span>;
<a name="l00232"></a>00232             
<a name="l00233"></a>00233             echo <span class="stringliteral">&quot;&lt;td class=sc_project_table_$gt&gt;&quot;</span>;
<a name="l00234"></a>00234             
<a name="l00235"></a>00235             echo <span class="stringliteral">&quot;&lt;a href=&#39;$RFS_SITE_URL/modules/exams/exams.php?action=run_exam&amp;exam_id=$exam-&gt;id&#39;&gt;$exam-&gt;name&lt;/a&gt;&quot;</span>;
<a name="l00236"></a>00236             
<a name="l00237"></a>00237             echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;
<a name="l00238"></a>00238             
<a name="l00239"></a>00239             
<a name="l00240"></a>00240             echo <span class="stringliteral">&quot;&lt;td class=sc_project_table_$gt&gt;&quot;</span>;
<a name="l00241"></a>00241             $eprct=<a class="code" href="lib_8exams_8php.html#a9806992330b13f93930b7d77043f6af6">exams_get_prct</a>(<a class="code" href="adm_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>-&gt;name,$exam-&gt;id);
<a name="l00242"></a>00242             $escor=<a class="code" href="lib_8exams_8php.html#a23a9e36c4642c574f1dcc00404ae1926">exams_get_score</a>(<a class="code" href="adm_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>-&gt;name,$exam-&gt;id);
<a name="l00243"></a>00243             $etotq=<a class="code" href="lib_8exams_8php.html#abc7a2842625f3b9d9c427f8e4cd9a52d">exams_get_total_questions</a>($exam-&gt;id);
<a name="l00244"></a>00244             
<a name="l00245"></a>00245             $oclr=<span class="stringliteral">&quot;RED&quot;</span>;
<a name="l00246"></a>00246             <span class="keywordflow">if</span>($eprct&gt;=$exam-&gt;pass_percent) $oclr=<span class="stringliteral">&quot;GREEN&quot;</span>;
<a name="l00247"></a>00247             
<a name="l00248"></a>00248             <a class="code" href="lib_8rfs_8php.html#aa8cc5d5d1daaf3d80162755c52959d9b">sc_info</a>(<span class="stringliteral">&quot;$escor/$etotq : $eprct%&quot;</span>, <span class="stringliteral">&quot;WHITE&quot;</span>, $oclr);
<a name="l00249"></a>00249             
<a name="l00250"></a>00250             echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;
<a name="l00251"></a>00251             
<a name="l00252"></a>00252 
<a name="l00253"></a>00253             echo <span class="stringliteral">&quot;&lt;td class=sc_project_table_$gt&gt;&quot;</span>;
<a name="l00254"></a>00254             echo $exam-&gt;pass_percent.<span class="stringliteral">&quot;%&quot;</span>;           
<a name="l00255"></a>00255             echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;
<a name="l00256"></a>00256             
<a name="l00257"></a>00257             
<a name="l00258"></a>00258             echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;           
<a name="l00259"></a>00259     }
<a name="l00260"></a>00260     echo <span class="stringliteral">&quot;&lt;/table&gt;&quot;</span>;
<a name="l00261"></a>00261     <span class="keywordflow">if</span>(!$n) echo <span class="stringliteral">&quot;There are no exams... yet.&lt;br&gt;&quot;</span>;
<a name="l00262"></a>00262 
<a name="l00263"></a>00263 }
<a name="l00264"></a>00264 
<a name="l00265"></a>00265 <span class="keywordflow">if</span>(<a class="code" href="install_8php.html#af9da176a74bd49cb97ea35c6ac7257bc">$action</a>==<span class="stringliteral">&quot;wipe_exam&quot;</span>) {
<a name="l00266"></a>00266     <a class="code" href="lib_8exams_8php.html#af57111353abc0d0a53d61d6fc6f16129">exams_wipe_user_exam</a>(<a class="code" href="adm_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>-&gt;name,$exam_id);
<a name="l00267"></a>00267     <a class="code" href="install_8php.html#af9da176a74bd49cb97ea35c6ac7257bc">$action</a>=<span class="stringliteral">&quot;run_exam&quot;</span>;
<a name="l00268"></a>00268 }
<a name="l00269"></a>00269 
<a name="l00270"></a>00270 <span class="keywordflow">if</span>(<a class="code" href="install_8php.html#af9da176a74bd49cb97ea35c6ac7257bc">$action</a>==<span class="stringliteral">&quot;run_exam&quot;</span>) {
<a name="l00271"></a>00271     
<a name="l00272"></a>00272     $exam   = <a class="code" href="lib_8mysql_8php.html#ad42d2c11477299cecf3dd06b259a316e">mfo1</a>(<span class="stringliteral">&quot;select * from exams where id=&#39;$exam_id&#39;&quot;</span>);          
<a name="l00273"></a>00273     $eprct  = <a class="code" href="lib_8exams_8php.html#a9806992330b13f93930b7d77043f6af6">exams_get_prct</a>(<a class="code" href="adm_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>-&gt;name,$exam_id);
<a name="l00274"></a>00274     $escor  = <a class="code" href="lib_8exams_8php.html#a23a9e36c4642c574f1dcc00404ae1926">exams_get_score</a>(<a class="code" href="adm_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>-&gt;name,$exam_id);
<a name="l00275"></a>00275     $etotq  = <a class="code" href="lib_8exams_8php.html#abc7a2842625f3b9d9c427f8e4cd9a52d">exams_get_total_questions</a>($exam_id);          
<a name="l00276"></a>00276     $etotqa = <a class="code" href="lib_8exams_8php.html#a346cbfcaf6d4eac8d9eeb85657ac9c45">exams_get_total_questions_answered</a>(<a class="code" href="adm_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>-&gt;name,$exam_id);
<a name="l00277"></a>00277     $oclr=<span class="stringliteral">&quot;RED&quot;</span>;
<a name="l00278"></a>00278     <span class="keywordflow">if</span>($eprct&gt;=$exam-&gt;pass_percent) $oclr=<span class="stringliteral">&quot;GREEN&quot;</span>;
<a name="l00279"></a>00279     
<a name="l00280"></a>00280     
<a name="l00281"></a>00281     <span class="keywordflow">if</span>($oclr==<span class="stringliteral">&quot;GREEN&quot;</span>) {
<a name="l00282"></a>00282         <span class="keywordflow">if</span>( $etotq == $etotqa ) {
<a name="l00283"></a>00283             
<a name="l00284"></a>00284             <a class="code" href="lib_8rfs_8php.html#aa8cc5d5d1daaf3d80162755c52959d9b">sc_info</a>(<span class="stringliteral">&quot;$escor/$etotq : $eprct%&quot;</span>, <span class="stringliteral">&quot;WHITE&quot;</span>, $oclr);
<a name="l00285"></a>00285             <a class="code" href="lib_8rfs_8php.html#aa8cc5d5d1daaf3d80162755c52959d9b">sc_info</a>($exam-&gt;pass_percent.<span class="stringliteral">&quot;% minimum passing score required.&quot;</span>, <span class="stringliteral">&quot;WHITE&quot;</span>, <span class="stringliteral">&quot;BLUE&quot;</span>);
<a name="l00286"></a>00286             <a class="code" href="lib_8rfs_8php.html#a253f1d0920d464309dd47147be42fedf">sc_warn</a>(<span class="stringliteral">&quot;You have already taken this exam and passed. If you wish, you may retake the exam, but your current score will be erased and you will have to take the exam in it&#39;s entirety with a passing score to recieve credit. If you are sure then</span>
<a name="l00287"></a>00287 <span class="stringliteral">            &lt;a href=&#39;$RFS_SITE_URL/modules/exams/exams.php?action=wipe_exam&amp;exam_id=$exam_id&#39;&gt;&lt;img src=$RFS_SITE_URL/images/icons/Play.png border=0&gt;click here&lt;/a&gt;. Note: This action can not be reversed.&quot;</span>);
<a name="l00288"></a>00288             <span class="keywordflow">for</span>($i=0;$i&lt;35;$i++) echo <span class="stringliteral">&quot;&lt;br&gt;&quot;</span>;
<a name="l00289"></a>00289             include(<span class="stringliteral">&quot;footer.php&quot;</span>);
<a name="l00290"></a>00290             exit();
<a name="l00291"></a>00291         
<a name="l00292"></a>00292         }
<a name="l00293"></a>00293 
<a name="l00294"></a>00294     }
<a name="l00295"></a>00295 
<a name="l00296"></a>00296     <a class="code" href="lib_8debug_8php.html#a9b55f447faf2e1928eb5c9ce9b9a864d">d_echo</a>(<span class="stringliteral">&quot;Exam $exam_id&quot;</span>);
<a name="l00297"></a>00297     $exam=<a class="code" href="lib_8mysql_8php.html#ad42d2c11477299cecf3dd06b259a316e">mfo1</a>(<span class="stringliteral">&quot;select * from exams where id=&#39;$exam_id&#39;&quot;</span>);
<a name="l00298"></a>00298     <a class="code" href="lib_8debug_8php.html#a9b55f447faf2e1928eb5c9ce9b9a864d">d_echo</a>(<span class="stringliteral">&quot;$exam-&gt;name&quot;</span>);
<a name="l00299"></a>00299 
<a name="l00300"></a>00300     <span class="keywordflow">if</span>($qsid!=<a class="code" href="session_8php.html#ad56c24858a88af52e4da3ae2f6a2b3b0">$_SESSION</a>[<span class="stringliteral">&#39;exam_$exam_id&#39;</span>]) <a class="code" href="session_8php.html#ad56c24858a88af52e4da3ae2f6a2b3b0">$_SESSION</a>[<span class="stringliteral">&#39;exam_$exam_id&#39;</span>]=$qsid;
<a name="l00301"></a>00301 
<a name="l00302"></a>00302     <a class="code" href="sp_8php.html#a8abe176bc41afd728f32ba8c506cbd98">$r</a>=<a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>(<span class="stringliteral">&quot;select * from exam_questions where exam_id=&#39;$exam_id&#39;&quot;</span>);
<a name="l00303"></a>00303     $nq=mysql_num_rows(<a class="code" href="sp_8php.html#a8abe176bc41afd728f32ba8c506cbd98">$r</a>);
<a name="l00304"></a>00304 
<a name="l00305"></a>00305     <a class="code" href="lib_8debug_8php.html#a9b55f447faf2e1928eb5c9ce9b9a864d">d_echo</a>(<span class="stringliteral">&quot;$nq&quot;</span>);
<a name="l00306"></a>00306 
<a name="l00307"></a>00307     $qsid=<a class="code" href="session_8php.html#ad56c24858a88af52e4da3ae2f6a2b3b0">$_SESSION</a>[<span class="stringliteral">&#39;exam_$exam_id&#39;</span>];
<a name="l00308"></a>00308 
<a name="l00309"></a>00309     <span class="keywordflow">if</span>($qsid&lt;1) $qsid=1;
<a name="l00310"></a>00310         <a class="code" href="session_8php.html#ad56c24858a88af52e4da3ae2f6a2b3b0">$_SESSION</a>[<span class="stringliteral">&#39;exam_$exam_id&#39;</span>]=1;
<a name="l00311"></a>00311 
<a name="l00312"></a>00312     <a class="code" href="lib_8debug_8php.html#a9b55f447faf2e1928eb5c9ce9b9a864d">d_echo</a>(<span class="stringliteral">&quot;$qsid&quot;</span>);
<a name="l00313"></a>00313     $question=<a class="code" href="lib_8mysql_8php.html#ad42d2c11477299cecf3dd06b259a316e">mfo1</a>(<span class="stringliteral">&quot;select * from exam_questions where exam_sequence=&#39;$qsid&#39; and exam_id=&#39;$exam_id&#39;&quot;</span>);
<a name="l00314"></a>00314     <a class="code" href="lib_8debug_8php.html#a9b55f447faf2e1928eb5c9ce9b9a864d">d_echo</a>($question-&gt;type);
<a name="l00315"></a>00315     
<a name="l00316"></a>00316     <a class="code" href="session_8php.html#ad56c24858a88af52e4da3ae2f6a2b3b0">$_SESSION</a>[<span class="stringliteral">&#39;question_id&#39;</span>]=$question-&gt;id;
<a name="l00317"></a>00317     
<a name="l00318"></a>00318     <span class="keywordflow">if</span>(empty($question-&gt;type)) {
<a name="l00319"></a>00319         
<a name="l00320"></a>00320         
<a name="l00321"></a>00321         $qq=<span class="stringliteral">&quot; &lt;BR&gt;&lt;BR&gt; END OF EXAM! &lt;HR&gt;&quot;</span>;
<a name="l00322"></a>00322         
<a name="l00323"></a>00323         <span class="comment">/*</span>
<a name="l00324"></a>00324 <span class="comment">        $r=sc_query(&quot;select * from exam_users where user=&#39;$data-&gt;name&#39; and exam_id=&#39;$exam_id&#39;&quot;);        </span>
<a name="l00325"></a>00325 <span class="comment">        $nq=mysql_num_rows($r);</span>
<a name="l00326"></a>00326 <span class="comment">        </span>
<a name="l00327"></a>00327 <span class="comment">        $r=sc_query(&quot;select * from exam_users where user=&#39;$data-&gt;name&#39; and exam_id=&#39;$exam_id&#39; and correct=&#39;1&#39;&quot;);</span>
<a name="l00328"></a>00328 <span class="comment">        $nqc=mysql_num_rows($r);</span>
<a name="l00329"></a>00329 <span class="comment">        </span>
<a name="l00330"></a>00330 <span class="comment">        $prct=$nqc/$nq;</span>
<a name="l00331"></a>00331 <span class="comment">        </span>
<a name="l00332"></a>00332 <span class="comment">        $prct=round($prct*100);</span>
<a name="l00333"></a>00333 <span class="comment">        */</span>
<a name="l00334"></a>00334         $nqc=<a class="code" href="lib_8exams_8php.html#a23a9e36c4642c574f1dcc00404ae1926">exams_get_score</a>(<a class="code" href="adm_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>-&gt;name,$exam_id);
<a name="l00335"></a>00335         $prct=<a class="code" href="lib_8exams_8php.html#a9806992330b13f93930b7d77043f6af6">exams_get_prct</a>(<a class="code" href="adm_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>-&gt;name,$exam_id);
<a name="l00336"></a>00336 
<a name="l00337"></a>00337         $qq.=<span class="stringliteral">&quot;&lt;h1&gt;&quot;</span>;
<a name="l00338"></a>00338         $qq.=<span class="stringliteral">&quot;You answered $nqc questions correctly out of $nq &lt;br&gt;&quot;</span>;       
<a name="l00339"></a>00339         $qq.=<span class="stringliteral">&quot;Percentage answered correctly $prct %&lt;br&gt;&quot;</span>;       
<a name="l00340"></a>00340         
<a name="l00341"></a>00341         $exam=<a class="code" href="lib_8mysql_8php.html#ad42d2c11477299cecf3dd06b259a316e">mfo1</a>(<span class="stringliteral">&quot;select * from exams where id=&#39;$exam_id&#39;&quot;</span>);
<a name="l00342"></a>00342         
<a name="l00343"></a>00343         $qq.=<span class="stringliteral">&quot;Minimum passing score for this exam: $exam-&gt;pass_percent &lt;br&gt; &lt;hr&gt;&quot;</span>;      
<a name="l00344"></a>00344         <span class="keywordflow">if</span>($prct&gt;$exam-&gt;pass_percent) {
<a name="l00345"></a>00345             $qq.=<span class="stringliteral">&quot;&lt;BR&gt;Congratulations, you passed.&lt;br&gt;&lt;BR&gt;&lt;hr&gt;&quot;</span>;
<a name="l00346"></a>00346             $qq.=<span class="stringliteral">&quot;Tasks covered by this exam:&lt;br&gt;&quot;</span>;
<a name="l00347"></a>00347             <a class="code" href="sp_8php.html#a8abe176bc41afd728f32ba8c506cbd98">$r</a>=<a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>(<span class="stringliteral">&quot;select distinct task from exam_questions where exam_id=&#39;$exam_id&#39;&quot;</span>);
<a name="l00348"></a>00348             <span class="keywordflow">for</span>($i=0;$i&lt;mysql_num_rows(<a class="code" href="sp_8php.html#a8abe176bc41afd728f32ba8c506cbd98">$r</a>);$i++) {
<a name="l00349"></a>00349                 $eq=mysql_fetch_object(<a class="code" href="sp_8php.html#a8abe176bc41afd728f32ba8c506cbd98">$r</a>);
<a name="l00350"></a>00350                 $qq.= <span class="stringliteral">&quot; $eq-&gt;task &lt;br&gt;&quot;</span>;
<a name="l00351"></a>00351             }
<a name="l00352"></a>00352             
<a name="l00353"></a>00353         } <span class="keywordflow">else</span> {
<a name="l00354"></a>00354             $qq.=<span class="stringliteral">&quot;You did not pass, please review the missed questions.&lt;br&gt;&lt;br&gt;&quot;</span>;
<a name="l00355"></a>00355             
<a name="l00356"></a>00356             
<a name="l00357"></a>00357         }       
<a name="l00358"></a>00358         $qq.=<span class="stringliteral">&quot;&lt;hr&gt;&lt;/h1&gt;&quot;</span>;
<a name="l00359"></a>00359 
<a name="l00360"></a>00360         $qq.=<span class="stringliteral">&quot;[&lt;a href=\&quot;$RFS_SITE_URL/modules/exams/exams.php?action=run_exam&amp;exam_id=$exam_id\&quot;&gt;Take this exam again&lt;/a&gt;]&quot;</span>;
<a name="l00361"></a>00361         $qq.=<span class="stringliteral">&quot;[Review missed questions]&quot;</span>;
<a name="l00362"></a>00362         $qq.=<span class="stringliteral">&quot;[Review all questions]&quot;</span>;
<a name="l00363"></a>00363         
<a name="l00364"></a>00364         <span class="keywordflow">if</span>( <a class="code" href="lib_8mysql_8php.html#acdc8ebc6dbeee8624b9ddcfd3f892098">sc_access_check</a>(<span class="stringliteral">&quot;exam_questions&quot;</span>,<span class="stringliteral">&quot;edit&quot;</span>) ) {
<a name="l00365"></a>00365                 $qq.=<span class="stringliteral">&quot;[&lt;a href=&#39;$RFS_SITE_URL/modules/exams/exams.php?action=admin_edit&#39;&gt;Exam Administration&lt;/a&gt;]&quot;</span>;
<a name="l00366"></a>00366         }
<a name="l00367"></a>00367         
<a name="l00368"></a>00368         $qq.=<span class="stringliteral">&quot;&lt;BR&gt;&lt;BR&gt; &lt;BR&gt;&lt;BR&gt;&quot;</span>;
<a name="l00369"></a>00369         
<a name="l00370"></a>00370         <a class="code" href="lib_8rfs_8php.html#ad462cd70a0b4384f67611d5608d5439f">sc_question</a>($qq);
<a name="l00371"></a>00371             
<a name="l00372"></a>00372         
<a name="l00373"></a>00373         
<a name="l00374"></a>00374         
<a name="l00375"></a>00375     }
<a name="l00376"></a>00376     <span class="keywordflow">else</span> {
<a name="l00377"></a>00377         
<a name="l00378"></a>00378         
<a name="l00379"></a>00379 
<a name="l00380"></a>00380 
<a name="l00381"></a>00381     $qq=<span class="stringliteral">&quot;&lt;br&gt;&lt;h1&gt; EXAM: $exam-&gt;name question ($qsid / $nq) &lt;/h1&gt; &quot;</span>;
<a name="l00382"></a>00382     <span class="comment">// $qq.=&quot;&lt;span style=&#39;color:red;background-color:black;&#39;&gt;    Development mode: this question is type: $question-&gt;type (ignore this) &lt;/span&gt;&quot;;</span>
<a name="l00383"></a>00383     $qq.=<span class="stringliteral">&quot;&lt;hr&gt;&quot;</span>;
<a name="l00384"></a>00384 
<a name="l00385"></a>00385     $qsid++;
<a name="l00386"></a>00386 
<a name="l00387"></a>00387     $qq.=<span class="stringliteral">&quot;&lt;form action=\&quot;$RFS_SITE_URL/modules/exams/exams.php\&quot; method=\&quot;post\&quot;&gt;\n&quot;</span>;
<a name="l00388"></a>00388     $ql= <span class="stringliteral">&quot; &lt;hr&gt;&lt;center&gt;</span>
<a name="l00389"></a>00389 <span class="stringliteral">    &lt;input type=hidden name=exam_id value=$exam-&gt;id&gt;</span>
<a name="l00390"></a>00390 <span class="stringliteral">    &lt;input type=hidden name=qsid value=$qsid&gt;</span>
<a name="l00391"></a>00391 <span class="stringliteral">    &lt;input type=hidden name=action value=run_exam&gt;</span>
<a name="l00392"></a>00392 <span class="stringliteral">    &lt;input type=submit name=submit value=Continue&gt;</span>
<a name="l00393"></a>00393 <span class="stringliteral">    &lt;/form&gt;\n&quot;</span>;
<a name="l00394"></a>00394 
<a name="l00395"></a>00395     <span class="keywordflow">if</span>(!empty($question-&gt;intro))   $qq.= <span class="stringliteral">&quot;$question-&gt;intro &lt;hr&gt;&quot;</span>;
<a name="l00396"></a>00396 
<a name="l00397"></a>00397     <span class="keywordflow">if</span>($question-&gt;type==<span class="stringliteral">&quot;multiple_choice&quot;</span>) {
<a name="l00398"></a>00398 
<a name="l00399"></a>00399         sc_div(<span class="stringliteral">&quot;MULTIPLE CHOICE TEST QUESTION&quot;</span>);
<a name="l00400"></a>00400 
<a name="l00401"></a>00401         $qq.=<span class="stringliteral">&quot;$question-&gt;question &lt;BR&gt;\n&quot;</span>;
<a name="l00402"></a>00402         $qq.=<span class="stringliteral">&quot;&lt;center&gt;&lt;img src=&#39;$question-&gt;question_image&#39; border=0 align=center width=64&gt;&lt;/center&gt;&lt;hr&gt;\n&quot;</span>;
<a name="l00403"></a>00403 
<a name="l00404"></a>00404 
<a name="l00405"></a>00405 
<a name="l00406"></a>00406         $qq.= <span class="stringliteral">&quot;&lt;input type=\&quot;radio\&quot; name=\&quot;group1\&quot; value=\&quot;A\&quot;&gt; A) $question-&gt;choice_1 &lt;br&gt;\n&quot;</span>;
<a name="l00407"></a>00407         $qq.= <span class="stringliteral">&quot;&lt;input type=\&quot;radio\&quot; name=\&quot;group1\&quot; value=\&quot;B\&quot;&gt; B) $question-&gt;choice_2 &lt;br&gt;\n&quot;</span>;
<a name="l00408"></a>00408 
<a name="l00409"></a>00409         <span class="keywordflow">if</span>(!empty($question-&gt;choice_3))
<a name="l00410"></a>00410             $qq.= <span class="stringliteral">&quot;&lt;input type=\&quot;radio\&quot; name=\&quot;group1\&quot; value=\&quot;C\&quot;&gt; C) $question-&gt;choice_3 &lt;br&gt;\n&quot;</span>;
<a name="l00411"></a>00411         <span class="keywordflow">if</span>(!empty($question-&gt;choice_4))
<a name="l00412"></a>00412             $qq.= <span class="stringliteral">&quot;&lt;input type=\&quot;radio\&quot; name=\&quot;group1\&quot; value=\&quot;D\&quot;&gt; D) $question-&gt;choice_4 &lt;br&gt;\n&quot;</span>;
<a name="l00413"></a>00413         <span class="keywordflow">if</span>(!empty($question-&gt;choice_5))
<a name="l00414"></a>00414             $qq.= <span class="stringliteral">&quot;&lt;input type=\&quot;radio\&quot; name=\&quot;group1\&quot; value=\&quot;A\&quot;&gt; E) $question-&gt;choice_5 &lt;br&gt;\n&quot;</span>;
<a name="l00415"></a>00415         <span class="keywordflow">if</span>(!empty($question-&gt;choice_6))
<a name="l00416"></a>00416             $qq.= <span class="stringliteral">&quot;&lt;input type=\&quot;radio\&quot; name=\&quot;group1\&quot; value=\&quot;A\&quot;&gt; F) $question-&gt;choice_6 &lt;br&gt;\n&quot;</span>;
<a name="l00417"></a>00417 
<a name="l00418"></a>00418        $qq.=$ql;
<a name="l00419"></a>00419     }
<a name="l00420"></a>00420 
<a name="l00421"></a>00421     <span class="keywordflow">if</span>($question-&gt;type==<span class="stringliteral">&quot;multi_select&quot;</span>) {       
<a name="l00422"></a>00422         sc_div(<span class="stringliteral">&quot;MULTI SELECT TEST QUESTION&quot;</span>);
<a name="l00423"></a>00423                 
<a name="l00424"></a>00424         $qq.=<span class="stringliteral">&quot;$question-&gt;question&lt;br&gt;&lt;br&gt;&quot;</span>;
<a name="l00425"></a>00425 
<a name="l00426"></a>00426         $qq.=<span class="stringliteral">&quot;&lt;input type=checkbox name=a value=\&quot;A\&quot;&gt; $question-&gt;choice_1 &lt;br&gt;\n&quot;</span>;
<a name="l00427"></a>00427         $qq.=<span class="stringliteral">&quot;&lt;input type=checkbox name=b value=\&quot;B\&quot;&gt; $question-&gt;choice_2 &lt;br&gt;\n&quot;</span>;
<a name="l00428"></a>00428         <span class="keywordflow">if</span>(!empty($question-&gt;choice_3)) 
<a name="l00429"></a>00429             $qq.=<span class="stringliteral">&quot;&lt;input type=checkbox name=c value=\&quot;C\&quot;&gt; $question-&gt;choice_3 &lt;br&gt;\n&quot;</span>;
<a name="l00430"></a>00430         <span class="keywordflow">if</span>(!empty($question-&gt;choice_4)) 
<a name="l00431"></a>00431             $qq.=<span class="stringliteral">&quot;&lt;input type=checkbox name=d value=\&quot;D\&quot;&gt; $question-&gt;choice_4 &lt;br&gt;\n&quot;</span>;
<a name="l00432"></a>00432         <span class="keywordflow">if</span>(!empty($question-&gt;choice_5)) 
<a name="l00433"></a>00433             $qq.=<span class="stringliteral">&quot;&lt;input type=checkbox name=e value=\&quot;E\&quot;&gt; $question-&gt;choice_5 &lt;br&gt;\n&quot;</span>;
<a name="l00434"></a>00434         <span class="keywordflow">if</span>(!empty($question-&gt;choice_6)) 
<a name="l00435"></a>00435             $qq.=<span class="stringliteral">&quot;&lt;input type=checkbox name=f value=\&quot;F\&quot;&gt; $question-&gt;choice_6 &lt;br&gt;\n&quot;</span>;
<a name="l00436"></a>00436             
<a name="l00437"></a>00437         $qq.=$ql;
<a name="l00438"></a>00438 
<a name="l00439"></a>00439     }
<a name="l00440"></a>00440 
<a name="l00441"></a>00441     <span class="keywordflow">if</span>($question-&gt;type==<span class="stringliteral">&quot;true_false&quot;</span>) {
<a name="l00442"></a>00442 
<a name="l00443"></a>00443 
<a name="l00444"></a>00444         sc_div(<span class="stringliteral">&quot;TRUE OR FALSE TEST QUESTION&quot;</span>);
<a name="l00445"></a>00445 
<a name="l00446"></a>00446         $qq.=<span class="stringliteral">&quot;$question-&gt;question&lt;br&gt;&lt;br&gt;&quot;</span>;
<a name="l00447"></a>00447 
<a name="l00448"></a>00448         $qq.= <span class="stringliteral">&quot;&lt;input type=\&quot;radio\&quot; name=\&quot;group1\&quot; value=\&quot;TRUE\&quot;&gt; TRUE &lt;br&gt;\n&quot;</span>;
<a name="l00449"></a>00449         $qq.= <span class="stringliteral">&quot;&lt;input type=\&quot;radio\&quot; name=\&quot;group1\&quot; value=\&quot;FALSE\&quot;&gt; FALSE &lt;br&gt;\n&quot;</span>;
<a name="l00450"></a>00450 
<a name="l00451"></a>00451         <span class="comment">//        $qq.=&quot;TRUE or FALSE &lt;br&gt;&quot;;</span>
<a name="l00452"></a>00452         $qq.=$ql;
<a name="l00453"></a>00453     }
<a name="l00454"></a>00454 
<a name="l00455"></a>00455     <span class="keywordflow">if</span>($question-&gt;type==<span class="stringliteral">&quot;fill_in_blank&quot;</span>) {
<a name="l00456"></a>00456 
<a name="l00457"></a>00457         sc_div(<span class="stringliteral">&quot;FILL IN THE BLANK TEST QUESTION&quot;</span>);
<a name="l00458"></a>00458 
<a name="l00459"></a>00459         $oq=str_replace(<span class="stringliteral">&quot;-a-&quot;</span>,<span class="stringliteral">&quot;&lt;input type=text name=a&gt;&quot;</span>, $question-&gt;question);
<a name="l00460"></a>00460         $oq=str_replace(<span class="stringliteral">&quot;-b-&quot;</span>,<span class="stringliteral">&quot;&lt;input type=text name=b&gt;&quot;</span>, $oq);
<a name="l00461"></a>00461         $oq=str_replace(<span class="stringliteral">&quot;-c-&quot;</span>,<span class="stringliteral">&quot;&lt;input type=text name=c&gt;&quot;</span>, $oq);
<a name="l00462"></a>00462         $oq=str_replace(<span class="stringliteral">&quot;-d-&quot;</span>,<span class="stringliteral">&quot;&lt;input type=text name=d&gt;&quot;</span>, $oq);
<a name="l00463"></a>00463         $oq=str_replace(<span class="stringliteral">&quot;-e-&quot;</span>,<span class="stringliteral">&quot;&lt;input type=text name=e&gt;&quot;</span>, $oq);
<a name="l00464"></a>00464         $oq=str_replace(<span class="stringliteral">&quot;-f-&quot;</span>,<span class="stringliteral">&quot;&lt;input type=text name=f&gt;&quot;</span>, $oq);
<a name="l00465"></a>00465 
<a name="l00466"></a>00466 
<a name="l00467"></a>00467         $qq.=$oq.$ql;
<a name="l00468"></a>00468     }
<a name="l00469"></a>00469 
<a name="l00470"></a>00470                            
<a name="l00471"></a>00471     <span class="keywordflow">if</span>($question-&gt;type==<span class="stringliteral">&quot;fib_dropdown&quot;</span>) {
<a name="l00472"></a>00472 
<a name="l00473"></a>00473             sc_div(<span class="stringliteral">&quot;FILL IN THE BLANK DROP DOWN TEST QUESTION&quot;</span>);
<a name="l00474"></a>00474 
<a name="l00475"></a>00475             $opts = <span class="stringliteral">&quot;&lt;option name=none&gt;Fill in the blank\n&quot;</span>;
<a name="l00476"></a>00476             $opts.= <span class="stringliteral">&quot;&lt;option&gt;$question-&gt;choice_1\n&quot;</span>;
<a name="l00477"></a>00477             $opts.= <span class="stringliteral">&quot;&lt;option&gt;$question-&gt;choice_2\n&quot;</span>;
<a name="l00478"></a>00478             <span class="keywordflow">if</span>(!empty($question-&gt;choice_3))
<a name="l00479"></a>00479             $opts.= <span class="stringliteral">&quot;&lt;option&gt;$question-&gt;choice_3\n&quot;</span>;
<a name="l00480"></a>00480             <span class="keywordflow">if</span>(!empty($question-&gt;choice_4))
<a name="l00481"></a>00481             $opts.= <span class="stringliteral">&quot;&lt;option&gt;$question-&gt;choice_4\n&quot;</span>;
<a name="l00482"></a>00482             <span class="keywordflow">if</span>(!empty($question-&gt;choice_5))
<a name="l00483"></a>00483             $opts.= <span class="stringliteral">&quot;&lt;option&gt;$question-&gt;choice_5\n&quot;</span>;
<a name="l00484"></a>00484             <span class="keywordflow">if</span>(!empty($question-&gt;choice_6))
<a name="l00485"></a>00485             $opts.= <span class="stringliteral">&quot;&lt;option&gt;$question-&gt;choice_6\n&quot;</span>;
<a name="l00486"></a>00486 
<a name="l00487"></a>00487 
<a name="l00488"></a>00488             $oq=str_replace(<span class="stringliteral">&quot;-a-&quot;</span>,<span class="stringliteral">&quot;&lt;select name=a&gt;&quot;</span>.$opts.<span class="stringliteral">&quot;&lt;/select&gt;&quot;</span>, $question-&gt;question);
<a name="l00489"></a>00489             $oq=str_replace(<span class="stringliteral">&quot;-b-&quot;</span>,<span class="stringliteral">&quot;&lt;select name=b&gt;&quot;</span>.$opts.<span class="stringliteral">&quot;&lt;/select&gt;&quot;</span>, $oq);
<a name="l00490"></a>00490             $oq=str_replace(<span class="stringliteral">&quot;-c-&quot;</span>,<span class="stringliteral">&quot;&lt;select name=c&gt;&quot;</span>.$opts.<span class="stringliteral">&quot;&lt;/select&gt;&quot;</span>, $oq);
<a name="l00491"></a>00491             $oq=str_replace(<span class="stringliteral">&quot;-d-&quot;</span>,<span class="stringliteral">&quot;&lt;select name=d&gt;&quot;</span>.$opts.<span class="stringliteral">&quot;&lt;/select&gt;&quot;</span>, $oq);
<a name="l00492"></a>00492             $oq=str_replace(<span class="stringliteral">&quot;-e-&quot;</span>,<span class="stringliteral">&quot;&lt;select name=e&gt;&quot;</span>.$opts.<span class="stringliteral">&quot;&lt;/select&gt;&quot;</span>, $oq);
<a name="l00493"></a>00493             $oq=str_replace(<span class="stringliteral">&quot;-f-&quot;</span>,<span class="stringliteral">&quot;&lt;select name=f&gt;&quot;</span>.$opts.<span class="stringliteral">&quot;&lt;/select&gt;&quot;</span>, $oq);
<a name="l00494"></a>00494 
<a name="l00495"></a>00495             $qq.=$oq.$ql;
<a name="l00496"></a>00496     }
<a name="l00497"></a>00497 
<a name="l00498"></a>00498 
<a name="l00499"></a>00499     $qq.=<span class="stringliteral">&quot;&lt;BR&gt;&lt;BR&gt;&lt;BR&gt;&quot;</span>;
<a name="l00500"></a>00500     <a class="code" href="lib_8rfs_8php.html#ad462cd70a0b4384f67611d5608d5439f">sc_question</a>($qq);
<a name="l00501"></a>00501     sc_div(<span class="stringliteral">&quot;END OF TEST QUESTION&quot;</span>);
<a name="l00502"></a>00502     
<a name="l00503"></a>00503     }
<a name="l00504"></a>00504 }
<a name="l00505"></a>00505 
<a name="l00506"></a>00506 
<a name="l00507"></a>00507 
<a name="l00508"></a>00508 <span class="keywordflow">if</span>(<a class="code" href="lib_8mysql_8php.html#acdc8ebc6dbeee8624b9ddcfd3f892098">sc_access_check</a>(<span class="stringliteral">&quot;exams.php&quot;</span>,<span class="stringliteral">&quot;edit&quot;</span>) ) {
<a name="l00509"></a>00509     
<a name="l00510"></a>00510     
<a name="l00511"></a>00511     <span class="keywordflow">if</span>(<a class="code" href="install_8php.html#af9da176a74bd49cb97ea35c6ac7257bc">$action</a>==<span class="stringliteral">&quot;admin_exam_edit_questions&quot;</span>) {
<a name="l00512"></a>00512         <span class="keywordflow">if</span>(!is_numeric($questions)) $questions=100;
<a name="l00513"></a>00513         
<a name="l00514"></a>00514         <a class="code" href="sp_8php.html#a8abe176bc41afd728f32ba8c506cbd98">$r</a>=<a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>(<span class="stringliteral">&quot;select * from exam_questions where exam_id=&#39;$exam_id&#39; order by exam_sequence&quot;</span>);
<a name="l00515"></a>00515         $n=mysql_num_rows(<a class="code" href="sp_8php.html#a8abe176bc41afd728f32ba8c506cbd98">$r</a>);
<a name="l00516"></a>00516         <span class="keywordflow">if</span>($questions&gt;$n) $questions=$n;
<a name="l00517"></a>00517         
<a name="l00518"></a>00518         <a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>(<span class="stringliteral">&quot;update exams set `questions` = &#39;$questions&#39; where id=&#39;$exam_id&#39;&quot;</span>);
<a name="l00519"></a>00519         <a class="code" href="install_8php.html#af9da176a74bd49cb97ea35c6ac7257bc">$action</a>=<span class="stringliteral">&quot;admin_exam_edit&quot;</span>;
<a name="l00520"></a>00520     }
<a name="l00521"></a>00521     
<a name="l00522"></a>00522     <span class="keywordflow">if</span>(<a class="code" href="install_8php.html#af9da176a74bd49cb97ea35c6ac7257bc">$action</a>==<span class="stringliteral">&quot;admin_exam_edit_method&quot;</span>) {
<a name="l00523"></a>00523         <a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>(<span class="stringliteral">&quot;update exams set `method`=&#39;$method&#39; where id=&#39;$exam_id&#39;&quot;</span>);
<a name="l00524"></a>00524         <a class="code" href="install_8php.html#af9da176a74bd49cb97ea35c6ac7257bc">$action</a>=<span class="stringliteral">&quot;admin_exam_edit&quot;</span>;
<a name="l00525"></a>00525     }
<a name="l00526"></a>00526     
<a name="l00527"></a>00527     <span class="keywordflow">if</span>(<a class="code" href="install_8php.html#af9da176a74bd49cb97ea35c6ac7257bc">$action</a>==<span class="stringliteral">&quot;admin_exam_edit_pass_percent&quot;</span>) {
<a name="l00528"></a>00528         <span class="keywordflow">if</span>(!is_numeric($pass_percent)) $pass_percent=70;
<a name="l00529"></a>00529         <span class="comment">// echo &quot; $exam_id  $pass_percent &lt;br&gt;&quot;;</span>
<a name="l00530"></a>00530         <a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>(<span class="stringliteral">&quot;update exams set `pass_percent`=&#39;$pass_percent&#39; where id=&#39;$exam_id&#39;&quot;</span>);
<a name="l00531"></a>00531         <a class="code" href="install_8php.html#af9da176a74bd49cb97ea35c6ac7257bc">$action</a>=<span class="stringliteral">&quot;admin_exam_edit&quot;</span>;      
<a name="l00532"></a>00532     }
<a name="l00533"></a>00533         
<a name="l00534"></a>00534     
<a name="l00535"></a>00535     <span class="keywordflow">if</span>(<a class="code" href="install_8php.html#af9da176a74bd49cb97ea35c6ac7257bc">$action</a>==<span class="stringliteral">&quot;admin_exam_question_edit&quot;</span>) {
<a name="l00536"></a>00536         
<a name="l00537"></a>00537 echo <span class="stringliteral">&quot;[&lt;a href=$RFS_SITE_URL/modules/exams/exams.php?action=run_exam&amp;exam_id=$exam_id&gt;Run this exam&lt;/a&gt;]&quot;</span>;
<a name="l00538"></a>00538 echo <span class="stringliteral">&quot;[&lt;a href=$RFS_SITE_URL/modules/exams/exams.php?action=admin_edit&gt;List all exams&lt;/a&gt;]&quot;</span>;
<a name="l00539"></a>00539 echo <span class="stringliteral">&quot;[&lt;a href=$RFS_SITE_URL/modules/exams/exams.php?action=admin_exam_edit&amp;exam_id=$exam_id&gt;List all questions&lt;/a&gt;]&lt;br&gt;&quot;</span>;
<a name="l00540"></a>00540         
<a name="l00541"></a>00541         $qt=<a class="code" href="lib_8mysql_8php.html#ad42d2c11477299cecf3dd06b259a316e">mfo1</a>(<span class="stringliteral">&quot;select * from exam_questions where id=&#39;$q&#39;&quot;</span>);
<a name="l00542"></a>00542         
<a name="l00543"></a>00543     <a class="code" href="lib_8mysql_8php.html#ab2a2e03dfc31eb5074a990325393609d">sc_bf</a>( <span class="stringliteral">&quot;$RFS_SITE_URL/modules/exams/exams.php&quot;</span>,
<a name="l00544"></a>00544            <span class="stringliteral">&quot;action=admin_exam_question_edit_2&quot;</span>.<a class="code" href="config_8sitevars_8php.html#a06fab752c166675deeb7a9191add17ab">$RFS_SITE_DELIMITER</a>.
<a name="l00545"></a>00545            <span class="stringliteral">&quot;SHOW_SELECTOR_exam_question_types#name#type#$qt-&gt;type&quot;</span>.$RFS_SITE_DELIMITER. 
<a name="l00546"></a>00546            <span class="stringliteral">&quot;SHOW_SELECTOR_cfetp_tasks#task&amp;name#task#$qt-&gt;task&quot;</span>,
<a name="l00547"></a>00547            <span class="stringliteral">&quot;exam_questions&quot;</span>,
<a name="l00548"></a>00548            <span class="stringliteral">&quot;select * from exam_questions where id=&#39;$q&#39;&quot;</span>,
<a name="l00549"></a>00549            <span class="stringliteral">&quot;id&quot;</span>,
<a name="l00550"></a>00550            <span class="stringliteral">&quot;type&quot;</span>.$RFS_SITE_DELIMITER.<span class="stringliteral">&quot;task&quot;</span>,
<a name="l00551"></a>00551            <span class="stringliteral">&quot;omit&quot;</span>,
<a name="l00552"></a>00552            <span class="stringliteral">&quot;&quot;</span>,
<a name="l00553"></a>00553            100,
<a name="l00554"></a>00554            <span class="stringliteral">&quot;submit&quot;</span> );      
<a name="l00555"></a>00555     }
<a name="l00556"></a>00556     <span class="keywordflow">if</span>(<a class="code" href="install_8php.html#af9da176a74bd49cb97ea35c6ac7257bc">$action</a>==<span class="stringliteral">&quot;admin_exam_question_edit_2&quot;</span>) {
<a name="l00557"></a>00557         
<a name="l00558"></a>00558         <span class="comment">/*      </span>
<a name="l00559"></a>00559 <span class="comment">        echo &quot;       &lt;BR&gt;</span>
<a name="l00560"></a>00560 <span class="comment">        id: $id &lt;BR&gt;</span>
<a name="l00561"></a>00561 <span class="comment">            exam_id: $exam_id &lt;BR&gt;</span>
<a name="l00562"></a>00562 <span class="comment">            exam_sequence: $exam_sequence &lt;BR&gt;</span>
<a name="l00563"></a>00563 <span class="comment">            type: $type  &lt;BR&gt;</span>
<a name="l00564"></a>00564 <span class="comment">            intro: $intro    &lt;BR&gt;</span>
<a name="l00565"></a>00565 <span class="comment">            question: $question  &lt;BR&gt;</span>
<a name="l00566"></a>00566 <span class="comment">            question_image: $question_image  &lt;BR&gt;</span>
<a name="l00567"></a>00567 <span class="comment">            correct_answer: $correct_answer &lt;BR&gt;    </span>
<a name="l00568"></a>00568 <span class="comment">            choice_1: $choice_1  &lt;BR&gt;</span>
<a name="l00569"></a>00569 <span class="comment">            choice_2: $choice_2  &lt;BR&gt;</span>
<a name="l00570"></a>00570 <span class="comment">            choice_3: $choice_3  &lt;BR&gt;</span>
<a name="l00571"></a>00571 <span class="comment">            choice_4: $choice_4  &lt;BR&gt;</span>
<a name="l00572"></a>00572 <span class="comment">            choice_5: $choice_5  &lt;BR&gt;</span>
<a name="l00573"></a>00573 <span class="comment">            choice_6: $choice_6  &lt;BR&gt;</span>
<a name="l00574"></a>00574 <span class="comment">        &quot;;</span>
<a name="l00575"></a>00575 <span class="comment">        </span>
<a name="l00576"></a>00576 <span class="comment">        */</span>
<a name="l00577"></a>00577         
<a name="l00578"></a>00578         <a class="code" href="sp_8php.html#a8abe176bc41afd728f32ba8c506cbd98">$r</a>=<a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>(<span class="stringliteral">&quot;select * from exam_question_types where name=&#39;$type&#39;&quot;</span>);
<a name="l00579"></a>00579         $eqt=mysql_fetch_object(<a class="code" href="sp_8php.html#a8abe176bc41afd728f32ba8c506cbd98">$r</a>);
<a name="l00580"></a>00580         
<a name="l00581"></a>00581         <span class="keywordflow">if</span>(empty($eqt-&gt;type)){
<a name="l00582"></a>00582             <a class="code" href="sp_8php.html#a8abe176bc41afd728f32ba8c506cbd98">$r</a>=<a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>(<span class="stringliteral">&quot;select * from exam_question_types where type=&#39;$type&#39;&quot;</span>);
<a name="l00583"></a>00583             $eqt=mysql_fetch_object(<a class="code" href="sp_8php.html#a8abe176bc41afd728f32ba8c506cbd98">$r</a>);
<a name="l00584"></a>00584         }
<a name="l00585"></a>00585         <span class="keywordflow">if</span>(empty($eqt-&gt;type)) $eqt-&gt;type=<span class="stringliteral">&quot;multiple_choice&quot;</span>;
<a name="l00586"></a>00586 
<a name="l00587"></a>00587 
<a name="l00588"></a>00588 <a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>(<span class="stringliteral">&quot;update exam_questions set `exam_id`=&#39;$exam_id&#39; where id=&#39;$id&#39;&quot;</span>);
<a name="l00589"></a>00589 <a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>(<span class="stringliteral">&quot;update exam_questions set `exam_sequence` =&#39;$exam_sequence&#39; where id=&#39;$id&#39;&quot;</span>);
<a name="l00590"></a>00590 <a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>(<span class="stringliteral">&quot;update exam_questions set `type`=&#39;$eqt-&gt;type&#39; where id=&#39;$id&#39;&quot;</span>);
<a name="l00591"></a>00591 <a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>(<span class="stringliteral">&quot;update exam_questions set `intro`=&#39;$intro&#39; where id=&#39;$id&#39;&quot;</span>);
<a name="l00592"></a>00592 <a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>(<span class="stringliteral">&quot;update exam_questions set `question`=&#39;$question&#39; where id=&#39;$id&#39;&quot;</span>);
<a name="l00593"></a>00593 <a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>(<span class="stringliteral">&quot;update exam_questions set `question_image`=&#39;$question_image&#39; where id=&#39;$id&#39;&quot;</span>);
<a name="l00594"></a>00594 <a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>(<span class="stringliteral">&quot;update exam_questions set `correct_answer`=&#39;$correct_answer&#39; where id=&#39;$id&#39;&quot;</span>);
<a name="l00595"></a>00595 <a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>(<span class="stringliteral">&quot;update exam_questions set `choice_1`=&#39;$choice_1&#39; where id=&#39;$id&#39;&quot;</span>);
<a name="l00596"></a>00596 <a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>(<span class="stringliteral">&quot;update exam_questions set `choice_2`=&#39;$choice_2&#39; where id=&#39;$id&#39;&quot;</span>);
<a name="l00597"></a>00597 <a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>(<span class="stringliteral">&quot;update exam_questions set `choice_3`=&#39;$choice_3&#39; where id=&#39;$id&#39;&quot;</span>);
<a name="l00598"></a>00598 <a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>(<span class="stringliteral">&quot;update exam_questions set `choice_4`=&#39;$choice_4&#39; where id=&#39;$id&#39;&quot;</span>);
<a name="l00599"></a>00599 <a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>(<span class="stringliteral">&quot;update exam_questions set `choice_5`=&#39;$choice_5&#39; where id=&#39;$id&#39;&quot;</span>);
<a name="l00600"></a>00600 <a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>(<span class="stringliteral">&quot;update exam_questions set `choice_6`=&#39;$choice_6&#39; where id=&#39;$id&#39;&quot;</span>);
<a name="l00601"></a>00601 <a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>(<span class="stringliteral">&quot;update exam_questions set `task`=&#39;$task&#39; where id=&#39;$id&#39;&quot;</span>);
<a name="l00602"></a>00602         
<a name="l00603"></a>00603         <a class="code" href="install_8php.html#af9da176a74bd49cb97ea35c6ac7257bc">$action</a>=<span class="stringliteral">&quot;admin_exam_edit&quot;</span>;
<a name="l00604"></a>00604         
<a name="l00605"></a>00605     }
<a name="l00606"></a>00606     
<a name="l00607"></a>00607     <span class="keywordflow">if</span>(<a class="code" href="install_8php.html#af9da176a74bd49cb97ea35c6ac7257bc">$action</a>==<span class="stringliteral">&quot;admin_exam_edit_add&quot;</span>) {
<a name="l00608"></a>00608         echo <span class="stringliteral">&quot;Adding a new exam question ($exam_sequence) for exam $exam_id&lt;br&gt;&quot;</span>;
<a name="l00609"></a>00609         
<a name="l00610"></a>00610         <span class="comment">// echo &quot;&lt;p&gt;Choose the type of exam question.&lt;/p&gt;&quot;;</span>
<a name="l00611"></a>00611                 
<a name="l00612"></a>00612         <a class="code" href="lib_8mysql_8php.html#a8594d0f9a34f20d40018060b96f6e679">sc_optionizer</a>(  <span class="stringliteral">&quot;$RFS_SITE_URL/modules/exams/exams.php&quot;</span>,
<a name="l00613"></a>00613                            <span class="stringliteral">&quot;action=admin_exam_edit_add_2&quot;</span>.<a class="code" href="config_8sitevars_8php.html#a06fab752c166675deeb7a9191add17ab">$RFS_SITE_DELIMITER</a>.
<a name="l00614"></a>00614                            <span class="stringliteral">&quot;exam_id=$exam_id&quot;</span>.$RFS_SITE_DELIMITER.
<a name="l00615"></a>00615                            <span class="stringliteral">&quot;exam_sequence=$exam_sequence&quot;</span>,
<a name="l00616"></a>00616                            <span class="stringliteral">&quot;exam_question_types&quot;</span>,
<a name="l00617"></a>00617                            <span class="stringliteral">&quot;name&quot;</span>,
<a name="l00618"></a>00618                            0,
<a name="l00619"></a>00619                            <span class="stringliteral">&quot;Select type of exam question&quot;</span>,
<a name="l00620"></a>00620                            1);
<a name="l00621"></a>00621     }
<a name="l00622"></a>00622     
<a name="l00623"></a>00623     <span class="keywordflow">if</span>(<a class="code" href="install_8php.html#af9da176a74bd49cb97ea35c6ac7257bc">$action</a>==<span class="stringliteral">&quot;admin_exam_edit_add_2&quot;</span>) {
<a name="l00624"></a>00624         
<a name="l00625"></a>00625         <a class="code" href="sp_8php.html#a8abe176bc41afd728f32ba8c506cbd98">$r</a>=<a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>(<span class="stringliteral">&quot;select * from exam_question_types where name=&#39;$name&#39;&quot;</span>);
<a name="l00626"></a>00626         $eqt=mysql_fetch_object(<a class="code" href="sp_8php.html#a8abe176bc41afd728f32ba8c506cbd98">$r</a>);
<a name="l00627"></a>00627                 
<a name="l00628"></a>00628         echo <span class="stringliteral">&quot;Adding new question to exam: $exam_id -&gt; $exam_sequence -&gt; $name ($eqt-&gt;type)&lt;br&gt;&quot;</span>;       
<a name="l00629"></a>00629         
<a name="l00630"></a>00630         <a class="code" href="lib_8mysql_8php.html#ab2a2e03dfc31eb5074a990325393609d">sc_bf</a>( <span class="stringliteral">&quot;$RFS_SITE_URL/modules/exams/exams.php&quot;</span>,
<a name="l00631"></a>00631            <span class="stringliteral">&quot;action=admin_exam_edit_add_3&quot;</span>.<a class="code" href="config_8sitevars_8php.html#a06fab752c166675deeb7a9191add17ab">$RFS_SITE_DELIMITER</a>.
<a name="l00632"></a>00632            <span class="stringliteral">&quot;aeexam_id=$exam_id&quot;</span>.$RFS_SITE_DELIMITER.
<a name="l00633"></a>00633            <span class="stringliteral">&quot;aeexam_sequence=$exam_sequence&quot;</span>.$RFS_SITE_DELIMITER.
<a name="l00634"></a>00634            <span class="stringliteral">&quot;aetype=$eqt-&gt;type&quot;</span>.$RFS_SITE_DELIMITER.
<a name="l00635"></a>00635            <span class="stringliteral">&quot;SHOW_SELECTOR_cfetp_tasks#task&amp;name#task#Select a task to associate with this question&quot;</span>,
<a name="l00636"></a>00636            <span class="stringliteral">&quot;exam_questions&quot;</span>,
<a name="l00637"></a>00637            <span class="stringliteral">&quot;&quot;</span>,
<a name="l00638"></a>00638            <span class="stringliteral">&quot;id&quot;</span>.$RFS_SITE_DELIMITER.
<a name="l00639"></a>00639            <span class="stringliteral">&quot;exam_id&quot;</span>.$RFS_SITE_DELIMITER.
<a name="l00640"></a>00640            <span class="stringliteral">&quot;exam_sequence&quot;</span>.$RFS_SITE_DELIMITER.
<a name="l00641"></a>00641            <span class="stringliteral">&quot;type&quot;</span>,
<a name="l00642"></a>00642            <span class="stringliteral">&quot;task&quot;</span>,
<a name="l00643"></a>00643            <span class="stringliteral">&quot;omit&quot;</span>,
<a name="l00644"></a>00644            <span class="stringliteral">&quot;&quot;</span>,
<a name="l00645"></a>00645            100,
<a name="l00646"></a>00646            <span class="stringliteral">&quot;submit&quot;</span> );
<a name="l00647"></a>00647         
<a name="l00648"></a>00648     }
<a name="l00649"></a>00649     
<a name="l00650"></a>00650     <span class="keywordflow">if</span>(<a class="code" href="install_8php.html#af9da176a74bd49cb97ea35c6ac7257bc">$action</a>==<span class="stringliteral">&quot;admin_exam_edit_add_3&quot;</span>) {
<a name="l00651"></a>00651 
<a name="l00652"></a>00652             $exam_id=$aeexam_id;
<a name="l00653"></a>00653             $exam_sequence=$aeexam_sequence;
<a name="l00654"></a>00654             <a class="code" href="sp_8php.html#a9a4a6fba2208984cabb3afacadf33919">$type</a>=$aetype;
<a name="l00655"></a>00655         <span class="comment">/*</span>
<a name="l00656"></a>00656 <span class="comment">        echo &quot;       &lt;BR&gt;</span>
<a name="l00657"></a>00657 <span class="comment">            exam_id: $exam_id &lt;BR&gt;</span>
<a name="l00658"></a>00658 <span class="comment">            exam_sequence: $exam_sequence &lt;BR&gt;</span>
<a name="l00659"></a>00659 <span class="comment">            type: $type  &lt;BR&gt;</span>
<a name="l00660"></a>00660 <span class="comment">            intro: $intro    &lt;BR&gt;</span>
<a name="l00661"></a>00661 <span class="comment">            question: $question  &lt;BR&gt;</span>
<a name="l00662"></a>00662 <span class="comment">            question_image: $question_image  &lt;BR&gt;</span>
<a name="l00663"></a>00663 <span class="comment">            correct_answer: $correct_answer &lt;BR&gt;    </span>
<a name="l00664"></a>00664 <span class="comment">            choice_1: $choice_1  &lt;BR&gt;</span>
<a name="l00665"></a>00665 <span class="comment">            choice_2: $choice_2  &lt;BR&gt;</span>
<a name="l00666"></a>00666 <span class="comment">            choice_3: $choice_3  &lt;BR&gt;</span>
<a name="l00667"></a>00667 <span class="comment">            choice_4: $choice_4  &lt;BR&gt;</span>
<a name="l00668"></a>00668 <span class="comment">            choice_5: $choice_5  &lt;BR&gt;</span>
<a name="l00669"></a>00669 <span class="comment">            choice_6: $choice_6  &lt;BR&gt;</span>
<a name="l00670"></a>00670 <span class="comment">        &quot;;</span>
<a name="l00671"></a>00671 <span class="comment">        */</span>
<a name="l00672"></a>00672 <a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>(<span class="stringliteral">&quot;</span>
<a name="l00673"></a>00673 <span class="stringliteral">insert into exam_questions </span>
<a name="l00674"></a>00674 <span class="stringliteral">       (`exam_id`,`exam_sequence`,`type`, `intro`, `question`, `question_image`, `correct_answer`, `choice_1`, `choice_2`, `choice_3`, `choice_4`, `choice_5`, `choice_6`, `task` )</span>
<a name="l00675"></a>00675 <span class="stringliteral">VALUES (&#39;$exam_id&#39;,&#39;$exam_sequence&#39;,&#39;$type&#39;, &#39;$intro&#39;, &#39;$question&#39;, &#39;$question_image&#39;, &#39;$correct_answer&#39;, &#39;$choice_1&#39;, &#39;$choice_2&#39;, &#39;$choice_3&#39;, &#39;$choice_4&#39;, &#39;$choice_5&#39;, &#39;$choice_6&#39;, &#39;$task&#39; )   &quot;</span>);
<a name="l00676"></a>00676 
<a name="l00677"></a>00677         
<a name="l00678"></a>00678         <a class="code" href="install_8php.html#af9da176a74bd49cb97ea35c6ac7257bc">$action</a>=<span class="stringliteral">&quot;admin_exam_edit&quot;</span>;
<a name="l00679"></a>00679     }
<a name="l00680"></a>00680     
<a name="l00681"></a>00681     
<a name="l00682"></a>00682     
<a name="l00683"></a>00683     <span class="keywordflow">if</span>(<a class="code" href="install_8php.html#af9da176a74bd49cb97ea35c6ac7257bc">$action</a>==<span class="stringliteral">&quot;admin_exam_edit&quot;</span>) {
<a name="l00684"></a>00684         
<a name="l00685"></a>00685         $exam=<a class="code" href="lib_8mysql_8php.html#ad42d2c11477299cecf3dd06b259a316e">mfo1</a>(<span class="stringliteral">&quot;select * from exams where id=&#39;$exam_id&#39;&quot;</span>);
<a name="l00686"></a>00686         
<a name="l00687"></a>00687         echo <span class="stringliteral">&quot;&lt;h1&gt;EDIT EXAM $exam_id $exam-&gt;name&lt;/h1&gt;&quot;</span>;
<a name="l00688"></a>00688         
<a name="l00689"></a>00689         echo <span class="stringliteral">&quot;[&lt;a href=$RFS_SITE_URL/modules/exams/exams.php?action=run_exam&amp;exam_id=$exam_id&gt;Run this exam&lt;/a&gt;]&quot;</span>;
<a name="l00690"></a>00690         echo <span class="stringliteral">&quot;[&lt;a href=$RFS_SITE_URL/modules/exams/exams.php?action=admin_edit&gt;List all exams&lt;/a&gt;]&lt;br&gt;&quot;</span>;
<a name="l00691"></a>00691         
<a name="l00692"></a>00692         echo <span class="stringliteral">&quot;&lt;table border=0&gt;&lt;tr&gt;&lt;td&gt; Method: $exam-&gt;method &lt;/td&gt;&lt;td&gt;&quot;</span>;        
<a name="l00693"></a>00693         echo <span class="stringliteral">&quot; &lt;form action=&#39;$RFS_SITE_URL/modules/exams/exams.php&#39; method=&#39;post&#39;&gt;  </span>
<a name="l00694"></a>00694 <span class="stringliteral">                &lt;input type=&#39;hidden&#39; name=&#39;action&#39; value=&#39;admin_exam_edit_method&#39;&gt;</span>
<a name="l00695"></a>00695 <span class="stringliteral">                &lt;input type=&#39;hidden&#39; name=&#39;exam_id&#39; value=&#39;$exam_id&#39;&gt;                               </span>
<a name="l00696"></a>00696 <span class="stringliteral">                &lt;select name=&#39;method&#39; onchange=&#39;this.form.submit()&#39;&gt;</span>
<a name="l00697"></a>00697 <span class="stringliteral">                &lt;option&gt;Select testing method</span>
<a name="l00698"></a>00698 <span class="stringliteral">                &lt;option&gt;Sequential&lt;option&gt;Random&lt;/select&gt;</span>
<a name="l00699"></a>00699 <span class="stringliteral">                &lt;/form&gt; &lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&quot;</span>;
<a name="l00700"></a>00700                 
<a name="l00701"></a>00701         
<a name="l00702"></a>00702         echo <span class="stringliteral">&quot;&lt;table border=0&gt;&lt;tr&gt;&lt;td&gt;Passing percentage: &lt;/td&gt;&lt;td&gt;&quot;</span>;
<a name="l00703"></a>00703         echo <span class="stringliteral">&quot; &lt;form action=&#39;$RFS_SITE_URL/modules/exams/exams.php&#39; method=&#39;post&#39;&gt;  </span>
<a name="l00704"></a>00704 <span class="stringliteral">                &lt;input type=&#39;hidden&#39; name=&#39;action&#39; value=&#39;admin_exam_edit_pass_percent&#39;&gt;</span>
<a name="l00705"></a>00705 <span class="stringliteral">                &lt;input type=&#39;hidden&#39; name=&#39;exam_id&#39; value=&#39;$exam_id&#39;&gt;</span>
<a name="l00706"></a>00706 <span class="stringliteral">                &lt;input name=&#39;pass_percent&#39; size=&#39;2&#39; value=&#39;$exam-&gt;pass_percent&#39;  onblur=&#39;this.form.submit()&#39;  &gt;</span>
<a name="l00707"></a>00707 <span class="stringliteral">                &lt;/form&gt; &lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&quot;</span>;        
<a name="l00708"></a>00708         
<a name="l00709"></a>00709         echo <span class="stringliteral">&quot;&lt;table border=0&gt;&lt;tr&gt;&lt;td&gt;Questions: $exam-&gt;questions&lt;/td&gt;&lt;td&gt;&quot;</span>;        
<a name="l00710"></a>00710         echo <span class="stringliteral">&quot; &lt;form action=&#39;$RFS_SITE_URL/modules/exams/exams.php&#39; method=&#39;post&#39;&gt;  </span>
<a name="l00711"></a>00711 <span class="stringliteral">                &lt;input type=&#39;hidden&#39; name=&#39;action&#39; value=&#39;admin_exam_edit_questions&#39;&gt;</span>
<a name="l00712"></a>00712 <span class="stringliteral">                &lt;input type=&#39;hidden&#39; name=&#39;exam_id&#39; value=&#39;$exam_id&#39;&gt;</span>
<a name="l00713"></a>00713 <span class="stringliteral">                &lt;input name=&#39;questions&#39; size=&#39;2&#39; value=&#39;$exam-&gt;questions&#39;  onblur=&#39;this.form.submit()&#39;  &gt;</span>
<a name="l00714"></a>00714 <span class="stringliteral">                &lt;/form&gt; &lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&quot;</span>;        
<a name="l00715"></a>00715         
<a name="l00716"></a>00716         
<a name="l00717"></a>00717         echo <span class="stringliteral">&quot;&lt;hr&gt;Question Pool:&lt;br&gt;&quot;</span>;
<a name="l00718"></a>00718         
<a name="l00719"></a>00719         echo <span class="stringliteral">&quot;[&lt;a href=&#39;$RFS_SITE_URL/modules/exams/exams.php?action=admin_exam_edit_add&amp;exam_id=$exam_id&amp;exam_sequence=$exam_sequence&#39;&gt;&lt;img src=&#39;$RFS_SITE_URL/images/icons/plus_2.gif&#39; width=16 border=0&gt;Add Question&lt;/a&gt;]&lt;br&gt;&quot;</span>;      
<a name="l00720"></a>00720 
<a name="l00721"></a>00721             echo <span class="stringliteral">&quot;&lt;table border=0 cellspacing=0&gt;&quot;</span>;
<a name="l00722"></a>00722             
<a name="l00723"></a>00723             echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;
<a name="l00724"></a>00724             echo <span class="stringliteral">&quot;&lt;td&gt; &amp;nbsp; &lt;/td&gt;&quot;</span>;
<a name="l00725"></a>00725             echo <span class="stringliteral">&quot;&lt;td&gt; &amp;nbsp; &lt;/td&gt;&quot;</span>;
<a name="l00726"></a>00726             echo <span class="stringliteral">&quot;&lt;td&gt; &amp;nbsp; &lt;/td&gt;&quot;</span>;
<a name="l00727"></a>00727             echo <span class="stringliteral">&quot;&lt;td&gt; &amp;nbsp; &lt;/td&gt;&quot;</span>;
<a name="l00728"></a>00728             echo <span class="stringliteral">&quot;&lt;td&gt; &amp;nbsp; &lt;/td&gt;&quot;</span>;
<a name="l00729"></a>00729             echo <span class="stringliteral">&quot;&lt;td&gt; Type &lt;/td&gt;&quot;</span>;
<a name="l00730"></a>00730             echo <span class="stringliteral">&quot;&lt;td&gt; Intro &lt;/td&gt;&quot;</span>;
<a name="l00731"></a>00731             echo <span class="stringliteral">&quot;&lt;td&gt; Question &lt;/td&gt;&quot;</span>;
<a name="l00732"></a>00732             echo <span class="stringliteral">&quot;&lt;td&gt; Correct Answer &lt;/td&gt;&quot;</span>;
<a name="l00733"></a>00733             echo <span class="stringliteral">&quot;&lt;td&gt; Choice 1 (A)&lt;/td&gt;&quot;</span>;
<a name="l00734"></a>00734             echo <span class="stringliteral">&quot;&lt;td&gt; Choice 2 (B)&lt;/td&gt;&quot;</span>;
<a name="l00735"></a>00735             echo <span class="stringliteral">&quot;&lt;td&gt; Choice 3 (C)&lt;/td&gt;&quot;</span>;
<a name="l00736"></a>00736             echo <span class="stringliteral">&quot;&lt;td&gt; Choice 4 (D)&lt;/td&gt;&quot;</span>;
<a name="l00737"></a>00737             echo <span class="stringliteral">&quot;&lt;td&gt; Choice 5 (E)&lt;/td&gt;&quot;</span>;
<a name="l00738"></a>00738             echo <span class="stringliteral">&quot;&lt;td&gt; Choice 6 (F)&lt;/td&gt;&quot;</span>;
<a name="l00739"></a>00739             
<a name="l00740"></a>00740             echo <span class="stringliteral">&quot;&lt;td&gt; Task &lt;/td&gt;&quot;</span>;
<a name="l00741"></a>00741             
<a name="l00742"></a>00742             
<a name="l00743"></a>00743             echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;
<a name="l00744"></a>00744             
<a name="l00745"></a>00745         <a class="code" href="sp_8php.html#a8abe176bc41afd728f32ba8c506cbd98">$r</a>=<a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>(<span class="stringliteral">&quot;select * from exam_questions where exam_id=&#39;$exam_id&#39; order by exam_sequence&quot;</span>);
<a name="l00746"></a>00746         $n=mysql_num_rows(<a class="code" href="sp_8php.html#a8abe176bc41afd728f32ba8c506cbd98">$r</a>);
<a name="l00747"></a>00747         <span class="keywordflow">for</span>($i=0;$i&lt;$n;$i++){
<a name="l00748"></a>00748             
<a name="l00749"></a>00749                 <a class="code" href="linkbin_2linkbin_8php.html#acc3ddc926074609c4cff4f0aa1793fad">$gt</a>++; <span class="keywordflow">if</span>(<a class="code" href="linkbin_2linkbin_8php.html#acc3ddc926074609c4cff4f0aa1793fad">$gt</a>&gt;1) <a class="code" href="linkbin_2linkbin_8php.html#acc3ddc926074609c4cff4f0aa1793fad">$gt</a>=0;
<a name="l00750"></a>00750             
<a name="l00751"></a>00751                 echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;
<a name="l00752"></a>00752         
<a name="l00753"></a>00753                 $q=mysql_fetch_object(<a class="code" href="sp_8php.html#a8abe176bc41afd728f32ba8c506cbd98">$r</a>);
<a name="l00754"></a>00754                 echo <span class="stringliteral">&quot;&lt;td class=sc_project_table_$gt&gt;</span>
<a name="l00755"></a>00755 <span class="stringliteral">                &lt;a href=&#39;$RFS_SITE_URL/modules/exams/exams.php?action=admin_exam_question_edit&amp;exam_id=$exam-&gt;id&amp;q=$q-&gt;id&#39;&gt;&quot;</span>;
<a name="l00756"></a>00756                 echo <span class="stringliteral">&quot;&lt;img src=&#39;$RFS_SITE_URL/images/icons/Edit.png&#39; width=16 border=0&gt;&quot;</span>;
<a name="l00757"></a>00757                 echo <span class="stringliteral">&quot;&lt;/a&gt;</span>
<a name="l00758"></a>00758 <span class="stringliteral">                &lt;/td&gt;&quot;</span>;             
<a name="l00759"></a>00759 
<a name="l00760"></a>00760 
<a name="l00761"></a>00761                                 
<a name="l00762"></a>00762                 echo <span class="stringliteral">&quot;&lt;td class=sc_project_table_$gt&gt;</span>
<a name="l00763"></a>00763 <span class="stringliteral">                &lt;a href=&#39;$RFS_SITE_URL/modules/exams/exams.php?action=admin_exam_question_remove&amp;exam_id=$exam-&gt;id&amp;q=$q-&gt;id&#39;&gt;&quot;</span>;
<a name="l00764"></a>00764                 echo <span class="stringliteral">&quot;&lt;img src=&#39;$RFS_SITE_URL/images/icons/Delete.png&#39; width=16 border=0&gt;&quot;</span>;
<a name="l00765"></a>00765                 echo <span class="stringliteral">&quot;&lt;/a&gt;</span>
<a name="l00766"></a>00766 <span class="stringliteral">                &lt;/td&gt;&quot;</span>;
<a name="l00767"></a>00767                 echo <span class="stringliteral">&quot;&lt;td class=sc_project_table_$gt&gt;&lt;img src=&#39;$RFS_SITE_URL/images/icons/arrow-up.png&#39; border=0 width=16&gt;&lt;/td&gt;&quot;</span>;
<a name="l00768"></a>00768                 echo <span class="stringliteral">&quot;&lt;td class=sc_project_table_$gt&gt;&lt;img src=&#39;$RFS_SITE_URL/images/icons/arrow-down.png&#39; border=0 width=16&gt;&lt;/td&gt;&quot;</span>;
<a name="l00769"></a>00769                 echo <span class="stringliteral">&quot;&lt;td class=sc_project_table_$gt&gt;$q-&gt;exam_sequence)&lt;/td&gt;&quot;</span>;
<a name="l00770"></a>00770                 echo <span class="stringliteral">&quot;&lt;td class=sc_project_table_$gt&gt;$q-&gt;type&lt;/td&gt;&quot;</span>;
<a name="l00771"></a>00771                 echo <span class="stringliteral">&quot;&lt;td class=sc_project_table_$gt&gt;&quot;</span>.sc_trunc($q-&gt;intro,85).<span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;
<a name="l00772"></a>00772                 echo <span class="stringliteral">&quot;&lt;td class=sc_project_table_$gt&gt;$q-&gt;question&lt;/td&gt;&quot;</span>;
<a name="l00773"></a>00773                 echo <span class="stringliteral">&quot;&lt;td class=sc_project_table_$gt&gt;$q-&gt;correct_answer&lt;/td&gt;&quot;</span>;
<a name="l00774"></a>00774                 
<a name="l00775"></a>00775                 echo <span class="stringliteral">&quot;&lt;td class=sc_project_table_$gt&gt;$q-&gt;choice_1&lt;/td&gt;&quot;</span>;
<a name="l00776"></a>00776                 echo <span class="stringliteral">&quot;&lt;td class=sc_project_table_$gt&gt;$q-&gt;choice_2&lt;/td&gt;&quot;</span>;
<a name="l00777"></a>00777                 echo <span class="stringliteral">&quot;&lt;td class=sc_project_table_$gt&gt;$q-&gt;choice_3&lt;/td&gt;&quot;</span>;
<a name="l00778"></a>00778                 echo <span class="stringliteral">&quot;&lt;td class=sc_project_table_$gt&gt;$q-&gt;choice_4&lt;/td&gt;&quot;</span>;
<a name="l00779"></a>00779                 echo <span class="stringliteral">&quot;&lt;td class=sc_project_table_$gt&gt;$q-&gt;choice_5&lt;/td&gt;&quot;</span>;
<a name="l00780"></a>00780                 echo <span class="stringliteral">&quot;&lt;td class=sc_project_table_$gt&gt;$q-&gt;choice_6&lt;/td&gt;&quot;</span>;
<a name="l00781"></a>00781                 
<a name="l00782"></a>00782                 echo <span class="stringliteral">&quot;&lt;td class=sc_project_table_$gt&gt;$q-&gt;task&lt;/td&gt;&quot;</span>;
<a name="l00783"></a>00783                 
<a name="l00784"></a>00784                 
<a name="l00785"></a>00785                 
<a name="l00786"></a>00786                 
<a name="l00787"></a>00787                 
<a name="l00788"></a>00788                 
<a name="l00789"></a>00789                 echo <span class="stringliteral">&quot;&lt;td class=sc_project_table_$gt&gt;&quot;</span>;
<a name="l00790"></a>00790                 <span class="keywordflow">if</span>(!empty($q-&gt;question_image)) 
<a name="l00791"></a>00791                     <a class="code" href="lib_8rfs_8php.html#afb6b656bf7c2d97ef28e2055ee73ac3a">rfs_echo</a>(<span class="stringliteral">&quot;&lt;img src=$q-&gt;question_image width=32&gt;&quot;</span>);
<a name="l00792"></a>00792                 echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;
<a name="l00793"></a>00793                 echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;
<a name="l00794"></a>00794                 $exam_sequence=$q-&gt;exam_sequence;
<a name="l00795"></a>00795         }
<a name="l00796"></a>00796         echo <span class="stringliteral">&quot;&lt;/table&gt;&quot;</span>;
<a name="l00797"></a>00797         $exam_sequence++;
<a name="l00798"></a>00798         
<a name="l00799"></a>00799 
<a name="l00800"></a>00800     }
<a name="l00801"></a>00801     
<a name="l00802"></a>00802 
<a name="l00803"></a>00803     <span class="keywordflow">if</span>(<a class="code" href="install_8php.html#af9da176a74bd49cb97ea35c6ac7257bc">$action</a>==<span class="stringliteral">&quot;admin_new_exam&quot;</span>) {
<a name="l00804"></a>00804 
<a name="l00805"></a>00805         <a class="code" href="sp_8php.html#a8abe176bc41afd728f32ba8c506cbd98">$r</a>=<a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>( <span class="stringliteral">&quot;insert into exams (`name`) VALUES (&#39;$name&#39;)&quot;</span>);
<a name="l00806"></a>00806         $id = mysql_insert_id();
<a name="l00807"></a>00807         echo <span class="stringliteral">&quot;&lt;p&gt; &quot;</span>;
<a name="l00808"></a>00808         <span class="keywordflow">if</span>($id)
<a name="l00809"></a>00809             echo <span class="stringliteral">&quot; Exam $name ($id) created&quot;</span>;
<a name="l00810"></a>00810         <span class="keywordflow">else</span>
<a name="l00811"></a>00811             echo <span class="stringliteral">&quot; Exam creation error. &quot;</span>;
<a name="l00812"></a>00812         echo <span class="stringliteral">&quot;&lt;/p&gt; &quot;</span>;
<a name="l00813"></a>00813     }
<a name="l00814"></a>00814 
<a name="l00815"></a>00815 
<a name="l00816"></a>00816 <span class="keywordflow">if</span>(<a class="code" href="install_8php.html#af9da176a74bd49cb97ea35c6ac7257bc">$action</a>==<span class="stringliteral">&quot;admin_exam_change_pod&quot;</span>) {
<a name="l00817"></a>00817     
<a name="l00818"></a>00818     echo <span class="stringliteral">&quot;&lt;p&gt; CHANGE EXAM POD &lt;/p&gt;&quot;</span>;
<a name="l00819"></a>00819     echo <span class="stringliteral">&quot;&lt;p&gt; Exam: $exam_id &lt;/p&gt;&quot;</span>;
<a name="l00820"></a>00820     echo <span class="stringliteral">&quot;&lt;p&gt; POD: $name &lt;/p&gt;&quot;</span>;
<a name="l00821"></a>00821     <span class="comment">// $pod=mfo1(&quot;select * from pods where name=&#39;$name&#39;&quot;);</span>
<a name="l00822"></a>00822     $q=<span class="stringliteral">&quot;update `exams` set `pod_id`=&#39;$name&#39; where `id`=&#39;$exam_id&#39;&quot;</span>;
<a name="l00823"></a>00823     
<a name="l00824"></a>00824     <a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>($q);
<a name="l00825"></a>00825     
<a name="l00826"></a>00826     <a class="code" href="install_8php.html#af9da176a74bd49cb97ea35c6ac7257bc">$action</a>=<span class="stringliteral">&quot;admin_edit&quot;</span>;
<a name="l00827"></a>00827 }
<a name="l00828"></a>00828 
<a name="l00829"></a>00829     <span class="comment">// Types of questions:</span>
<a name="l00830"></a>00830     <span class="comment">//</span>
<a name="l00831"></a>00831     <span class="comment">// Multiple choice</span>
<a name="l00832"></a>00832     <span class="comment">// Fill in the blank</span>
<a name="l00833"></a>00833     <span class="comment">// Fill in the blank (with dropdown box)</span>
<a name="l00834"></a>00834     <span class="comment">// True / False</span>
<a name="l00835"></a>00835     <span class="comment">// Matching</span>
<a name="l00836"></a>00836 
<a name="l00837"></a>00837     <span class="keywordflow">if</span>(<a class="code" href="install_8php.html#af9da176a74bd49cb97ea35c6ac7257bc">$action</a>==<span class="stringliteral">&quot;admin_edit&quot;</span>){
<a name="l00838"></a>00838 
<a name="l00839"></a>00839         <a class="code" href="lib_8mysql_8php.html#a80abbdad3e2473fa9a676869019a152f">sc_bqf</a>(<span class="stringliteral">&quot;action=admin_new_exam&quot;</span>.<a class="code" href="config_8sitevars_8php.html#a06fab752c166675deeb7a9191add17ab">$RFS_SITE_DELIMITER</a>.<span class="stringliteral">&quot;SHOW_TEXT_name=new exam&quot;</span>,<span class="stringliteral">&quot;Create new exam&quot;</span>);
<a name="l00840"></a>00840 
<a name="l00841"></a>00841         $q=<span class="stringliteral">&quot;select * from exams order by name &quot;</span>;
<a name="l00842"></a>00842         <a class="code" href="sp_8php.html#a8abe176bc41afd728f32ba8c506cbd98">$r</a>=<a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>($q); $n=mysql_num_rows(<a class="code" href="sp_8php.html#a8abe176bc41afd728f32ba8c506cbd98">$r</a>);
<a name="l00843"></a>00843 
<a name="l00844"></a>00844         echo <span class="stringliteral">&quot;&lt;table border=0 cellspacing=o cell padding=0&gt;&quot;</span>;
<a name="l00845"></a>00845 
<a name="l00846"></a>00846         echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;
<a name="l00847"></a>00847         echo <span class="stringliteral">&quot;&lt;td&gt;Tools&lt;/td&gt;&quot;</span>;
<a name="l00848"></a>00848         echo <span class="stringliteral">&quot;&lt;td&gt;Name &lt;/td&gt;&quot;</span>;
<a name="l00849"></a>00849         echo <span class="stringliteral">&quot;&lt;td&gt;Method&lt;/td&gt;&quot;</span>;
<a name="l00850"></a>00850         echo <span class="stringliteral">&quot;&lt;td&gt;Pass Percent&lt;/td&gt;&quot;</span>;
<a name="l00851"></a>00851         echo <span class="stringliteral">&quot;&lt;td&gt;Questions&lt;/td&gt;&quot;</span>;
<a name="l00852"></a>00852         echo <span class="stringliteral">&quot;&lt;td&gt;Total Questions&lt;/td&gt;&quot;</span>;
<a name="l00853"></a>00853         echo <span class="stringliteral">&quot;&lt;td&gt;POD&lt;/td&gt;&quot;</span>;
<a name="l00854"></a>00854 
<a name="l00855"></a>00855         echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;
<a name="l00856"></a>00856 
<a name="l00857"></a>00857         <span class="keywordflow">for</span>($i=0;$i&lt;$n;$i++){
<a name="l00858"></a>00858 
<a name="l00859"></a>00859             $exam=mysql_fetch_object(<a class="code" href="sp_8php.html#a8abe176bc41afd728f32ba8c506cbd98">$r</a>);
<a name="l00860"></a>00860             <a class="code" href="linkbin_2linkbin_8php.html#acc3ddc926074609c4cff4f0aa1793fad">$gt</a>++; <span class="keywordflow">if</span>(<a class="code" href="linkbin_2linkbin_8php.html#acc3ddc926074609c4cff4f0aa1793fad">$gt</a>&gt;2) <a class="code" href="linkbin_2linkbin_8php.html#acc3ddc926074609c4cff4f0aa1793fad">$gt</a>=1;
<a name="l00861"></a>00861 
<a name="l00862"></a>00862             echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;
<a name="l00863"></a>00863 
<a name="l00864"></a>00864                 echo <span class="stringliteral">&quot;&lt;td class=sc_project_table_$gt&gt;&quot;</span>;<span class="comment"></span>
<a name="l00865"></a>00865 <span class="comment">                ///////// tools</span>
<a name="l00866"></a>00866 <span class="comment"></span>                                                echo <span class="stringliteral">&quot;&lt;table border=0 cellspacing=0 cellpadding=0&gt;&quot;</span>;
<a name="l00867"></a>00867                                         echo <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;
<a name="l00868"></a>00868 
<a name="l00869"></a>00869 <span class="comment"></span>
<a name="l00870"></a>00870 <span class="comment">                ///// edit</span>
<a name="l00871"></a>00871 <span class="comment"></span>                                    echo <span class="stringliteral">&quot;&lt;td&gt;&quot;</span>;
<a name="l00872"></a>00872                 echo <span class="stringliteral">&quot;&lt;a href=&#39;$RFS_SITE_URL/modules/exams/exams.php?action=admin_exam_edit&amp;exam_id=$exam-&gt;id&#39;&gt;&quot;</span>;
<a name="l00873"></a>00873                 echo <span class="stringliteral">&quot;&lt;img src=&#39;$RFS_SITE_URL/images/icons/Edit.png&#39; width=32 border=0&gt;&quot;</span>;
<a name="l00874"></a>00874                 echo <span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;
<a name="l00875"></a>00875                                     echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;
<a name="l00876"></a>00876 
<a name="l00877"></a>00877 <span class="comment"></span>
<a name="l00878"></a>00878 <span class="comment">                ///// delete</span>
<a name="l00879"></a>00879 <span class="comment"></span>                                    echo <span class="stringliteral">&quot;&lt;td&gt;&quot;</span>;
<a name="l00880"></a>00880                 echo <span class="stringliteral">&quot;&lt;a href=&#39;$RFS_SITE_URL/modules/exams/exams.php?action=admin_exam_remove&amp;exam_id=$exam-&gt;id&#39;&gt;&quot;</span>;
<a name="l00881"></a>00881                 echo <span class="stringliteral">&quot;&lt;img src=&#39;$RFS_SITE_URL/images/icons/Delete.png&#39; width=32 border=0&gt;&quot;</span>;
<a name="l00882"></a>00882                 echo <span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;
<a name="l00883"></a>00883                                     echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;
<a name="l00884"></a>00884 <span class="comment"></span>
<a name="l00885"></a>00885 <span class="comment">                ///// rename</span>
<a name="l00886"></a>00886 <span class="comment"></span>
<a name="l00887"></a>00887                                     echo <span class="stringliteral">&quot;&lt;td&gt;&quot;</span>;
<a name="l00888"></a>00888                 echo <span class="stringliteral">&quot;&lt;a href=&#39;$RFS_SITE_URL/modules/exams/exams.php?action=admin_exam_rename&amp;exam_id=$exam-&gt;id&#39;&gt;&quot;</span>;
<a name="l00889"></a>00889                 echo <span class="stringliteral">&quot;&lt;img src=&#39;$RFS_SITE_URL/images/icons/Tag.png&#39; width=32  border=0&gt;&quot;</span>;
<a name="l00890"></a>00890                 echo <span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;
<a name="l00891"></a>00891                                     echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;
<a name="l00892"></a>00892 
<a name="l00893"></a>00893 
<a name="l00894"></a>00894 <span class="comment"></span>
<a name="l00895"></a>00895 <span class="comment">                ///// run</span>
<a name="l00896"></a>00896 <span class="comment"></span>
<a name="l00897"></a>00897                                     echo <span class="stringliteral">&quot;&lt;td&gt;&quot;</span>;
<a name="l00898"></a>00898                 echo <span class="stringliteral">&quot;&lt;a href=&#39;$RFS_SITE_URL/modules/exams/exams.php?action=admin_exam_test&amp;exam_id=$exam-&gt;id&#39;&gt;&quot;</span>;
<a name="l00899"></a>00899                 echo <span class="stringliteral">&quot;&lt;img src=&#39;$RFS_SITE_URL/images/icons/Play.png&#39; width=32  border=0&gt;&quot;</span>;
<a name="l00900"></a>00900                 echo <span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>;
<a name="l00901"></a>00901                                     echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;
<a name="l00902"></a>00902 
<a name="l00903"></a>00903 
<a name="l00904"></a>00904 
<a name="l00905"></a>00905                                             echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;
<a name="l00906"></a>00906                                                     echo <span class="stringliteral">&quot;&lt;/table&gt;&quot;</span>;
<a name="l00907"></a>00907 
<a name="l00908"></a>00908                 echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;
<a name="l00909"></a>00909 <span class="comment"></span>
<a name="l00910"></a>00910 <span class="comment">                //// exam name</span>
<a name="l00911"></a>00911 <span class="comment"></span>
<a name="l00912"></a>00912                 echo <span class="stringliteral">&quot;&lt;td class=sc_project_table_$gt&gt;&quot;</span>;
<a name="l00913"></a>00913                     echo $exam-&gt;name;
<a name="l00914"></a>00914                 echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;
<a name="l00915"></a>00915 
<a name="l00916"></a>00916 <span class="comment"></span>
<a name="l00917"></a>00917 <span class="comment">                //// exam method</span>
<a name="l00918"></a>00918 <span class="comment"></span>
<a name="l00919"></a>00919                 echo <span class="stringliteral">&quot;&lt;td class=sc_project_table_$gt&gt;&quot;</span>;
<a name="l00920"></a>00920                     echo $exam-&gt;method;
<a name="l00921"></a>00921                 echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;
<a name="l00922"></a>00922                 <span class="comment"></span>
<a name="l00923"></a>00923 <span class="comment">               //// exam pass percent</span>
<a name="l00924"></a>00924 <span class="comment"></span>
<a name="l00925"></a>00925                 echo <span class="stringliteral">&quot;&lt;td class=sc_project_table_$gt&gt;&quot;</span>;
<a name="l00926"></a>00926                     echo $exam-&gt;pass_percent;
<a name="l00927"></a>00927                 echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;
<a name="l00928"></a>00928         <span class="comment"></span>
<a name="l00929"></a>00929 <span class="comment">               //// exam questions</span>
<a name="l00930"></a>00930 <span class="comment"></span>
<a name="l00931"></a>00931                 echo <span class="stringliteral">&quot;&lt;td class=sc_project_table_$gt&gt;&quot;</span>;
<a name="l00932"></a>00932                     echo $exam-&gt;questions;
<a name="l00933"></a>00933                 echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;
<a name="l00934"></a>00934                 
<a name="l00935"></a>00935                 <span class="comment"></span>
<a name="l00936"></a>00936 <span class="comment">               //// exam total questions</span>
<a name="l00937"></a>00937 <span class="comment"></span>
<a name="l00938"></a>00938                 echo <span class="stringliteral">&quot;&lt;td class=sc_project_table_$gt&gt;&quot;</span>;
<a name="l00939"></a>00939                 $rnq=<a class="code" href="lib_8mysql_8php.html#aa22ac855bc784ef271c92223b57e43f0">sc_query</a>(<span class="stringliteral">&quot;select * from exam_questions where exam_id=&#39;$exam-&gt;id&#39;&quot;</span>);
<a name="l00940"></a>00940                 $nq=mysql_num_rows($rnq);
<a name="l00941"></a>00941                     echo $nq;
<a name="l00942"></a>00942                 echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;
<a name="l00943"></a>00943 
<a name="l00944"></a>00944 
<a name="l00945"></a>00945 
<a name="l00946"></a>00946                 
<a name="l00947"></a>00947 <span class="comment"></span>
<a name="l00948"></a>00948 <span class="comment">                //// POD association</span>
<a name="l00949"></a>00949 <span class="comment"></span>                    echo <span class="stringliteral">&quot;&lt;td class=sc_project_table_$gt&gt;&quot;</span>;
<a name="l00950"></a>00950                     $pod_id=$exam-&gt;pod_id;
<a name="l00951"></a>00951                     $pod=<span class="stringliteral">&quot; &quot;</span>;
<a name="l00952"></a>00952                     <span class="keywordflow">if</span>($pod_id==0){
<a name="l00953"></a>00953                         $pod=<span class="stringliteral">&quot;Select POD to associate with this exam&quot;</span>;
<a name="l00954"></a>00954                     }
<a name="l00955"></a>00955                     <span class="keywordflow">else</span>    {
<a name="l00956"></a>00956                             $podd=<a class="code" href="lib_8mysql_8php.html#ad42d2c11477299cecf3dd06b259a316e">mfo1</a>(<span class="stringliteral">&quot;select * from pods where id=&#39;$pod_id&#39;&quot;</span>);
<a name="l00957"></a>00957                             $pod=$podd-&gt;name;
<a name="l00958"></a>00958                     }
<a name="l00959"></a>00959                     
<a name="l00960"></a>00960 
<a name="l00961"></a>00961                 <a class="code" href="lib_8mysql_8php.html#a8594d0f9a34f20d40018060b96f6e679">sc_optionizer</a>(  <a class="code" href="lib_8mysql_8php.html#a90227497e3406a51ddbaad5bcf7ba665">sc_phpself</a>(),
<a name="l00962"></a>00962                                 <span class="stringliteral">&quot;action=admin_exam_change_pod&quot;</span>.<a class="code" href="config_8sitevars_8php.html#a06fab752c166675deeb7a9191add17ab">$RFS_SITE_DELIMITER</a>.
<a name="l00963"></a>00963                                 <span class="stringliteral">&quot;exam_id=$exam-&gt;id&quot;</span>,
<a name="l00964"></a>00964                                 <span class="stringliteral">&quot;pods&quot;</span>,
<a name="l00965"></a>00965                                 <span class="stringliteral">&quot;name&quot;</span>,
<a name="l00966"></a>00966                                 <span class="stringliteral">&quot;1&quot;</span>,
<a name="l00967"></a>00967                                 $pod,
<a name="l00968"></a>00968                                 <span class="stringliteral">&quot;1&quot;</span>
<a name="l00969"></a>00969                                 );
<a name="l00970"></a>00970                 echo <span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;
<a name="l00971"></a>00971 
<a name="l00972"></a>00972 
<a name="l00973"></a>00973             echo <span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;
<a name="l00974"></a>00974         }
<a name="l00975"></a>00975 
<a name="l00976"></a>00976         echo <span class="stringliteral">&quot;&lt;/table&gt;&quot;</span>;        
<a name="l00977"></a>00977     }
<a name="l00978"></a>00978 
<a name="l00979"></a>00979 
<a name="l00980"></a>00980 
<a name="l00981"></a>00981 <span class="comment">/*</span>
<a name="l00982"></a>00982 <span class="comment">if($action==&quot;add_script_group&quot;){</span>
<a name="l00983"></a>00983 <span class="comment">    sc_query(&quot;insert into script_groups (`name`) values(&#39;$name&#39;)&quot;);</span>
<a name="l00984"></a>00984 <span class="comment">    $r=sc_query(&quot;select * from script_groups where name = &#39;$name&#39;&quot;);</span>
<a name="l00985"></a>00985 <span class="comment">    $scr=mysql_fetch_object($r) ;</span>
<a name="l00986"></a>00986 <span class="comment">    echo &quot;&lt;h1&gt;Add $scr-&gt;name&lt;/h1&gt;&quot;;</span>
<a name="l00987"></a>00987 <span class="comment"></span>
<a name="l00988"></a>00988 <span class="comment">}</span>
<a name="l00989"></a>00989 <span class="comment"></span>
<a name="l00990"></a>00990 <span class="comment">if($action==&quot;script_group_change_pod&quot;){</span>
<a name="l00991"></a>00991 <span class="comment"></span>
<a name="l00992"></a>00992 <span class="comment">    echo &quot;script_group [$script_group] &lt;br&gt;&quot;;</span>
<a name="l00993"></a>00993 <span class="comment">    echo &quot;name [$name] &lt;br&gt;&quot;;</span>
<a name="l00994"></a>00994 <span class="comment"></span>
<a name="l00995"></a>00995 <span class="comment">    sc_query(&quot;update script_groups set pod=&#39;$name&#39; where id=&#39;$script_group&#39;&quot;);</span>
<a name="l00996"></a>00996 <span class="comment"></span>
<a name="l00997"></a>00997 <span class="comment">    $action=&quot;show_script_groups&quot;;</span>
<a name="l00998"></a>00998 <span class="comment"></span>
<a name="l00999"></a>00999 <span class="comment">}</span>
<a name="l01000"></a>01000 <span class="comment"></span>
<a name="l01001"></a>01001 <span class="comment">if($action==&quot;script_change_group&quot;){</span>
<a name="l01002"></a>01002 <span class="comment">    echo &quot;&lt;h1&gt;Change GROUP!&lt;/h1&gt;&quot;;</span>
<a name="l01003"></a>01003 <span class="comment"></span>
<a name="l01004"></a>01004 <span class="comment">    // remove_script_from_groups($script);</span>
<a name="l01005"></a>01005 <span class="comment"></span>
<a name="l01006"></a>01006 <span class="comment">    echo &quot;$script&lt;br&gt;&quot;;</span>
<a name="l01007"></a>01007 <span class="comment">    echo &quot;$name&lt;br&gt;&quot;;</span>
<a name="l01008"></a>01008 <span class="comment">    $sgr=sc_query(&quot;select * from script_groups where id=$name&quot;);</span>
<a name="l01009"></a>01009 <span class="comment">    $sg=mysql_fetch_object($sgr);</span>
<a name="l01010"></a>01010 <span class="comment">    echo &quot;Script Group -&gt; $sg-&gt;name &lt;br&gt;&quot;;</span>
<a name="l01011"></a>01011 <span class="comment">    $sgsc=&quot;,$sg-&gt;scripts,&quot;;</span>
<a name="l01012"></a>01012 <span class="comment">    $sgsc=str_replace(&quot;,$script,&quot;,&quot;,&quot;,$sgsc);</span>
<a name="l01013"></a>01013 <span class="comment">    $sgsc=str_replace(&quot;,,&quot;,&quot;,&quot;,$sgsc);</span>
<a name="l01014"></a>01014 <span class="comment">    $sgsc=rtrim($sgsc,&quot;,&quot;);</span>
<a name="l01015"></a>01015 <span class="comment">    $sgsc=$script.$sgsc;</span>
<a name="l01016"></a>01016 <span class="comment"></span>
<a name="l01017"></a>01017 <span class="comment">    sc_query(&quot;update script_groups set scripts = &#39;$sgsc&#39; where id=&#39;$name&#39;&quot;);</span>
<a name="l01018"></a>01018 <span class="comment">    sc_query(&quot;update scripts set script_group=&#39;$name&#39; where id=&#39;$sgsc&#39;&quot;);</span>
<a name="l01019"></a>01019 <span class="comment"></span>
<a name="l01020"></a>01020 <span class="comment">    echo &quot;Scripts in this group: $sgsc &lt;br&gt;&quot;;</span>
<a name="l01021"></a>01021 <span class="comment"></span>
<a name="l01022"></a>01022 <span class="comment">    $action=&quot;show_scripts&quot;;</span>
<a name="l01023"></a>01023 <span class="comment"></span>
<a name="l01024"></a>01024 <span class="comment">}</span>
<a name="l01025"></a>01025 <span class="comment"></span>
<a name="l01026"></a>01026 <span class="comment">if($action==&quot;remove_script_from_group&quot;){</span>
<a name="l01027"></a>01027 <span class="comment">        //echo &quot;Remove script[$script] from group [$group]&lt;br&gt;&lt;br&gt;&quot;;</span>
<a name="l01028"></a>01028 <span class="comment">        $r=sc_query(&quot;select * from script_groups where id=&#39;$group&#39;&quot;);</span>
<a name="l01029"></a>01029 <span class="comment">        $sg=mysql_fetch_object($r);</span>
<a name="l01030"></a>01030 <span class="comment">        $sgx=explode(&quot;,&quot;,$sg-&gt;scripts);</span>
<a name="l01031"></a>01031 <span class="comment">        $sgi=&quot;&quot;;</span>
<a name="l01032"></a>01032 <span class="comment">        for($si=0;$si&lt;count($sgx);$si++){</span>
<a name="l01033"></a>01033 <span class="comment">            //echo &quot;$sgx[$si] &lt;BR&gt;&quot;;</span>
<a name="l01034"></a>01034 <span class="comment">            if($sgx[$si]==$script){</span>
<a name="l01035"></a>01035 <span class="comment"></span>
<a name="l01036"></a>01036 <span class="comment">            }</span>
<a name="l01037"></a>01037 <span class="comment">                //echo &quot; ^^^^^^ WINNER &lt;BR&gt;&quot;;</span>
<a name="l01038"></a>01038 <span class="comment">            else</span>
<a name="l01039"></a>01039 <span class="comment">                $sgi.=$sgx[$si].&quot;,&quot;;</span>
<a name="l01040"></a>01040 <span class="comment"></span>
<a name="l01041"></a>01041 <span class="comment">        }</span>
<a name="l01042"></a>01042 <span class="comment">        $sgi=rtrim($sgi,&quot;,&quot;);</span>
<a name="l01043"></a>01043 <span class="comment">        echo &quot;$sgi&lt;br&gt;&quot;;</span>
<a name="l01044"></a>01044 <span class="comment">        sc_query(&quot;update script_groups set scripts=&#39;$sgi&#39; where id=&#39;$group&#39;&quot;);</span>
<a name="l01045"></a>01045 <span class="comment">        $action=&quot;show_script_groups&quot;;</span>
<a name="l01046"></a>01046 <span class="comment">}</span>
<a name="l01047"></a>01047 <span class="comment"></span>
<a name="l01048"></a>01048 <span class="comment">if($action==&quot;show_script_groups&quot;){</span>
<a name="l01049"></a>01049 <span class="comment"></span>
<a name="l01050"></a>01050 <span class="comment">    $q=&quot;select * from script_groups&quot;;</span>
<a name="l01051"></a>01051 <span class="comment">    $r=sc_query($q);</span>
<a name="l01052"></a>01052 <span class="comment">    $n=mysql_num_rows($r);</span>
<a name="l01053"></a>01053 <span class="comment">    echo &quot;&lt;table border=0&gt;&quot;;</span>
<a name="l01054"></a>01054 <span class="comment"></span>
<a name="l01055"></a>01055 <span class="comment">    echo &quot;&lt;tr&gt;&quot;;</span>
<a name="l01056"></a>01056 <span class="comment">    echo &quot;&lt;td&gt;Name&lt;/td&gt;&quot;;</span>
<a name="l01057"></a>01057 <span class="comment">    echo &quot;&lt;td&gt;Pod&lt;/td&gt;&quot;;</span>
<a name="l01058"></a>01058 <span class="comment">    echo &quot;&lt;td&gt;Scripts&lt;/td&gt;&quot;;</span>
<a name="l01059"></a>01059 <span class="comment"></span>
<a name="l01060"></a>01060 <span class="comment">    echo &quot;&lt;/tr&gt;&quot;;</span>
<a name="l01061"></a>01061 <span class="comment"></span>
<a name="l01062"></a>01062 <span class="comment">    for($i=0;$i&lt;$n;$i++){</span>
<a name="l01063"></a>01063 <span class="comment"></span>
<a name="l01064"></a>01064 <span class="comment">        $s=mysql_fetch_object($r);</span>
<a name="l01065"></a>01065 <span class="comment">        $gt++; if($gt&gt;2) $gt=1;</span>
<a name="l01066"></a>01066 <span class="comment"></span>
<a name="l01067"></a>01067 <span class="comment">        echo &quot;&lt;tr&gt;&quot;;</span>
<a name="l01068"></a>01068 <span class="comment"></span>
<a name="l01069"></a>01069 <span class="comment">        echo &quot;&lt;td class=sc_project_table_$gt&gt;$s-&gt;name&lt;/td&gt;&quot;;</span>
<a name="l01070"></a>01070 <span class="comment"></span>
<a name="l01071"></a>01071 <span class="comment">        echo &quot;&lt;td class=sc_project_table_$gt&gt;&quot;;</span>
<a name="l01072"></a>01072 <span class="comment"></span>
<a name="l01073"></a>01073 <span class="comment">        // echo $s-&gt;pod;</span>
<a name="l01074"></a>01074 <span class="comment"></span>
<a name="l01075"></a>01075 <span class="comment">        $dpod=&quot;Select Pod&quot;;</span>
<a name="l01076"></a>01076 <span class="comment">        if($s-&gt;pod&gt;0){</span>
<a name="l01077"></a>01077 <span class="comment">            $pr=sc_query(&quot;select * from pods where id=&#39;$s-&gt;pod&#39;&quot;);</span>
<a name="l01078"></a>01078 <span class="comment">            $pod=mysql_fetch_object($pr);</span>
<a name="l01079"></a>01079 <span class="comment">            $dpod=$pod-&gt;name;</span>
<a name="l01080"></a>01080 <span class="comment">        }</span>
<a name="l01081"></a>01081 <span class="comment"></span>
<a name="l01082"></a>01082 <span class="comment">        sc_optionizer(  sc_phpself(), // return page</span>
<a name="l01083"></a>01083 <span class="comment">                            &quot;action=script_group_change_pod&quot;. // variables to return</span>
<a name="l01084"></a>01084 <span class="comment">                            &quot;script_group=$s-&gt;id&quot;,</span>
<a name="l01085"></a>01085 <span class="comment">                            &quot;pods&quot;, // table to optionize</span>
<a name="l01086"></a>01086 <span class="comment">                            &quot;name&quot;, // field to optionize</span>
<a name="l01087"></a>01087 <span class="comment">                            &quot;1&quot;, // use id method</span>
<a name="l01088"></a>01088 <span class="comment">                            $dpod, // default text to show</span>
<a name="l01089"></a>01089 <span class="comment">                            &quot;1&quot;  // use on change method</span>
<a name="l01090"></a>01090 <span class="comment">                            );</span>
<a name="l01091"></a>01091 <span class="comment"></span>
<a name="l01092"></a>01092 <span class="comment"></span>
<a name="l01093"></a>01093 <span class="comment">        echo &quot;&lt;/td&gt;&quot;;</span>
<a name="l01094"></a>01094 <span class="comment"></span>
<a name="l01095"></a>01095 <span class="comment">        echo &quot;&lt;td class=sc_project_table_$gt&gt;&quot;;</span>
<a name="l01096"></a>01096 <span class="comment"></span>
<a name="l01097"></a>01097 <span class="comment">        //$sr=sc_query(&quot;select * from scripts where script_group=&#39;$s-&gt;id&#39;&quot;);</span>
<a name="l01098"></a>01098 <span class="comment">        //$ns=mysql_num_rows($sr);</span>
<a name="l01099"></a>01099 <span class="comment">        //for($ni=0;$ni&lt;$ns;$ni++){</span>
<a name="l01100"></a>01100 <span class="comment">        //  $ins=mysql_fetch_object($sr);</span>
<a name="l01101"></a>01101 <span class="comment">        //  echo &quot;$ins-&gt;name $ins-&gt;network_device ($ins-&gt;file)&lt;br&gt;&quot;;</span>
<a name="l01102"></a>01102 <span class="comment">        //}</span>
<a name="l01103"></a>01103 <span class="comment">        $sx=explode(&quot;,&quot;,$s-&gt;scripts);</span>
<a name="l01104"></a>01104 <span class="comment"></span>
<a name="l01105"></a>01105 <span class="comment">        //echo &quot;&lt;BR&gt; [COUNT [&quot;;</span>
<a name="l01106"></a>01106 <span class="comment">        //echo count($sx);</span>
<a name="l01107"></a>01107 <span class="comment">        //echo &quot;]]&lt;BR&gt;&quot;;</span>
<a name="l01108"></a>01108 <span class="comment"></span>
<a name="l01109"></a>01109 <span class="comment">        for($sii=0;$sii&lt;count($sx);$sii++){</span>
<a name="l01110"></a>01110 <span class="comment"></span>
<a name="l01111"></a>01111 <span class="comment">            if(!empty($sx[$sii])) {</span>
<a name="l01112"></a>01112 <span class="comment">                $scr_name=mfo1(&quot;select * from scripts where id=&#39;$sx[$sii]&#39;&quot;);</span>
<a name="l01113"></a>01113 <span class="comment">                echo &quot;&lt;a href=&#39;$RFS_SITE_URL/net.php?action=remove_script_from_group&amp;group=$s-&gt;id&amp;script=$sx[$sii]&#39;&gt;&quot;;</span>
<a name="l01114"></a>01114 <span class="comment">                echo &quot;&lt;img src=images/icons/network_devices/cross.png border=0&gt;&quot;;</span>
<a name="l01115"></a>01115 <span class="comment">                echo &quot;&lt;/a&gt;&quot;;</span>
<a name="l01116"></a>01116 <span class="comment">                echo $scr_name-&gt;name.&quot;&lt;br&gt;&quot;;</span>
<a name="l01117"></a>01117 <span class="comment">            }</span>
<a name="l01118"></a>01118 <span class="comment"></span>
<a name="l01119"></a>01119 <span class="comment"></span>
<a name="l01120"></a>01120 <span class="comment">        }</span>
<a name="l01121"></a>01121 <span class="comment"></span>
<a name="l01122"></a>01122 <span class="comment"></span>
<a name="l01123"></a>01123 <span class="comment">        echo &quot;&lt;/td&gt;&quot;;</span>
<a name="l01124"></a>01124 <span class="comment">        echo &quot;&lt;/tr&gt;&quot;;</span>
<a name="l01125"></a>01125 <span class="comment">    }</span>
<a name="l01126"></a>01126 <span class="comment"></span>
<a name="l01127"></a>01127 <span class="comment">    echo &quot;&lt;/table&gt;&quot;;</span>
<a name="l01128"></a>01128 <span class="comment"></span>
<a name="l01129"></a>01129 <span class="comment">    $page=$GLOBALS[&#39;site_url&#39;].$GLOBALS[&#39;PHP_SELF&#39;];</span>
<a name="l01130"></a>01130 <span class="comment">    sc_bf($page,&quot;action=add_script_group&quot;,&quot;script_groups&quot;,&quot;&quot;,&quot;&quot;,&quot;name&quot;,&quot;include&quot;,&quot;&quot;,60,&quot;add&quot;);</span>
<a name="l01131"></a>01131 <span class="comment">}</span>
<a name="l01132"></a>01132 <span class="comment"></span>
<a name="l01133"></a>01133 <span class="comment"></span>
<a name="l01134"></a>01134 <span class="comment">function orphan_script_scan($dir){</span>
<a name="l01135"></a>01135 <span class="comment">    echo &quot;Scanning [$dir]&lt;br&gt;&quot;;</span>
<a name="l01136"></a>01136 <span class="comment">    $dir_count=0;</span>
<a name="l01137"></a>01137 <span class="comment">    $dirfiles = array();</span>
<a name="l01138"></a>01138 <span class="comment">    $handle=opendir($dir) or die(&quot;Unable to open filepath&quot;);</span>
<a name="l01139"></a>01139 <span class="comment">    while (false!==($file = readdir($handle))) array_push($dirfiles,$file);</span>
<a name="l01140"></a>01140 <span class="comment">    closedir($handle);</span>
<a name="l01141"></a>01141 <span class="comment">    reset($dirfiles);</span>
<a name="l01142"></a>01142 <span class="comment">    while(list ($key, $file) = each ($dirfiles)){</span>
<a name="l01143"></a>01143 <span class="comment">        if($file!=&quot;.&quot;){</span>
<a name="l01144"></a>01144 <span class="comment">            if($file!=&quot;..&quot;){</span>
<a name="l01145"></a>01145 <span class="comment">                if(is_dir($dir.&quot;/&quot;.$file)){</span>
<a name="l01146"></a>01146 <span class="comment">                    orphan_scan($dir.&quot;/&quot;.$file);</span>
<a name="l01147"></a>01147 <span class="comment">                }</span>
<a name="l01148"></a>01148 <span class="comment">                else {</span>
<a name="l01149"></a>01149 <span class="comment">                    $filefound=0;</span>
<a name="l01150"></a>01150 <span class="comment">                    $url = &quot;$dir/$file&quot;;</span>
<a name="l01151"></a>01151 <span class="comment">                    $res=sc_query(&quot;select * from `scripts` where `file` like &#39;%$file%&#39;&quot;);</span>
<a name="l01152"></a>01152 <span class="comment">                    if(mysql_num_rows($res)&gt;0) $filefound=1;</span>
<a name="l01153"></a>01153 <span class="comment">                    $res=sc_query(&quot;select * from `scripts` where `name` = &#39;%$file%&#39;&quot;);</span>
<a name="l01154"></a>01154 <span class="comment">                    if(mysql_num_rows($res)&gt;0) $filefound=1;</span>
<a name="l01155"></a>01155 <span class="comment">                    if($filefound){</span>
<a name="l01156"></a>01156 <span class="comment">                        // echo &quot;Skipped [$url] already in database&lt;br&gt;&quot;;</span>
<a name="l01157"></a>01157 <span class="comment">                    }</span>
<a name="l01158"></a>01158 <span class="comment">                    else{</span>
<a name="l01159"></a>01159 <span class="comment">                        $time=date(&quot;Y-m-d H:i:s&quot;);</span>
<a name="l01160"></a>01160 <span class="comment">                        $filetype=sc_getfiletype($file);</span>
<a name="l01161"></a>01161 <span class="comment">                        // $filesizebytes=filesize(getcwd().&quot;/$dir/$file&quot;);</span>
<a name="l01162"></a>01162 <span class="comment">                        $name=$file;</span>
<a name="l01163"></a>01163 <span class="comment">                        sc_query(&quot;INSERT INTO `scripts` (`file`) VALUES(&#39;$file&#39;);&quot;);</span>
<a name="l01164"></a>01164 <span class="comment">                        sc_query(&quot;UPDATE scripts SET `name`=&#39;$file&#39; where `file`=&#39;$name&#39;&quot;);</span>
<a name="l01165"></a>01165 <span class="comment">                        sc_query(&quot;UPDATE scripts SET `type`=&#39;none&#39; where `file`=&#39;$name&#39;&quot;);</span>
<a name="l01166"></a>01166 <span class="comment">                        echo &quot;Added [$url] to database&lt;br&gt;&quot;;</span>
<a name="l01167"></a>01167 <span class="comment">                        $dir_count++;</span>
<a name="l01168"></a>01168 <span class="comment">                   }</span>
<a name="l01169"></a>01169 <span class="comment">                 }</span>
<a name="l01170"></a>01170 <span class="comment">            }</span>
<a name="l01171"></a>01171 <span class="comment">        }</span>
<a name="l01172"></a>01172 <span class="comment">    }</span>
<a name="l01173"></a>01173 <span class="comment">    echo &quot;Finished scan for orphan scripts&lt;br&gt;&quot;;</span>
<a name="l01174"></a>01174 <span class="comment">}</span>
<a name="l01175"></a>01175 <span class="comment"></span>
<a name="l01176"></a>01176 <span class="comment">function purge_scripts(){</span>
<a name="l01177"></a>01177 <span class="comment">    $scripts=sc_query(&quot;select * from scripts&quot;);</span>
<a name="l01178"></a>01178 <span class="comment">    for($i=0;$i&lt;mysql_num_rows($scripts);$i++){</span>
<a name="l01179"></a>01179 <span class="comment">        $script=mysql_fetch_object($scripts);</span>
<a name="l01180"></a>01180 <span class="comment"></span>
<a name="l01181"></a>01181 <span class="comment">        if( (!file_exists(&quot;/var/www/scripts/$script-&gt;file&quot;))  ||</span>
<a name="l01182"></a>01182 <span class="comment">                (filesize(&quot;/var/www/scripts/$script-&gt;file&quot;)==0)</span>
<a name="l01183"></a>01183 <span class="comment">            ) {</span>
<a name="l01184"></a>01184 <span class="comment">            system(&quot;rm /var/www/scripts/$script-&gt;file&quot;);</span>
<a name="l01185"></a>01185 <span class="comment">            sc_query(&quot;delete from scripts where id = $script-&gt;id&quot;);</span>
<a name="l01186"></a>01186 <span class="comment">            echo &quot;-- &gt; $script-&gt;file removed &lt;BR&gt;&quot;;</span>
<a name="l01187"></a>01187 <span class="comment"></span>
<a name="l01188"></a>01188 <span class="comment">        }</span>
<a name="l01189"></a>01189 <span class="comment"></span>
<a name="l01190"></a>01190 <span class="comment"></span>
<a name="l01191"></a>01191 <span class="comment">    }</span>
<a name="l01192"></a>01192 <span class="comment"></span>
<a name="l01193"></a>01193 <span class="comment">}</span>
<a name="l01194"></a>01194 <span class="comment"></span>
<a name="l01195"></a>01195 <span class="comment">if($action==&quot;orphan_scripts&quot;){</span>
<a name="l01196"></a>01196 <span class="comment">    echo &quot;&lt;h2&gt;Searching for scripts&lt;/h2&gt;&quot;;</span>
<a name="l01197"></a>01197 <span class="comment">    orphan_script_scan(&quot;/var/www/scripts&quot;);</span>
<a name="l01198"></a>01198 <span class="comment">    $action=&quot;show_scripts&quot;;</span>
<a name="l01199"></a>01199 <span class="comment">}</span>
<a name="l01200"></a>01200 <span class="comment"></span>
<a name="l01201"></a>01201 <span class="comment">if($action==&quot;purge_scripts&quot;){</span>
<a name="l01202"></a>01202 <span class="comment">    echo &quot;&lt;h2&gt;Purging scripts&lt;/h2&gt;&quot;;</span>
<a name="l01203"></a>01203 <span class="comment">    purge_scripts();</span>
<a name="l01204"></a>01204 <span class="comment">    $action=&quot;show_scripts&quot;;</span>
<a name="l01205"></a>01205 <span class="comment">}</span>
<a name="l01206"></a>01206 <span class="comment"></span>
<a name="l01207"></a>01207 <span class="comment">if($action==&quot;script_assoc&quot;){</span>
<a name="l01208"></a>01208 <span class="comment">    sc_query(&quot;update scripts set network_device=&#39;$network_device&#39; where id=&#39;$name&#39;&quot;);</span>
<a name="l01209"></a>01209 <span class="comment">    $action=&quot;show_scripts&quot;;</span>
<a name="l01210"></a>01210 <span class="comment">}</span>
<a name="l01211"></a>01211 <span class="comment"></span>
<a name="l01212"></a>01212 <span class="comment">if($action==&quot;script_change_network_device&quot;){</span>
<a name="l01213"></a>01213 <span class="comment"></span>
<a name="l01214"></a>01214 <span class="comment">    sc_query(&quot;update scripts set network_device=&#39;$ipaddress&#39; where id=&#39;$script&#39;&quot;);</span>
<a name="l01215"></a>01215 <span class="comment">    $scr=mfo1(&quot;select * from scripts where id=&#39;$script&#39;&quot;);</span>
<a name="l01216"></a>01216 <span class="comment"></span>
<a name="l01217"></a>01217 <span class="comment">    echo &quot;SCRIPT: $scr-&gt;name &lt;BR&gt;&quot;;</span>
<a name="l01218"></a>01218 <span class="comment">    $nd=mfo1(&quot;select * from network_devices where id=&#39;$ipaddress&#39;&quot;);</span>
<a name="l01219"></a>01219 <span class="comment">    echo &quot;NETWORK DEVICE: $nd-&gt;name ($nd-&gt;ipaddress)&lt;BR&gt;&quot;;</span>
<a name="l01220"></a>01220 <span class="comment"></span>
<a name="l01221"></a>01221 <span class="comment">    $action=&quot;show_scripts&quot;;</span>
<a name="l01222"></a>01222 <span class="comment"></span>
<a name="l01223"></a>01223 <span class="comment"></span>
<a name="l01224"></a>01224 <span class="comment">}</span>
<a name="l01225"></a>01225 <span class="comment">*/</span>
<a name="l01226"></a>01226 <span class="comment">/*</span>
<a name="l01227"></a>01227 <span class="comment">function remove_script_from_groups($script){</span>
<a name="l01228"></a>01228 <span class="comment">    $r=sc_query(&quot;select * from script_groups&quot;);</span>
<a name="l01229"></a>01229 <span class="comment">    for($i=0;$i&lt;mysql_num_rows($r);$i++) {</span>
<a name="l01230"></a>01230 <span class="comment">        $sg=mysql_fetch_object($r);</span>
<a name="l01231"></a>01231 <span class="comment">        $sgsx=explode(&quot;,&quot;,$sg-&gt;scripts);</span>
<a name="l01232"></a>01232 <span class="comment">        $sgso=&quot;&quot;;</span>
<a name="l01233"></a>01233 <span class="comment">        for($si=0;$si&lt;count($sgsx);$si++){</span>
<a name="l01234"></a>01234 <span class="comment">            if($sgsx[$si]!=$script){</span>
<a name="l01235"></a>01235 <span class="comment">                $sgso.=$sgsx[$si].&quot;,&quot;;</span>
<a name="l01236"></a>01236 <span class="comment">            }</span>
<a name="l01237"></a>01237 <span class="comment">        }</span>
<a name="l01238"></a>01238 <span class="comment">        $sgso=rtrim($sgso,&quot;,&quot;);</span>
<a name="l01239"></a>01239 <span class="comment">        echo &quot;removing script $script from $sg-&gt;name ($sgso)&lt;br&gt;&quot;;</span>
<a name="l01240"></a>01240 <span class="comment">        sc_query(&quot;update script_groups set scripts=&#39;$sgso&#39;&quot;);</span>
<a name="l01241"></a>01241 <span class="comment">    }</span>
<a name="l01242"></a>01242 <span class="comment">}</span>
<a name="l01243"></a>01243 <span class="comment">  */</span>
<a name="l01244"></a>01244 
<a name="l01245"></a>01245   <span class="comment">/*</span>
<a name="l01246"></a>01246 <span class="comment"></span>
<a name="l01247"></a>01247 <span class="comment">if($action==&quot;script_modify_go&quot;) {</span>
<a name="l01248"></a>01248 <span class="comment"></span>
<a name="l01249"></a>01249 <span class="comment">    echo &quot;&lt;h1&gt;Edit Script&lt;/h1&gt;&quot;;</span>
<a name="l01250"></a>01250 <span class="comment">    $action=&quot;show_scripts&quot;;</span>
<a name="l01251"></a>01251 <span class="comment">    $scr=mfo1(&quot;select * from scripts where id=$id&quot;);</span>
<a name="l01252"></a>01252 <span class="comment">    $fp=fopen(&quot;/var/www/scripts/$scr-&gt;file&quot;,wt);</span>
<a name="l01253"></a>01253 <span class="comment">    if($fp){</span>
<a name="l01254"></a>01254 <span class="comment">        fputs($fp,$config);</span>
<a name="l01255"></a>01255 <span class="comment">        fclose($fp);</span>
<a name="l01256"></a>01256 <span class="comment">    }</span>
<a name="l01257"></a>01257 <span class="comment">    $action=&quot;show_scripts&quot;;</span>
<a name="l01258"></a>01258 <span class="comment"></span>
<a name="l01259"></a>01259 <span class="comment">}</span>
<a name="l01260"></a>01260 <span class="comment"></span>
<a name="l01261"></a>01261 <span class="comment">if($action==&quot;show_script&quot;) {</span>
<a name="l01262"></a>01262 <span class="comment"></span>
<a name="l01263"></a>01263 <span class="comment">    $script=mfo1(&quot;select * from scripts where id=$id&quot;);</span>
<a name="l01264"></a>01264 <span class="comment"></span>
<a name="l01265"></a>01265 <span class="comment">    echo &quot;&lt;h1&gt;Edit script $script-&gt;file &lt;/h1&gt;&quot;;</span>
<a name="l01266"></a>01266 <span class="comment"></span>
<a name="l01267"></a>01267 <span class="comment">    $scr=file_get_contents(&quot;/var/www/scripts/$script-&gt;file&quot;);</span>
<a name="l01268"></a>01268 <span class="comment"></span>
<a name="l01269"></a>01269 <span class="comment">    // $scr=str_replace(&quot;&lt;&quot;,&quot;&amp;lt;&quot;,$scr);</span>
<a name="l01270"></a>01270 <span class="comment"></span>
<a name="l01271"></a>01271 <span class="comment">    $dorksz=&quot;id=$script-&gt;id&quot;;</span>
<a name="l01272"></a>01272 <span class="comment"></span>
<a name="l01273"></a>01273 <span class="comment">    sc_bqf(&quot;action=script_modify_go&quot;.$dorksz.&quot;&quot;.</span>
<a name="l01274"></a>01274 <span class="comment">            &quot;SHOW_TEXTAREA_32#110#config=$scr&quot;,</span>
<a name="l01275"></a>01275 <span class="comment">            &quot;Modify&quot;);</span>
<a name="l01276"></a>01276 <span class="comment">}</span>
<a name="l01277"></a>01277 <span class="comment">if($action==&quot;script_remove_go&quot;){</span>
<a name="l01278"></a>01278 <span class="comment">    echo &quot;&lt;h1&gt;Remove script confirmed&lt;/h1&gt;&quot;;</span>
<a name="l01279"></a>01279 <span class="comment">    $s=mfo1(&quot;select * from scripts where id=&#39;$script&#39;&quot;);</span>
<a name="l01280"></a>01280 <span class="comment">    echo sc_warn(&quot;$script $s-&gt;name $s-&gt;file removed&quot;);</span>
<a name="l01281"></a>01281 <span class="comment">    sc_query(&quot;delete from scripts where id=&#39;$script&#39;&quot;);</span>
<a name="l01282"></a>01282 <span class="comment"></span>
<a name="l01283"></a>01283 <span class="comment">    $cm=&quot;rm /var/www/scripts/$s-&gt;name&quot;;</span>
<a name="l01284"></a>01284 <span class="comment">    echo &quot;&lt;br&gt;$cm&lt;br&gt;&quot;;</span>
<a name="l01285"></a>01285 <span class="comment">    system($cm);</span>
<a name="l01286"></a>01286 <span class="comment"></span>
<a name="l01287"></a>01287 <span class="comment">    $action=&quot;show_scripts&quot;;</span>
<a name="l01288"></a>01288 <span class="comment"></span>
<a name="l01289"></a>01289 <span class="comment">}</span>
<a name="l01290"></a>01290 <span class="comment">if($action==&quot;script_remove&quot;){</span>
<a name="l01291"></a>01291 <span class="comment">    echo &quot;&lt;h1&gt;Remove script&lt;/h1&gt;&quot;;</span>
<a name="l01292"></a>01292 <span class="comment">    $s=mfo1(&quot;select * from scripts where id=&#39;$script&#39;&quot;);</span>
<a name="l01293"></a>01293 <span class="comment">    sc_confirmform(sc_warn(&quot;Remove $s-&gt;name from server and database?&quot;),</span>
<a name="l01294"></a>01294 <span class="comment">                    &quot;net.php&quot;,</span>
<a name="l01295"></a>01295 <span class="comment">                    &quot;action=script_remove_go&quot;.</span>
<a name="l01296"></a>01296 <span class="comment">                    &quot;script=$script&quot; );</span>
<a name="l01297"></a>01297 <span class="comment">    $action=&quot;show_scripts&quot;;</span>
<a name="l01298"></a>01298 <span class="comment">}</span>
<a name="l01299"></a>01299 <span class="comment"></span>
<a name="l01300"></a>01300 <span class="comment">if($action==&quot;script_rename_go&quot;) {</span>
<a name="l01301"></a>01301 <span class="comment">    echo &quot;&lt;h1&gt;Rename script&lt;/h1&gt;&quot;;</span>
<a name="l01302"></a>01302 <span class="comment">    $cm=&quot;mv &#39;/var/www/scripts/$script&#39; &#39;/var/www/scripts/$new_name&#39;&quot;;</span>
<a name="l01303"></a>01303 <span class="comment">    echo &quot;&lt;br&gt;$cm&lt;br&gt;&quot;;</span>
<a name="l01304"></a>01304 <span class="comment">    system($cm);</span>
<a name="l01305"></a>01305 <span class="comment">    purge_scripts();</span>
<a name="l01306"></a>01306 <span class="comment">    orphan_script_scan(&quot;/var/www/scripts&quot;);</span>
<a name="l01307"></a>01307 <span class="comment">    $action=&quot;show_scripts&quot;;</span>
<a name="l01308"></a>01308 <span class="comment">}</span>
<a name="l01309"></a>01309 <span class="comment"></span>
<a name="l01310"></a>01310 <span class="comment">if($action==&quot;script_rename&quot;) {</span>
<a name="l01311"></a>01311 <span class="comment">    $s=mfo1(&quot;select * from scripts where id=&#39;$script&#39;&quot;);</span>
<a name="l01312"></a>01312 <span class="comment">    echo &quot;&lt;h1&gt;Rename script&lt;/h1&gt;&quot;;</span>
<a name="l01313"></a>01313 <span class="comment">    echo &quot;Rename: $s-&gt;name&quot;;</span>
<a name="l01314"></a>01314 <span class="comment">    sc_bqf(&quot;action=script_rename_go&quot;.</span>
<a name="l01315"></a>01315 <span class="comment">            &quot;script=$s-&gt;name&quot;.</span>
<a name="l01316"></a>01316 <span class="comment">            &quot;SHOW_TEXT_1#60#new_name=$s-&gt;name&quot;,</span>
<a name="l01317"></a>01317 <span class="comment">            &quot;submit&quot;);</span>
<a name="l01318"></a>01318 <span class="comment">    $action=&quot;show_scripts&quot;;</span>
<a name="l01319"></a>01319 <span class="comment">}</span>
<a name="l01320"></a>01320 <span class="comment"></span>
<a name="l01321"></a>01321 <span class="comment">if($action==&quot;script_copy_go&quot;) {</span>
<a name="l01322"></a>01322 <span class="comment">    echo &quot;&lt;h1&gt;Copy script&lt;/h1&gt;&quot;;</span>
<a name="l01323"></a>01323 <span class="comment">    sc_inform(&quot;copied /var/www/scripts/$script to /var/www/scripts/$copy_to_filename&quot;);</span>
<a name="l01324"></a>01324 <span class="comment">    $cm=&quot;cp &#39;/var/www/scripts/$script&#39; &#39;/var/www/scripts/$copy_to_filename&#39;&quot;;</span>
<a name="l01325"></a>01325 <span class="comment">    echo &quot;&lt;br&gt;$cm&lt;br&gt;&quot;;</span>
<a name="l01326"></a>01326 <span class="comment">    system($cm);</span>
<a name="l01327"></a>01327 <span class="comment"></span>
<a name="l01328"></a>01328 <span class="comment">    orphan_script_scan(&quot;/var/www/scripts&quot;);</span>
<a name="l01329"></a>01329 <span class="comment">    $action=&quot;show_scripts&quot;;</span>
<a name="l01330"></a>01330 <span class="comment">}</span>
<a name="l01331"></a>01331 <span class="comment"></span>
<a name="l01332"></a>01332 <span class="comment">if($action==&quot;script_copy&quot;){</span>
<a name="l01333"></a>01333 <span class="comment"></span>
<a name="l01334"></a>01334 <span class="comment">    $s=mfo1(&quot;select * from scripts where id=&#39;$script&#39;&quot;);</span>
<a name="l01335"></a>01335 <span class="comment">    $newname=&quot;copy-&quot;.time().&quot;-&quot;.$s-&gt;name;</span>
<a name="l01336"></a>01336 <span class="comment">    echo &quot;&lt;h1&gt;Copy script&lt;/h1&gt;&quot;;</span>
<a name="l01337"></a>01337 <span class="comment">    sc_bqf(&quot;action=script_copy_go&quot;.</span>
<a name="l01338"></a>01338 <span class="comment">            &quot;script=$s-&gt;name&quot;.</span>
<a name="l01339"></a>01339 <span class="comment">            &quot;SHOW_TEXT_1#60#copy_to_filename=$newname&quot;,</span>
<a name="l01340"></a>01340 <span class="comment">            &quot;submit&quot;);</span>
<a name="l01341"></a>01341 <span class="comment"></span>
<a name="l01342"></a>01342 <span class="comment">    $action=&quot;show_scripts&quot;;</span>
<a name="l01343"></a>01343 <span class="comment">}</span>
<a name="l01344"></a>01344 <span class="comment"></span>
<a name="l01345"></a>01345 <span class="comment">if($action==&quot;script_push&quot;){</span>
<a name="l01346"></a>01346 <span class="comment">    $action=&quot;show_scripts&quot;;</span>
<a name="l01347"></a>01347 <span class="comment">}</span>
<a name="l01348"></a>01348 <span class="comment">*/</span>
<a name="l01349"></a>01349 
<a name="l01350"></a>01350 
<a name="l01351"></a>01351 
<a name="l01352"></a>01352 
<a name="l01353"></a>01353 
<a name="l01354"></a>01354 }
<a name="l01355"></a>01355 
<a name="l01356"></a>01356 
<a name="l01357"></a>01357 <span class="keywordflow">for</span>($i=0;$i&lt;35;$i++) echo <span class="stringliteral">&quot;&lt;br&gt;&quot;</span>;
<a name="l01358"></a>01358 include(<span class="stringliteral">&quot;footer.php&quot;</span>);
<a name="l01359"></a>01359 
<a name="l01360"></a>01360 
<a name="l01361"></a>01361 ?&gt;
</pre></div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="exams_8php.html">exams.php</a>      </li>

    <li class="footer">Generated on Sat Apr 27 2013 13:56:28 for RFSCMSAPIDocumentation by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
