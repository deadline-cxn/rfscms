<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>RFSCMSAPIDocumentation: mod_oss_results.php Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">RFSCMSAPIDocumentation
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('mod__oss__results_8php.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">mod_oss_results.php</div>  </div>
</div><!--header-->
<div class="contents">
<a href="mod__oss__results_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="comment">// no direct access</span>
<a name="l00004"></a>00004 defined(<span class="stringliteral">&#39;_JEXEC&#39;</span>) or die(&#39;Restricted access&#39;);
<a name="l00005"></a>00005 
<a name="l00006"></a>00006 <span class="comment">// Include the syndicate functions only once</span>
<a name="l00007"></a>00007 require_once( dirname(__FILE__).DS.&#39;helper.php&#39; );
<a name="l00008"></a>00008 
<a name="l00009"></a><a class="code" href="mod__oss__results_8php.html#a99e1a0c0eb34e0c92152bc6bc12b79bf">00009</a> <a class="code" href="mod__oss__results_8php.html#a99e1a0c0eb34e0c92152bc6bc12b79bf">$moduleclass_sfx</a> = <a class="code" href="header__scripts_8inc_8php.html#afe68e6fbe7acfbffc0af0c84a1996466">$params</a>-&gt;get(&#39;moduleclass_sfx&#39;, &#39;&#39;);
<a name="l00010"></a>00010 
<a name="l00011"></a><a class="code" href="mod__oss__results_8php.html#a6c7db55cb69a3846d254023debc5b6b6">00011</a> define(&#39;<a class="code" href="mod__oss__results_8php.html#a6c7db55cb69a3846d254023debc5b6b6">BASE_DIR</a>&#39;, dirname(__FILE__));
<a name="l00012"></a>00012 require BASE_DIR.&#39;/lib/misc.lib.php&#39;;
<a name="l00013"></a>00013 require BASE_DIR.&#39;/lib/<a class="code" href="classOSS__API.html">OSS_API</a>.<a class="code" href="webSearch_8php.html#a6517c424651b4181f725b15db7da0ed3">class</a>.php&#39;;
<a name="l00014"></a>00014 require BASE_DIR.&#39;/lib/<a class="code" href="classOSS__Search.html">OSS_Search</a>.<a class="code" href="webSearch_8php.html#a6517c424651b4181f725b15db7da0ed3">class</a>.php&#39;;
<a name="l00015"></a>00015 
<a name="l00016"></a><a class="code" href="mod__oss__results_8php.html#a8afaab8f271efa2cfdba792cc71bb9b8">00016</a> define(&#39;<a class="code" href="mod__oss__results_8php.html#a8afaab8f271efa2cfdba792cc71bb9b8">MAX_PAGE_TO_LINK</a>&#39;, <a class="code" href="header__scripts_8inc_8php.html#afe68e6fbe7acfbffc0af0c84a1996466">$params</a>-&gt;get(&#39;maxResultPerPage&#39;,10));
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 
<a name="l00019"></a><a class="code" href="mod__oss__results_8php.html#a075b0c8cda478a8c0deb55fcb3fbb904">00019</a> <a class="code" href="mod__oss__results_8php.html#a075b0c8cda478a8c0deb55fcb3fbb904">$ossEnginePath</a>  = <a class="code" href="misc_8lib_8php.html#a1920895b3451a684cb0ca7deab91115d" title="Store and retrieve a value from the browser (In order REQUEST, COOKIE, DEFAULT)">configRequestValue</a>(&#39;ossEnginePath&#39;, <a class="code" href="header__scripts_8inc_8php.html#afe68e6fbe7acfbffc0af0c84a1996466">$params</a>-&gt;get(&#39;urlSearchEngine&#39;), &#39;engineURL&#39;);
<a name="l00020"></a><a class="code" href="mod__oss__results_8php.html#ad6c44787f8bf9dc1cf73ec5d383b0efe">00020</a> <a class="code" href="mod__oss__results_8php.html#ad6c44787f8bf9dc1cf73ec5d383b0efe">$ossEngineConnectTimeOut</a> = <a class="code" href="misc_8lib_8php.html#a1920895b3451a684cb0ca7deab91115d" title="Store and retrieve a value from the browser (In order REQUEST, COOKIE, DEFAULT)">configRequestValue</a>(&#39;ossEngineConnectTimeOut&#39;, <a class="code" href="header__scripts_8inc_8php.html#afe68e6fbe7acfbffc0af0c84a1996466">$params</a>-&gt;get(&#39;ossEngineConnectTimeOut&#39;,5), &#39;engineConnectTimeOut&#39;);
<a name="l00021"></a><a class="code" href="mod__oss__results_8php.html#aad1d5344baaa278724f0b671f7ad9195">00021</a> <a class="code" href="mod__oss__results_8php.html#aad1d5344baaa278724f0b671f7ad9195">$ossEngineIndex</a> = <a class="code" href="misc_8lib_8php.html#a1920895b3451a684cb0ca7deab91115d" title="Store and retrieve a value from the browser (In order REQUEST, COOKIE, DEFAULT)">configRequestValue</a>(&#39;ossEngineIndex_contrib_filesearch&#39;, <a class="code" href="header__scripts_8inc_8php.html#afe68e6fbe7acfbffc0af0c84a1996466">$params</a>-&gt;get(&#39;ossEngineIndexName&#39;), &#39;engineIndex&#39;);
<a name="l00022"></a>00022 
<a name="l00023"></a><a class="code" href="mod__oss__results_8php.html#af3f1f5595f3c407a0d1ac020a5e591d9">00023</a> <a class="code" href="query_8php.html#a231909d7d70685f4c616735c1a4b3e5d" title="Ensures the database exists (else move to the &quot;parent&quot; script) and displays headers.">if</a> (isset(<a class="code" href="libraries_2common_8inc_8php.html#a1697cbb709132a827a24cf16714b73ab" title="avoid problems in phpmyadmin.css.php in some cases  string $js_frame">$_REQUEST</a>[&#39;query&#39;])) {
<a name="l00024"></a>00024 
<a name="l00025"></a>00025     $search = <span class="keyword">new</span> <a class="code" href="classOSS__Search.html">OSS_Search</a>(<a class="code" href="mod__oss__results_8php.html#a075b0c8cda478a8c0deb55fcb3fbb904">$ossEnginePath</a>, <a class="code" href="mod__oss__results_8php.html#aad1d5344baaa278724f0b671f7ad9195">$ossEngineIndex</a>);
<a name="l00026"></a>00026 
<a name="l00027"></a>00027     <span class="keywordflow">if</span> (!empty(<a class="code" href="libraries_2common_8inc_8php.html#a1697cbb709132a827a24cf16714b73ab" title="avoid problems in phpmyadmin.css.php in some cases  string $js_frame">$_REQUEST</a>[<span class="stringliteral">&#39;lang&#39;</span>])) {
<a name="l00028"></a>00028         $search-&gt;lang(<a class="code" href="libraries_2common_8inc_8php.html#a1697cbb709132a827a24cf16714b73ab" title="avoid problems in phpmyadmin.css.php in some cases  string $js_frame">$_REQUEST</a>[<span class="stringliteral">&#39;lang&#39;</span>])
<a name="l00029"></a>00029         -&gt;filter(<span class="stringliteral">&#39;lang:&#39;</span>.<a class="code" href="libraries_2common_8inc_8php.html#a1697cbb709132a827a24cf16714b73ab" title="avoid problems in phpmyadmin.css.php in some cases  string $js_frame">$_REQUEST</a>[<span class="stringliteral">&#39;lang&#39;</span>]);
<a name="l00030"></a>00030     }
<a name="l00031"></a>00031 
<a name="l00032"></a>00032     <span class="comment">// Restrict row count between 5 and 50</span>
<a name="l00033"></a>00033     <a class="code" href="query_8php.html#ace2ec39e7df3899fa8df9640ec274b03">$rows</a>  = isset(<a class="code" href="libraries_2common_8inc_8php.html#a1697cbb709132a827a24cf16714b73ab" title="avoid problems in phpmyadmin.css.php in some cases  string $js_frame">$_REQUEST</a>[<span class="stringliteral">&#39;rows&#39;</span>]) ? max(1, min(<a class="code" href="libraries_2common_8inc_8php.html#a1697cbb709132a827a24cf16714b73ab" title="avoid problems in phpmyadmin.css.php in some cases  string $js_frame">$_REQUEST</a>[<span class="stringliteral">&#39;rows&#39;</span>], 50)) : 10;
<a name="l00034"></a>00034     <a class="code" href="query_8php.html#a50a00e7de77365e00b117e73aa82fb9b">$start</a> = isset(<a class="code" href="libraries_2common_8inc_8php.html#a1697cbb709132a827a24cf16714b73ab" title="avoid problems in phpmyadmin.css.php in some cases  string $js_frame">$_REQUEST</a>[<span class="charliteral">&#39;p&#39;</span>])    ? max(0, <a class="code" href="libraries_2common_8inc_8php.html#a1697cbb709132a827a24cf16714b73ab" title="avoid problems in phpmyadmin.css.php in some cases  string $js_frame">$_REQUEST</a>[<span class="charliteral">&#39;p&#39;</span>]) * <a class="code" href="query_8php.html#ace2ec39e7df3899fa8df9640ec274b03">$rows</a> : 0;
<a name="l00035"></a>00035 
<a name="l00036"></a>00036     <span class="comment">//echo $start;</span>
<a name="l00037"></a>00037     
<a name="l00038"></a>00038     <a class="code" href="db__create_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a> = $search-&gt;query(<a class="code" href="libraries_2common_8inc_8php.html#a1697cbb709132a827a24cf16714b73ab" title="avoid problems in phpmyadmin.css.php in some cases  string $js_frame">$_REQUEST</a>[<span class="stringliteral">&#39;query&#39;</span>])
<a name="l00039"></a>00039     -&gt;template(<span class="stringliteral">&#39;search&#39;</span>)
<a name="l00040"></a>00040     -&gt;facet(<span class="stringliteral">&#39;lang&#39;</span>, 0)
<a name="l00041"></a>00041     <span class="comment">// -&gt;field(array(&#39;uri&#39;, &#39;crawlDate&#39;, &#39;directory&#39;, &#39;fileSystemDate&#39;, &#39;metaDescription&#39;, &#39;metaKeywords&#39;, &#39;lang&#39;, &#39;title&#39;, &#39;when&#39;))</span>
<a name="l00042"></a>00042     -&gt;start(<a class="code" href="query_8php.html#a50a00e7de77365e00b117e73aa82fb9b">$start</a>)
<a name="l00043"></a>00043     -&gt;rows(<a class="code" href="header__scripts_8inc_8php.html#afe68e6fbe7acfbffc0af0c84a1996466">$params</a>-&gt;get(<span class="stringliteral">&#39;maxResultPerPage&#39;</span>,10))
<a name="l00044"></a>00044     -&gt;execute(<a class="code" href="mod__oss__results_8php.html#ad6c44787f8bf9dc1cf73ec5d383b0efe">$ossEngineConnectTimeOut</a>);
<a name="l00045"></a>00045 
<a name="l00046"></a>00046     
<a name="l00047"></a>00047     <span class="keywordflow">if</span> (<a class="code" href="db__create_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a> instanceof SimpleXMLElement) {
<a name="l00048"></a>00048 
<a name="l00049"></a>00049         $resultFound   = (int)<a class="code" href="db__create_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>-&gt;result[<span class="stringliteral">&#39;numFound&#39;</span>];
<a name="l00050"></a>00050         <a class="code" href="OSS__paging_8php.html#a5e0541fcefd0ced19b52699f0bdadd57">$resultTime</a>    = (<span class="keywordtype">float</span>)<a class="code" href="db__create_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>-&gt;result[<span class="stringliteral">&#39;time&#39;</span>] / 1000;
<a name="l00051"></a>00051         $resultRows    = (int)<a class="code" href="db__create_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>-&gt;result[<span class="stringliteral">&#39;rows&#39;</span>];
<a name="l00052"></a>00052         $resultStart   = (<span class="keywordtype">int</span>)<a class="code" href="db__create_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>-&gt;result[<span class="stringliteral">&#39;start&#39;</span>];
<a name="l00053"></a>00053 
<a name="l00054"></a>00054         $resultEntries = <a class="code" href="db__create_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>-&gt;xpath(<span class="stringliteral">&#39;result/doc&#39;</span>);
<a name="l00055"></a>00055         
<a name="l00056"></a>00056         <span class="comment">// Navigation between pages</span>
<a name="l00057"></a>00057         $resultCurrentPage = floor($resultStart / $resultRows);
<a name="l00058"></a>00058         <a class="code" href="OSS__paging_8php.html#a05f683a933dda0e2ab1c1a7aba546c9f">$resultTotalPages</a>  = ceil($resultFound / $resultRows);
<a name="l00059"></a>00059         
<a name="l00060"></a>00060         <span class="comment">//echo $resultRows;</span>
<a name="l00061"></a>00061         
<a name="l00062"></a>00062         <span class="keywordflow">if</span> (<a class="code" href="OSS__paging_8php.html#a05f683a933dda0e2ab1c1a7aba546c9f">$resultTotalPages</a> &gt; 1) {
<a name="l00063"></a>00063             $low  = $resultCurrentPage - (MAX_PAGE_TO_LINK / 2);
<a name="l00064"></a>00064             $high = $resultCurrentPage + (MAX_PAGE_TO_LINK / 2 - 1);
<a name="l00065"></a>00065             <span class="keywordflow">if</span> ($low &lt; 0) {
<a name="l00066"></a>00066                 $high += $low * -1;
<a name="l00067"></a>00067             }
<a name="l00068"></a>00068             <span class="keywordflow">if</span> ($high &gt; <a class="code" href="OSS__paging_8php.html#a05f683a933dda0e2ab1c1a7aba546c9f">$resultTotalPages</a>) {
<a name="l00069"></a>00069                 $low -= $high - <a class="code" href="OSS__paging_8php.html#a05f683a933dda0e2ab1c1a7aba546c9f">$resultTotalPages</a>;
<a name="l00070"></a>00070             }
<a name="l00071"></a>00071             $resultLowPage  = max($low, 0);
<a name="l00072"></a>00072             $resultHighPage = min(<a class="code" href="OSS__paging_8php.html#a05f683a933dda0e2ab1c1a7aba546c9f">$resultTotalPages</a>, $high);
<a name="l00073"></a>00073             <a class="code" href="OSS__paging_8php.html#a80695408fe5a739084d66e6d63c76dfc">$resultLowPrev</a>  = max($resultCurrentPage - MAX_PAGE_TO_LINK, 0);
<a name="l00074"></a>00074             <a class="code" href="OSS__paging_8php.html#a3b53b0056bef19241fc98a47dd8cb361">$resultHighNext</a> = min($resultCurrentPage + MAX_PAGE_TO_LINK, <a class="code" href="OSS__paging_8php.html#a05f683a933dda0e2ab1c1a7aba546c9f">$resultTotalPages</a>);
<a name="l00075"></a>00075             $pageBaseURI = preg_replace(<span class="stringliteral">&#39;/&amp;(?:p|rows)=[\d]+/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $_SERVER[<span class="stringliteral">&#39;REQUEST_URI&#39;</span>]).<span class="stringliteral">&#39;&amp;rows=&#39;</span>.$resultRows.<span class="stringliteral">&#39;&amp;p=&#39;</span>;
<a name="l00076"></a>00076         }
<a name="l00077"></a>00077 
<a name="l00078"></a>00078         <span class="comment">/*$langFacets = $result-&gt;xpath(&#39;faceting/field[@name=&quot;lang&quot;]/facet&#39;);</span>
<a name="l00079"></a>00079 <span class="comment">        if ($langFacets === false) $langFacets = array();*/</span>
<a name="l00080"></a>00080     }
<a name="l00081"></a>00081 }
<a name="l00082"></a>00082 require(JModuleHelper::getLayoutPath(<span class="stringliteral">&#39;mod_oss_results&#39;</span>));
</pre></div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="mod__oss__results_8php.html">mod_oss_results.php</a>      </li>

    <li class="footer">Generated on Sat Apr 27 2013 13:18:30 for RFSCMSAPIDocumentation by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
