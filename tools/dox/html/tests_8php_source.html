<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>RFSCMSAPIDocumentation: tests.php Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">RFSCMSAPIDocumentation
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('tests_8php.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">tests.php</div>  </div>
</div><!--header-->
<div class="contents">
<a href="tests_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php<span class="comment"></span>
<a name="l00002"></a>00002 <span class="comment">/**</span>
<a name="l00003"></a>00003 <span class="comment"> * Copyright 2011 Facebook, Inc.</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may</span>
<a name="l00006"></a>00006 <span class="comment"> * not use this file except in compliance with the License. You may obtain</span>
<a name="l00007"></a>00007 <span class="comment"> * a copy of the License at</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> *     http://www.apache.org/licenses/LICENSE-2.0</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> * Unless required by applicable law or agreed to in writing, software</span>
<a name="l00012"></a>00012 <span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT</span>
<a name="l00013"></a>00013 <span class="comment"> * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the</span>
<a name="l00014"></a>00014 <span class="comment"> * License for the specific language governing permissions and limitations</span>
<a name="l00015"></a>00015 <span class="comment"> * under the License.</span>
<a name="l00016"></a>00016 <span class="comment"> */</span>
<a name="l00017"></a>00017 
<a name="l00018"></a><a class="code" href="classPHPSDKTestCase.html">00018</a> <span class="keyword">class </span><a class="code" href="classPHPSDKTestCase.html" title="Copyright 2011 Facebook, Inc.">PHPSDKTestCase</a> <span class="keyword">extends</span> PHPUnit_Framework_TestCase {
<a name="l00019"></a><a class="code" href="classPHPSDKTestCase.html#a42953a934e7fe71b3071c2776d9df949">00019</a>   <span class="keyword">const</span> <a class="code" href="classPHPSDKTestCase.html#a42953a934e7fe71b3071c2776d9df949">APP_ID</a> = <span class="stringliteral">&#39;117743971608120&#39;</span>;
<a name="l00020"></a><a class="code" href="classPHPSDKTestCase.html#a2e31ccc7c2b15ed269966d301045f040">00020</a>   <span class="keyword">const</span> <a class="code" href="classPHPSDKTestCase.html#a2e31ccc7c2b15ed269966d301045f040">SECRET</a> = <span class="stringliteral">&#39;9c8ea2071859659bea1246d33a9207cf&#39;</span>;
<a name="l00021"></a>00021 
<a name="l00022"></a><a class="code" href="classPHPSDKTestCase.html#aeec98b2a076ae4d7022eb3c4eb955992">00022</a>   <span class="keyword">const</span> <a class="code" href="classPHPSDKTestCase.html#aeec98b2a076ae4d7022eb3c4eb955992">MIGRATED_APP_ID</a> = <span class="stringliteral">&#39;174236045938435&#39;</span>;
<a name="l00023"></a><a class="code" href="classPHPSDKTestCase.html#ae8b651bf891ad8f60089036e736fe273">00023</a>   <span class="keyword">const</span> <a class="code" href="classPHPSDKTestCase.html#ae8b651bf891ad8f60089036e736fe273">MIGRATED_SECRET</a> = <span class="stringliteral">&#39;0073dce2d95c4a5c2922d1827ea0cca6&#39;</span>;
<a name="l00024"></a>00024 
<a name="l00025"></a><a class="code" href="classPHPSDKTestCase.html#a2c481b98610ac29143ea71b21fdd9be2">00025</a>   <span class="keyword">const</span> <a class="code" href="classPHPSDKTestCase.html#a2c481b98610ac29143ea71b21fdd9be2">TEST_USER</a> = 499834690;
<a name="l00026"></a>00026 
<a name="l00027"></a><a class="code" href="classPHPSDKTestCase.html#a9c3873b359d518cb42c758363fb22e08">00027</a>   <span class="keyword">private</span> <span class="keyword">static</span> <a class="code" href="classPHPSDKTestCase.html#a9c3873b359d518cb42c758363fb22e08">$kExpiredAccessToken</a> = <span class="stringliteral">&#39;AAABrFmeaJjgBAIshbq5ZBqZBICsmveZCZBi6O4w9HSTkFI73VMtmkL9jLuWsZBZC9QMHvJFtSulZAqonZBRIByzGooCZC8DWr0t1M4BL9FARdQwPWPnIqCiFQ&#39;</span>;
<a name="l00028"></a>00028 
<a name="l00029"></a><a class="code" href="classPHPSDKTestCase.html#a6bd8d63d2a2cb372b67d5f218c685e14">00029</a>   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a6bd8d63d2a2cb372b67d5f218c685e14">kValidSignedRequest</a>() {
<a name="l00030"></a>00030     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classFBPublic.html">FBPublic</a>(array(
<a name="l00031"></a>00031       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00032"></a>00032       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00033"></a>00033     ));
<a name="l00034"></a>00034     <span class="keywordflow">return</span> <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;publicMakeSignedRequest(
<a name="l00035"></a>00035       array(
<a name="l00036"></a>00036         <span class="stringliteral">&#39;user_id&#39;</span> =&gt; self::TEST_USER,
<a name="l00037"></a>00037       )
<a name="l00038"></a>00038     );
<a name="l00039"></a>00039   }
<a name="l00040"></a>00040 
<a name="l00041"></a><a class="code" href="classPHPSDKTestCase.html#a71570cb8812d9e8da84039bd999645a1">00041</a>   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a71570cb8812d9e8da84039bd999645a1">kNonTosedSignedRequest</a>() {
<a name="l00042"></a>00042     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classFBPublic.html">FBPublic</a>(array(
<a name="l00043"></a>00043       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00044"></a>00044       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00045"></a>00045     ));
<a name="l00046"></a>00046     <span class="keywordflow">return</span> <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;publicMakeSignedRequest(array());
<a name="l00047"></a>00047   }
<a name="l00048"></a>00048 
<a name="l00049"></a><a class="code" href="classPHPSDKTestCase.html#adc10e4a44393b8436d8c4f44b91d13a1">00049</a>   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#adc10e4a44393b8436d8c4f44b91d13a1">kSignedRequestWithBogusSignature</a>() {
<a name="l00050"></a>00050     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classFBPublic.html">FBPublic</a>(array(
<a name="l00051"></a>00051       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00052"></a>00052       <span class="stringliteral">&#39;secret&#39;</span> =&gt; <span class="stringliteral">&#39;bogus&#39;</span>,
<a name="l00053"></a>00053     ));
<a name="l00054"></a>00054     <span class="keywordflow">return</span> <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;publicMakeSignedRequest(
<a name="l00055"></a>00055       array(
<a name="l00056"></a>00056         <span class="stringliteral">&#39;algorithm&#39;</span> =&gt; <span class="stringliteral">&#39;HMAC-SHA256&#39;</span>,
<a name="l00057"></a>00057       )
<a name="l00058"></a>00058     );
<a name="l00059"></a>00059   }
<a name="l00060"></a>00060 
<a name="l00061"></a><a class="code" href="classPHPSDKTestCase.html#ae68c82f4fe717de903edd384e8de3a5e">00061</a>   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#ae68c82f4fe717de903edd384e8de3a5e">kSignedRequestWithWrongAlgo</a>() {
<a name="l00062"></a>00062     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classFBPublic.html">FBPublic</a>(array(
<a name="l00063"></a>00063       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00064"></a>00064       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00065"></a>00065     ));
<a name="l00066"></a>00066     <a class="code" href="adm_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>[<span class="stringliteral">&#39;algorithm&#39;</span>] = <span class="stringliteral">&#39;foo&#39;</span>;
<a name="l00067"></a>00067     $json = json_encode(<a class="code" href="adm_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>);
<a name="l00068"></a>00068     $b64 = <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;publicBase64UrlEncode($json);
<a name="l00069"></a>00069     $raw_sig = hash_hmac(<span class="stringliteral">&#39;sha256&#39;</span>, $b64, self::SECRET, $raw = <span class="keyword">true</span>);
<a name="l00070"></a>00070     $sig = <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;publicBase64UrlEncode($raw_sig);
<a name="l00071"></a>00071     <span class="keywordflow">return</span> $sig.<span class="charliteral">&#39;.&#39;</span>.$b64;
<a name="l00072"></a>00072   }
<a name="l00073"></a>00073 
<a name="l00074"></a><a class="code" href="classPHPSDKTestCase.html#a656cc5d706129eccae52e6a15d061a7f">00074</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a656cc5d706129eccae52e6a15d061a7f">testConstructor</a>() {
<a name="l00075"></a>00075     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a>(array(
<a name="l00076"></a>00076       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00077"></a>00077       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00078"></a>00078     ));
<a name="l00079"></a>00079     $this-&gt;assertEquals(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getAppId(), <a class="code" href="classPHPSDKTestCase.html#a42953a934e7fe71b3071c2776d9df949">self::APP_ID</a>,
<a name="l00080"></a>00080                         <span class="stringliteral">&#39;Expect the App ID to be set.&#39;</span>);
<a name="l00081"></a>00081     $this-&gt;assertEquals(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getAppSecret(), <a class="code" href="classPHPSDKTestCase.html#a2e31ccc7c2b15ed269966d301045f040">self::SECRET</a>,
<a name="l00082"></a>00082                         <span class="stringliteral">&#39;Expect the API secret to be set.&#39;</span>);
<a name="l00083"></a>00083   }
<a name="l00084"></a>00084 
<a name="l00085"></a><a class="code" href="classPHPSDKTestCase.html#a11f7eae7da8c32df8445bd6d1e06570e">00085</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a11f7eae7da8c32df8445bd6d1e06570e">testConstructorWithFileUpload</a>() {
<a name="l00086"></a>00086     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a>(array(
<a name="l00087"></a>00087       <span class="stringliteral">&#39;appId&#39;</span>      =&gt; self::APP_ID,
<a name="l00088"></a>00088       <span class="stringliteral">&#39;secret&#39;</span>     =&gt; self::SECRET,
<a name="l00089"></a>00089       <span class="stringliteral">&#39;fileUpload&#39;</span> =&gt; <span class="keyword">true</span>,
<a name="l00090"></a>00090     ));
<a name="l00091"></a>00091     $this-&gt;assertEquals(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getAppId(), <a class="code" href="classPHPSDKTestCase.html#a42953a934e7fe71b3071c2776d9df949">self::APP_ID</a>,
<a name="l00092"></a>00092                         <span class="stringliteral">&#39;Expect the App ID to be set.&#39;</span>);
<a name="l00093"></a>00093     $this-&gt;assertEquals(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getAppSecret(), <a class="code" href="classPHPSDKTestCase.html#a2e31ccc7c2b15ed269966d301045f040">self::SECRET</a>,
<a name="l00094"></a>00094                         <span class="stringliteral">&#39;Expect the API secret to be set.&#39;</span>);
<a name="l00095"></a>00095     $this-&gt;assertTrue(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getFileUploadSupport(),
<a name="l00096"></a>00096                       <span class="stringliteral">&#39;Expect file upload support to be on.&#39;</span>);
<a name="l00097"></a>00097     <span class="comment">// alias (depricated) for getFileUploadSupport -- test until removed</span>
<a name="l00098"></a>00098     $this-&gt;assertTrue(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;useFileUploadSupport(),
<a name="l00099"></a>00099                       <span class="stringliteral">&#39;Expect file upload support to be on.&#39;</span>);
<a name="l00100"></a>00100   }
<a name="l00101"></a>00101 
<a name="l00102"></a><a class="code" href="classPHPSDKTestCase.html#a9709f564fcf641a4ae69087b847d68f2">00102</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a9709f564fcf641a4ae69087b847d68f2">testSetAppId</a>() {
<a name="l00103"></a>00103     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a>(array(
<a name="l00104"></a>00104       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00105"></a>00105       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00106"></a>00106     ));
<a name="l00107"></a>00107     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;setAppId(<span class="stringliteral">&#39;dummy&#39;</span>);
<a name="l00108"></a>00108     $this-&gt;assertEquals(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getAppId(), <span class="stringliteral">&#39;dummy&#39;</span>,
<a name="l00109"></a>00109                         <span class="stringliteral">&#39;Expect the App ID to be dummy.&#39;</span>);
<a name="l00110"></a>00110   }
<a name="l00111"></a>00111 
<a name="l00112"></a><a class="code" href="classPHPSDKTestCase.html#a20cacffff8b7f76acb128f99dbcd2cad">00112</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a20cacffff8b7f76acb128f99dbcd2cad">testSetAPISecret</a>() {
<a name="l00113"></a>00113     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a>(array(
<a name="l00114"></a>00114       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00115"></a>00115       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00116"></a>00116     ));
<a name="l00117"></a>00117     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;setApiSecret(<span class="stringliteral">&#39;dummy&#39;</span>);
<a name="l00118"></a>00118     $this-&gt;assertEquals(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getApiSecret(), <span class="stringliteral">&#39;dummy&#39;</span>,
<a name="l00119"></a>00119                         <span class="stringliteral">&#39;Expect the API secret to be dummy.&#39;</span>);
<a name="l00120"></a>00120   }
<a name="l00121"></a>00121 
<a name="l00122"></a><a class="code" href="classPHPSDKTestCase.html#a2939f323e15320c350b72ff4a5744844">00122</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a2939f323e15320c350b72ff4a5744844">testSetAPPSecret</a>() {
<a name="l00123"></a>00123     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a>(array(
<a name="l00124"></a>00124       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00125"></a>00125       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00126"></a>00126     ));
<a name="l00127"></a>00127     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;setAppSecret(<span class="stringliteral">&#39;dummy&#39;</span>);
<a name="l00128"></a>00128     $this-&gt;assertEquals(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getAppSecret(), <span class="stringliteral">&#39;dummy&#39;</span>,
<a name="l00129"></a>00129                         <span class="stringliteral">&#39;Expect the API secret to be dummy.&#39;</span>);
<a name="l00130"></a>00130   }
<a name="l00131"></a>00131 
<a name="l00132"></a><a class="code" href="classPHPSDKTestCase.html#a95d3630d9ff190641d30bb9da0494cba">00132</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a95d3630d9ff190641d30bb9da0494cba">testSetAccessToken</a>() {
<a name="l00133"></a>00133     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a>(array(
<a name="l00134"></a>00134       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00135"></a>00135       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00136"></a>00136     ));
<a name="l00137"></a>00137 
<a name="l00138"></a>00138     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;setAccessToken(<span class="stringliteral">&#39;saltydog&#39;</span>);
<a name="l00139"></a>00139     $this-&gt;assertEquals(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getAccessToken(), <span class="stringliteral">&#39;saltydog&#39;</span>,
<a name="l00140"></a>00140                         <span class="stringliteral">&#39;Expect installed access token to remain \&#39;saltydog\&#39;&#39;</span>);
<a name="l00141"></a>00141   }
<a name="l00142"></a>00142 
<a name="l00143"></a><a class="code" href="classPHPSDKTestCase.html#a4076ec699d7241bf3701129051db2a9e">00143</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a4076ec699d7241bf3701129051db2a9e">testSetFileUploadSupport</a>() {
<a name="l00144"></a>00144     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a>(array(
<a name="l00145"></a>00145       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00146"></a>00146       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00147"></a>00147     ));
<a name="l00148"></a>00148     $this-&gt;assertFalse(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getFileUploadSupport(),
<a name="l00149"></a>00149                        <span class="stringliteral">&#39;Expect file upload support to be off.&#39;</span>);
<a name="l00150"></a>00150     <span class="comment">// alias for getFileUploadSupport (depricated), testing until removed</span>
<a name="l00151"></a>00151     $this-&gt;assertFalse(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;useFileUploadSupport(),
<a name="l00152"></a>00152                        <span class="stringliteral">&#39;Expect file upload support to be off.&#39;</span>);
<a name="l00153"></a>00153     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;setFileUploadSupport(<span class="keyword">true</span>);
<a name="l00154"></a>00154     $this-&gt;assertTrue(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getFileUploadSupport(),
<a name="l00155"></a>00155                       <span class="stringliteral">&#39;Expect file upload support to be on.&#39;</span>);
<a name="l00156"></a>00156     <span class="comment">// alias for getFileUploadSupport (depricated), testing until removed</span>
<a name="l00157"></a>00157     $this-&gt;assertTrue(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;useFileUploadSupport(),
<a name="l00158"></a>00158                       <span class="stringliteral">&#39;Expect file upload support to be on.&#39;</span>);
<a name="l00159"></a>00159   }
<a name="l00160"></a>00160 
<a name="l00161"></a><a class="code" href="classPHPSDKTestCase.html#a87063207f5be4f168e06042bdbaa5755">00161</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a87063207f5be4f168e06042bdbaa5755">testGetCurrentURL</a>() {
<a name="l00162"></a>00162     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classFBGetCurrentURLFacebook.html">FBGetCurrentURLFacebook</a>(array(
<a name="l00163"></a>00163       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00164"></a>00164       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00165"></a>00165     ));
<a name="l00166"></a>00166 
<a name="l00167"></a>00167     <span class="comment">// fake the HPHP $_SERVER globals</span>
<a name="l00168"></a>00168     $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>] = <span class="stringliteral">&#39;www.test.com&#39;</span>;
<a name="l00169"></a>00169     $_SERVER[<span class="stringliteral">&#39;REQUEST_URI&#39;</span>] = <span class="stringliteral">&#39;/unit-tests.php?one=one&amp;two=two&amp;three=three&#39;</span>;
<a name="l00170"></a>00170     $current_url = <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;publicGetCurrentUrl();
<a name="l00171"></a>00171     $this-&gt;assertEquals(
<a name="l00172"></a>00172       <span class="stringliteral">&#39;http://www.test.com/unit-tests.php?one=one&amp;two=two&amp;three=three&#39;</span>,
<a name="l00173"></a>00173       $current_url,
<a name="l00174"></a>00174       <span class="stringliteral">&#39;getCurrentUrl function is changing the current URL&#39;</span>);
<a name="l00175"></a>00175 
<a name="l00176"></a>00176     <span class="comment">// ensure structure of valueless GET params is retained (sometimes</span>
<a name="l00177"></a>00177     <span class="comment">// an = sign was present, and sometimes it was not)</span>
<a name="l00178"></a>00178     <span class="comment">// first test when equal signs are present</span>
<a name="l00179"></a>00179     $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>] = <span class="stringliteral">&#39;www.test.com&#39;</span>;
<a name="l00180"></a>00180     $_SERVER[<span class="stringliteral">&#39;REQUEST_URI&#39;</span>] = <span class="stringliteral">&#39;/unit-tests.php?one=&amp;two=&amp;three=&#39;</span>;
<a name="l00181"></a>00181     $current_url = <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;publicGetCurrentUrl();
<a name="l00182"></a>00182     $this-&gt;assertEquals(
<a name="l00183"></a>00183       <span class="stringliteral">&#39;http://www.test.com/unit-tests.php?one=&amp;two=&amp;three=&#39;</span>,
<a name="l00184"></a>00184       $current_url,
<a name="l00185"></a>00185       <span class="stringliteral">&#39;getCurrentUrl function is changing the current URL&#39;</span>);
<a name="l00186"></a>00186 
<a name="l00187"></a>00187     <span class="comment">// now confirm that</span>
<a name="l00188"></a>00188     $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>] = <span class="stringliteral">&#39;www.test.com&#39;</span>;
<a name="l00189"></a>00189     $_SERVER[<span class="stringliteral">&#39;REQUEST_URI&#39;</span>] = <span class="stringliteral">&#39;/unit-tests.php?one&amp;two&amp;three&#39;</span>;
<a name="l00190"></a>00190     $current_url = <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;publicGetCurrentUrl();
<a name="l00191"></a>00191     $this-&gt;assertEquals(
<a name="l00192"></a>00192       <span class="stringliteral">&#39;http://www.test.com/unit-tests.php?one&amp;two&amp;three&#39;</span>,
<a name="l00193"></a>00193       $current_url,
<a name="l00194"></a>00194       <span class="stringliteral">&#39;getCurrentUrl function is changing the current URL&#39;</span>);
<a name="l00195"></a>00195   }
<a name="l00196"></a>00196 
<a name="l00197"></a><a class="code" href="classPHPSDKTestCase.html#a2b60e4270ac185134fc0337c4b0cccfa">00197</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a2b60e4270ac185134fc0337c4b0cccfa">testGetLoginURL</a>() {
<a name="l00198"></a>00198     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classFacebook.html" title="Copyright 2011 Facebook, Inc.">Facebook</a>(array(
<a name="l00199"></a>00199       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00200"></a>00200       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00201"></a>00201     ));
<a name="l00202"></a>00202 
<a name="l00203"></a>00203     <span class="comment">// fake the HPHP $_SERVER globals</span>
<a name="l00204"></a>00204     $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>] = <span class="stringliteral">&#39;www.test.com&#39;</span>;
<a name="l00205"></a>00205     $_SERVER[<span class="stringliteral">&#39;REQUEST_URI&#39;</span>] = <span class="stringliteral">&#39;/unit-tests.php&#39;</span>;
<a name="l00206"></a>00206     $login_url = parse_url(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getLoginUrl());
<a name="l00207"></a>00207     $this-&gt;assertEquals($login_url[<span class="stringliteral">&#39;scheme&#39;</span>], <span class="stringliteral">&#39;https&#39;</span>);
<a name="l00208"></a>00208     $this-&gt;assertEquals($login_url[<span class="stringliteral">&#39;host&#39;</span>], <span class="stringliteral">&#39;www.facebook.com&#39;</span>);
<a name="l00209"></a>00209     $this-&gt;assertEquals($login_url[<span class="stringliteral">&#39;path&#39;</span>], <span class="stringliteral">&#39;/dialog/oauth&#39;</span>);
<a name="l00210"></a>00210     $expected_login_params =
<a name="l00211"></a>00211       array(<span class="stringliteral">&#39;client_id&#39;</span> =&gt; self::APP_ID,
<a name="l00212"></a>00212             <span class="stringliteral">&#39;redirect_uri&#39;</span> =&gt; <span class="stringliteral">&#39;http://www.test.com/unit-tests.php&#39;</span>);
<a name="l00213"></a>00213 
<a name="l00214"></a>00214     $query_map = array();
<a name="l00215"></a>00215     parse_str($login_url[<span class="stringliteral">&#39;query&#39;</span>], $query_map);
<a name="l00216"></a>00216     $this-&gt;<a class="code" href="classPHPSDKTestCase.html#aa2fa68d8c85c185cae89c19403408f15" title="Checks that the correct args are a subset of the returned obj.">assertIsSubset</a>($expected_login_params, $query_map);
<a name="l00217"></a>00217     <span class="comment">// we don&#39;t know what the state is, but we know it&#39;s an md5 and should</span>
<a name="l00218"></a>00218     <span class="comment">// be 32 characters long.</span>
<a name="l00219"></a>00219     $this-&gt;assertEquals(strlen($query_map[<span class="stringliteral">&#39;state&#39;</span>]), $num_characters = 32);
<a name="l00220"></a>00220   }
<a name="l00221"></a>00221 
<a name="l00222"></a><a class="code" href="classPHPSDKTestCase.html#ada36c8fc911c8caabe298794be7484d4">00222</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#ada36c8fc911c8caabe298794be7484d4">testGetLoginURLWithExtraParams</a>() {
<a name="l00223"></a>00223     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classFacebook.html" title="Copyright 2011 Facebook, Inc.">Facebook</a>(array(
<a name="l00224"></a>00224       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00225"></a>00225       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00226"></a>00226     ));
<a name="l00227"></a>00227 
<a name="l00228"></a>00228     <span class="comment">// fake the HPHP $_SERVER globals</span>
<a name="l00229"></a>00229     $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>] = <span class="stringliteral">&#39;www.test.com&#39;</span>;
<a name="l00230"></a>00230     $_SERVER[<span class="stringliteral">&#39;REQUEST_URI&#39;</span>] = <span class="stringliteral">&#39;/unit-tests.php&#39;</span>;
<a name="l00231"></a>00231     $extra_params = array(<span class="stringliteral">&#39;scope&#39;</span> =&gt; <span class="stringliteral">&#39;email, sms&#39;</span>,
<a name="l00232"></a>00232                           <span class="stringliteral">&#39;nonsense&#39;</span> =&gt; <span class="stringliteral">&#39;nonsense&#39;</span>);
<a name="l00233"></a>00233     $login_url = parse_url(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getLoginUrl($extra_params));
<a name="l00234"></a>00234     $this-&gt;assertEquals($login_url[<span class="stringliteral">&#39;scheme&#39;</span>], <span class="stringliteral">&#39;https&#39;</span>);
<a name="l00235"></a>00235     $this-&gt;assertEquals($login_url[<span class="stringliteral">&#39;host&#39;</span>], <span class="stringliteral">&#39;www.facebook.com&#39;</span>);
<a name="l00236"></a>00236     $this-&gt;assertEquals($login_url[<span class="stringliteral">&#39;path&#39;</span>], <span class="stringliteral">&#39;/dialog/oauth&#39;</span>);
<a name="l00237"></a>00237     $expected_login_params =
<a name="l00238"></a>00238       array_merge(
<a name="l00239"></a>00239         array(<span class="stringliteral">&#39;client_id&#39;</span> =&gt; self::APP_ID,
<a name="l00240"></a>00240               <span class="stringliteral">&#39;redirect_uri&#39;</span> =&gt; <span class="stringliteral">&#39;http://www.test.com/unit-tests.php&#39;</span>),
<a name="l00241"></a>00241         $extra_params);
<a name="l00242"></a>00242     $query_map = array();
<a name="l00243"></a>00243     parse_str($login_url[<span class="stringliteral">&#39;query&#39;</span>], $query_map);
<a name="l00244"></a>00244     $this-&gt;<a class="code" href="classPHPSDKTestCase.html#aa2fa68d8c85c185cae89c19403408f15" title="Checks that the correct args are a subset of the returned obj.">assertIsSubset</a>($expected_login_params, $query_map);
<a name="l00245"></a>00245     <span class="comment">// we don&#39;t know what the state is, but we know it&#39;s an md5 and should</span>
<a name="l00246"></a>00246     <span class="comment">// be 32 characters long.</span>
<a name="l00247"></a>00247     $this-&gt;assertEquals(strlen($query_map[<span class="stringliteral">&#39;state&#39;</span>]), $num_characters = 32);
<a name="l00248"></a>00248   }
<a name="l00249"></a>00249 
<a name="l00250"></a><a class="code" href="classPHPSDKTestCase.html#a42a55c152e102c4be974c1853adc81a2">00250</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a42a55c152e102c4be974c1853adc81a2">testGetLoginURLWithScopeParamsAsArray</a>() {
<a name="l00251"></a>00251     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classFacebook.html" title="Copyright 2011 Facebook, Inc.">Facebook</a>(array(
<a name="l00252"></a>00252       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00253"></a>00253       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00254"></a>00254     ));
<a name="l00255"></a>00255 
<a name="l00256"></a>00256     <span class="comment">// fake the HPHP $_SERVER globals</span>
<a name="l00257"></a>00257     $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>] = <span class="stringliteral">&#39;www.test.com&#39;</span>;
<a name="l00258"></a>00258     $_SERVER[<span class="stringliteral">&#39;REQUEST_URI&#39;</span>] = <span class="stringliteral">&#39;/unit-tests.php&#39;</span>;
<a name="l00259"></a>00259     $scope_params_as_array = array(<span class="stringliteral">&#39;email&#39;</span>,<span class="stringliteral">&#39;sms&#39;</span>,<span class="stringliteral">&#39;read_stream&#39;</span>);
<a name="l00260"></a>00260     $extra_params = array(<span class="stringliteral">&#39;scope&#39;</span> =&gt; $scope_params_as_array,
<a name="l00261"></a>00261                           <span class="stringliteral">&#39;nonsense&#39;</span> =&gt; <span class="stringliteral">&#39;nonsense&#39;</span>);
<a name="l00262"></a>00262     $login_url = parse_url(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getLoginUrl($extra_params));
<a name="l00263"></a>00263     $this-&gt;assertEquals($login_url[<span class="stringliteral">&#39;scheme&#39;</span>], <span class="stringliteral">&#39;https&#39;</span>);
<a name="l00264"></a>00264     $this-&gt;assertEquals($login_url[<span class="stringliteral">&#39;host&#39;</span>], <span class="stringliteral">&#39;www.facebook.com&#39;</span>);
<a name="l00265"></a>00265     $this-&gt;assertEquals($login_url[<span class="stringliteral">&#39;path&#39;</span>], <span class="stringliteral">&#39;/dialog/oauth&#39;</span>);
<a name="l00266"></a>00266     <span class="comment">// expect api to flatten array params to comma separated list</span>
<a name="l00267"></a>00267     <span class="comment">// should do the same here before asserting to make sure API is behaving</span>
<a name="l00268"></a>00268     <span class="comment">// correctly;</span>
<a name="l00269"></a>00269     $extra_params[<span class="stringliteral">&#39;scope&#39;</span>] = implode(<span class="charliteral">&#39;,&#39;</span>, $scope_params_as_array);
<a name="l00270"></a>00270     $expected_login_params =
<a name="l00271"></a>00271       array_merge(
<a name="l00272"></a>00272         array(<span class="stringliteral">&#39;client_id&#39;</span> =&gt; self::APP_ID,
<a name="l00273"></a>00273               <span class="stringliteral">&#39;redirect_uri&#39;</span> =&gt; <span class="stringliteral">&#39;http://www.test.com/unit-tests.php&#39;</span>),
<a name="l00274"></a>00274         $extra_params);
<a name="l00275"></a>00275     $query_map = array();
<a name="l00276"></a>00276     parse_str($login_url[<span class="stringliteral">&#39;query&#39;</span>], $query_map);
<a name="l00277"></a>00277     $this-&gt;<a class="code" href="classPHPSDKTestCase.html#aa2fa68d8c85c185cae89c19403408f15" title="Checks that the correct args are a subset of the returned obj.">assertIsSubset</a>($expected_login_params, $query_map);
<a name="l00278"></a>00278     <span class="comment">// we don&#39;t know what the state is, but we know it&#39;s an md5 and should</span>
<a name="l00279"></a>00279     <span class="comment">// be 32 characters long.</span>
<a name="l00280"></a>00280     $this-&gt;assertEquals(strlen($query_map[<span class="stringliteral">&#39;state&#39;</span>]), $num_characters = 32);
<a name="l00281"></a>00281   }
<a name="l00282"></a>00282 
<a name="l00283"></a><a class="code" href="classPHPSDKTestCase.html#a5cdc60226d93c60f5b0cfcf104292c1e">00283</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a5cdc60226d93c60f5b0cfcf104292c1e">testGetCodeWithValidCSRFState</a>() {
<a name="l00284"></a>00284     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classFBCode.html">FBCode</a>(array(
<a name="l00285"></a>00285       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00286"></a>00286       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00287"></a>00287     ));
<a name="l00288"></a>00288 
<a name="l00289"></a>00289     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;setCSRFStateToken();
<a name="l00290"></a>00290     $code = $_REQUEST[<span class="stringliteral">&#39;code&#39;</span>] = $this-&gt;<a class="code" href="classPHPSDKTestCase.html#aa20695a503ea8ec7379627444fb58178">generateMD5HashOfRandomValue</a>();
<a name="l00291"></a>00291     $_REQUEST[<span class="stringliteral">&#39;state&#39;</span>] = <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getCSRFStateToken();
<a name="l00292"></a>00292     $this-&gt;assertEquals($code,
<a name="l00293"></a>00293                         <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;publicGetCode(),
<a name="l00294"></a>00294                         <span class="stringliteral">&#39;Expect code to be pulled from $_REQUEST[\&#39;code\&#39;]&#39;</span>);
<a name="l00295"></a>00295   }
<a name="l00296"></a>00296 
<a name="l00297"></a><a class="code" href="classPHPSDKTestCase.html#a174fb38891b8753f2b7d7684344d7acc">00297</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a174fb38891b8753f2b7d7684344d7acc">testGetCodeWithInvalidCSRFState</a>() {
<a name="l00298"></a>00298     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classFBCode.html">FBCode</a>(array(
<a name="l00299"></a>00299       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00300"></a>00300       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00301"></a>00301     ));
<a name="l00302"></a>00302 
<a name="l00303"></a>00303     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;setCSRFStateToken();
<a name="l00304"></a>00304     $code = $_REQUEST[<span class="stringliteral">&#39;code&#39;</span>] = $this-&gt;<a class="code" href="classPHPSDKTestCase.html#aa20695a503ea8ec7379627444fb58178">generateMD5HashOfRandomValue</a>();
<a name="l00305"></a>00305     $_REQUEST[<span class="stringliteral">&#39;state&#39;</span>] = <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getCSRFStateToken().<span class="stringliteral">&#39;forgery!!!&#39;</span>;
<a name="l00306"></a>00306     $this-&gt;assertFalse(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;publicGetCode(),
<a name="l00307"></a>00307                        <span class="stringliteral">&#39;Expect getCode to fail, CSRF state should not match.&#39;</span>);
<a name="l00308"></a>00308   }
<a name="l00309"></a>00309 
<a name="l00310"></a><a class="code" href="classPHPSDKTestCase.html#a49215584c48fdc35ddb292d5e06db1b1">00310</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a49215584c48fdc35ddb292d5e06db1b1">testGetCodeWithMissingCSRFState</a>() {
<a name="l00311"></a>00311     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classFBCode.html">FBCode</a>(array(
<a name="l00312"></a>00312       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00313"></a>00313       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00314"></a>00314     ));
<a name="l00315"></a>00315 
<a name="l00316"></a>00316     $code = $_REQUEST[<span class="stringliteral">&#39;code&#39;</span>] = $this-&gt;<a class="code" href="classPHPSDKTestCase.html#aa20695a503ea8ec7379627444fb58178">generateMD5HashOfRandomValue</a>();
<a name="l00317"></a>00317     <span class="comment">// intentionally don&#39;t set CSRF token at all</span>
<a name="l00318"></a>00318     $this-&gt;assertFalse(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;publicGetCode(),
<a name="l00319"></a>00319                        <span class="stringliteral">&#39;Expect getCode to fail, CSRF state not sent back.&#39;</span>);
<a name="l00320"></a>00320 
<a name="l00321"></a>00321   }
<a name="l00322"></a>00322 
<a name="l00323"></a><a class="code" href="classPHPSDKTestCase.html#afaf4a010ecdf9076f78700ae95cc92b5">00323</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#afaf4a010ecdf9076f78700ae95cc92b5">testGetUserFromSignedRequest</a>() {
<a name="l00324"></a>00324     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a>(array(
<a name="l00325"></a>00325       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00326"></a>00326       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00327"></a>00327     ));
<a name="l00328"></a>00328 
<a name="l00329"></a>00329     $_REQUEST[<span class="stringliteral">&#39;signed_request&#39;</span>] = <a class="code" href="classPHPSDKTestCase.html#a6bd8d63d2a2cb372b67d5f218c685e14">self::kValidSignedRequest</a>();
<a name="l00330"></a>00330     $this-&gt;assertEquals(<span class="stringliteral">&#39;499834690&#39;</span>, <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getUser(),
<a name="l00331"></a>00331                         <span class="stringliteral">&#39;Failed to get user ID from a valid signed request.&#39;</span>);
<a name="l00332"></a>00332   }
<a name="l00333"></a>00333 
<a name="l00334"></a><a class="code" href="classPHPSDKTestCase.html#ae8252e5db02dca4ed006c9d9626a1a67">00334</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#ae8252e5db02dca4ed006c9d9626a1a67">testGetSignedRequestFromCookie</a>() {
<a name="l00335"></a>00335     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classFBPublicCookie.html">FBPublicCookie</a>(array(
<a name="l00336"></a>00336       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00337"></a>00337       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00338"></a>00338     ));
<a name="l00339"></a>00339 
<a name="l00340"></a>00340     $_COOKIE[<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;publicGetSignedRequestCookieName()] =
<a name="l00341"></a>00341       <a class="code" href="classPHPSDKTestCase.html#a6bd8d63d2a2cb372b67d5f218c685e14">self::kValidSignedRequest</a>();
<a name="l00342"></a>00342     $this-&gt;assertNotNull(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;publicGetSignedRequest());
<a name="l00343"></a>00343     $this-&gt;assertEquals(<span class="stringliteral">&#39;499834690&#39;</span>, <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getUser(),
<a name="l00344"></a>00344                         <span class="stringliteral">&#39;Failed to get user ID from a valid signed request.&#39;</span>);
<a name="l00345"></a>00345   }
<a name="l00346"></a>00346 
<a name="l00347"></a><a class="code" href="classPHPSDKTestCase.html#a1cac72cdb57f0d734e043300d88aa008">00347</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a1cac72cdb57f0d734e043300d88aa008">testGetSignedRequestWithIncorrectSignature</a>() {
<a name="l00348"></a>00348     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classFBPublicCookie.html">FBPublicCookie</a>(array(
<a name="l00349"></a>00349       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00350"></a>00350       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00351"></a>00351     ));
<a name="l00352"></a>00352 
<a name="l00353"></a>00353     $_COOKIE[<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;publicGetSignedRequestCookieName()] =
<a name="l00354"></a>00354       <a class="code" href="classPHPSDKTestCase.html#adc10e4a44393b8436d8c4f44b91d13a1">self::kSignedRequestWithBogusSignature</a>();
<a name="l00355"></a>00355     $this-&gt;assertNull(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;publicGetSignedRequest());
<a name="l00356"></a>00356   }
<a name="l00357"></a>00357 
<a name="l00358"></a><a class="code" href="classPHPSDKTestCase.html#a5dbf51699ea924abb7786a9831eb9931">00358</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a5dbf51699ea924abb7786a9831eb9931">testNonUserAccessToken</a>() {
<a name="l00359"></a>00359     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classFBAccessToken.html">FBAccessToken</a>(array(
<a name="l00360"></a>00360       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00361"></a>00361       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00362"></a>00362     ));
<a name="l00363"></a>00363 
<a name="l00364"></a>00364     <span class="comment">// no cookies, and no request params, so no user or code,</span>
<a name="l00365"></a>00365     <span class="comment">// so no user access token (even with cookie support)</span>
<a name="l00366"></a>00366     $this-&gt;assertEquals(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;publicGetApplicationAccessToken(),
<a name="l00367"></a>00367                         <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getAccessToken(),
<a name="l00368"></a>00368                         <span class="stringliteral">&#39;Access token should be that for logged out users.&#39;</span>);
<a name="l00369"></a>00369   }
<a name="l00370"></a>00370 
<a name="l00371"></a><a class="code" href="classPHPSDKTestCase.html#ab5b8301e4766c1b84f3656b1bb4d3781">00371</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#ab5b8301e4766c1b84f3656b1bb4d3781">testMissingMetadataCookie</a>() {
<a name="l00372"></a>00372     $fb = <span class="keyword">new</span> <a class="code" href="classFBPublicCookie.html">FBPublicCookie</a>(array(
<a name="l00373"></a>00373       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00374"></a>00374       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00375"></a>00375     ));
<a name="l00376"></a>00376     $this-&gt;assertEmpty($fb-&gt;publicGetMetadataCookie());
<a name="l00377"></a>00377   }
<a name="l00378"></a>00378 
<a name="l00379"></a><a class="code" href="classPHPSDKTestCase.html#ab638a3a7b8a630ff81e8119694cd78fe">00379</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#ab638a3a7b8a630ff81e8119694cd78fe">testEmptyMetadataCookie</a>() {
<a name="l00380"></a>00380     $fb = <span class="keyword">new</span> <a class="code" href="classFBPublicCookie.html">FBPublicCookie</a>(array(
<a name="l00381"></a>00381       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00382"></a>00382       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00383"></a>00383     ));
<a name="l00384"></a>00384     $_COOKIE[$fb-&gt;publicGetMetadataCookieName()] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00385"></a>00385     $this-&gt;assertEmpty($fb-&gt;publicGetMetadataCookie());
<a name="l00386"></a>00386   }
<a name="l00387"></a>00387 
<a name="l00388"></a><a class="code" href="classPHPSDKTestCase.html#aff1c5184464e6eafa6ffa811d24539b7">00388</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#aff1c5184464e6eafa6ffa811d24539b7">testMetadataCookie</a>() {
<a name="l00389"></a>00389     $fb = <span class="keyword">new</span> <a class="code" href="classFBPublicCookie.html">FBPublicCookie</a>(array(
<a name="l00390"></a>00390       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00391"></a>00391       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00392"></a>00392     ));
<a name="l00393"></a>00393     $key = <span class="stringliteral">&#39;foo&#39;</span>;
<a name="l00394"></a>00394     $val = <span class="stringliteral">&#39;42&#39;</span>;
<a name="l00395"></a>00395     $_COOKIE[$fb-&gt;publicGetMetadataCookieName()] = <span class="stringliteral">&quot;$key=$val&quot;</span>;
<a name="l00396"></a>00396     $this-&gt;assertEquals(array($key =&gt; $val), $fb-&gt;publicGetMetadataCookie());
<a name="l00397"></a>00397   }
<a name="l00398"></a>00398 
<a name="l00399"></a><a class="code" href="classPHPSDKTestCase.html#a23d3902f5f50998fa0963618f3942445">00399</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a23d3902f5f50998fa0963618f3942445">testQuotedMetadataCookie</a>() {
<a name="l00400"></a>00400     $fb = <span class="keyword">new</span> <a class="code" href="classFBPublicCookie.html">FBPublicCookie</a>(array(
<a name="l00401"></a>00401       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00402"></a>00402       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00403"></a>00403     ));
<a name="l00404"></a>00404     $key = <span class="stringliteral">&#39;foo&#39;</span>;
<a name="l00405"></a>00405     $val = <span class="stringliteral">&#39;42&#39;</span>;
<a name="l00406"></a>00406     $_COOKIE[$fb-&gt;publicGetMetadataCookieName()] = <span class="stringliteral">&quot;\&quot;$key=$val\&quot;&quot;</span>;
<a name="l00407"></a>00407     $this-&gt;assertEquals(array($key =&gt; $val), $fb-&gt;publicGetMetadataCookie());
<a name="l00408"></a>00408   }
<a name="l00409"></a>00409 
<a name="l00410"></a><a class="code" href="classPHPSDKTestCase.html#ae39fae1698553f22d1d3578e3fd65fe4">00410</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#ae39fae1698553f22d1d3578e3fd65fe4">testAPIForLoggedOutUsers</a>() {
<a name="l00411"></a>00411     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a>(array(
<a name="l00412"></a>00412       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00413"></a>00413       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00414"></a>00414     ));
<a name="l00415"></a>00415     $response = <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;api(array(
<a name="l00416"></a>00416       <span class="stringliteral">&#39;method&#39;</span> =&gt; <span class="stringliteral">&#39;fql.query&#39;</span>,
<a name="l00417"></a>00417       <span class="stringliteral">&#39;query&#39;</span> =&gt; <span class="stringliteral">&#39;SELECT name FROM user WHERE uid=4&#39;</span>,
<a name="l00418"></a>00418     ));
<a name="l00419"></a>00419     $this-&gt;assertEquals(count($response), 1,
<a name="l00420"></a>00420                         <span class="stringliteral">&#39;Expect one row back.&#39;</span>);
<a name="l00421"></a>00421     $this-&gt;assertEquals($response[0][<span class="stringliteral">&#39;name&#39;</span>], <span class="stringliteral">&#39;Mark Zuckerberg&#39;</span>,
<a name="l00422"></a>00422                         <span class="stringliteral">&#39;Expect the name back.&#39;</span>);
<a name="l00423"></a>00423   }
<a name="l00424"></a>00424 
<a name="l00425"></a><a class="code" href="classPHPSDKTestCase.html#ad3601d19bf8605484a05fc6a13448a88">00425</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#ad3601d19bf8605484a05fc6a13448a88">testAPIWithBogusAccessToken</a>() {
<a name="l00426"></a>00426     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a>(array(
<a name="l00427"></a>00427       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00428"></a>00428       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00429"></a>00429     ));
<a name="l00430"></a>00430 
<a name="l00431"></a>00431     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;setAccessToken(<span class="stringliteral">&#39;this-is-not-really-an-access-token&#39;</span>);
<a name="l00432"></a>00432     <span class="comment">// if we don&#39;t set an access token and there&#39;s no way to</span>
<a name="l00433"></a>00433     <span class="comment">// get one, then the FQL query below works beautifully, handing</span>
<a name="l00434"></a>00434     <span class="comment">// over Zuck&#39;s public data.  But if you specify a bogus access</span>
<a name="l00435"></a>00435     <span class="comment">// token as I have right here, then the FQL query should fail.</span>
<a name="l00436"></a>00436     <span class="comment">// We could return just Zuck&#39;s public data, but that wouldn&#39;t</span>
<a name="l00437"></a>00437     <span class="comment">// advertise the issue that the access token is at worst broken</span>
<a name="l00438"></a>00438     <span class="comment">// and at best expired.</span>
<a name="l00439"></a>00439     <span class="keywordflow">try</span> {
<a name="l00440"></a>00440       $response = <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;api(array(
<a name="l00441"></a>00441         <span class="stringliteral">&#39;method&#39;</span> =&gt; <span class="stringliteral">&#39;fql.query&#39;</span>,
<a name="l00442"></a>00442         <span class="stringliteral">&#39;query&#39;</span> =&gt; <span class="stringliteral">&#39;SELECT name FROM profile WHERE id=4&#39;</span>,
<a name="l00443"></a>00443       ));
<a name="l00444"></a>00444       $this-&gt;fail(<span class="stringliteral">&#39;Should not get here.&#39;</span>);
<a name="l00445"></a>00445     } <span class="keywordflow">catch</span>(<a class="code" href="classFacebookApiException.html" title="Copyright 2011 Facebook, Inc.">FacebookApiException</a> $e) {
<a name="l00446"></a>00446       <a class="code" href="link__out_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a> = $e-&gt;<a class="code" href="classFacebookApiException.html#ac6376ad18e5695a4ff443d4b6832f5f1" title="Return the associated result object returned by the API server.">getResult</a>();
<a name="l00447"></a>00447       $this-&gt;assertTrue(is_array(<a class="code" href="link__out_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>), <span class="stringliteral">&#39;expect a result object&#39;</span>);
<a name="l00448"></a>00448       $this-&gt;assertEquals(<span class="stringliteral">&#39;190&#39;</span>, <a class="code" href="link__out_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>[<span class="stringliteral">&#39;error_code&#39;</span>], <span class="stringliteral">&#39;expect code&#39;</span>);
<a name="l00449"></a>00449     }
<a name="l00450"></a>00450   }
<a name="l00451"></a>00451 
<a name="l00452"></a><a class="code" href="classPHPSDKTestCase.html#af914365520eea1c8ac00a5c639f4debe">00452</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#af914365520eea1c8ac00a5c639f4debe">testAPIGraphPublicData</a>() {
<a name="l00453"></a>00453     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a>(array(
<a name="l00454"></a>00454       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00455"></a>00455       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00456"></a>00456     ));
<a name="l00457"></a>00457 
<a name="l00458"></a>00458     $response = <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;api(<span class="stringliteral">&#39;/jerry&#39;</span>);
<a name="l00459"></a>00459     $this-&gt;assertEquals(
<a name="l00460"></a>00460       $response[<span class="stringliteral">&#39;id&#39;</span>], <span class="stringliteral">&#39;214707&#39;</span>, <span class="stringliteral">&#39;should get expected id.&#39;</span>);
<a name="l00461"></a>00461   }
<a name="l00462"></a>00462 
<a name="l00463"></a><a class="code" href="classPHPSDKTestCase.html#aee5c1c6a4b3ffcaea890f52fbf977926">00463</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#aee5c1c6a4b3ffcaea890f52fbf977926">testGraphAPIWithBogusAccessToken</a>() {
<a name="l00464"></a>00464     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a>(array(
<a name="l00465"></a>00465       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00466"></a>00466       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00467"></a>00467     ));
<a name="l00468"></a>00468 
<a name="l00469"></a>00469     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;setAccessToken(<span class="stringliteral">&#39;this-is-not-really-an-access-token&#39;</span>);
<a name="l00470"></a>00470     <span class="keywordflow">try</span> {
<a name="l00471"></a>00471       $response = <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;api(<span class="stringliteral">&#39;/me&#39;</span>);
<a name="l00472"></a>00472       $this-&gt;fail(<span class="stringliteral">&#39;Should not get here.&#39;</span>);
<a name="l00473"></a>00473     } <span class="keywordflow">catch</span>(<a class="code" href="classFacebookApiException.html" title="Copyright 2011 Facebook, Inc.">FacebookApiException</a> $e) {
<a name="l00474"></a>00474       <span class="comment">// means the server got the access token and didn&#39;t like it</span>
<a name="l00475"></a>00475       $msg = <span class="stringliteral">&#39;OAuthException: Invalid OAuth access token.&#39;</span>;
<a name="l00476"></a>00476       $this-&gt;assertEquals($msg, (<span class="keywordtype">string</span>) $e,
<a name="l00477"></a>00477                           <span class="stringliteral">&#39;Expect the invalid OAuth token message.&#39;</span>);
<a name="l00478"></a>00478     }
<a name="l00479"></a>00479   }
<a name="l00480"></a>00480 
<a name="l00481"></a><a class="code" href="classPHPSDKTestCase.html#a41f5ef1c40ecf17ea21ffe8540589191">00481</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a41f5ef1c40ecf17ea21ffe8540589191">testGraphAPIWithExpiredAccessToken</a>() {
<a name="l00482"></a>00482     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a>(array(
<a name="l00483"></a>00483       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00484"></a>00484       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00485"></a>00485     ));
<a name="l00486"></a>00486 
<a name="l00487"></a>00487     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;setAccessToken(self::$kExpiredAccessToken);
<a name="l00488"></a>00488     <span class="keywordflow">try</span> {
<a name="l00489"></a>00489       $response = <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;api(<span class="stringliteral">&#39;/me&#39;</span>);
<a name="l00490"></a>00490       $this-&gt;fail(<span class="stringliteral">&#39;Should not get here.&#39;</span>);
<a name="l00491"></a>00491     } <span class="keywordflow">catch</span>(<a class="code" href="classFacebookApiException.html" title="Copyright 2011 Facebook, Inc.">FacebookApiException</a> $e) {
<a name="l00492"></a>00492       <span class="comment">// means the server got the access token and didn&#39;t like it</span>
<a name="l00493"></a>00493       $error_msg_start = <span class="stringliteral">&#39;OAuthException: Error validating access token:&#39;</span>;
<a name="l00494"></a>00494       $this-&gt;assertTrue(strpos((<span class="keywordtype">string</span>) $e, $error_msg_start) === 0,
<a name="l00495"></a>00495                         <span class="stringliteral">&#39;Expect the token validation error message.&#39;</span>);
<a name="l00496"></a>00496     }
<a name="l00497"></a>00497   }
<a name="l00498"></a>00498 
<a name="l00499"></a><a class="code" href="classPHPSDKTestCase.html#ad231125c22ba65ebaf70ccb5dfb92fed">00499</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#ad231125c22ba65ebaf70ccb5dfb92fed">testGraphAPIOAuthSpecError</a>() {
<a name="l00500"></a>00500     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a>(array(
<a name="l00501"></a>00501       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::MIGRATED_APP_ID,
<a name="l00502"></a>00502       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::MIGRATED_SECRET,
<a name="l00503"></a>00503     ));
<a name="l00504"></a>00504 
<a name="l00505"></a>00505     <span class="keywordflow">try</span> {
<a name="l00506"></a>00506       $response = <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;api(<span class="stringliteral">&#39;/me&#39;</span>, array(
<a name="l00507"></a>00507         <span class="stringliteral">&#39;client_id&#39;</span> =&gt; self::MIGRATED_APP_ID));
<a name="l00508"></a>00508 
<a name="l00509"></a>00509       $this-&gt;fail(<span class="stringliteral">&#39;Should not get here.&#39;</span>);
<a name="l00510"></a>00510     } <span class="keywordflow">catch</span>(<a class="code" href="classFacebookApiException.html" title="Copyright 2011 Facebook, Inc.">FacebookApiException</a> $e) {
<a name="l00511"></a>00511       <span class="comment">// means the server got the access token</span>
<a name="l00512"></a>00512       $msg = <span class="stringliteral">&#39;invalid_request: An active access token must be used &#39;</span>.
<a name="l00513"></a>00513              <span class="stringliteral">&#39;to query information about the current user.&#39;</span>;
<a name="l00514"></a>00514       $this-&gt;assertEquals($msg, (<span class="keywordtype">string</span>) $e,
<a name="l00515"></a>00515                           <span class="stringliteral">&#39;Expect the invalid session message.&#39;</span>);
<a name="l00516"></a>00516     }
<a name="l00517"></a>00517   }
<a name="l00518"></a>00518 
<a name="l00519"></a><a class="code" href="classPHPSDKTestCase.html#aac14894031cd58047eb66d7ef3088b0e">00519</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#aac14894031cd58047eb66d7ef3088b0e">testGraphAPIMethodOAuthSpecError</a>() {
<a name="l00520"></a>00520     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a>(array(
<a name="l00521"></a>00521       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::MIGRATED_APP_ID,
<a name="l00522"></a>00522       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::MIGRATED_SECRET,
<a name="l00523"></a>00523     ));
<a name="l00524"></a>00524 
<a name="l00525"></a>00525     <span class="keywordflow">try</span> {
<a name="l00526"></a>00526       $response = <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;api(<span class="stringliteral">&#39;/daaku.shah&#39;</span>, <span class="stringliteral">&#39;DELETE&#39;</span>, array(
<a name="l00527"></a>00527         <span class="stringliteral">&#39;client_id&#39;</span> =&gt; self::MIGRATED_APP_ID));
<a name="l00528"></a>00528       $this-&gt;fail(<span class="stringliteral">&#39;Should not get here.&#39;</span>);
<a name="l00529"></a>00529     } <span class="keywordflow">catch</span>(<a class="code" href="classFacebookApiException.html" title="Copyright 2011 Facebook, Inc.">FacebookApiException</a> $e) {
<a name="l00530"></a>00530       $this-&gt;assertEquals(strpos($e, <span class="stringliteral">&#39;invalid_request&#39;</span>), 0);
<a name="l00531"></a>00531     }
<a name="l00532"></a>00532   }
<a name="l00533"></a>00533 
<a name="l00534"></a><a class="code" href="classPHPSDKTestCase.html#a57e88af850f269ac4d015766c91b96cf">00534</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a57e88af850f269ac4d015766c91b96cf">testCurlFailure</a>() {
<a name="l00535"></a>00535     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a>(array(
<a name="l00536"></a>00536       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00537"></a>00537       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00538"></a>00538     ));
<a name="l00539"></a>00539 
<a name="l00540"></a>00540     <span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;CURLOPT_TIMEOUT_MS&#39;</span>)) {
<a name="l00541"></a>00541       <span class="comment">// can&#39;t test it if we don&#39;t have millisecond timeouts</span>
<a name="l00542"></a>00542       <span class="keywordflow">return</span>;
<a name="l00543"></a>00543     }
<a name="l00544"></a>00544 
<a name="l00545"></a>00545     $exception = null;
<a name="l00546"></a>00546     <span class="keywordflow">try</span> {
<a name="l00547"></a>00547       <span class="comment">// we dont expect facebook will ever return in 1ms</span>
<a name="l00548"></a>00548       <a class="code" href="classBaseFacebook.html#ad48ad58bc8120acf03f199bb100be6dd" title="Default options for curl.">Facebook::$CURL_OPTS</a>[CURLOPT_TIMEOUT_MS] = 50;
<a name="l00549"></a>00549       <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;api(<span class="stringliteral">&#39;/naitik&#39;</span>);
<a name="l00550"></a>00550     } <span class="keywordflow">catch</span>(<a class="code" href="classFacebookApiException.html" title="Copyright 2011 Facebook, Inc.">FacebookApiException</a> $e) {
<a name="l00551"></a>00551       $exception = $e;
<a name="l00552"></a>00552     }
<a name="l00553"></a>00553     unset(<a class="code" href="classBaseFacebook.html#ad48ad58bc8120acf03f199bb100be6dd" title="Default options for curl.">Facebook::$CURL_OPTS</a>[CURLOPT_TIMEOUT_MS]);
<a name="l00554"></a>00554     <span class="keywordflow">if</span> (!$exception) {
<a name="l00555"></a>00555       $this-&gt;fail(<span class="stringliteral">&#39;no exception was thrown on timeout.&#39;</span>);
<a name="l00556"></a>00556     }
<a name="l00557"></a>00557 
<a name="l00558"></a>00558     $code = $exception-&gt;getCode();
<a name="l00559"></a>00559     <span class="keywordflow">if</span> ($code != CURLE_OPERATION_TIMEOUTED &amp;&amp; $code != CURLE_COULDNT_CONNECT) {
<a name="l00560"></a>00560       $this-&gt;fail(<span class="stringliteral">&quot;Expected curl error code 7 or 28 but got: $code&quot;</span>);
<a name="l00561"></a>00561     }
<a name="l00562"></a>00562     $this-&gt;assertEquals(<span class="stringliteral">&#39;CurlException&#39;</span>, $exception-&gt;getType(), <span class="stringliteral">&#39;expect type&#39;</span>);
<a name="l00563"></a>00563   }
<a name="l00564"></a>00564 
<a name="l00565"></a><a class="code" href="classPHPSDKTestCase.html#a967d3d17ff03a6f31fabcda80b3a3d58">00565</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a967d3d17ff03a6f31fabcda80b3a3d58">testGraphAPIWithOnlyParams</a>() {
<a name="l00566"></a>00566     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a>(array(
<a name="l00567"></a>00567       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00568"></a>00568       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00569"></a>00569     ));
<a name="l00570"></a>00570 
<a name="l00571"></a>00571     $response = <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;api(<span class="stringliteral">&#39;/jerry&#39;</span>);
<a name="l00572"></a>00572     $this-&gt;assertTrue(isset($response[<span class="stringliteral">&#39;id&#39;</span>]),
<a name="l00573"></a>00573                       <span class="stringliteral">&#39;User ID should be public.&#39;</span>);
<a name="l00574"></a>00574     $this-&gt;assertTrue(isset($response[<span class="stringliteral">&#39;name&#39;</span>]),
<a name="l00575"></a>00575                       <span class="stringliteral">&#39;User\&#39;s name should be public.&#39;</span>);
<a name="l00576"></a>00576     $this-&gt;assertTrue(isset($response[<span class="stringliteral">&#39;first_name&#39;</span>]),
<a name="l00577"></a>00577                       <span class="stringliteral">&#39;User\&#39;s first name should be public.&#39;</span>);
<a name="l00578"></a>00578     $this-&gt;assertTrue(isset($response[<span class="stringliteral">&#39;last_name&#39;</span>]),
<a name="l00579"></a>00579                       <span class="stringliteral">&#39;User\&#39;s last name should be public.&#39;</span>);
<a name="l00580"></a>00580     $this-&gt;assertFalse(isset($response[<span class="stringliteral">&#39;work&#39;</span>]),
<a name="l00581"></a>00581                        <span class="stringliteral">&#39;User\&#39;s work history should only be available with &#39;</span>.
<a name="l00582"></a>00582                        <span class="stringliteral">&#39;a valid access token.&#39;</span>);
<a name="l00583"></a>00583     $this-&gt;assertFalse(isset($response[<span class="stringliteral">&#39;education&#39;</span>]),
<a name="l00584"></a>00584                        <span class="stringliteral">&#39;User\&#39;s education history should only be &#39;</span>.
<a name="l00585"></a>00585                        <span class="stringliteral">&#39;available with a valid access token.&#39;</span>);
<a name="l00586"></a>00586     $this-&gt;assertFalse(isset($response[<span class="stringliteral">&#39;verified&#39;</span>]),
<a name="l00587"></a>00587                        <span class="stringliteral">&#39;User\&#39;s verification status should only be &#39;</span>.
<a name="l00588"></a>00588                        <span class="stringliteral">&#39;available with a valid access token.&#39;</span>);
<a name="l00589"></a>00589   }
<a name="l00590"></a>00590 
<a name="l00591"></a><a class="code" href="classPHPSDKTestCase.html#ab2e1e4bd8ca881a3801460a66e9eecd1">00591</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#ab2e1e4bd8ca881a3801460a66e9eecd1">testLoginURLDefaults</a>() {
<a name="l00592"></a>00592     $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>] = <span class="stringliteral">&#39;fbrell.com&#39;</span>;
<a name="l00593"></a>00593     $_SERVER[<span class="stringliteral">&#39;REQUEST_URI&#39;</span>] = <span class="stringliteral">&#39;/examples&#39;</span>;
<a name="l00594"></a>00594     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a>(array(
<a name="l00595"></a>00595       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00596"></a>00596       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00597"></a>00597     ));
<a name="l00598"></a>00598     $encodedUrl = rawurlencode(<span class="stringliteral">&#39;http://fbrell.com/examples&#39;</span>);
<a name="l00599"></a>00599     $this-&gt;assertNotNull(strpos(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getLoginUrl(), $encodedUrl),
<a name="l00600"></a>00600                          <span class="stringliteral">&#39;Expect the current url to exist.&#39;</span>);
<a name="l00601"></a>00601   }
<a name="l00602"></a>00602 
<a name="l00603"></a><a class="code" href="classPHPSDKTestCase.html#abe3fd74a7a3277c18f51ae1af9ab6956">00603</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#abe3fd74a7a3277c18f51ae1af9ab6956">testLoginURLDefaultsDropStateQueryParam</a>() {
<a name="l00604"></a>00604     $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>] = <span class="stringliteral">&#39;fbrell.com&#39;</span>;
<a name="l00605"></a>00605     $_SERVER[<span class="stringliteral">&#39;REQUEST_URI&#39;</span>] = <span class="stringliteral">&#39;/examples?state=xx42xx&#39;</span>;
<a name="l00606"></a>00606     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a>(array(
<a name="l00607"></a>00607       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00608"></a>00608       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00609"></a>00609     ));
<a name="l00610"></a>00610     $expectEncodedUrl = rawurlencode(<span class="stringliteral">&#39;http://fbrell.com/examples&#39;</span>);
<a name="l00611"></a>00611     $this-&gt;assertTrue(strpos(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getLoginUrl(), $expectEncodedUrl) &gt; -1,
<a name="l00612"></a>00612                       <span class="stringliteral">&#39;Expect the current url to exist.&#39;</span>);
<a name="l00613"></a>00613     $this-&gt;assertFalse(strpos(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getLoginUrl(), <span class="stringliteral">&#39;xx42xx&#39;</span>),
<a name="l00614"></a>00614                        <span class="stringliteral">&#39;Expect the session param to be dropped.&#39;</span>);
<a name="l00615"></a>00615   }
<a name="l00616"></a>00616 
<a name="l00617"></a><a class="code" href="classPHPSDKTestCase.html#a1115f379ac3bda2e5c5f34d9b0e796fa">00617</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a1115f379ac3bda2e5c5f34d9b0e796fa">testLoginURLDefaultsDropCodeQueryParam</a>() {
<a name="l00618"></a>00618     $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>] = <span class="stringliteral">&#39;fbrell.com&#39;</span>;
<a name="l00619"></a>00619     $_SERVER[<span class="stringliteral">&#39;REQUEST_URI&#39;</span>] = <span class="stringliteral">&#39;/examples?code=xx42xx&#39;</span>;
<a name="l00620"></a>00620     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a>(array(
<a name="l00621"></a>00621       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00622"></a>00622       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00623"></a>00623     ));
<a name="l00624"></a>00624     $expectEncodedUrl = rawurlencode(<span class="stringliteral">&#39;http://fbrell.com/examples&#39;</span>);
<a name="l00625"></a>00625     $this-&gt;assertTrue(strpos(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getLoginUrl(), $expectEncodedUrl) &gt; -1,
<a name="l00626"></a>00626                       <span class="stringliteral">&#39;Expect the current url to exist.&#39;</span>);
<a name="l00627"></a>00627     $this-&gt;assertFalse(strpos(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getLoginUrl(), <span class="stringliteral">&#39;xx42xx&#39;</span>),
<a name="l00628"></a>00628                        <span class="stringliteral">&#39;Expect the session param to be dropped.&#39;</span>);
<a name="l00629"></a>00629   }
<a name="l00630"></a>00630 
<a name="l00631"></a><a class="code" href="classPHPSDKTestCase.html#a01ec3144d841ade345b89745eb4595c2">00631</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a01ec3144d841ade345b89745eb4595c2">testLoginURLDefaultsDropSignedRequestParamButNotOthers</a>() {
<a name="l00632"></a>00632     $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>] = <span class="stringliteral">&#39;fbrell.com&#39;</span>;
<a name="l00633"></a>00633     $_SERVER[<span class="stringliteral">&#39;REQUEST_URI&#39;</span>] =
<a name="l00634"></a>00634       <span class="stringliteral">&#39;/examples?signed_request=xx42xx&amp;do_not_drop=xx43xx&#39;</span>;
<a name="l00635"></a>00635     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a>(array(
<a name="l00636"></a>00636       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00637"></a>00637       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00638"></a>00638     ));
<a name="l00639"></a>00639     $expectEncodedUrl = rawurlencode(<span class="stringliteral">&#39;http://fbrell.com/examples&#39;</span>);
<a name="l00640"></a>00640     $this-&gt;assertFalse(strpos(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getLoginUrl(), <span class="stringliteral">&#39;xx42xx&#39;</span>),
<a name="l00641"></a>00641                        <span class="stringliteral">&#39;Expect the session param to be dropped.&#39;</span>);
<a name="l00642"></a>00642     $this-&gt;assertTrue(strpos(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getLoginUrl(), <span class="stringliteral">&#39;xx43xx&#39;</span>) &gt; -1,
<a name="l00643"></a>00643                       <span class="stringliteral">&#39;Expect the do_not_drop param to exist.&#39;</span>);
<a name="l00644"></a>00644   }
<a name="l00645"></a>00645 
<a name="l00646"></a><a class="code" href="classPHPSDKTestCase.html#a2a659864f5da55448750a921f389f1d1">00646</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a2a659864f5da55448750a921f389f1d1">testLoginURLCustomNext</a>() {
<a name="l00647"></a>00647     $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>] = <span class="stringliteral">&#39;fbrell.com&#39;</span>;
<a name="l00648"></a>00648     $_SERVER[<span class="stringliteral">&#39;REQUEST_URI&#39;</span>] = <span class="stringliteral">&#39;/examples&#39;</span>;
<a name="l00649"></a>00649     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a>(array(
<a name="l00650"></a>00650       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00651"></a>00651       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00652"></a>00652     ));
<a name="l00653"></a>00653     $next = <span class="stringliteral">&#39;http://fbrell.com/custom&#39;</span>;
<a name="l00654"></a>00654     $loginUrl = <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getLoginUrl(array(
<a name="l00655"></a>00655       <span class="stringliteral">&#39;redirect_uri&#39;</span> =&gt; $next,
<a name="l00656"></a>00656       <span class="stringliteral">&#39;cancel_url&#39;</span> =&gt; $next
<a name="l00657"></a>00657     ));
<a name="l00658"></a>00658     $currentEncodedUrl = rawurlencode(<span class="stringliteral">&#39;http://fbrell.com/examples&#39;</span>);
<a name="l00659"></a>00659     $expectedEncodedUrl = rawurlencode($next);
<a name="l00660"></a>00660     $this-&gt;assertNotNull(strpos($loginUrl, $expectedEncodedUrl),
<a name="l00661"></a>00661                          <span class="stringliteral">&#39;Expect the custom url to exist.&#39;</span>);
<a name="l00662"></a>00662     $this-&gt;assertFalse(strpos($loginUrl, $currentEncodedUrl),
<a name="l00663"></a>00663                       <span class="stringliteral">&#39;Expect the current url to not exist.&#39;</span>);
<a name="l00664"></a>00664   }
<a name="l00665"></a>00665 
<a name="l00666"></a><a class="code" href="classPHPSDKTestCase.html#aafbe108f3e294c96c6cccbe0a83ad738">00666</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#aafbe108f3e294c96c6cccbe0a83ad738">testLogoutURLDefaults</a>() {
<a name="l00667"></a>00667     $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>] = <span class="stringliteral">&#39;fbrell.com&#39;</span>;
<a name="l00668"></a>00668     $_SERVER[<span class="stringliteral">&#39;REQUEST_URI&#39;</span>] = <span class="stringliteral">&#39;/examples&#39;</span>;
<a name="l00669"></a>00669     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a>(array(
<a name="l00670"></a>00670       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00671"></a>00671       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00672"></a>00672     ));
<a name="l00673"></a>00673     $encodedUrl = rawurlencode(<span class="stringliteral">&#39;http://fbrell.com/examples&#39;</span>);
<a name="l00674"></a>00674     $this-&gt;assertNotNull(strpos(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getLogoutUrl(), $encodedUrl),
<a name="l00675"></a>00675                          <span class="stringliteral">&#39;Expect the current url to exist.&#39;</span>);
<a name="l00676"></a>00676     $this-&gt;assertFalse(strpos(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getLogoutUrl(), <a class="code" href="classPHPSDKTestCase.html#a2e31ccc7c2b15ed269966d301045f040">self::SECRET</a>));
<a name="l00677"></a>00677   }
<a name="l00678"></a>00678 
<a name="l00679"></a><a class="code" href="classPHPSDKTestCase.html#a707f33e4c3e89326c90ca41cd5fc5007">00679</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a707f33e4c3e89326c90ca41cd5fc5007">testLoginStatusURLDefaults</a>() {
<a name="l00680"></a>00680     $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>] = <span class="stringliteral">&#39;fbrell.com&#39;</span>;
<a name="l00681"></a>00681     $_SERVER[<span class="stringliteral">&#39;REQUEST_URI&#39;</span>] = <span class="stringliteral">&#39;/examples&#39;</span>;
<a name="l00682"></a>00682     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a>(array(
<a name="l00683"></a>00683       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00684"></a>00684       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00685"></a>00685     ));
<a name="l00686"></a>00686     $encodedUrl = rawurlencode(<span class="stringliteral">&#39;http://fbrell.com/examples&#39;</span>);
<a name="l00687"></a>00687     $this-&gt;assertNotNull(strpos(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getLoginStatusUrl(), $encodedUrl),
<a name="l00688"></a>00688                          <span class="stringliteral">&#39;Expect the current url to exist.&#39;</span>);
<a name="l00689"></a>00689   }
<a name="l00690"></a>00690 
<a name="l00691"></a><a class="code" href="classPHPSDKTestCase.html#a8276bfd51418a90dc4e116538ffef2b3">00691</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a8276bfd51418a90dc4e116538ffef2b3">testLoginStatusURLCustom</a>() {
<a name="l00692"></a>00692     $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>] = <span class="stringliteral">&#39;fbrell.com&#39;</span>;
<a name="l00693"></a>00693     $_SERVER[<span class="stringliteral">&#39;REQUEST_URI&#39;</span>] = <span class="stringliteral">&#39;/examples&#39;</span>;
<a name="l00694"></a>00694     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a>(array(
<a name="l00695"></a>00695       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00696"></a>00696       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00697"></a>00697     ));
<a name="l00698"></a>00698     $encodedUrl1 = rawurlencode(<span class="stringliteral">&#39;http://fbrell.com/examples&#39;</span>);
<a name="l00699"></a>00699     $okUrl = <span class="stringliteral">&#39;http://fbrell.com/here1&#39;</span>;
<a name="l00700"></a>00700     $encodedUrl2 = rawurlencode($okUrl);
<a name="l00701"></a>00701     $loginStatusUrl = <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getLoginStatusUrl(array(
<a name="l00702"></a>00702       <span class="stringliteral">&#39;ok_session&#39;</span> =&gt; $okUrl,
<a name="l00703"></a>00703     ));
<a name="l00704"></a>00704     $this-&gt;assertNotNull(strpos($loginStatusUrl, $encodedUrl1),
<a name="l00705"></a>00705                          <span class="stringliteral">&#39;Expect the current url to exist.&#39;</span>);
<a name="l00706"></a>00706     $this-&gt;assertNotNull(strpos($loginStatusUrl, $encodedUrl2),
<a name="l00707"></a>00707                          <span class="stringliteral">&#39;Expect the custom url to exist.&#39;</span>);
<a name="l00708"></a>00708   }
<a name="l00709"></a>00709 
<a name="l00710"></a><a class="code" href="classPHPSDKTestCase.html#a4ad6ff6c7f7cbeda61684d2d82b4fbaf">00710</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a4ad6ff6c7f7cbeda61684d2d82b4fbaf">testNonDefaultPort</a>() {
<a name="l00711"></a>00711     $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>] = <span class="stringliteral">&#39;fbrell.com:8080&#39;</span>;
<a name="l00712"></a>00712     $_SERVER[<span class="stringliteral">&#39;REQUEST_URI&#39;</span>] = <span class="stringliteral">&#39;/examples&#39;</span>;
<a name="l00713"></a>00713     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a>(array(
<a name="l00714"></a>00714       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00715"></a>00715       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00716"></a>00716     ));
<a name="l00717"></a>00717     $encodedUrl = rawurlencode(<span class="stringliteral">&#39;http://fbrell.com:8080/examples&#39;</span>);
<a name="l00718"></a>00718     $this-&gt;assertNotNull(strpos(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getLoginUrl(), $encodedUrl),
<a name="l00719"></a>00719                          <span class="stringliteral">&#39;Expect the current url to exist.&#39;</span>);
<a name="l00720"></a>00720   }
<a name="l00721"></a>00721 
<a name="l00722"></a><a class="code" href="classPHPSDKTestCase.html#a11b14d5fc311d1b726163a72ddd77962">00722</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a11b14d5fc311d1b726163a72ddd77962">testSecureCurrentUrl</a>() {
<a name="l00723"></a>00723     $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>] = <span class="stringliteral">&#39;fbrell.com&#39;</span>;
<a name="l00724"></a>00724     $_SERVER[<span class="stringliteral">&#39;REQUEST_URI&#39;</span>] = <span class="stringliteral">&#39;/examples&#39;</span>;
<a name="l00725"></a>00725     $_SERVER[<span class="stringliteral">&#39;HTTPS&#39;</span>] = <span class="stringliteral">&#39;on&#39;</span>;
<a name="l00726"></a>00726     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a>(array(
<a name="l00727"></a>00727       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00728"></a>00728       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00729"></a>00729     ));
<a name="l00730"></a>00730     $encodedUrl = rawurlencode(<span class="stringliteral">&#39;https://fbrell.com/examples&#39;</span>);
<a name="l00731"></a>00731     $this-&gt;assertNotNull(strpos(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getLoginUrl(), $encodedUrl),
<a name="l00732"></a>00732                          <span class="stringliteral">&#39;Expect the current url to exist.&#39;</span>);
<a name="l00733"></a>00733   }
<a name="l00734"></a>00734 
<a name="l00735"></a><a class="code" href="classPHPSDKTestCase.html#a21f39989a3ebaf29bef8743d40e91358">00735</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a21f39989a3ebaf29bef8743d40e91358">testSecureCurrentUrlWithNonDefaultPort</a>() {
<a name="l00736"></a>00736     $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>] = <span class="stringliteral">&#39;fbrell.com:8080&#39;</span>;
<a name="l00737"></a>00737     $_SERVER[<span class="stringliteral">&#39;REQUEST_URI&#39;</span>] = <span class="stringliteral">&#39;/examples&#39;</span>;
<a name="l00738"></a>00738     $_SERVER[<span class="stringliteral">&#39;HTTPS&#39;</span>] = <span class="stringliteral">&#39;on&#39;</span>;
<a name="l00739"></a>00739     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a>(array(
<a name="l00740"></a>00740       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00741"></a>00741       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l00742"></a>00742     ));
<a name="l00743"></a>00743     $encodedUrl = rawurlencode(<span class="stringliteral">&#39;https://fbrell.com:8080/examples&#39;</span>);
<a name="l00744"></a>00744     $this-&gt;assertNotNull(strpos(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getLoginUrl(), $encodedUrl),
<a name="l00745"></a>00745                          <span class="stringliteral">&#39;Expect the current url to exist.&#39;</span>);
<a name="l00746"></a>00746   }
<a name="l00747"></a>00747 
<a name="l00748"></a><a class="code" href="classPHPSDKTestCase.html#adaf8f1908eb04ad32ce065d4631eb3c3">00748</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#adaf8f1908eb04ad32ce065d4631eb3c3">testBase64UrlEncode</a>() {
<a name="l00749"></a>00749     $input = <span class="stringliteral">&#39;Facebook rocks&#39;</span>;
<a name="l00750"></a>00750     $output = <span class="stringliteral">&#39;RmFjZWJvb2sgcm9ja3M&#39;</span>;
<a name="l00751"></a>00751 
<a name="l00752"></a>00752     $this-&gt;assertEquals(<a class="code" href="classFBPublic.html#a355256ea41cd8312f2e9b7e29a8bb89d">FBPublic::publicBase64UrlDecode</a>($output), $input);
<a name="l00753"></a>00753   }
<a name="l00754"></a>00754 
<a name="l00755"></a><a class="code" href="classPHPSDKTestCase.html#afebedd4aa2704b604e41e09471d112fd">00755</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#afebedd4aa2704b604e41e09471d112fd">testSignedToken</a>() {
<a name="l00756"></a>00756     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classFBPublic.html">FBPublic</a>(array(
<a name="l00757"></a>00757       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00758"></a>00758       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET
<a name="l00759"></a>00759     ));
<a name="l00760"></a>00760     $payload = <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;publicParseSignedRequest(self::kValidSignedRequest());
<a name="l00761"></a>00761     $this-&gt;assertNotNull($payload, <span class="stringliteral">&#39;Expected token to parse&#39;</span>);
<a name="l00762"></a>00762     $this-&gt;assertEquals(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getSignedRequest(), null);
<a name="l00763"></a>00763     $_REQUEST[<span class="stringliteral">&#39;signed_request&#39;</span>] = <a class="code" href="classPHPSDKTestCase.html#a6bd8d63d2a2cb372b67d5f218c685e14">self::kValidSignedRequest</a>();
<a name="l00764"></a>00764     $this-&gt;assertEquals(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getSignedRequest(), $payload);
<a name="l00765"></a>00765   }
<a name="l00766"></a>00766 
<a name="l00767"></a><a class="code" href="classPHPSDKTestCase.html#a946f6f98464a9acca7d22b0e67be52db">00767</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a946f6f98464a9acca7d22b0e67be52db">testNonTossedSignedtoken</a>() {
<a name="l00768"></a>00768     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classFBPublic.html">FBPublic</a>(array(
<a name="l00769"></a>00769       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00770"></a>00770       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET
<a name="l00771"></a>00771     ));
<a name="l00772"></a>00772     $payload = <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;publicParseSignedRequest(
<a name="l00773"></a>00773       self::kNonTosedSignedRequest());
<a name="l00774"></a>00774     $this-&gt;assertNotNull($payload, <span class="stringliteral">&#39;Expected token to parse&#39;</span>);
<a name="l00775"></a>00775     $this-&gt;assertNull(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getSignedRequest());
<a name="l00776"></a>00776     $_REQUEST[<span class="stringliteral">&#39;signed_request&#39;</span>] = <a class="code" href="classPHPSDKTestCase.html#a71570cb8812d9e8da84039bd999645a1">self::kNonTosedSignedRequest</a>();
<a name="l00777"></a>00777     $sr = <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getSignedRequest();
<a name="l00778"></a>00778     $this-&gt;assertTrue(isset($sr[<span class="stringliteral">&#39;algorithm&#39;</span>]));
<a name="l00779"></a>00779   }
<a name="l00780"></a>00780 
<a name="l00781"></a><a class="code" href="classPHPSDKTestCase.html#a4956b4b5239b8f724ef257466b1357fb">00781</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a4956b4b5239b8f724ef257466b1357fb">testSignedRequestWithWrongAlgo</a>() {
<a name="l00782"></a>00782     $fb = <span class="keyword">new</span> <a class="code" href="classFBPublic.html">FBPublic</a>(array(
<a name="l00783"></a>00783       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00784"></a>00784       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET
<a name="l00785"></a>00785     ));
<a name="l00786"></a>00786     $payload = $fb-&gt;publicParseSignedRequest(
<a name="l00787"></a>00787       self::kSignedRequestWithWrongAlgo());
<a name="l00788"></a>00788     $this-&gt;assertNull($payload, <span class="stringliteral">&#39;Expected nothing back.&#39;</span>);
<a name="l00789"></a>00789   }
<a name="l00790"></a>00790 
<a name="l00791"></a><a class="code" href="classPHPSDKTestCase.html#ae8a683a014d6504dd69a3fa07ab7dcae">00791</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#ae8a683a014d6504dd69a3fa07ab7dcae">testMakeAndParse</a>() {
<a name="l00792"></a>00792     $fb = <span class="keyword">new</span> <a class="code" href="classFBPublic.html">FBPublic</a>(array(
<a name="l00793"></a>00793       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00794"></a>00794       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET
<a name="l00795"></a>00795     ));
<a name="l00796"></a>00796     <a class="code" href="adm_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a> = array(<span class="stringliteral">&#39;foo&#39;</span> =&gt; 42);
<a name="l00797"></a>00797     $sr = $fb-&gt;publicMakeSignedRequest(<a class="code" href="adm_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>);
<a name="l00798"></a>00798     $decoded = $fb-&gt;publicParseSignedRequest($sr);
<a name="l00799"></a>00799     $this-&gt;assertEquals(<a class="code" href="adm_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>[<span class="stringliteral">&#39;foo&#39;</span>], $decoded[<span class="stringliteral">&#39;foo&#39;</span>]);
<a name="l00800"></a>00800   }
<a name="l00801"></a>00801 <span class="comment"></span>
<a name="l00802"></a>00802 <span class="comment">  /**</span>
<a name="l00803"></a>00803 <span class="comment">   * @expectedException InvalidArgumentException</span>
<a name="l00804"></a>00804 <span class="comment">   */</span>
<a name="l00805"></a><a class="code" href="classPHPSDKTestCase.html#aebd77583c00c95d9e7adb3bb191798f5">00805</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#aebd77583c00c95d9e7adb3bb191798f5" title="InvalidArgumentException">testMakeSignedRequestExpectsArray</a>() {
<a name="l00806"></a>00806     $fb = <span class="keyword">new</span> <a class="code" href="classFBPublic.html">FBPublic</a>(array(
<a name="l00807"></a>00807       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00808"></a>00808       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET
<a name="l00809"></a>00809     ));
<a name="l00810"></a>00810     $sr = $fb-&gt;publicMakeSignedRequest(<span class="stringliteral">&#39;&#39;</span>);
<a name="l00811"></a>00811   }
<a name="l00812"></a>00812 
<a name="l00813"></a><a class="code" href="classPHPSDKTestCase.html#ad0cb93bf32ed1876921ad970ad5eab3d">00813</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#ad0cb93bf32ed1876921ad970ad5eab3d">testBundledCACert</a>() {
<a name="l00814"></a>00814     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a>(array(
<a name="l00815"></a>00815       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00816"></a>00816       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET
<a name="l00817"></a>00817     ));
<a name="l00818"></a>00818 
<a name="l00819"></a>00819       <span class="comment">// use the bundled cert from the start</span>
<a name="l00820"></a>00820     <a class="code" href="classBaseFacebook.html#ad48ad58bc8120acf03f199bb100be6dd" title="Default options for curl.">Facebook::$CURL_OPTS</a>[CURLOPT_CAINFO] =
<a name="l00821"></a>00821       dirname(__FILE__) . <span class="stringliteral">&#39;/../src/fb_ca_chain_bundle.crt&#39;</span>;
<a name="l00822"></a>00822     $response = <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;api(<span class="stringliteral">&#39;/naitik&#39;</span>);
<a name="l00823"></a>00823 
<a name="l00824"></a>00824     unset(<a class="code" href="classBaseFacebook.html#ad48ad58bc8120acf03f199bb100be6dd" title="Default options for curl.">Facebook::$CURL_OPTS</a>[CURLOPT_CAINFO]);
<a name="l00825"></a>00825     $this-&gt;assertEquals(
<a name="l00826"></a>00826       $response[<span class="stringliteral">&#39;id&#39;</span>], <span class="stringliteral">&#39;5526183&#39;</span>, <span class="stringliteral">&#39;should get expected id.&#39;</span>);
<a name="l00827"></a>00827   }
<a name="l00828"></a>00828 
<a name="l00829"></a><a class="code" href="classPHPSDKTestCase.html#a705a487b17675e54961b3d3f2971620d">00829</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a705a487b17675e54961b3d3f2971620d">testVideoUpload</a>() {
<a name="l00830"></a>00830     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classFBRecordURL.html">FBRecordURL</a>(array(
<a name="l00831"></a>00831       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00832"></a>00832       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET
<a name="l00833"></a>00833     ));
<a name="l00834"></a>00834 
<a name="l00835"></a>00835     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;api(array(<span class="stringliteral">&#39;method&#39;</span> =&gt; <span class="stringliteral">&#39;video.upload&#39;</span>));
<a name="l00836"></a>00836     $this-&gt;assertContains(<span class="stringliteral">&#39;//api-video.&#39;</span>, <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getRequestedURL(),
<a name="l00837"></a>00837                           <span class="stringliteral">&#39;video.upload should go against api-video&#39;</span>);
<a name="l00838"></a>00838   }
<a name="l00839"></a>00839 
<a name="l00840"></a><a class="code" href="classPHPSDKTestCase.html#aaa9348e23fe75e9c194f1ac5e00daeee">00840</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#aaa9348e23fe75e9c194f1ac5e00daeee">testVideoUploadGraph</a>() {
<a name="l00841"></a>00841     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classFBRecordURL.html">FBRecordURL</a>(array(
<a name="l00842"></a>00842       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00843"></a>00843       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET
<a name="l00844"></a>00844     ));
<a name="l00845"></a>00845 
<a name="l00846"></a>00846     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;api(<span class="stringliteral">&#39;/me/videos&#39;</span>, <span class="stringliteral">&#39;POST&#39;</span>);
<a name="l00847"></a>00847     $this-&gt;assertContains(<span class="stringliteral">&#39;//graph-video.&#39;</span>, <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getRequestedURL(),
<a name="l00848"></a>00848                           <span class="stringliteral">&#39;/me/videos should go against graph-video&#39;</span>);
<a name="l00849"></a>00849   }
<a name="l00850"></a>00850 
<a name="l00851"></a><a class="code" href="classPHPSDKTestCase.html#a90975cc76342348c8f5a1533387dfc69">00851</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a90975cc76342348c8f5a1533387dfc69">testGetUserAndAccessTokenFromSession</a>() {
<a name="l00852"></a>00852     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classPersistentFBPublic.html">PersistentFBPublic</a>(array(
<a name="l00853"></a>00853                                          <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00854"></a>00854                                          <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET
<a name="l00855"></a>00855                                        ));
<a name="l00856"></a>00856 
<a name="l00857"></a>00857     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;publicSetPersistentData(<span class="stringliteral">&#39;access_token&#39;</span>,
<a name="l00858"></a>00858                                        self::$kExpiredAccessToken);
<a name="l00859"></a>00859     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;publicSetPersistentData(<span class="stringliteral">&#39;user_id&#39;</span>, 12345);
<a name="l00860"></a>00860     $this-&gt;assertEquals(self::$kExpiredAccessToken,
<a name="l00861"></a>00861                         <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getAccessToken(),
<a name="l00862"></a>00862                         <span class="stringliteral">&#39;Get access token from persistent store.&#39;</span>);
<a name="l00863"></a>00863     $this-&gt;assertEquals(<span class="stringliteral">&#39;12345&#39;</span>,
<a name="l00864"></a>00864                         <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getUser(),
<a name="l00865"></a>00865                         <span class="stringliteral">&#39;Get user id from persistent store.&#39;</span>);
<a name="l00866"></a>00866   }
<a name="l00867"></a>00867 
<a name="l00868"></a><a class="code" href="classPHPSDKTestCase.html#a328f26b2144da7b04a061b90be8d7389">00868</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a328f26b2144da7b04a061b90be8d7389">testGetUserAndAccessTokenFromSignedRequestNotSession</a>() {
<a name="l00869"></a>00869     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classPersistentFBPublic.html">PersistentFBPublic</a>(array(
<a name="l00870"></a>00870                                          <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00871"></a>00871                                          <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET
<a name="l00872"></a>00872                                        ));
<a name="l00873"></a>00873 
<a name="l00874"></a>00874     $_REQUEST[<span class="stringliteral">&#39;signed_request&#39;</span>] = <a class="code" href="classPHPSDKTestCase.html#a6bd8d63d2a2cb372b67d5f218c685e14">self::kValidSignedRequest</a>();
<a name="l00875"></a>00875     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;publicSetPersistentData(<span class="stringliteral">&#39;user_id&#39;</span>, 41572);
<a name="l00876"></a>00876     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;publicSetPersistentData(<span class="stringliteral">&#39;access_token&#39;</span>,
<a name="l00877"></a>00877                                        self::$kExpiredAccessToken);
<a name="l00878"></a>00878     $this-&gt;assertNotEquals(<span class="stringliteral">&#39;41572&#39;</span>, <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getUser(),
<a name="l00879"></a>00879                            <span class="stringliteral">&#39;Got user from session instead of signed request.&#39;</span>);
<a name="l00880"></a>00880     $this-&gt;assertEquals(<span class="stringliteral">&#39;499834690&#39;</span>, <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getUser(),
<a name="l00881"></a>00881                         <span class="stringliteral">&#39;Failed to get correct user ID from signed request.&#39;</span>);
<a name="l00882"></a>00882     $this-&gt;assertNotEquals(
<a name="l00883"></a>00883       self::$kExpiredAccessToken,
<a name="l00884"></a>00884       <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getAccessToken(),
<a name="l00885"></a>00885       <span class="stringliteral">&#39;Got access token from session instead of signed request.&#39;</span>);
<a name="l00886"></a>00886     $this-&gt;assertNotEmpty(
<a name="l00887"></a>00887       <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getAccessToken(),
<a name="l00888"></a>00888       <span class="stringliteral">&#39;Failed to extract an access token from the signed request.&#39;</span>);
<a name="l00889"></a>00889   }
<a name="l00890"></a>00890 
<a name="l00891"></a><a class="code" href="classPHPSDKTestCase.html#a5ae70b92bf4c16a49d2a9a21f66d9b83">00891</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a5ae70b92bf4c16a49d2a9a21f66d9b83">testGetUserWithoutCodeOrSignedRequestOrSession</a>() {
<a name="l00892"></a>00892     <a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a> = <span class="keyword">new</span> <a class="code" href="classPersistentFBPublic.html">PersistentFBPublic</a>(array(
<a name="l00893"></a>00893                                          <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00894"></a>00894                                          <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET
<a name="l00895"></a>00895                                        ));
<a name="l00896"></a>00896 
<a name="l00897"></a>00897     <span class="comment">// deliberately leave $_REQUEST and _$SESSION empty</span>
<a name="l00898"></a>00898     $this-&gt;assertEmpty($_REQUEST,
<a name="l00899"></a>00899                        <span class="stringliteral">&#39;GET, POST, and COOKIE params exist even though &#39;</span>.
<a name="l00900"></a>00900                        <span class="stringliteral">&#39;they should.  Test cannot succeed unless all of &#39;</span>.
<a name="l00901"></a>00901                        <span class="stringliteral">&#39;$_REQUEST is empty.&#39;</span>);
<a name="l00902"></a>00902     $this-&gt;assertEmpty(<a class="code" href="session_8php.html#ad56c24858a88af52e4da3ae2f6a2b3b0">$_SESSION</a>,
<a name="l00903"></a>00903                        <span class="stringliteral">&#39;Session is carrying state and should not be.&#39;</span>);
<a name="l00904"></a>00904     $this-&gt;assertEmpty(<a class="code" href="example_8php.html#a4b9bb5e9f7a5ea9381bdbe31c44e9339" title="Copyright 2011 Facebook, Inc.">$facebook</a>-&gt;getUser(),
<a name="l00905"></a>00905                        <span class="stringliteral">&#39;Got a user id, even without a signed request, &#39;</span>.
<a name="l00906"></a>00906                        <span class="stringliteral">&#39;access token, or session variable.&#39;</span>);
<a name="l00907"></a>00907     $this-&gt;assertEmpty(<a class="code" href="session_8php.html#ad56c24858a88af52e4da3ae2f6a2b3b0">$_SESSION</a>,
<a name="l00908"></a>00908                        <span class="stringliteral">&#39;Session superglobal incorrectly populated by getUser.&#39;</span>);
<a name="l00909"></a>00909   }
<a name="l00910"></a>00910 
<a name="l00911"></a><a class="code" href="classPHPSDKTestCase.html#aae497b03dde955da1f478346fe2d91bb">00911</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#aae497b03dde955da1f478346fe2d91bb">testGetAccessTokenUsingCodeInJsSdkCookie</a>() {
<a name="l00912"></a>00912     $code = <span class="stringliteral">&#39;code1&#39;</span>;
<a name="l00913"></a>00913     $access_token = <span class="stringliteral">&#39;at1&#39;</span>;
<a name="l00914"></a>00914     $methods_to_stub = array(<span class="stringliteral">&#39;getSignedRequest&#39;</span>, <span class="stringliteral">&#39;getAccessTokenFromCode&#39;</span>);
<a name="l00915"></a>00915     $constructor_args = array(array(
<a name="l00916"></a>00916       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00917"></a>00917       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET
<a name="l00918"></a>00918     ));
<a name="l00919"></a>00919     $stub = $this-&gt;getMock(
<a name="l00920"></a>00920       <span class="stringliteral">&#39;TransientFacebook&#39;</span>, $methods_to_stub, $constructor_args);
<a name="l00921"></a>00921     $stub
<a name="l00922"></a>00922       -&gt;expects($this-&gt;once())
<a name="l00923"></a>00923       -&gt;method(<span class="stringliteral">&#39;getSignedRequest&#39;</span>)
<a name="l00924"></a>00924       -&gt;will($this-&gt;returnValue(array(<span class="stringliteral">&#39;code&#39;</span> =&gt; $code)));
<a name="l00925"></a>00925     $stub
<a name="l00926"></a>00926       -&gt;expects($this-&gt;once())
<a name="l00927"></a>00927       -&gt;method(<span class="stringliteral">&#39;getAccessTokenFromCode&#39;</span>)
<a name="l00928"></a>00928       -&gt;will($this-&gt;returnValueMap(array(array($code, <span class="stringliteral">&#39;&#39;</span>, $access_token))));
<a name="l00929"></a>00929     $this-&gt;assertEquals($stub-&gt;getAccessToken(), $access_token);
<a name="l00930"></a>00930   }
<a name="l00931"></a>00931 
<a name="l00932"></a><a class="code" href="classPHPSDKTestCase.html#ab99897d94c9870e3012c972baccb95d8">00932</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#ab99897d94c9870e3012c972baccb95d8">testSignedRequestWithoutAuthClearsData</a>() {
<a name="l00933"></a>00933     $methods_to_stub = array(<span class="stringliteral">&#39;getSignedRequest&#39;</span>, <span class="stringliteral">&#39;clearAllPersistentData&#39;</span>);
<a name="l00934"></a>00934     $constructor_args = array(array(
<a name="l00935"></a>00935       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00936"></a>00936       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET
<a name="l00937"></a>00937     ));
<a name="l00938"></a>00938     $stub = $this-&gt;getMock(
<a name="l00939"></a>00939       <span class="stringliteral">&#39;TransientFacebook&#39;</span>, $methods_to_stub, $constructor_args);
<a name="l00940"></a>00940     $stub
<a name="l00941"></a>00941       -&gt;expects($this-&gt;once())
<a name="l00942"></a>00942       -&gt;method(<span class="stringliteral">&#39;getSignedRequest&#39;</span>)
<a name="l00943"></a>00943       -&gt;will($this-&gt;returnValue(array(<span class="stringliteral">&#39;foo&#39;</span> =&gt; 1)));
<a name="l00944"></a>00944     $stub
<a name="l00945"></a>00945       -&gt;expects($this-&gt;once())
<a name="l00946"></a>00946       -&gt;method(<span class="stringliteral">&#39;clearAllPersistentData&#39;</span>);
<a name="l00947"></a>00947     $this-&gt;assertEquals(self::APP_ID.<span class="charliteral">&#39;|&#39;</span>.self::SECRET, $stub-&gt;getAccessToken());
<a name="l00948"></a>00948   }
<a name="l00949"></a>00949 
<a name="l00950"></a><a class="code" href="classPHPSDKTestCase.html#afadfcabeb2b2931c399f031baa8e3a6b">00950</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#afadfcabeb2b2931c399f031baa8e3a6b">testInvalidCodeInSignedRequestWillClearData</a>() {
<a name="l00951"></a>00951     $code = <span class="stringliteral">&#39;code1&#39;</span>;
<a name="l00952"></a>00952     $methods_to_stub = array(
<a name="l00953"></a>00953       <span class="stringliteral">&#39;getSignedRequest&#39;</span>,
<a name="l00954"></a>00954       <span class="stringliteral">&#39;getAccessTokenFromCode&#39;</span>,
<a name="l00955"></a>00955       <span class="stringliteral">&#39;clearAllPersistentData&#39;</span>,
<a name="l00956"></a>00956     );
<a name="l00957"></a>00957     $constructor_args = array(array(
<a name="l00958"></a>00958       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00959"></a>00959       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET
<a name="l00960"></a>00960     ));
<a name="l00961"></a>00961     $stub = $this-&gt;getMock(
<a name="l00962"></a>00962       <span class="stringliteral">&#39;TransientFacebook&#39;</span>, $methods_to_stub, $constructor_args);
<a name="l00963"></a>00963     $stub
<a name="l00964"></a>00964       -&gt;expects($this-&gt;once())
<a name="l00965"></a>00965       -&gt;method(<span class="stringliteral">&#39;getSignedRequest&#39;</span>)
<a name="l00966"></a>00966       -&gt;will($this-&gt;returnValue(array(<span class="stringliteral">&#39;code&#39;</span> =&gt; $code)));
<a name="l00967"></a>00967     $stub
<a name="l00968"></a>00968       -&gt;expects($this-&gt;once())
<a name="l00969"></a>00969       -&gt;method(<span class="stringliteral">&#39;getAccessTokenFromCode&#39;</span>)
<a name="l00970"></a>00970       -&gt;will($this-&gt;returnValue(null));
<a name="l00971"></a>00971     $stub
<a name="l00972"></a>00972       -&gt;expects($this-&gt;once())
<a name="l00973"></a>00973       -&gt;method(<span class="stringliteral">&#39;clearAllPersistentData&#39;</span>);
<a name="l00974"></a>00974     $this-&gt;assertEquals(self::APP_ID.<span class="charliteral">&#39;|&#39;</span>.self::SECRET, $stub-&gt;getAccessToken());
<a name="l00975"></a>00975   }
<a name="l00976"></a>00976 
<a name="l00977"></a><a class="code" href="classPHPSDKTestCase.html#a324e200041a7237285e12f055bb05b97">00977</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a324e200041a7237285e12f055bb05b97">testInvalidCodeWillClearData</a>() {
<a name="l00978"></a>00978     $code = <span class="stringliteral">&#39;code1&#39;</span>;
<a name="l00979"></a>00979     $methods_to_stub = array(
<a name="l00980"></a>00980       <span class="stringliteral">&#39;getCode&#39;</span>,
<a name="l00981"></a>00981       <span class="stringliteral">&#39;getAccessTokenFromCode&#39;</span>,
<a name="l00982"></a>00982       <span class="stringliteral">&#39;clearAllPersistentData&#39;</span>,
<a name="l00983"></a>00983     );
<a name="l00984"></a>00984     $constructor_args = array(array(
<a name="l00985"></a>00985       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l00986"></a>00986       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET
<a name="l00987"></a>00987     ));
<a name="l00988"></a>00988     $stub = $this-&gt;getMock(
<a name="l00989"></a>00989       <span class="stringliteral">&#39;TransientFacebook&#39;</span>, $methods_to_stub, $constructor_args);
<a name="l00990"></a>00990     $stub
<a name="l00991"></a>00991       -&gt;expects($this-&gt;once())
<a name="l00992"></a>00992       -&gt;method(<span class="stringliteral">&#39;getCode&#39;</span>)
<a name="l00993"></a>00993       -&gt;will($this-&gt;returnValue($code));
<a name="l00994"></a>00994     $stub
<a name="l00995"></a>00995       -&gt;expects($this-&gt;once())
<a name="l00996"></a>00996       -&gt;method(<span class="stringliteral">&#39;getAccessTokenFromCode&#39;</span>)
<a name="l00997"></a>00997       -&gt;will($this-&gt;returnValue(null));
<a name="l00998"></a>00998     $stub
<a name="l00999"></a>00999       -&gt;expects($this-&gt;once())
<a name="l01000"></a>01000       -&gt;method(<span class="stringliteral">&#39;clearAllPersistentData&#39;</span>);
<a name="l01001"></a>01001     $this-&gt;assertEquals(self::APP_ID.<span class="charliteral">&#39;|&#39;</span>.self::SECRET, $stub-&gt;getAccessToken());
<a name="l01002"></a>01002   }
<a name="l01003"></a>01003 
<a name="l01004"></a><a class="code" href="classPHPSDKTestCase.html#a415171dfef9b90c3317a29aa81d981b4">01004</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a415171dfef9b90c3317a29aa81d981b4">testValidCodeToToken</a>() {
<a name="l01005"></a>01005     $code = <span class="stringliteral">&#39;code1&#39;</span>;
<a name="l01006"></a>01006     $access_token = <span class="stringliteral">&#39;at1&#39;</span>;
<a name="l01007"></a>01007     $methods_to_stub = array(
<a name="l01008"></a>01008       <span class="stringliteral">&#39;getSignedRequest&#39;</span>,
<a name="l01009"></a>01009       <span class="stringliteral">&#39;getCode&#39;</span>,
<a name="l01010"></a>01010       <span class="stringliteral">&#39;getAccessTokenFromCode&#39;</span>,
<a name="l01011"></a>01011     );
<a name="l01012"></a>01012     $constructor_args = array(array(
<a name="l01013"></a>01013       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01014"></a>01014       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET
<a name="l01015"></a>01015     ));
<a name="l01016"></a>01016     $stub = $this-&gt;getMock(
<a name="l01017"></a>01017       <span class="stringliteral">&#39;TransientFacebook&#39;</span>, $methods_to_stub, $constructor_args);
<a name="l01018"></a>01018     $stub
<a name="l01019"></a>01019       -&gt;expects($this-&gt;once())
<a name="l01020"></a>01020       -&gt;method(<span class="stringliteral">&#39;getCode&#39;</span>)
<a name="l01021"></a>01021       -&gt;will($this-&gt;returnValue($code));
<a name="l01022"></a>01022     $stub
<a name="l01023"></a>01023       -&gt;expects($this-&gt;once())
<a name="l01024"></a>01024       -&gt;method(<span class="stringliteral">&#39;getAccessTokenFromCode&#39;</span>)
<a name="l01025"></a>01025       -&gt;will($this-&gt;returnValueMap(array(array($code, null, $access_token))));
<a name="l01026"></a>01026     $this-&gt;assertEquals($stub-&gt;getAccessToken(), $access_token);
<a name="l01027"></a>01027   }
<a name="l01028"></a>01028 
<a name="l01029"></a><a class="code" href="classPHPSDKTestCase.html#a58a6a94f7b892cf498cb56d109a3e8c1">01029</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a58a6a94f7b892cf498cb56d109a3e8c1">testSignedRequestWithoutAuthClearsDataInAvailData</a>() {
<a name="l01030"></a>01030     $methods_to_stub = array(<span class="stringliteral">&#39;getSignedRequest&#39;</span>, <span class="stringliteral">&#39;clearAllPersistentData&#39;</span>);
<a name="l01031"></a>01031     $constructor_args = array(array(
<a name="l01032"></a>01032       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01033"></a>01033       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET
<a name="l01034"></a>01034     ));
<a name="l01035"></a>01035     $stub = $this-&gt;getMock(
<a name="l01036"></a>01036       <span class="stringliteral">&#39;TransientFacebook&#39;</span>, $methods_to_stub, $constructor_args);
<a name="l01037"></a>01037     $stub
<a name="l01038"></a>01038       -&gt;expects($this-&gt;once())
<a name="l01039"></a>01039       -&gt;method(<span class="stringliteral">&#39;getSignedRequest&#39;</span>)
<a name="l01040"></a>01040       -&gt;will($this-&gt;returnValue(array(<span class="stringliteral">&#39;foo&#39;</span> =&gt; 1)));
<a name="l01041"></a>01041     $stub
<a name="l01042"></a>01042       -&gt;expects($this-&gt;once())
<a name="l01043"></a>01043       -&gt;method(<span class="stringliteral">&#39;clearAllPersistentData&#39;</span>);
<a name="l01044"></a>01044     $this-&gt;assertEquals(0, $stub-&gt;getUser());
<a name="l01045"></a>01045   }
<a name="l01046"></a>01046 
<a name="l01047"></a><a class="code" href="classPHPSDKTestCase.html#a8cbb9e73d69d8326793b87e956ee451b">01047</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a8cbb9e73d69d8326793b87e956ee451b">testFailedToGetUserFromAccessTokenClearsData</a>() {
<a name="l01048"></a>01048     $methods_to_stub = array(
<a name="l01049"></a>01049       <span class="stringliteral">&#39;getAccessToken&#39;</span>,
<a name="l01050"></a>01050       <span class="stringliteral">&#39;getUserFromAccessToken&#39;</span>,
<a name="l01051"></a>01051       <span class="stringliteral">&#39;clearAllPersistentData&#39;</span>,
<a name="l01052"></a>01052     );
<a name="l01053"></a>01053     $constructor_args = array(array(
<a name="l01054"></a>01054       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01055"></a>01055       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET
<a name="l01056"></a>01056     ));
<a name="l01057"></a>01057     $stub = $this-&gt;getMock(
<a name="l01058"></a>01058       <span class="stringliteral">&#39;TransientFacebook&#39;</span>, $methods_to_stub, $constructor_args);
<a name="l01059"></a>01059     $stub
<a name="l01060"></a>01060       -&gt;expects($this-&gt;once())
<a name="l01061"></a>01061       -&gt;method(<span class="stringliteral">&#39;getAccessToken&#39;</span>)
<a name="l01062"></a>01062       -&gt;will($this-&gt;returnValue(<span class="stringliteral">&#39;at1&#39;</span>));
<a name="l01063"></a>01063     $stub
<a name="l01064"></a>01064       -&gt;expects($this-&gt;once())
<a name="l01065"></a>01065       -&gt;method(<span class="stringliteral">&#39;getUserFromAccessToken&#39;</span>);
<a name="l01066"></a>01066     $stub
<a name="l01067"></a>01067       -&gt;expects($this-&gt;once())
<a name="l01068"></a>01068       -&gt;method(<span class="stringliteral">&#39;clearAllPersistentData&#39;</span>);
<a name="l01069"></a>01069     $this-&gt;assertEquals(0, $stub-&gt;getUser());
<a name="l01070"></a>01070   }
<a name="l01071"></a>01071 
<a name="l01072"></a><a class="code" href="classPHPSDKTestCase.html#a275c65f20ab70f77a560b058f7a4a55f">01072</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a275c65f20ab70f77a560b058f7a4a55f">testUserFromAccessTokenIsStored</a>() {
<a name="l01073"></a>01073     $methods_to_stub = array(
<a name="l01074"></a>01074       <span class="stringliteral">&#39;getAccessToken&#39;</span>,
<a name="l01075"></a>01075       <span class="stringliteral">&#39;getUserFromAccessToken&#39;</span>,
<a name="l01076"></a>01076       <span class="stringliteral">&#39;setPersistentData&#39;</span>,
<a name="l01077"></a>01077     );
<a name="l01078"></a>01078     $constructor_args = array(array(
<a name="l01079"></a>01079       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01080"></a>01080       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET
<a name="l01081"></a>01081     ));
<a name="l01082"></a>01082     <a class="code" href="example_8php.html#a598ca4e71b15a1313ec95f0df1027ca5">$user</a> = 42;
<a name="l01083"></a>01083     $stub = $this-&gt;getMock(
<a name="l01084"></a>01084       <span class="stringliteral">&#39;TransientFacebook&#39;</span>, $methods_to_stub, $constructor_args);
<a name="l01085"></a>01085     $stub
<a name="l01086"></a>01086       -&gt;expects($this-&gt;once())
<a name="l01087"></a>01087       -&gt;method(<span class="stringliteral">&#39;getAccessToken&#39;</span>)
<a name="l01088"></a>01088       -&gt;will($this-&gt;returnValue(<span class="stringliteral">&#39;at1&#39;</span>));
<a name="l01089"></a>01089     $stub
<a name="l01090"></a>01090       -&gt;expects($this-&gt;once())
<a name="l01091"></a>01091       -&gt;method(<span class="stringliteral">&#39;getUserFromAccessToken&#39;</span>)
<a name="l01092"></a>01092       -&gt;will($this-&gt;returnValue(<a class="code" href="example_8php.html#a598ca4e71b15a1313ec95f0df1027ca5">$user</a>));
<a name="l01093"></a>01093     $stub
<a name="l01094"></a>01094       -&gt;expects($this-&gt;once())
<a name="l01095"></a>01095       -&gt;method(<span class="stringliteral">&#39;setPersistentData&#39;</span>);
<a name="l01096"></a>01096     $this-&gt;assertEquals(<a class="code" href="example_8php.html#a598ca4e71b15a1313ec95f0df1027ca5">$user</a>, $stub-&gt;getUser());
<a name="l01097"></a>01097   }
<a name="l01098"></a>01098 
<a name="l01099"></a><a class="code" href="classPHPSDKTestCase.html#a90488e16a9100181e384e3a90b74d2e2">01099</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a90488e16a9100181e384e3a90b74d2e2">testUserFromAccessTokenPullsID</a>() {
<a name="l01100"></a>01100     $methods_to_stub = array(
<a name="l01101"></a>01101       <span class="stringliteral">&#39;getAccessToken&#39;</span>,
<a name="l01102"></a>01102       <span class="stringliteral">&#39;api&#39;</span>,
<a name="l01103"></a>01103     );
<a name="l01104"></a>01104     $constructor_args = array(array(
<a name="l01105"></a>01105       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01106"></a>01106       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET
<a name="l01107"></a>01107     ));
<a name="l01108"></a>01108     <a class="code" href="example_8php.html#a598ca4e71b15a1313ec95f0df1027ca5">$user</a> = 42;
<a name="l01109"></a>01109     $stub = $this-&gt;getMock(
<a name="l01110"></a>01110       <span class="stringliteral">&#39;TransientFacebook&#39;</span>, $methods_to_stub, $constructor_args);
<a name="l01111"></a>01111     $stub
<a name="l01112"></a>01112       -&gt;expects($this-&gt;once())
<a name="l01113"></a>01113       -&gt;method(<span class="stringliteral">&#39;getAccessToken&#39;</span>)
<a name="l01114"></a>01114       -&gt;will($this-&gt;returnValue(<span class="stringliteral">&#39;at1&#39;</span>));
<a name="l01115"></a>01115     $stub
<a name="l01116"></a>01116       -&gt;expects($this-&gt;once())
<a name="l01117"></a>01117       -&gt;method(<span class="stringliteral">&#39;api&#39;</span>)
<a name="l01118"></a>01118       -&gt;will($this-&gt;returnValue(array(<span class="stringliteral">&#39;id&#39;</span> =&gt; <a class="code" href="example_8php.html#a598ca4e71b15a1313ec95f0df1027ca5">$user</a>)));
<a name="l01119"></a>01119     $this-&gt;assertEquals(<a class="code" href="example_8php.html#a598ca4e71b15a1313ec95f0df1027ca5">$user</a>, $stub-&gt;getUser());
<a name="l01120"></a>01120   }
<a name="l01121"></a>01121 
<a name="l01122"></a><a class="code" href="classPHPSDKTestCase.html#a3d11a2e9ebc35c201fd1ff17b12e938f">01122</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a3d11a2e9ebc35c201fd1ff17b12e938f">testUserFromAccessTokenResetsOnApiException</a>() {
<a name="l01123"></a>01123     $methods_to_stub = array(
<a name="l01124"></a>01124       <span class="stringliteral">&#39;getAccessToken&#39;</span>,
<a name="l01125"></a>01125       <span class="stringliteral">&#39;clearAllPersistentData&#39;</span>,
<a name="l01126"></a>01126       <span class="stringliteral">&#39;api&#39;</span>,
<a name="l01127"></a>01127     );
<a name="l01128"></a>01128     $constructor_args = array(array(
<a name="l01129"></a>01129       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01130"></a>01130       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET
<a name="l01131"></a>01131     ));
<a name="l01132"></a>01132     $stub = $this-&gt;getMock(
<a name="l01133"></a>01133       <span class="stringliteral">&#39;TransientFacebook&#39;</span>, $methods_to_stub, $constructor_args);
<a name="l01134"></a>01134     $stub
<a name="l01135"></a>01135       -&gt;expects($this-&gt;once())
<a name="l01136"></a>01136       -&gt;method(<span class="stringliteral">&#39;getAccessToken&#39;</span>)
<a name="l01137"></a>01137       -&gt;will($this-&gt;returnValue(<span class="stringliteral">&#39;at1&#39;</span>));
<a name="l01138"></a>01138     $stub
<a name="l01139"></a>01139       -&gt;expects($this-&gt;once())
<a name="l01140"></a>01140       -&gt;method(<span class="stringliteral">&#39;api&#39;</span>)
<a name="l01141"></a>01141       -&gt;will($this-&gt;throwException(<span class="keyword">new</span> <a class="code" href="classFacebookApiException.html" title="Copyright 2011 Facebook, Inc.">FacebookApiException</a>(<span class="keyword">false</span>)));
<a name="l01142"></a>01142     $stub
<a name="l01143"></a>01143       -&gt;expects($this-&gt;once())
<a name="l01144"></a>01144       -&gt;method(<span class="stringliteral">&#39;clearAllPersistentData&#39;</span>);
<a name="l01145"></a>01145     $this-&gt;assertEquals(0, $stub-&gt;getUser());
<a name="l01146"></a>01146   }
<a name="l01147"></a>01147 
<a name="l01148"></a><a class="code" href="classPHPSDKTestCase.html#a55c23081626ba476a1993d93b947bcb0">01148</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a55c23081626ba476a1993d93b947bcb0">testEmptyCodeReturnsFalse</a>() {
<a name="l01149"></a>01149     $fb = <span class="keyword">new</span> <a class="code" href="classFBPublicGetAccessTokenFromCode.html">FBPublicGetAccessTokenFromCode</a>(array(
<a name="l01150"></a>01150       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01151"></a>01151       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET
<a name="l01152"></a>01152     ));
<a name="l01153"></a>01153     $this-&gt;assertFalse($fb-&gt;publicGetAccessTokenFromCode(<span class="stringliteral">&#39;&#39;</span>));
<a name="l01154"></a>01154     $this-&gt;assertFalse($fb-&gt;publicGetAccessTokenFromCode(null));
<a name="l01155"></a>01155     $this-&gt;assertFalse($fb-&gt;publicGetAccessTokenFromCode(<span class="keyword">false</span>));
<a name="l01156"></a>01156   }
<a name="l01157"></a>01157 
<a name="l01158"></a><a class="code" href="classPHPSDKTestCase.html#a993652db1ebfac3e8d5ba10341aabf6c">01158</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a993652db1ebfac3e8d5ba10341aabf6c">testNullRedirectURIUsesCurrentURL</a>() {
<a name="l01159"></a>01159     $methods_to_stub = array(
<a name="l01160"></a>01160       <span class="stringliteral">&#39;_oauthRequest&#39;</span>,
<a name="l01161"></a>01161       <span class="stringliteral">&#39;getCurrentUrl&#39;</span>,
<a name="l01162"></a>01162     );
<a name="l01163"></a>01163     $constructor_args = array(array(
<a name="l01164"></a>01164       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01165"></a>01165       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET
<a name="l01166"></a>01166     ));
<a name="l01167"></a>01167     $access_token = <span class="stringliteral">&#39;at1&#39;</span>;
<a name="l01168"></a>01168     $stub = $this-&gt;getMock(
<a name="l01169"></a>01169       <span class="stringliteral">&#39;FBPublicGetAccessTokenFromCode&#39;</span>, $methods_to_stub, $constructor_args);
<a name="l01170"></a>01170     $stub
<a name="l01171"></a>01171       -&gt;expects($this-&gt;once())
<a name="l01172"></a>01172       -&gt;method(<span class="stringliteral">&#39;_oauthRequest&#39;</span>)
<a name="l01173"></a>01173       -&gt;will($this-&gt;returnValue(<span class="stringliteral">&quot;access_token=$access_token&quot;</span>));
<a name="l01174"></a>01174     $stub
<a name="l01175"></a>01175       -&gt;expects($this-&gt;once())
<a name="l01176"></a>01176       -&gt;method(<span class="stringliteral">&#39;getCurrentUrl&#39;</span>);
<a name="l01177"></a>01177     $this-&gt;assertEquals(
<a name="l01178"></a>01178       $access_token, $stub-&gt;publicGetAccessTokenFromCode(<span class="charliteral">&#39;c&#39;</span>));
<a name="l01179"></a>01179   }
<a name="l01180"></a>01180 
<a name="l01181"></a><a class="code" href="classPHPSDKTestCase.html#a000d6a8460620cded4c1b68f14cbed68">01181</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a000d6a8460620cded4c1b68f14cbed68">testNullRedirectURIAllowsEmptyStringForCookie</a>() {
<a name="l01182"></a>01182     $methods_to_stub = array(
<a name="l01183"></a>01183       <span class="stringliteral">&#39;_oauthRequest&#39;</span>,
<a name="l01184"></a>01184       <span class="stringliteral">&#39;getCurrentUrl&#39;</span>,
<a name="l01185"></a>01185     );
<a name="l01186"></a>01186     $constructor_args = array(array(
<a name="l01187"></a>01187       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01188"></a>01188       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET
<a name="l01189"></a>01189     ));
<a name="l01190"></a>01190     $access_token = <span class="stringliteral">&#39;at1&#39;</span>;
<a name="l01191"></a>01191     $stub = $this-&gt;getMock(
<a name="l01192"></a>01192       <span class="stringliteral">&#39;FBPublicGetAccessTokenFromCode&#39;</span>, $methods_to_stub, $constructor_args);
<a name="l01193"></a>01193     $stub
<a name="l01194"></a>01194       -&gt;expects($this-&gt;once())
<a name="l01195"></a>01195       -&gt;method(<span class="stringliteral">&#39;_oauthRequest&#39;</span>)
<a name="l01196"></a>01196       -&gt;will($this-&gt;returnValue(<span class="stringliteral">&quot;access_token=$access_token&quot;</span>));
<a name="l01197"></a>01197     $stub
<a name="l01198"></a>01198       -&gt;expects($this-&gt;never())
<a name="l01199"></a>01199       -&gt;method(<span class="stringliteral">&#39;getCurrentUrl&#39;</span>);
<a name="l01200"></a>01200     $this-&gt;assertEquals(
<a name="l01201"></a>01201       $access_token, $stub-&gt;publicGetAccessTokenFromCode(<span class="charliteral">&#39;c&#39;</span>, <span class="stringliteral">&#39;&#39;</span>));
<a name="l01202"></a>01202   }
<a name="l01203"></a>01203 
<a name="l01204"></a><a class="code" href="classPHPSDKTestCase.html#a92aee8b6b6deca395fe1029c8b7350d4">01204</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a92aee8b6b6deca395fe1029c8b7350d4">testAPIExceptionDuringCodeExchangeIsIgnored</a>() {
<a name="l01205"></a>01205     $methods_to_stub = array(
<a name="l01206"></a>01206       <span class="stringliteral">&#39;_oauthRequest&#39;</span>,
<a name="l01207"></a>01207     );
<a name="l01208"></a>01208     $constructor_args = array(array(
<a name="l01209"></a>01209       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01210"></a>01210       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET
<a name="l01211"></a>01211     ));
<a name="l01212"></a>01212     $stub = $this-&gt;getMock(
<a name="l01213"></a>01213       <span class="stringliteral">&#39;FBPublicGetAccessTokenFromCode&#39;</span>, $methods_to_stub, $constructor_args);
<a name="l01214"></a>01214     $stub
<a name="l01215"></a>01215       -&gt;expects($this-&gt;once())
<a name="l01216"></a>01216       -&gt;method(<span class="stringliteral">&#39;_oauthRequest&#39;</span>)
<a name="l01217"></a>01217       -&gt;will($this-&gt;throwException(<span class="keyword">new</span> <a class="code" href="classFacebookApiException.html" title="Copyright 2011 Facebook, Inc.">FacebookApiException</a>(<span class="keyword">false</span>)));
<a name="l01218"></a>01218     $this-&gt;assertFalse($stub-&gt;publicGetAccessTokenFromCode(<span class="charliteral">&#39;c&#39;</span>, <span class="stringliteral">&#39;&#39;</span>));
<a name="l01219"></a>01219   }
<a name="l01220"></a>01220 
<a name="l01221"></a><a class="code" href="classPHPSDKTestCase.html#ac4ee09e7314459103236a986f78243f1">01221</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#ac4ee09e7314459103236a986f78243f1">testEmptyResponseInCodeExchangeIsIgnored</a>() {
<a name="l01222"></a>01222     $methods_to_stub = array(
<a name="l01223"></a>01223       <span class="stringliteral">&#39;_oauthRequest&#39;</span>,
<a name="l01224"></a>01224     );
<a name="l01225"></a>01225     $constructor_args = array(array(
<a name="l01226"></a>01226       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01227"></a>01227       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET
<a name="l01228"></a>01228     ));
<a name="l01229"></a>01229     $stub = $this-&gt;getMock(
<a name="l01230"></a>01230       <span class="stringliteral">&#39;FBPublicGetAccessTokenFromCode&#39;</span>, $methods_to_stub, $constructor_args);
<a name="l01231"></a>01231     $stub
<a name="l01232"></a>01232       -&gt;expects($this-&gt;once())
<a name="l01233"></a>01233       -&gt;method(<span class="stringliteral">&#39;_oauthRequest&#39;</span>)
<a name="l01234"></a>01234       -&gt;will($this-&gt;returnValue(<span class="stringliteral">&#39;&#39;</span>));
<a name="l01235"></a>01235     $this-&gt;assertFalse($stub-&gt;publicGetAccessTokenFromCode(<span class="charliteral">&#39;c&#39;</span>, <span class="stringliteral">&#39;&#39;</span>));
<a name="l01236"></a>01236   }
<a name="l01237"></a>01237 
<a name="l01238"></a><a class="code" href="classPHPSDKTestCase.html#ac5c437c3b1dce46c9c45ab672c366d8b">01238</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#ac5c437c3b1dce46c9c45ab672c366d8b">testExistingStateRestoredInConstructor</a>() {
<a name="l01239"></a>01239     $fb = <span class="keyword">new</span> <a class="code" href="classFBPublicState.html">FBPublicState</a>(array(
<a name="l01240"></a>01240       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01241"></a>01241       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET
<a name="l01242"></a>01242     ));
<a name="l01243"></a>01243     $this-&gt;assertEquals(<a class="code" href="classFBPublicState.html#a66ff1d27e9b452eed6697bf502fa213d">FBPublicState::STATE</a>, $fb-&gt;publicGetState());
<a name="l01244"></a>01244   }
<a name="l01245"></a>01245 
<a name="l01246"></a><a class="code" href="classPHPSDKTestCase.html#a28f5a53345ec07b83ae8d871db80b831">01246</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a28f5a53345ec07b83ae8d871db80b831">testMissingAccessTokenInCodeExchangeIsIgnored</a>() {
<a name="l01247"></a>01247     $methods_to_stub = array(
<a name="l01248"></a>01248       <span class="stringliteral">&#39;_oauthRequest&#39;</span>,
<a name="l01249"></a>01249     );
<a name="l01250"></a>01250     $constructor_args = array(array(
<a name="l01251"></a>01251       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01252"></a>01252       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET
<a name="l01253"></a>01253     ));
<a name="l01254"></a>01254     $stub = $this-&gt;getMock(
<a name="l01255"></a>01255       <span class="stringliteral">&#39;FBPublicGetAccessTokenFromCode&#39;</span>, $methods_to_stub, $constructor_args);
<a name="l01256"></a>01256     $stub
<a name="l01257"></a>01257       -&gt;expects($this-&gt;once())
<a name="l01258"></a>01258       -&gt;method(<span class="stringliteral">&#39;_oauthRequest&#39;</span>)
<a name="l01259"></a>01259       -&gt;will($this-&gt;returnValue(<span class="stringliteral">&#39;foo=1&#39;</span>));
<a name="l01260"></a>01260     $this-&gt;assertFalse($stub-&gt;publicGetAccessTokenFromCode(<span class="charliteral">&#39;c&#39;</span>, <span class="stringliteral">&#39;&#39;</span>));
<a name="l01261"></a>01261   }
<a name="l01262"></a>01262 
<a name="l01263"></a><a class="code" href="classPHPSDKTestCase.html#a3709e180a03ebad35f1aac95e270ddbb">01263</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a3709e180a03ebad35f1aac95e270ddbb">testExceptionConstructorWithErrorCode</a>() {
<a name="l01264"></a>01264     $code = 404;
<a name="l01265"></a>01265     $e = <span class="keyword">new</span> <a class="code" href="classFacebookApiException.html" title="Copyright 2011 Facebook, Inc.">FacebookApiException</a>(array(<span class="stringliteral">&#39;error_code&#39;</span> =&gt; $code));
<a name="l01266"></a>01266     $this-&gt;assertEquals($code, $e-&gt;getCode());
<a name="l01267"></a>01267   }
<a name="l01268"></a>01268 
<a name="l01269"></a>01269   <span class="comment">// this happens often despite the fact that it is useless</span>
<a name="l01270"></a><a class="code" href="classPHPSDKTestCase.html#abda2a4db927712b261470d09e4dd3265">01270</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#abda2a4db927712b261470d09e4dd3265">testExceptionTypeFalse</a>() {
<a name="l01271"></a>01271     $e = <span class="keyword">new</span> <a class="code" href="classFacebookApiException.html" title="Copyright 2011 Facebook, Inc.">FacebookApiException</a>(<span class="keyword">false</span>);
<a name="l01272"></a>01272     $this-&gt;assertEquals(<span class="stringliteral">&#39;Exception&#39;</span>, $e-&gt;getType());
<a name="l01273"></a>01273   }
<a name="l01274"></a>01274 
<a name="l01275"></a><a class="code" href="classPHPSDKTestCase.html#a02604f91b7a0b36d8c6318ca6eb2323e">01275</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a02604f91b7a0b36d8c6318ca6eb2323e">testExceptionTypeMixedDraft00</a>() {
<a name="l01276"></a>01276     $e = <span class="keyword">new</span> <a class="code" href="classFacebookApiException.html" title="Copyright 2011 Facebook, Inc.">FacebookApiException</a>(array(<span class="stringliteral">&#39;error&#39;</span> =&gt; array(<span class="stringliteral">&#39;message&#39;</span> =&gt; <span class="stringliteral">&#39;foo&#39;</span>)));
<a name="l01277"></a>01277     $this-&gt;assertEquals(<span class="stringliteral">&#39;Exception&#39;</span>, $e-&gt;getType());
<a name="l01278"></a>01278   }
<a name="l01279"></a>01279 
<a name="l01280"></a><a class="code" href="classPHPSDKTestCase.html#a98a8239bf82dc2de60c1c61729ea4b3b">01280</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a98a8239bf82dc2de60c1c61729ea4b3b">testExceptionTypeDraft00</a>() {
<a name="l01281"></a>01281     $error = <span class="stringliteral">&#39;foo&#39;</span>;
<a name="l01282"></a>01282     $e = <span class="keyword">new</span> <a class="code" href="classFacebookApiException.html" title="Copyright 2011 Facebook, Inc.">FacebookApiException</a>(
<a name="l01283"></a>01283       array(<span class="stringliteral">&#39;error&#39;</span> =&gt; array(<span class="stringliteral">&#39;type&#39;</span> =&gt; $error, <span class="stringliteral">&#39;message&#39;</span> =&gt; <span class="stringliteral">&#39;hello world&#39;</span>)));
<a name="l01284"></a>01284     $this-&gt;assertEquals($error, $e-&gt;getType());
<a name="l01285"></a>01285   }
<a name="l01286"></a>01286 
<a name="l01287"></a><a class="code" href="classPHPSDKTestCase.html#a7c587cbf34510834c933d93ca08fb8af">01287</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a7c587cbf34510834c933d93ca08fb8af">testExceptionTypeDraft10</a>() {
<a name="l01288"></a>01288     $error = <span class="stringliteral">&#39;foo&#39;</span>;
<a name="l01289"></a>01289     $e = <span class="keyword">new</span> <a class="code" href="classFacebookApiException.html" title="Copyright 2011 Facebook, Inc.">FacebookApiException</a>(array(<span class="stringliteral">&#39;error&#39;</span> =&gt; $error));
<a name="l01290"></a>01290     $this-&gt;assertEquals($error, $e-&gt;getType());
<a name="l01291"></a>01291   }
<a name="l01292"></a>01292 
<a name="l01293"></a><a class="code" href="classPHPSDKTestCase.html#a0154b5fb963b822d1dcebd152037c2b4">01293</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a0154b5fb963b822d1dcebd152037c2b4">testExceptionTypeDefault</a>() {
<a name="l01294"></a>01294     $e = <span class="keyword">new</span> <a class="code" href="classFacebookApiException.html" title="Copyright 2011 Facebook, Inc.">FacebookApiException</a>(array(<span class="stringliteral">&#39;error&#39;</span> =&gt; <span class="keyword">false</span>));
<a name="l01295"></a>01295     $this-&gt;assertEquals(<span class="stringliteral">&#39;Exception&#39;</span>, $e-&gt;getType());
<a name="l01296"></a>01296   }
<a name="l01297"></a>01297 
<a name="l01298"></a><a class="code" href="classPHPSDKTestCase.html#a56781c2c8acb5e72c05d2ec853cedb7d">01298</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a56781c2c8acb5e72c05d2ec853cedb7d">testExceptionToString</a>() {
<a name="l01299"></a>01299     $e = <span class="keyword">new</span> <a class="code" href="classFacebookApiException.html" title="Copyright 2011 Facebook, Inc.">FacebookApiException</a>(array(
<a name="l01300"></a>01300       <span class="stringliteral">&#39;error_code&#39;</span> =&gt; 1,
<a name="l01301"></a>01301       <span class="stringliteral">&#39;error_description&#39;</span> =&gt; <span class="stringliteral">&#39;foo&#39;</span>,
<a name="l01302"></a>01302     ));
<a name="l01303"></a>01303     $this-&gt;assertEquals(<span class="stringliteral">&#39;Exception: 1: foo&#39;</span>, (<span class="keywordtype">string</span>) $e);
<a name="l01304"></a>01304   }
<a name="l01305"></a>01305 
<a name="l01306"></a><a class="code" href="classPHPSDKTestCase.html#a8a5cb65f454856e869a1be7e5aa0ebd5">01306</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a8a5cb65f454856e869a1be7e5aa0ebd5">testDestroyClearsCookie</a>() {
<a name="l01307"></a>01307     $fb = <span class="keyword">new</span> <a class="code" href="classFBPublicCookie.html">FBPublicCookie</a>(array(
<a name="l01308"></a>01308       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01309"></a>01309       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l01310"></a>01310     ));
<a name="l01311"></a>01311     $_COOKIE[$fb-&gt;publicGetSignedRequestCookieName()] = <span class="stringliteral">&#39;foo&#39;</span>;
<a name="l01312"></a>01312     $_COOKIE[$fb-&gt;publicGetMetadataCookieName()] = <span class="stringliteral">&#39;base_domain=fbrell.com&#39;</span>;
<a name="l01313"></a>01313     $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>] = <span class="stringliteral">&#39;fbrell.com&#39;</span>;
<a name="l01314"></a>01314     $fb-&gt;destroySession();
<a name="l01315"></a>01315     $this-&gt;assertFalse(
<a name="l01316"></a>01316       array_key_exists($fb-&gt;publicGetSignedRequestCookieName(), $_COOKIE));
<a name="l01317"></a>01317   }
<a name="l01318"></a>01318 
<a name="l01319"></a><a class="code" href="classPHPSDKTestCase.html#a79f1af35a5d18e69c7441b930eb00a82">01319</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a79f1af35a5d18e69c7441b930eb00a82">testAuthExpireSessionDestroysSession</a>() {
<a name="l01320"></a>01320     $methods_to_stub = array(
<a name="l01321"></a>01321       <span class="stringliteral">&#39;_oauthRequest&#39;</span>,
<a name="l01322"></a>01322       <span class="stringliteral">&#39;destroySession&#39;</span>,
<a name="l01323"></a>01323     );
<a name="l01324"></a>01324     $constructor_args = array(array(
<a name="l01325"></a>01325       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01326"></a>01326       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET
<a name="l01327"></a>01327     ));
<a name="l01328"></a>01328     $key = <span class="stringliteral">&#39;foo&#39;</span>;
<a name="l01329"></a>01329     $val = 42;
<a name="l01330"></a>01330     $stub = $this-&gt;getMock(
<a name="l01331"></a>01331       <span class="stringliteral">&#39;TransientFacebook&#39;</span>, $methods_to_stub, $constructor_args);
<a name="l01332"></a>01332     $stub
<a name="l01333"></a>01333       -&gt;expects($this-&gt;once())
<a name="l01334"></a>01334       -&gt;method(<span class="stringliteral">&#39;_oauthRequest&#39;</span>)
<a name="l01335"></a>01335       -&gt;will($this-&gt;returnValue(<span class="stringliteral">&quot;{\&quot;$key\&quot;:$val}&quot;</span>));
<a name="l01336"></a>01336     $stub
<a name="l01337"></a>01337       -&gt;expects($this-&gt;once())
<a name="l01338"></a>01338       -&gt;method(<span class="stringliteral">&#39;destroySession&#39;</span>);
<a name="l01339"></a>01339     $this-&gt;assertEquals(
<a name="l01340"></a>01340       array($key =&gt; $val),
<a name="l01341"></a>01341       $stub-&gt;api(array(<span class="stringliteral">&#39;method&#39;</span> =&gt; <span class="stringliteral">&#39;auth.expireSession&#39;</span>))
<a name="l01342"></a>01342     );
<a name="l01343"></a>01343   }
<a name="l01344"></a>01344 
<a name="l01345"></a><a class="code" href="classPHPSDKTestCase.html#a7337af28888559210ee37a3e5aa9d5d4">01345</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a7337af28888559210ee37a3e5aa9d5d4">testLowercaseAuthRevokeAuthDestroysSession</a>() {
<a name="l01346"></a>01346     $methods_to_stub = array(
<a name="l01347"></a>01347       <span class="stringliteral">&#39;_oauthRequest&#39;</span>,
<a name="l01348"></a>01348       <span class="stringliteral">&#39;destroySession&#39;</span>,
<a name="l01349"></a>01349     );
<a name="l01350"></a>01350     $constructor_args = array(array(
<a name="l01351"></a>01351       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01352"></a>01352       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET
<a name="l01353"></a>01353     ));
<a name="l01354"></a>01354     $key = <span class="stringliteral">&#39;foo&#39;</span>;
<a name="l01355"></a>01355     $val = 42;
<a name="l01356"></a>01356     $stub = $this-&gt;getMock(
<a name="l01357"></a>01357       <span class="stringliteral">&#39;TransientFacebook&#39;</span>, $methods_to_stub, $constructor_args);
<a name="l01358"></a>01358     $stub
<a name="l01359"></a>01359       -&gt;expects($this-&gt;once())
<a name="l01360"></a>01360       -&gt;method(<span class="stringliteral">&#39;_oauthRequest&#39;</span>)
<a name="l01361"></a>01361       -&gt;will($this-&gt;returnValue(<span class="stringliteral">&quot;{\&quot;$key\&quot;:$val}&quot;</span>));
<a name="l01362"></a>01362     $stub
<a name="l01363"></a>01363       -&gt;expects($this-&gt;once())
<a name="l01364"></a>01364       -&gt;method(<span class="stringliteral">&#39;destroySession&#39;</span>);
<a name="l01365"></a>01365     $this-&gt;assertEquals(
<a name="l01366"></a>01366       array($key =&gt; $val),
<a name="l01367"></a>01367       $stub-&gt;api(array(<span class="stringliteral">&#39;method&#39;</span> =&gt; <span class="stringliteral">&#39;auth.revokeauthorization&#39;</span>))
<a name="l01368"></a>01368     );
<a name="l01369"></a>01369   }
<a name="l01370"></a>01370 <span class="comment"></span>
<a name="l01371"></a>01371 <span class="comment">  /**</span>
<a name="l01372"></a>01372 <span class="comment">   * @expectedException FacebookAPIException</span>
<a name="l01373"></a>01373 <span class="comment">   */</span>
<a name="l01374"></a><a class="code" href="classPHPSDKTestCase.html#afbc098e9b46c6410baa1569ef0a90741">01374</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#afbc098e9b46c6410baa1569ef0a90741" title="FacebookAPIException">testErrorCodeFromRestAPIThrowsException</a>() {
<a name="l01375"></a>01375     $methods_to_stub = array(
<a name="l01376"></a>01376       <span class="stringliteral">&#39;_oauthRequest&#39;</span>,
<a name="l01377"></a>01377     );
<a name="l01378"></a>01378     $constructor_args = array(array(
<a name="l01379"></a>01379       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01380"></a>01380       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET
<a name="l01381"></a>01381     ));
<a name="l01382"></a>01382     $stub = $this-&gt;getMock(
<a name="l01383"></a>01383       <span class="stringliteral">&#39;TransientFacebook&#39;</span>, $methods_to_stub, $constructor_args);
<a name="l01384"></a>01384     $stub
<a name="l01385"></a>01385       -&gt;expects($this-&gt;once())
<a name="l01386"></a>01386       -&gt;method(<span class="stringliteral">&#39;_oauthRequest&#39;</span>)
<a name="l01387"></a>01387       -&gt;will($this-&gt;returnValue(<span class="stringliteral">&#39;{&quot;error_code&quot;: 500}&#39;</span>));
<a name="l01388"></a>01388     $stub-&gt;api(array(<span class="stringliteral">&#39;method&#39;</span> =&gt; <span class="stringliteral">&#39;foo&#39;</span>));
<a name="l01389"></a>01389   }
<a name="l01390"></a>01390 
<a name="l01391"></a><a class="code" href="classPHPSDKTestCase.html#ab5c12a7c090049aac1ddb097e334ae67">01391</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#ab5c12a7c090049aac1ddb097e334ae67">testJsonEncodeOfNonStringParams</a>() {
<a name="l01392"></a>01392     $foo = array(1, 2);
<a name="l01393"></a>01393     $params = array(
<a name="l01394"></a>01394       <span class="stringliteral">&#39;method&#39;</span> =&gt; <span class="stringliteral">&#39;get&#39;</span>,
<a name="l01395"></a>01395       <span class="stringliteral">&#39;foo&#39;</span> =&gt; $foo,
<a name="l01396"></a>01396     );
<a name="l01397"></a>01397     $fb = <span class="keyword">new</span> <a class="code" href="classFBRecordMakeRequest.html">FBRecordMakeRequest</a>(array(
<a name="l01398"></a>01398       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01399"></a>01399       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l01400"></a>01400     ));
<a name="l01401"></a>01401     $fb-&gt;api(<span class="stringliteral">&#39;/naitik&#39;</span>, $params);
<a name="l01402"></a>01402     $requests = $fb-&gt;publicGetRequests();
<a name="l01403"></a>01403     $this-&gt;assertEquals(json_encode($foo), $requests[0][<span class="stringliteral">&#39;params&#39;</span>][<span class="stringliteral">&#39;foo&#39;</span>]);
<a name="l01404"></a>01404   }
<a name="l01405"></a>01405 
<a name="l01406"></a><a class="code" href="classPHPSDKTestCase.html#a95838a17975a0c6c1135f01b85c8acbd">01406</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a95838a17975a0c6c1135f01b85c8acbd">testSessionBackedFacebook</a>() {
<a name="l01407"></a>01407     $fb = <span class="keyword">new</span> <a class="code" href="classPersistentFBPublic.html">PersistentFBPublic</a>(array(
<a name="l01408"></a>01408       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01409"></a>01409       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l01410"></a>01410     ));
<a name="l01411"></a>01411     $key = <span class="stringliteral">&#39;state&#39;</span>;
<a name="l01412"></a>01412     $val = <span class="stringliteral">&#39;foo&#39;</span>;
<a name="l01413"></a>01413     $fb-&gt;publicSetPersistentData($key, $val);
<a name="l01414"></a>01414     $this-&gt;assertEquals(
<a name="l01415"></a>01415       $val,
<a name="l01416"></a>01416       <a class="code" href="session_8php.html#ad56c24858a88af52e4da3ae2f6a2b3b0">$_SESSION</a>[sprintf(<span class="stringliteral">&#39;fb_%s_%s&#39;</span>, self::APP_ID, $key)]
<a name="l01417"></a>01417     );
<a name="l01418"></a>01418     $this-&gt;assertEquals(
<a name="l01419"></a>01419       $val,
<a name="l01420"></a>01420       $fb-&gt;publicGetPersistentData($key)
<a name="l01421"></a>01421     );
<a name="l01422"></a>01422   }
<a name="l01423"></a>01423 
<a name="l01424"></a><a class="code" href="classPHPSDKTestCase.html#aaab4a7a32855e5b053d284ee7fa71a0f">01424</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#aaab4a7a32855e5b053d284ee7fa71a0f">testSessionBackedFacebookIgnoresUnsupportedKey</a>() {
<a name="l01425"></a>01425     $fb = <span class="keyword">new</span> <a class="code" href="classPersistentFBPublic.html">PersistentFBPublic</a>(array(
<a name="l01426"></a>01426       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01427"></a>01427       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l01428"></a>01428     ));
<a name="l01429"></a>01429     $key = <span class="stringliteral">&#39;--invalid--&#39;</span>;
<a name="l01430"></a>01430     $val = <span class="stringliteral">&#39;foo&#39;</span>;
<a name="l01431"></a>01431     $fb-&gt;publicSetPersistentData($key, $val);
<a name="l01432"></a>01432     $this-&gt;assertFalse(
<a name="l01433"></a>01433       array_key_exists(
<a name="l01434"></a>01434         sprintf(<span class="stringliteral">&#39;fb_%s_%s&#39;</span>, self::APP_ID, $key),
<a name="l01435"></a>01435         <a class="code" href="session_8php.html#ad56c24858a88af52e4da3ae2f6a2b3b0">$_SESSION</a>
<a name="l01436"></a>01436       )
<a name="l01437"></a>01437     );
<a name="l01438"></a>01438     $this-&gt;assertFalse($fb-&gt;publicGetPersistentData($key));
<a name="l01439"></a>01439   }
<a name="l01440"></a>01440 
<a name="l01441"></a><a class="code" href="classPHPSDKTestCase.html#a77fdd3ed08d0a306518d1212739ce643">01441</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a77fdd3ed08d0a306518d1212739ce643">testClearSessionBackedFacebook</a>() {
<a name="l01442"></a>01442     $fb = <span class="keyword">new</span> <a class="code" href="classPersistentFBPublic.html">PersistentFBPublic</a>(array(
<a name="l01443"></a>01443       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01444"></a>01444       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l01445"></a>01445     ));
<a name="l01446"></a>01446     $key = <span class="stringliteral">&#39;state&#39;</span>;
<a name="l01447"></a>01447     $val = <span class="stringliteral">&#39;foo&#39;</span>;
<a name="l01448"></a>01448     $fb-&gt;publicSetPersistentData($key, $val);
<a name="l01449"></a>01449     $this-&gt;assertEquals(
<a name="l01450"></a>01450       $val,
<a name="l01451"></a>01451       <a class="code" href="session_8php.html#ad56c24858a88af52e4da3ae2f6a2b3b0">$_SESSION</a>[sprintf(<span class="stringliteral">&#39;fb_%s_%s&#39;</span>, self::APP_ID, $key)]
<a name="l01452"></a>01452     );
<a name="l01453"></a>01453     $this-&gt;assertEquals(
<a name="l01454"></a>01454       $val,
<a name="l01455"></a>01455       $fb-&gt;publicGetPersistentData($key)
<a name="l01456"></a>01456     );
<a name="l01457"></a>01457     $fb-&gt;publicClearPersistentData($key);
<a name="l01458"></a>01458     $this-&gt;assertFalse(
<a name="l01459"></a>01459       array_key_exists(
<a name="l01460"></a>01460         sprintf(<span class="stringliteral">&#39;fb_%s_%s&#39;</span>, self::APP_ID, $key),
<a name="l01461"></a>01461         <a class="code" href="session_8php.html#ad56c24858a88af52e4da3ae2f6a2b3b0">$_SESSION</a>
<a name="l01462"></a>01462       )
<a name="l01463"></a>01463     );
<a name="l01464"></a>01464     $this-&gt;assertFalse($fb-&gt;publicGetPersistentData($key));
<a name="l01465"></a>01465   }
<a name="l01466"></a>01466 
<a name="l01467"></a><a class="code" href="classPHPSDKTestCase.html#a8669007a82797e538d71285062ef922f">01467</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a8669007a82797e538d71285062ef922f">testSessionBackedFacebookIgnoresUnsupportedKeyInClear</a>() {
<a name="l01468"></a>01468     $fb = <span class="keyword">new</span> <a class="code" href="classPersistentFBPublic.html">PersistentFBPublic</a>(array(
<a name="l01469"></a>01469       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01470"></a>01470       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l01471"></a>01471     ));
<a name="l01472"></a>01472     $key = <span class="stringliteral">&#39;--invalid--&#39;</span>;
<a name="l01473"></a>01473     $val = <span class="stringliteral">&#39;foo&#39;</span>;
<a name="l01474"></a>01474     $session_var_name = sprintf(<span class="stringliteral">&#39;fb_%s_%s&#39;</span>, self::APP_ID, $key);
<a name="l01475"></a>01475     <a class="code" href="session_8php.html#ad56c24858a88af52e4da3ae2f6a2b3b0">$_SESSION</a>[$session_var_name] = $val;
<a name="l01476"></a>01476     $fb-&gt;publicClearPersistentData($key);
<a name="l01477"></a>01477     $this-&gt;assertTrue(array_key_exists($session_var_name, <a class="code" href="session_8php.html#ad56c24858a88af52e4da3ae2f6a2b3b0">$_SESSION</a>));
<a name="l01478"></a>01478     $this-&gt;assertFalse($fb-&gt;publicGetPersistentData($key));
<a name="l01479"></a>01479   }
<a name="l01480"></a>01480 
<a name="l01481"></a><a class="code" href="classPHPSDKTestCase.html#aa4e705ef2f9d8cc54d60a7defe386fb5">01481</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#aa4e705ef2f9d8cc54d60a7defe386fb5">testClearAllSessionBackedFacebook</a>() {
<a name="l01482"></a>01482     $fb = <span class="keyword">new</span> <a class="code" href="classPersistentFBPublic.html">PersistentFBPublic</a>(array(
<a name="l01483"></a>01483       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01484"></a>01484       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l01485"></a>01485     ));
<a name="l01486"></a>01486     $key = <span class="stringliteral">&#39;state&#39;</span>;
<a name="l01487"></a>01487     $val = <span class="stringliteral">&#39;foo&#39;</span>;
<a name="l01488"></a>01488     $session_var_name = sprintf(<span class="stringliteral">&#39;fb_%s_%s&#39;</span>, self::APP_ID, $key);
<a name="l01489"></a>01489     $fb-&gt;publicSetPersistentData($key, $val);
<a name="l01490"></a>01490     $this-&gt;assertEquals($val, <a class="code" href="session_8php.html#ad56c24858a88af52e4da3ae2f6a2b3b0">$_SESSION</a>[$session_var_name]);
<a name="l01491"></a>01491     $this-&gt;assertEquals($val, $fb-&gt;publicGetPersistentData($key));
<a name="l01492"></a>01492     $fb-&gt;publicClearAllPersistentData();
<a name="l01493"></a>01493     $this-&gt;assertFalse(array_key_exists($session_var_name, <a class="code" href="session_8php.html#ad56c24858a88af52e4da3ae2f6a2b3b0">$_SESSION</a>));
<a name="l01494"></a>01494     $this-&gt;assertFalse($fb-&gt;publicGetPersistentData($key));
<a name="l01495"></a>01495   }
<a name="l01496"></a>01496 
<a name="l01497"></a><a class="code" href="classPHPSDKTestCase.html#aa0ad510cb5d7db6fb845dbf7a67532d5">01497</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#aa0ad510cb5d7db6fb845dbf7a67532d5">testSharedSessionBackedFacebook</a>() {
<a name="l01498"></a>01498     $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>] = <span class="stringliteral">&#39;fbrell.com&#39;</span>;
<a name="l01499"></a>01499     $fb = <span class="keyword">new</span> <a class="code" href="classPersistentFBPublic.html">PersistentFBPublic</a>(array(
<a name="l01500"></a>01500       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01501"></a>01501       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l01502"></a>01502       <span class="stringliteral">&#39;sharedSession&#39;</span> =&gt; <span class="keyword">true</span>,
<a name="l01503"></a>01503     ));
<a name="l01504"></a>01504     $key = <span class="stringliteral">&#39;state&#39;</span>;
<a name="l01505"></a>01505     $val = <span class="stringliteral">&#39;foo&#39;</span>;
<a name="l01506"></a>01506     $session_var_name = sprintf(
<a name="l01507"></a>01507       <span class="stringliteral">&#39;%s_fb_%s_%s&#39;</span>,
<a name="l01508"></a>01508       $fb-&gt;publicGetSharedSessionID(),
<a name="l01509"></a>01509       <a class="code" href="classPHPSDKTestCase.html#a42953a934e7fe71b3071c2776d9df949">self::APP_ID</a>,
<a name="l01510"></a>01510       $key
<a name="l01511"></a>01511     );
<a name="l01512"></a>01512     $fb-&gt;publicSetPersistentData($key, $val);
<a name="l01513"></a>01513     $this-&gt;assertEquals($val, <a class="code" href="session_8php.html#ad56c24858a88af52e4da3ae2f6a2b3b0">$_SESSION</a>[$session_var_name]);
<a name="l01514"></a>01514     $this-&gt;assertEquals($val, $fb-&gt;publicGetPersistentData($key));
<a name="l01515"></a>01515   }
<a name="l01516"></a>01516 
<a name="l01517"></a><a class="code" href="classPHPSDKTestCase.html#a2acdef47be22ffc68259da2e4dfaf6c0">01517</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a2acdef47be22ffc68259da2e4dfaf6c0">testSharedSessionBackedFacebookIgnoresUnsupportedKey</a>() {
<a name="l01518"></a>01518     $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>] = <span class="stringliteral">&#39;fbrell.com&#39;</span>;
<a name="l01519"></a>01519     $fb = <span class="keyword">new</span> <a class="code" href="classPersistentFBPublic.html">PersistentFBPublic</a>(array(
<a name="l01520"></a>01520       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01521"></a>01521       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l01522"></a>01522       <span class="stringliteral">&#39;sharedSession&#39;</span> =&gt; <span class="keyword">true</span>,
<a name="l01523"></a>01523     ));
<a name="l01524"></a>01524     $key = <span class="stringliteral">&#39;--invalid--&#39;</span>;
<a name="l01525"></a>01525     $val = <span class="stringliteral">&#39;foo&#39;</span>;
<a name="l01526"></a>01526     $session_var_name = sprintf(
<a name="l01527"></a>01527       <span class="stringliteral">&#39;%s_fb_%s_%s&#39;</span>,
<a name="l01528"></a>01528       $fb-&gt;publicGetSharedSessionID(),
<a name="l01529"></a>01529       <a class="code" href="classPHPSDKTestCase.html#a42953a934e7fe71b3071c2776d9df949">self::APP_ID</a>,
<a name="l01530"></a>01530       $key
<a name="l01531"></a>01531     );
<a name="l01532"></a>01532     $fb-&gt;publicSetPersistentData($key, $val);
<a name="l01533"></a>01533     $this-&gt;assertFalse(array_key_exists($session_var_name, <a class="code" href="session_8php.html#ad56c24858a88af52e4da3ae2f6a2b3b0">$_SESSION</a>));
<a name="l01534"></a>01534     $this-&gt;assertFalse($fb-&gt;publicGetPersistentData($key));
<a name="l01535"></a>01535   }
<a name="l01536"></a>01536 
<a name="l01537"></a><a class="code" href="classPHPSDKTestCase.html#a886b5ab058a6ef6e1200f115213fbf64">01537</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a886b5ab058a6ef6e1200f115213fbf64">testSharedClearSessionBackedFacebook</a>() {
<a name="l01538"></a>01538     $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>] = <span class="stringliteral">&#39;fbrell.com&#39;</span>;
<a name="l01539"></a>01539     $fb = <span class="keyword">new</span> <a class="code" href="classPersistentFBPublic.html">PersistentFBPublic</a>(array(
<a name="l01540"></a>01540       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01541"></a>01541       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l01542"></a>01542       <span class="stringliteral">&#39;sharedSession&#39;</span> =&gt; <span class="keyword">true</span>,
<a name="l01543"></a>01543     ));
<a name="l01544"></a>01544     $key = <span class="stringliteral">&#39;state&#39;</span>;
<a name="l01545"></a>01545     $val = <span class="stringliteral">&#39;foo&#39;</span>;
<a name="l01546"></a>01546     $session_var_name = sprintf(
<a name="l01547"></a>01547       <span class="stringliteral">&#39;%s_fb_%s_%s&#39;</span>,
<a name="l01548"></a>01548       $fb-&gt;publicGetSharedSessionID(),
<a name="l01549"></a>01549       <a class="code" href="classPHPSDKTestCase.html#a42953a934e7fe71b3071c2776d9df949">self::APP_ID</a>,
<a name="l01550"></a>01550       $key
<a name="l01551"></a>01551     );
<a name="l01552"></a>01552     $fb-&gt;publicSetPersistentData($key, $val);
<a name="l01553"></a>01553     $this-&gt;assertEquals($val, <a class="code" href="session_8php.html#ad56c24858a88af52e4da3ae2f6a2b3b0">$_SESSION</a>[$session_var_name]);
<a name="l01554"></a>01554     $this-&gt;assertEquals($val, $fb-&gt;publicGetPersistentData($key));
<a name="l01555"></a>01555     $fb-&gt;publicClearPersistentData($key);
<a name="l01556"></a>01556     $this-&gt;assertFalse(array_key_exists($session_var_name, <a class="code" href="session_8php.html#ad56c24858a88af52e4da3ae2f6a2b3b0">$_SESSION</a>));
<a name="l01557"></a>01557     $this-&gt;assertFalse($fb-&gt;publicGetPersistentData($key));
<a name="l01558"></a>01558   }
<a name="l01559"></a>01559 
<a name="l01560"></a><a class="code" href="classPHPSDKTestCase.html#a6c82faa9b735cddde60a5899830cb4a8">01560</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a6c82faa9b735cddde60a5899830cb4a8">testSharedSessionBackedFacebookIgnoresUnsupportedKeyInClear</a>() {
<a name="l01561"></a>01561     $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>] = <span class="stringliteral">&#39;fbrell.com&#39;</span>;
<a name="l01562"></a>01562     $fb = <span class="keyword">new</span> <a class="code" href="classPersistentFBPublic.html">PersistentFBPublic</a>(array(
<a name="l01563"></a>01563       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01564"></a>01564       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l01565"></a>01565       <span class="stringliteral">&#39;sharedSession&#39;</span> =&gt; <span class="keyword">true</span>,
<a name="l01566"></a>01566     ));
<a name="l01567"></a>01567     $key = <span class="stringliteral">&#39;--invalid--&#39;</span>;
<a name="l01568"></a>01568     $val = <span class="stringliteral">&#39;foo&#39;</span>;
<a name="l01569"></a>01569     $session_var_name = sprintf(
<a name="l01570"></a>01570       <span class="stringliteral">&#39;%s_fb_%s_%s&#39;</span>,
<a name="l01571"></a>01571       $fb-&gt;publicGetSharedSessionID(),
<a name="l01572"></a>01572       <a class="code" href="classPHPSDKTestCase.html#a42953a934e7fe71b3071c2776d9df949">self::APP_ID</a>,
<a name="l01573"></a>01573       $key
<a name="l01574"></a>01574     );
<a name="l01575"></a>01575     <a class="code" href="session_8php.html#ad56c24858a88af52e4da3ae2f6a2b3b0">$_SESSION</a>[$session_var_name] = $val;
<a name="l01576"></a>01576     $fb-&gt;publicClearPersistentData($key);
<a name="l01577"></a>01577     $this-&gt;assertTrue(array_key_exists($session_var_name, $_SESSION));
<a name="l01578"></a>01578     $this-&gt;assertFalse($fb-&gt;publicGetPersistentData($key));
<a name="l01579"></a>01579   }
<a name="l01580"></a>01580 
<a name="l01581"></a><a class="code" href="classPHPSDKTestCase.html#af31d8da1c62feff0fb4d36278fc24a18">01581</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#af31d8da1c62feff0fb4d36278fc24a18">testSharedClearAllSessionBackedFacebook</a>() {
<a name="l01582"></a>01582     $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>] = <span class="stringliteral">&#39;fbrell.com&#39;</span>;
<a name="l01583"></a>01583     $fb = <span class="keyword">new</span> <a class="code" href="classPersistentFBPublic.html">PersistentFBPublic</a>(array(
<a name="l01584"></a>01584       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01585"></a>01585       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l01586"></a>01586       <span class="stringliteral">&#39;sharedSession&#39;</span> =&gt; <span class="keyword">true</span>,
<a name="l01587"></a>01587     ));
<a name="l01588"></a>01588     $key = <span class="stringliteral">&#39;state&#39;</span>;
<a name="l01589"></a>01589     $val = <span class="stringliteral">&#39;foo&#39;</span>;
<a name="l01590"></a>01590     $session_var_name = sprintf(
<a name="l01591"></a>01591       <span class="stringliteral">&#39;%s_fb_%s_%s&#39;</span>,
<a name="l01592"></a>01592       $fb-&gt;publicGetSharedSessionID(),
<a name="l01593"></a>01593       <a class="code" href="classPHPSDKTestCase.html#a42953a934e7fe71b3071c2776d9df949">self::APP_ID</a>,
<a name="l01594"></a>01594       $key
<a name="l01595"></a>01595     );
<a name="l01596"></a>01596     $fb-&gt;publicSetPersistentData($key, $val);
<a name="l01597"></a>01597     $this-&gt;assertEquals($val, <a class="code" href="session_8php.html#ad56c24858a88af52e4da3ae2f6a2b3b0">$_SESSION</a>[$session_var_name]);
<a name="l01598"></a>01598     $this-&gt;assertEquals($val, $fb-&gt;publicGetPersistentData($key));
<a name="l01599"></a>01599     $fb-&gt;publicClearAllPersistentData();
<a name="l01600"></a>01600     $this-&gt;assertFalse(array_key_exists($session_var_name, <a class="code" href="session_8php.html#ad56c24858a88af52e4da3ae2f6a2b3b0">$_SESSION</a>));
<a name="l01601"></a>01601     $this-&gt;assertFalse($fb-&gt;publicGetPersistentData($key));
<a name="l01602"></a>01602   }
<a name="l01603"></a>01603 
<a name="l01604"></a><a class="code" href="classPHPSDKTestCase.html#ab05f75be0415d027dac62b8c9dde831a">01604</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#ab05f75be0415d027dac62b8c9dde831a">testSharedSessionBackedFacebookIsRestored</a>() {
<a name="l01605"></a>01605     $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>] = <span class="stringliteral">&#39;fbrell.com&#39;</span>;
<a name="l01606"></a>01606     $fb = <span class="keyword">new</span> <a class="code" href="classPersistentFBPublic.html">PersistentFBPublic</a>(array(
<a name="l01607"></a>01607       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01608"></a>01608       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l01609"></a>01609       <span class="stringliteral">&#39;sharedSession&#39;</span> =&gt; <span class="keyword">true</span>,
<a name="l01610"></a>01610     ));
<a name="l01611"></a>01611     $key = <span class="stringliteral">&#39;state&#39;</span>;
<a name="l01612"></a>01612     $val = <span class="stringliteral">&#39;foo&#39;</span>;
<a name="l01613"></a>01613     $shared_session_id = $fb-&gt;publicGetSharedSessionID();
<a name="l01614"></a>01614     $session_var_name = sprintf(
<a name="l01615"></a>01615       <span class="stringliteral">&#39;%s_fb_%s_%s&#39;</span>,
<a name="l01616"></a>01616       $shared_session_id,
<a name="l01617"></a>01617       self::APP_ID,
<a name="l01618"></a>01618       $key
<a name="l01619"></a>01619     );
<a name="l01620"></a>01620     $fb-&gt;publicSetPersistentData($key, $val);
<a name="l01621"></a>01621     $this-&gt;assertEquals($val, <a class="code" href="session_8php.html#ad56c24858a88af52e4da3ae2f6a2b3b0">$_SESSION</a>[$session_var_name]);
<a name="l01622"></a>01622     $this-&gt;assertEquals($val, $fb-&gt;publicGetPersistentData($key));
<a name="l01623"></a>01623 
<a name="l01624"></a>01624     <span class="comment">// check the new instance has the same data</span>
<a name="l01625"></a>01625     $fb = <span class="keyword">new</span> <a class="code" href="classPersistentFBPublic.html">PersistentFBPublic</a>(array(
<a name="l01626"></a>01626       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01627"></a>01627       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l01628"></a>01628       <span class="stringliteral">&#39;sharedSession&#39;</span> =&gt; <span class="keyword">true</span>,
<a name="l01629"></a>01629     ));
<a name="l01630"></a>01630     $this-&gt;assertEquals(
<a name="l01631"></a>01631       $shared_session_id,
<a name="l01632"></a>01632       $fb-&gt;publicGetSharedSessionID()
<a name="l01633"></a>01633     );
<a name="l01634"></a>01634     $this-&gt;assertEquals($val, $fb-&gt;publicGetPersistentData($key));
<a name="l01635"></a>01635   }
<a name="l01636"></a>01636 
<a name="l01637"></a><a class="code" href="classPHPSDKTestCase.html#abd4f66d6d3227bbba01caddf92087b00">01637</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#abd4f66d6d3227bbba01caddf92087b00">testSharedSessionBackedFacebookIsNotRestoredWhenCorrupt</a>() {
<a name="l01638"></a>01638     $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>] = <span class="stringliteral">&#39;fbrell.com&#39;</span>;
<a name="l01639"></a>01639     $fb = <span class="keyword">new</span> <a class="code" href="classPersistentFBPublic.html">PersistentFBPublic</a>(array(
<a name="l01640"></a>01640       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01641"></a>01641       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l01642"></a>01642       <span class="stringliteral">&#39;sharedSession&#39;</span> =&gt; <span class="keyword">true</span>,
<a name="l01643"></a>01643     ));
<a name="l01644"></a>01644     $key = <span class="stringliteral">&#39;state&#39;</span>;
<a name="l01645"></a>01645     $val = <span class="stringliteral">&#39;foo&#39;</span>;
<a name="l01646"></a>01646     $shared_session_id = $fb-&gt;publicGetSharedSessionID();
<a name="l01647"></a>01647     $session_var_name = sprintf(
<a name="l01648"></a>01648       <span class="stringliteral">&#39;%s_fb_%s_%s&#39;</span>,
<a name="l01649"></a>01649       $shared_session_id,
<a name="l01650"></a>01650       self::APP_ID,
<a name="l01651"></a>01651       $key
<a name="l01652"></a>01652     );
<a name="l01653"></a>01653     $fb-&gt;publicSetPersistentData($key, $val);
<a name="l01654"></a>01654     $this-&gt;assertEquals($val, <a class="code" href="session_8php.html#ad56c24858a88af52e4da3ae2f6a2b3b0">$_SESSION</a>[$session_var_name]);
<a name="l01655"></a>01655     $this-&gt;assertEquals($val, $fb-&gt;publicGetPersistentData($key));
<a name="l01656"></a>01656 
<a name="l01657"></a>01657     <span class="comment">// break the cookie</span>
<a name="l01658"></a>01658     $cookie_name = $fb-&gt;publicGetSharedSessionCookieName();
<a name="l01659"></a>01659     $_COOKIE[$cookie_name] = substr($_COOKIE[$cookie_name], 1);
<a name="l01660"></a>01660 
<a name="l01661"></a>01661     <span class="comment">// check the new instance does not have the data</span>
<a name="l01662"></a>01662     $fb = <span class="keyword">new</span> <a class="code" href="classPersistentFBPublic.html">PersistentFBPublic</a>(array(
<a name="l01663"></a>01663       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01664"></a>01664       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l01665"></a>01665       <span class="stringliteral">&#39;sharedSession&#39;</span> =&gt; <span class="keyword">true</span>,
<a name="l01666"></a>01666     ));
<a name="l01667"></a>01667     $this-&gt;assertFalse($fb-&gt;publicGetPersistentData($key));
<a name="l01668"></a>01668     $this-&gt;assertNotEquals(
<a name="l01669"></a>01669       $shared_session_id,
<a name="l01670"></a>01670       $fb-&gt;publicGetSharedSessionID()
<a name="l01671"></a>01671     );
<a name="l01672"></a>01672   }
<a name="l01673"></a>01673 
<a name="l01674"></a><a class="code" href="classPHPSDKTestCase.html#a89dadf8f28fb86a99da4d2788f54038c">01674</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a89dadf8f28fb86a99da4d2788f54038c">testHttpHost</a>() {
<a name="l01675"></a>01675     $real = <span class="stringliteral">&#39;foo.com&#39;</span>;
<a name="l01676"></a>01676     $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>] = $real;
<a name="l01677"></a>01677     $_SERVER[<span class="stringliteral">&#39;HTTP_X_FORWARDED_HOST&#39;</span>] = <span class="stringliteral">&#39;evil.com&#39;</span>;
<a name="l01678"></a>01678     $fb = <span class="keyword">new</span> <a class="code" href="classPersistentFBPublic.html">PersistentFBPublic</a>(array(
<a name="l01679"></a>01679       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01680"></a>01680       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l01681"></a>01681     ));
<a name="l01682"></a>01682     $this-&gt;assertEquals($real, $fb-&gt;publicGetHttpHost());
<a name="l01683"></a>01683   }
<a name="l01684"></a>01684 
<a name="l01685"></a><a class="code" href="classPHPSDKTestCase.html#af46e4a32798c96379fe3be70dd963288">01685</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#af46e4a32798c96379fe3be70dd963288">testHttpProtocol</a>() {
<a name="l01686"></a>01686     $_SERVER[<span class="stringliteral">&#39;HTTPS&#39;</span>] = <span class="stringliteral">&#39;on&#39;</span>;
<a name="l01687"></a>01687     $_SERVER[<span class="stringliteral">&#39;HTTP_X_FORWARDED_PROTO&#39;</span>] = <span class="stringliteral">&#39;http&#39;</span>;
<a name="l01688"></a>01688     $fb = <span class="keyword">new</span> <a class="code" href="classPersistentFBPublic.html">PersistentFBPublic</a>(array(
<a name="l01689"></a>01689       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01690"></a>01690       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l01691"></a>01691     ));
<a name="l01692"></a>01692     $this-&gt;assertEquals(<span class="stringliteral">&#39;https&#39;</span>, $fb-&gt;publicGetHttpProtocol());
<a name="l01693"></a>01693   }
<a name="l01694"></a>01694 
<a name="l01695"></a><a class="code" href="classPHPSDKTestCase.html#ac636302133175c5a9de8251eff315012">01695</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#ac636302133175c5a9de8251eff315012">testHttpHostForwarded</a>() {
<a name="l01696"></a>01696     $real = <span class="stringliteral">&#39;foo.com&#39;</span>;
<a name="l01697"></a>01697     $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>] = <span class="stringliteral">&#39;localhost&#39;</span>;
<a name="l01698"></a>01698     $_SERVER[<span class="stringliteral">&#39;HTTP_X_FORWARDED_HOST&#39;</span>] = $real;
<a name="l01699"></a>01699     $fb = <span class="keyword">new</span> <a class="code" href="classPersistentFBPublic.html">PersistentFBPublic</a>(array(
<a name="l01700"></a>01700       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01701"></a>01701       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l01702"></a>01702       <span class="stringliteral">&#39;trustForwarded&#39;</span> =&gt; <span class="keyword">true</span>,
<a name="l01703"></a>01703     ));
<a name="l01704"></a>01704     $this-&gt;assertEquals($real, $fb-&gt;publicGetHttpHost());
<a name="l01705"></a>01705   }
<a name="l01706"></a>01706 
<a name="l01707"></a><a class="code" href="classPHPSDKTestCase.html#a7bcd75da794dc51a648c98d31e3aa720">01707</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a7bcd75da794dc51a648c98d31e3aa720">testHttpProtocolForwarded</a>() {
<a name="l01708"></a>01708     $_SERVER[<span class="stringliteral">&#39;HTTPS&#39;</span>] = <span class="stringliteral">&#39;on&#39;</span>;
<a name="l01709"></a>01709     $_SERVER[<span class="stringliteral">&#39;HTTP_X_FORWARDED_PROTO&#39;</span>] = <span class="stringliteral">&#39;http&#39;</span>;
<a name="l01710"></a>01710     $fb = <span class="keyword">new</span> <a class="code" href="classPersistentFBPublic.html">PersistentFBPublic</a>(array(
<a name="l01711"></a>01711       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01712"></a>01712       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l01713"></a>01713       <span class="stringliteral">&#39;trustForwarded&#39;</span> =&gt; <span class="keyword">true</span>,
<a name="l01714"></a>01714     ));
<a name="l01715"></a>01715     $this-&gt;assertEquals(<span class="stringliteral">&#39;http&#39;</span>, $fb-&gt;publicGetHttpProtocol());
<a name="l01716"></a>01716   }
<a name="l01717"></a>01717 
<a name="l01718"></a><a class="code" href="classPHPSDKTestCase.html#a26309b9367d7744c185f81f669676b42">01718</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a26309b9367d7744c185f81f669676b42">testHttpProtocolForwardedSecure</a>() {
<a name="l01719"></a>01719     $_SERVER[<span class="stringliteral">&#39;HTTPS&#39;</span>] = <span class="stringliteral">&#39;on&#39;</span>;
<a name="l01720"></a>01720     $_SERVER[<span class="stringliteral">&#39;HTTP_X_FORWARDED_PROTO&#39;</span>] = <span class="stringliteral">&#39;https&#39;</span>;
<a name="l01721"></a>01721     $fb = <span class="keyword">new</span> <a class="code" href="classPersistentFBPublic.html">PersistentFBPublic</a>(array(
<a name="l01722"></a>01722       <span class="stringliteral">&#39;appId&#39;</span>  =&gt; self::APP_ID,
<a name="l01723"></a>01723       <span class="stringliteral">&#39;secret&#39;</span> =&gt; self::SECRET,
<a name="l01724"></a>01724       <span class="stringliteral">&#39;trustForwarded&#39;</span> =&gt; <span class="keyword">true</span>,
<a name="l01725"></a>01725     ));
<a name="l01726"></a>01726     $this-&gt;assertEquals(<span class="stringliteral">&#39;https&#39;</span>, $fb-&gt;publicGetHttpProtocol());
<a name="l01727"></a>01727   }
<a name="l01728"></a>01728 <span class="comment"></span>
<a name="l01729"></a>01729 <span class="comment">  /**</span>
<a name="l01730"></a>01730 <span class="comment">   * @dataProvider provideEndsWith</span>
<a name="l01731"></a>01731 <span class="comment">   */</span>
<a name="l01732"></a><a class="code" href="classPHPSDKTestCase.html#a0d37a6b1b0f3808619cb56ff51d6c034">01732</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a0d37a6b1b0f3808619cb56ff51d6c034" title="provideEndsWith">testEndsWith</a>($big, $small, <a class="code" href="link__out_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>) {
<a name="l01733"></a>01733     $this-&gt;assertEquals(
<a name="l01734"></a>01734       <a class="code" href="link__out_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>,
<a name="l01735"></a>01735       <a class="code" href="classPersistentFBPublic.html#a2626c8e1bdfbb5482725e80a95399e05">PersistentFBPublic::publicEndsWith</a>($big, $small)
<a name="l01736"></a>01736     );
<a name="l01737"></a>01737   }
<a name="l01738"></a>01738 
<a name="l01739"></a><a class="code" href="classPHPSDKTestCase.html#a3f9755abfaeb22e5a178209b15d5e842">01739</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a3f9755abfaeb22e5a178209b15d5e842">provideEndsWith</a>() {
<a name="l01740"></a>01740     <span class="keywordflow">return</span> array(
<a name="l01741"></a>01741       array(<span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, <span class="keyword">true</span>),
<a name="l01742"></a>01742       array(<span class="stringliteral">&#39;&#39;</span>, <span class="charliteral">&#39;a&#39;</span>, <span class="keyword">false</span>),
<a name="l01743"></a>01743       array(<span class="charliteral">&#39;a&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, <span class="keyword">true</span>),
<a name="l01744"></a>01744       array(<span class="charliteral">&#39;a&#39;</span>, <span class="charliteral">&#39;b&#39;</span>, <span class="keyword">false</span>),
<a name="l01745"></a>01745       array(<span class="charliteral">&#39;a&#39;</span>, <span class="charliteral">&#39;a&#39;</span>, <span class="keyword">true</span>),
<a name="l01746"></a>01746       array(<span class="stringliteral">&#39;aa&#39;</span>, <span class="charliteral">&#39;a&#39;</span>, <span class="keyword">true</span>),
<a name="l01747"></a>01747       array(<span class="stringliteral">&#39;ab&#39;</span>, <span class="charliteral">&#39;a&#39;</span>, <span class="keyword">false</span>),
<a name="l01748"></a>01748       array(<span class="stringliteral">&#39;ba&#39;</span>, <span class="charliteral">&#39;a&#39;</span>, <span class="keyword">true</span>),
<a name="l01749"></a>01749     );
<a name="l01750"></a>01750   }
<a name="l01751"></a>01751 <span class="comment"></span>
<a name="l01752"></a>01752 <span class="comment">  /**</span>
<a name="l01753"></a>01753 <span class="comment">   * @dataProvider provideIsAllowedDomain</span>
<a name="l01754"></a>01754 <span class="comment">   */</span>
<a name="l01755"></a><a class="code" href="classPHPSDKTestCase.html#aff74ded41540e5ec4a32e7656acbe928">01755</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#aff74ded41540e5ec4a32e7656acbe928" title="provideIsAllowedDomain">testIsAllowedDomain</a>($big, $small, <a class="code" href="link__out_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>) {
<a name="l01756"></a>01756     $this-&gt;assertEquals(
<a name="l01757"></a>01757       <a class="code" href="link__out_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>,
<a name="l01758"></a>01758       <a class="code" href="classPersistentFBPublic.html#a31b29a37bcadfc18e9623146fbc4fda2">PersistentFBPublic::publicIsAllowedDomain</a>($big, $small)
<a name="l01759"></a>01759     );
<a name="l01760"></a>01760   }
<a name="l01761"></a>01761 
<a name="l01762"></a><a class="code" href="classPHPSDKTestCase.html#a52d73196c325cd233320d3e75dad22fa">01762</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a52d73196c325cd233320d3e75dad22fa">provideIsAllowedDomain</a>() {
<a name="l01763"></a>01763     <span class="keywordflow">return</span> array(
<a name="l01764"></a>01764       array(<span class="stringliteral">&#39;fbrell.com&#39;</span>, <span class="stringliteral">&#39;fbrell.com&#39;</span>, <span class="keyword">true</span>),
<a name="l01765"></a>01765       array(<span class="stringliteral">&#39;foo.fbrell.com&#39;</span>, <span class="stringliteral">&#39;fbrell.com&#39;</span>, <span class="keyword">true</span>),
<a name="l01766"></a>01766       array(<span class="stringliteral">&#39;foofbrell.com&#39;</span>, <span class="stringliteral">&#39;fbrell.com&#39;</span>, <span class="keyword">false</span>),
<a name="l01767"></a>01767       array(<span class="stringliteral">&#39;evil.com&#39;</span>, <span class="stringliteral">&#39;fbrell.com&#39;</span>, <span class="keyword">false</span>),
<a name="l01768"></a>01768       array(<span class="stringliteral">&#39;foo.fbrell.com&#39;</span>, <span class="stringliteral">&#39;bar.fbrell.com&#39;</span>, <span class="keyword">false</span>),
<a name="l01769"></a>01769     );
<a name="l01770"></a>01770   }
<a name="l01771"></a>01771 
<a name="l01772"></a><a class="code" href="classPHPSDKTestCase.html#aa20695a503ea8ec7379627444fb58178">01772</a>   <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#aa20695a503ea8ec7379627444fb58178">generateMD5HashOfRandomValue</a>() {
<a name="l01773"></a>01773     <span class="keywordflow">return</span> md5(uniqid(mt_rand(), <span class="keyword">true</span>));
<a name="l01774"></a>01774   }
<a name="l01775"></a>01775 
<a name="l01776"></a><a class="code" href="classPHPSDKTestCase.html#a66142e68c04271ff37150f2dcf180a9f">01776</a>   <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a66142e68c04271ff37150f2dcf180a9f">setUp</a>() {
<a name="l01777"></a>01777     <a class="code" href="classPHPSDKTestCase.html#a66142e68c04271ff37150f2dcf180a9f">parent::setUp</a>();
<a name="l01778"></a>01778   }
<a name="l01779"></a>01779 
<a name="l01780"></a><a class="code" href="classPHPSDKTestCase.html#a84b379cc54c24dcb1f8deb2c5b08827d">01780</a>   <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a84b379cc54c24dcb1f8deb2c5b08827d">tearDown</a>() {
<a name="l01781"></a>01781     $this-&gt;<a class="code" href="classPHPSDKTestCase.html#a3809a78e0339db2e66ed31413d092b8f">clearSuperGlobals</a>();
<a name="l01782"></a>01782     <a class="code" href="classPHPSDKTestCase.html#a84b379cc54c24dcb1f8deb2c5b08827d">parent::tearDown</a>();
<a name="l01783"></a>01783   }
<a name="l01784"></a>01784 
<a name="l01785"></a><a class="code" href="classPHPSDKTestCase.html#a3809a78e0339db2e66ed31413d092b8f">01785</a>   <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#a3809a78e0339db2e66ed31413d092b8f">clearSuperGlobals</a>() {
<a name="l01786"></a>01786     unset($_SERVER[<span class="stringliteral">&#39;HTTPS&#39;</span>]);
<a name="l01787"></a>01787     unset($_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>]);
<a name="l01788"></a>01788     unset($_SERVER[<span class="stringliteral">&#39;REQUEST_URI&#39;</span>]);
<a name="l01789"></a>01789     <a class="code" href="session_8php.html#ad56c24858a88af52e4da3ae2f6a2b3b0">$_SESSION</a> = array();
<a name="l01790"></a>01790     $_COOKIE = array();
<a name="l01791"></a>01791     $_REQUEST = array();
<a name="l01792"></a>01792     $_POST = array();
<a name="l01793"></a>01793     $_GET = array();
<a name="l01794"></a>01794     <span class="keywordflow">if</span> (session_id()) {
<a name="l01795"></a>01795       session_destroy();
<a name="l01796"></a>01796     }
<a name="l01797"></a>01797   }
<a name="l01798"></a>01798 <span class="comment"></span>
<a name="l01799"></a>01799 <span class="comment">  /**</span>
<a name="l01800"></a>01800 <span class="comment">   * Checks that the correct args are a subset of the returned obj</span>
<a name="l01801"></a>01801 <span class="comment">   * @param  array $correct The correct array values</span>
<a name="l01802"></a>01802 <span class="comment">   * @param  array $actual  The values in practice</span>
<a name="l01803"></a>01803 <span class="comment">   * @param  string $message to be shown on failure</span>
<a name="l01804"></a>01804 <span class="comment">   */</span>
<a name="l01805"></a><a class="code" href="classPHPSDKTestCase.html#aa2fa68d8c85c185cae89c19403408f15">01805</a>   <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classPHPSDKTestCase.html#aa2fa68d8c85c185cae89c19403408f15" title="Checks that the correct args are a subset of the returned obj.">assertIsSubset</a>($correct, $actual, $msg=<span class="stringliteral">&#39;&#39;</span>) {
<a name="l01806"></a>01806     <span class="keywordflow">foreach</span> ($correct as $key =&gt; $value) {
<a name="l01807"></a>01807       $actual_value = $actual[$key];
<a name="l01808"></a>01808       $newMsg = (strlen($msg) ? ($msg.<span class="charliteral">&#39; &#39;</span>) : <span class="stringliteral">&#39;&#39;</span>).<span class="stringliteral">&#39;Key: &#39;</span>.$key;
<a name="l01809"></a>01809       $this-&gt;assertEquals($value, $actual_value, $newMsg);
<a name="l01810"></a>01810     }
<a name="l01811"></a>01811   }
<a name="l01812"></a>01812 }
<a name="l01813"></a>01813 
<a name="l01814"></a><a class="code" href="classTransientFacebook.html">01814</a> <span class="keyword">class </span><a class="code" href="classTransientFacebook.html">TransientFacebook</a> <span class="keyword">extends</span> <a class="code" href="classBaseFacebook.html" title="Provides access to the Facebook Platform.">BaseFacebook</a> {
<a name="l01815"></a><a class="code" href="classTransientFacebook.html#af59a1c6a33ece992311a1a97b7849805">01815</a>   <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classTransientFacebook.html#af59a1c6a33ece992311a1a97b7849805" title="Each of the following four methods should be overridden in a concrete subclass, as they are in the pr...">setPersistentData</a>($key, $value) {}
<a name="l01816"></a><a class="code" href="classTransientFacebook.html#a7b8591652ca1a85f03647acbff9e4382">01816</a>   <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classTransientFacebook.html#a7b8591652ca1a85f03647acbff9e4382" title="Get the data for $key, persisted by BaseFacebook::setPersistentData()">getPersistentData</a>($key, $default = <span class="keyword">false</span>) {
<a name="l01817"></a>01817     <span class="keywordflow">return</span> $default;
<a name="l01818"></a>01818   }
<a name="l01819"></a><a class="code" href="classTransientFacebook.html#a6bddf7435fc760c097031ff145f1b260">01819</a>   <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classTransientFacebook.html#a6bddf7435fc760c097031ff145f1b260" title="Clear the data with $key from the persistent storage.">clearPersistentData</a>($key) {}
<a name="l01820"></a><a class="code" href="classTransientFacebook.html#a4960fce046dd024daa121c48d84da091">01820</a>   <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classTransientFacebook.html#a4960fce046dd024daa121c48d84da091" title="Clear all data from the persistent storage.">clearAllPersistentData</a>() {}
<a name="l01821"></a>01821 }
<a name="l01822"></a>01822 
<a name="l01823"></a><a class="code" href="classFBRecordURL.html">01823</a> <span class="keyword">class </span><a class="code" href="classFBRecordURL.html">FBRecordURL</a> <span class="keyword">extends</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a> {
<a name="l01824"></a><a class="code" href="classFBRecordURL.html#a6c38e5874d7348a57a112f9f67a651c8">01824</a>   <span class="keyword">private</span> <a class="code" href="classFBRecordURL.html#a6c38e5874d7348a57a112f9f67a651c8">$url</a>;
<a name="l01825"></a>01825 
<a name="l01826"></a><a class="code" href="classFBRecordURL.html#ae81e680a268b7fcb0692ae9b370c2ab4">01826</a>   <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classFBRecordURL.html#ae81e680a268b7fcb0692ae9b370c2ab4" title="Make a OAuth Request.">_oauthRequest</a>(<a class="code" href="classFBRecordURL.html#a6c38e5874d7348a57a112f9f67a651c8">$url</a>, $params) {
<a name="l01827"></a>01827     $this-&gt;url = <a class="code" href="classFBRecordURL.html#a6c38e5874d7348a57a112f9f67a651c8">$url</a>;
<a name="l01828"></a>01828   }
<a name="l01829"></a>01829 
<a name="l01830"></a><a class="code" href="classFBRecordURL.html#a4565c384b9966b4a12f753e6d8648699">01830</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classFBRecordURL.html#a4565c384b9966b4a12f753e6d8648699">getRequestedURL</a>() {
<a name="l01831"></a>01831     <span class="keywordflow">return</span> $this-&gt;url;
<a name="l01832"></a>01832   }
<a name="l01833"></a>01833 }
<a name="l01834"></a>01834 
<a name="l01835"></a><a class="code" href="classFBRecordMakeRequest.html">01835</a> <span class="keyword">class </span><a class="code" href="classFBRecordMakeRequest.html">FBRecordMakeRequest</a> <span class="keyword">extends</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a> {
<a name="l01836"></a><a class="code" href="classFBRecordMakeRequest.html#a6911706c815f6676eb17a95672cb230a">01836</a>   <span class="keyword">private</span> <a class="code" href="classFBRecordMakeRequest.html#a6911706c815f6676eb17a95672cb230a">$requests</a> = array();
<a name="l01837"></a>01837 
<a name="l01838"></a><a class="code" href="classFBRecordMakeRequest.html#a03317f123383834e8c257cbdad64e556">01838</a>   <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classFBRecordMakeRequest.html#a03317f123383834e8c257cbdad64e556" title="Makes an HTTP request.">makeRequest</a>($url, $params, <a class="code" href="sp_8php.html#a696b903bbc5c02914bdd402e91826eca">$ch</a>=null) {
<a name="l01839"></a>01839     $this-&gt;requests[] = array(
<a name="l01840"></a>01840       <span class="stringliteral">&#39;url&#39;</span> =&gt; $url,
<a name="l01841"></a>01841       <span class="stringliteral">&#39;params&#39;</span> =&gt; $params,
<a name="l01842"></a>01842     );
<a name="l01843"></a>01843     <span class="keywordflow">return</span> <a class="code" href="classFBRecordMakeRequest.html#a03317f123383834e8c257cbdad64e556" title="Makes an HTTP request.">parent::makeRequest</a>($url, $params, <a class="code" href="sp_8php.html#a696b903bbc5c02914bdd402e91826eca">$ch</a>);
<a name="l01844"></a>01844   }
<a name="l01845"></a>01845 
<a name="l01846"></a><a class="code" href="classFBRecordMakeRequest.html#a6852682a06ca7d54963770bcc9f6e41e">01846</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classFBRecordMakeRequest.html#a6852682a06ca7d54963770bcc9f6e41e">publicGetRequests</a>() {
<a name="l01847"></a>01847     <span class="keywordflow">return</span> $this-&gt;requests;
<a name="l01848"></a>01848   }
<a name="l01849"></a>01849 }
<a name="l01850"></a>01850 
<a name="l01851"></a><a class="code" href="classFBPublic.html">01851</a> <span class="keyword">class </span><a class="code" href="classFBPublic.html">FBPublic</a> <span class="keyword">extends</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a> {
<a name="l01852"></a><a class="code" href="classFBPublic.html#a355256ea41cd8312f2e9b7e29a8bb89d">01852</a>   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="classFBPublic.html#a355256ea41cd8312f2e9b7e29a8bb89d">publicBase64UrlDecode</a>($input) {
<a name="l01853"></a>01853     <span class="keywordflow">return</span> <a class="code" href="classBaseFacebook.html#a8cb499f186fbbd10b7d30c37094d9b97" title="Base64 encoding that doesn&#39;t need to be urlencode()ed.">self::base64UrlDecode</a>($input);
<a name="l01854"></a>01854   }
<a name="l01855"></a><a class="code" href="classFBPublic.html#aad76f4246afe534ae6caf1a8ac7c670f">01855</a>   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="classFBPublic.html#aad76f4246afe534ae6caf1a8ac7c670f">publicBase64UrlEncode</a>($input) {
<a name="l01856"></a>01856     <span class="keywordflow">return</span> <a class="code" href="classBaseFacebook.html#aa9a23342190c5b2dedfbab5354de6d8b" title="Base64 encoding that doesn&#39;t need to be urlencode()ed.">self::base64UrlEncode</a>($input);
<a name="l01857"></a>01857   }
<a name="l01858"></a><a class="code" href="classFBPublic.html#a5aa7376607b3460d5a1a3cdbd9c63d98">01858</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classFBPublic.html#a5aa7376607b3460d5a1a3cdbd9c63d98">publicParseSignedRequest</a>($input) {
<a name="l01859"></a>01859     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classBaseFacebook.html#a0f155bb002187e66febf73bef11aeb4d" title="Parses a signed_request and validates the signature.">parseSignedRequest</a>($input);
<a name="l01860"></a>01860   }
<a name="l01861"></a><a class="code" href="classFBPublic.html#a48bb7d662d76648df19e2bdc2ab02487">01861</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classFBPublic.html#a48bb7d662d76648df19e2bdc2ab02487">publicMakeSignedRequest</a>(<a class="code" href="adm_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>) {
<a name="l01862"></a>01862     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classBaseFacebook.html#a1b9a10f4e44581553ee4cdc5a28455e1" title="Makes a signed_request blob using the given data.">makeSignedRequest</a>(<a class="code" href="adm_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>);
<a name="l01863"></a>01863   }
<a name="l01864"></a>01864 }
<a name="l01865"></a>01865 
<a name="l01866"></a><a class="code" href="classPersistentFBPublic.html">01866</a> <span class="keyword">class </span><a class="code" href="classPersistentFBPublic.html">PersistentFBPublic</a> <span class="keyword">extends</span> <a class="code" href="classFacebook.html" title="Copyright 2011 Facebook, Inc.">Facebook</a> {
<a name="l01867"></a><a class="code" href="classPersistentFBPublic.html#a46702277ec4586217f15f85f37c99dc4">01867</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPersistentFBPublic.html#a46702277ec4586217f15f85f37c99dc4">publicParseSignedRequest</a>($input) {
<a name="l01868"></a>01868     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classBaseFacebook.html#a0f155bb002187e66febf73bef11aeb4d" title="Parses a signed_request and validates the signature.">parseSignedRequest</a>($input);
<a name="l01869"></a>01869   }
<a name="l01870"></a>01870 
<a name="l01871"></a><a class="code" href="classPersistentFBPublic.html#aa44ad4640453041b9787177566082fee">01871</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPersistentFBPublic.html#aa44ad4640453041b9787177566082fee">publicSetPersistentData</a>($key, $value) {
<a name="l01872"></a>01872     $this-&gt;<a class="code" href="classFacebook.html#a8f094cc1c798c533283018a8100dffdf" title="Provides the implementations of the inherited abstract methods.">setPersistentData</a>($key, $value);
<a name="l01873"></a>01873   }
<a name="l01874"></a>01874 
<a name="l01875"></a><a class="code" href="classPersistentFBPublic.html#a83d5bb2871764d124bb9e4e6f1eabe31">01875</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPersistentFBPublic.html#a83d5bb2871764d124bb9e4e6f1eabe31">publicGetPersistentData</a>($key, $default = <span class="keyword">false</span>) {
<a name="l01876"></a>01876     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classFacebook.html#a87953f6e9607dbd1f669d01c7d4098d0" title="Get the data for $key, persisted by BaseFacebook::setPersistentData()">getPersistentData</a>($key, $default);
<a name="l01877"></a>01877   }
<a name="l01878"></a>01878 
<a name="l01879"></a><a class="code" href="classPersistentFBPublic.html#ac6ed45b8a5717065ecdcd33e90672d0d">01879</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPersistentFBPublic.html#ac6ed45b8a5717065ecdcd33e90672d0d">publicClearPersistentData</a>($key) {
<a name="l01880"></a>01880     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classFacebook.html#a1a953ac1cb01d079715a0922f3e566ac" title="Clear the data with $key from the persistent storage.">clearPersistentData</a>($key);
<a name="l01881"></a>01881   }
<a name="l01882"></a>01882 
<a name="l01883"></a><a class="code" href="classPersistentFBPublic.html#a08e1cf81e885fc870bc8371248e6f27d">01883</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPersistentFBPublic.html#a08e1cf81e885fc870bc8371248e6f27d">publicClearAllPersistentData</a>() {
<a name="l01884"></a>01884     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classFacebook.html#abc8a9a05ccd6ba5905169e775bd5b9fc" title="Clear all data from the persistent storage.">clearAllPersistentData</a>();
<a name="l01885"></a>01885   }
<a name="l01886"></a>01886 
<a name="l01887"></a><a class="code" href="classPersistentFBPublic.html#aa446c2dad94366ae3d25a707bd190028">01887</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPersistentFBPublic.html#aa446c2dad94366ae3d25a707bd190028">publicGetSharedSessionID</a>() {
<a name="l01888"></a>01888     <span class="keywordflow">return</span> $this-&gt;sharedSessionID;
<a name="l01889"></a>01889   }
<a name="l01890"></a>01890 
<a name="l01891"></a><a class="code" href="classPersistentFBPublic.html#a31b29a37bcadfc18e9623146fbc4fda2">01891</a>   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="classPersistentFBPublic.html#a31b29a37bcadfc18e9623146fbc4fda2">publicIsAllowedDomain</a>($big, $small) {
<a name="l01892"></a>01892     <span class="keywordflow">return</span> <a class="code" href="classBaseFacebook.html#af9bbbb9875829d9f0dcbc9eff6524f43">self::isAllowedDomain</a>($big, $small);
<a name="l01893"></a>01893   }
<a name="l01894"></a>01894 
<a name="l01895"></a><a class="code" href="classPersistentFBPublic.html#a2626c8e1bdfbb5482725e80a95399e05">01895</a>   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="classPersistentFBPublic.html#a2626c8e1bdfbb5482725e80a95399e05">publicEndsWith</a>($big, $small) {
<a name="l01896"></a>01896     <span class="keywordflow">return</span> <a class="code" href="classBaseFacebook.html#a3d654f35a132f19cba844cb276bb09f3">self::endsWith</a>($big, $small);
<a name="l01897"></a>01897   }
<a name="l01898"></a>01898 
<a name="l01899"></a><a class="code" href="classPersistentFBPublic.html#ae632685d4c4ae4abc17f9eed7912818f">01899</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPersistentFBPublic.html#ae632685d4c4ae4abc17f9eed7912818f">publicGetSharedSessionCookieName</a>() {
<a name="l01900"></a>01900     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classFacebook.html#acb13e9abc11591d4a7c8b90b84125b32">getSharedSessionCookieName</a>();
<a name="l01901"></a>01901   }
<a name="l01902"></a>01902 
<a name="l01903"></a><a class="code" href="classPersistentFBPublic.html#a56b7d6f3f343b623e542aebeb39e3e11">01903</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPersistentFBPublic.html#a56b7d6f3f343b623e542aebeb39e3e11">publicGetHttpHost</a>() {
<a name="l01904"></a>01904     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classBaseFacebook.html#a5fcf8434f74ce2f5624412f6c076003a">getHttpHost</a>();
<a name="l01905"></a>01905   }
<a name="l01906"></a>01906 
<a name="l01907"></a><a class="code" href="classPersistentFBPublic.html#a2d87a70d47c32d968baee9b80c053d63">01907</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classPersistentFBPublic.html#a2d87a70d47c32d968baee9b80c053d63">publicGetHttpProtocol</a>() {
<a name="l01908"></a>01908     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classBaseFacebook.html#af9abc533c861a43f273e78060460a277">getHttpProtocol</a>();
<a name="l01909"></a>01909   }
<a name="l01910"></a>01910 }
<a name="l01911"></a>01911 
<a name="l01912"></a><a class="code" href="classFBCode.html">01912</a> <span class="keyword">class </span><a class="code" href="classFBCode.html">FBCode</a> <span class="keyword">extends</span> <a class="code" href="classFacebook.html" title="Copyright 2011 Facebook, Inc.">Facebook</a> {
<a name="l01913"></a><a class="code" href="classFBCode.html#abf2c4dc2ed7e822d9b23cd43267b573f">01913</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classFBCode.html#abf2c4dc2ed7e822d9b23cd43267b573f">publicGetCode</a>() {
<a name="l01914"></a>01914     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classBaseFacebook.html#a63452f26d5a4fc7fbcb1732920c1758e" title="Get the authorization code from the query parameters, if it exists, and otherwise return false to sig...">getCode</a>();
<a name="l01915"></a>01915   }
<a name="l01916"></a>01916 
<a name="l01917"></a><a class="code" href="classFBCode.html#a39918078429d9ea2ee73956b41630fa6">01917</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classFBCode.html#a39918078429d9ea2ee73956b41630fa6">setCSRFStateToken</a>() {
<a name="l01918"></a>01918     $this-&gt;<a class="code" href="classBaseFacebook.html#a461a0bb17c1aec841d401983e069f06a" title="Lays down a CSRF state token for this process.">establishCSRFTokenState</a>();
<a name="l01919"></a>01919   }
<a name="l01920"></a>01920 
<a name="l01921"></a><a class="code" href="classFBCode.html#ac1acc2e33d6be7a16d841213bfe6e69a">01921</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classFBCode.html#ac1acc2e33d6be7a16d841213bfe6e69a">getCSRFStateToken</a>() {
<a name="l01922"></a>01922     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classFacebook.html#a87953f6e9607dbd1f669d01c7d4098d0" title="Get the data for $key, persisted by BaseFacebook::setPersistentData()">getPersistentData</a>(<span class="stringliteral">&#39;state&#39;</span>);
<a name="l01923"></a>01923   }
<a name="l01924"></a>01924 }
<a name="l01925"></a>01925 
<a name="l01926"></a><a class="code" href="classFBAccessToken.html">01926</a> <span class="keyword">class </span><a class="code" href="classFBAccessToken.html">FBAccessToken</a> <span class="keyword">extends</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a> {
<a name="l01927"></a><a class="code" href="classFBAccessToken.html#aae04210e69a83359008775a08f2b35dc">01927</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classFBAccessToken.html#aae04210e69a83359008775a08f2b35dc">publicGetApplicationAccessToken</a>() {
<a name="l01928"></a>01928     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classBaseFacebook.html#a18b991618948872f3f350ee088fea74d" title="Returns the access token that should be used for logged out users when no authorization code is avail...">getApplicationAccessToken</a>();
<a name="l01929"></a>01929   }
<a name="l01930"></a>01930 }
<a name="l01931"></a>01931 
<a name="l01932"></a><a class="code" href="classFBGetCurrentURLFacebook.html">01932</a> <span class="keyword">class </span><a class="code" href="classFBGetCurrentURLFacebook.html">FBGetCurrentURLFacebook</a> <span class="keyword">extends</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a> {
<a name="l01933"></a><a class="code" href="classFBGetCurrentURLFacebook.html#a9de3408704de6fadc90f2d84f359deed">01933</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classFBGetCurrentURLFacebook.html#a9de3408704de6fadc90f2d84f359deed">publicGetCurrentUrl</a>() {
<a name="l01934"></a>01934     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classBaseFacebook.html#a5746a277eddefc701ad5308285252465" title="/** Returns the Current URL, stripping it of known FB parameters that should not persist.">getCurrentUrl</a>();
<a name="l01935"></a>01935   }
<a name="l01936"></a>01936 }
<a name="l01937"></a>01937 
<a name="l01938"></a><a class="code" href="classFBPublicCookie.html">01938</a> <span class="keyword">class </span><a class="code" href="classFBPublicCookie.html">FBPublicCookie</a> <span class="keyword">extends</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a> {
<a name="l01939"></a><a class="code" href="classFBPublicCookie.html#a9b0d5c4bedfeedf7f41af913ec5f1ae8">01939</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classFBPublicCookie.html#a9b0d5c4bedfeedf7f41af913ec5f1ae8">publicGetSignedRequest</a>() {
<a name="l01940"></a>01940     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classBaseFacebook.html#adf3c753e09842db169309daf8713d17a" title="Retrieve the signed request, either from a request parameter or, if not present, from a cookie...">getSignedRequest</a>();
<a name="l01941"></a>01941   }
<a name="l01942"></a>01942 
<a name="l01943"></a><a class="code" href="classFBPublicCookie.html#aa4312c56cc8a68b19c2e06883047c1a6">01943</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classFBPublicCookie.html#aa4312c56cc8a68b19c2e06883047c1a6">publicGetSignedRequestCookieName</a>() {
<a name="l01944"></a>01944     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classBaseFacebook.html#a67b1b4b1b2337a342ed03aa0a8f91ec5" title="Constructs and returns the name of the cookie that potentially houses the signed request for the app ...">getSignedRequestCookieName</a>();
<a name="l01945"></a>01945   }
<a name="l01946"></a>01946 
<a name="l01947"></a><a class="code" href="classFBPublicCookie.html#ad3095c7e3209d49b654bf9b18cbbe49c">01947</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classFBPublicCookie.html#ad3095c7e3209d49b654bf9b18cbbe49c">publicGetMetadataCookie</a>() {
<a name="l01948"></a>01948     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classBaseFacebook.html#a934183edea46236610bc661c92747c71" title="Parses the metadata cookie that our Javascript API set.">getMetadataCookie</a>();
<a name="l01949"></a>01949   }
<a name="l01950"></a>01950 
<a name="l01951"></a><a class="code" href="classFBPublicCookie.html#a4d9293176686a89d544cddef6f6967a3">01951</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classFBPublicCookie.html#a4d9293176686a89d544cddef6f6967a3">publicGetMetadataCookieName</a>() {
<a name="l01952"></a>01952     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classBaseFacebook.html#ac73bdb41c831a2176eaea8902fdb7d71" title="Constructs and returns the name of the coookie that potentially contain metadata.">getMetadataCookieName</a>();
<a name="l01953"></a>01953   }
<a name="l01954"></a>01954 }
<a name="l01955"></a>01955 
<a name="l01956"></a>01956 
<a name="l01957"></a><a class="code" href="classFBPublicGetAccessTokenFromCode.html">01957</a> <span class="keyword">class </span><a class="code" href="classFBPublicGetAccessTokenFromCode.html">FBPublicGetAccessTokenFromCode</a> <span class="keyword">extends</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a> {
<a name="l01958"></a><a class="code" href="classFBPublicGetAccessTokenFromCode.html#a41c3f6f15f27fafc6f71b45c382a2ae7">01958</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classFBPublicGetAccessTokenFromCode.html#a41c3f6f15f27fafc6f71b45c382a2ae7">publicGetAccessTokenFromCode</a>($code, $redirect_uri = null) {
<a name="l01959"></a>01959     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classBaseFacebook.html#a5cf64ed0104ccf5267e9cee1e73ed783" title="Retrieves an access token for the given authorization code (previously generated from www...">getAccessTokenFromCode</a>($code, $redirect_uri);
<a name="l01960"></a>01960   }
<a name="l01961"></a>01961 }
<a name="l01962"></a>01962 
<a name="l01963"></a><a class="code" href="classFBPublicState.html">01963</a> <span class="keyword">class </span><a class="code" href="classFBPublicState.html">FBPublicState</a> <span class="keyword">extends</span> <a class="code" href="classTransientFacebook.html">TransientFacebook</a> {
<a name="l01964"></a><a class="code" href="classFBPublicState.html#a66ff1d27e9b452eed6697bf502fa213d">01964</a>   <span class="keyword">const</span> <a class="code" href="classFBPublicState.html#a66ff1d27e9b452eed6697bf502fa213d">STATE</a> = <span class="stringliteral">&#39;foo&#39;</span>;
<a name="l01965"></a><a class="code" href="classFBPublicState.html#a023d9df6dd9b4d4a7ef63300a3aeca35">01965</a>   <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classFBPublicState.html#a023d9df6dd9b4d4a7ef63300a3aeca35" title="Get the data for $key, persisted by BaseFacebook::setPersistentData()">getPersistentData</a>($key, $default = <span class="keyword">false</span>) {
<a name="l01966"></a>01966     <span class="keywordflow">if</span> ($key === <span class="stringliteral">&#39;state&#39;</span>) {
<a name="l01967"></a>01967       <span class="keywordflow">return</span> <a class="code" href="classFBPublicState.html#a66ff1d27e9b452eed6697bf502fa213d">self::STATE</a>;
<a name="l01968"></a>01968     }
<a name="l01969"></a>01969     <span class="keywordflow">return</span> <a class="code" href="classFBPublicState.html#a023d9df6dd9b4d4a7ef63300a3aeca35" title="Get the data for $key, persisted by BaseFacebook::setPersistentData()">parent::getPersistentData</a>($key, $default);
<a name="l01970"></a>01970   }
<a name="l01971"></a>01971 
<a name="l01972"></a><a class="code" href="classFBPublicState.html#a61058ca4542784def3fcd20eb9872d34">01972</a>   <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classFBPublicState.html#a61058ca4542784def3fcd20eb9872d34">publicGetState</a>() {
<a name="l01973"></a>01973     <span class="keywordflow">return</span> $this-&gt;state;
<a name="l01974"></a>01974   }
<a name="l01975"></a>01975 }
</pre></div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="tests_8php.html">tests.php</a>      </li>

    <li class="footer">Generated on Sat Apr 27 2013 13:22:25 for RFSCMSAPIDocumentation by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
